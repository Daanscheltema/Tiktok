"use strict";(self.__LOADABLE_LOADED_CHUNKS__=self.__LOADABLE_LOADED_CHUNKS__||[]).push([[647],{16241:(e,t,i)=>{i.d(t,{g:()=>ze});var n=function(){return(n=Object.assign||function(e){for(var t,i=1,n=arguments.length;i<n;i++)for(var o in t=arguments[i])Object.prototype.hasOwnProperty.call(t,o)&&(e[o]=t[o]);return e}).apply(this,arguments)};function o(e,t){var i="function"==typeof Symbol&&e[Symbol.iterator];if(!i)return e;var n,o,r=i.call(e),a=[];try{for(;(void 0===t||t-- >0)&&!(n=r.next()).done;)a.push(n.value)}catch(e){o={error:e}}finally{try{n&&!n.done&&(i=r.return)&&i.call(r)}finally{if(o)throw o.error}}return a}function r(){for(var e=[],t=0;t<arguments.length;t++)e=e.concat(o(arguments[t]));return e}var a,s,c,l=function(){function e(){this._hooks={},this._cache=[],this._hooksCache={}}return e.prototype.on=function(e,t){e&&t&&"function"==typeof t&&(this._hooks[e]||(this._hooks[e]=[]),this._hooks[e].push(t))},e.prototype.once=function(e,t){var i=this;e&&t&&"function"==typeof t&&this.on(e,function n(o){t(o),i.off(e,n)})},e.prototype.off=function(e,t){if(e&&this._hooks[e]&&this._hooks[e].length)if(t){var i=this._hooks[e].indexOf(t);-1!==i&&this._hooks[e].splice(i,1)}else this._hooks[e]=[]},e.prototype.emit=function(e,t,i){if(i){if(!e)return;-1!==this._cache.indexOf(i)?this._emit(e,t):(this._hooksCache.hasOwnProperty(i)||(this._hooksCache[i]={}),this._hooksCache[i].hasOwnProperty(e)||(this._hooksCache[i][e]=[]),this._hooksCache[i][e].push(t))}else this._emit(e,t)},e.prototype._emit=function(e,t){e&&this._hooks[e]&&this._hooks[e].length&&r(this._hooks[e]).forEach(function(e){try{e(t)}catch(e){}})},e.prototype.set=function(e){e&&-1===this._cache.indexOf(e)&&this._cache.push(e)},e}(),u=function(e){return null!=e&&"[object Object]"==Object.prototype.toString.call(e)},h=function(e){return Array.isArray(e)},d=(a=+Date.now()+Number((""+Math.random()).slice(2,8)),function(){return a+=1}),p=function(e){return function(e,t,i){if("string"==typeof e&&"number"==typeof i){var n,o=[];i=i<=25?i:i%25;var r=String.fromCharCode(i+97);n=e.split(r);for(var a=0;a<n.length;a++){var s=parseInt(n[a],i);s=1*s^64;var c=String.fromCharCode(s);o.push(c)}return o.join("")}}(e,0,25)},f=function(e){navigator.userAgent.match(/\(i[^;]+;( U;)? CPU.+Mac OS X/)?window.addEventListener("pagehide",e,!1):window.addEventListener("beforeunload",e,!1)},g=function(){var e=0;return["hidden","msHidden","webkitHidden"].forEach(function(t){void 0!==document[t]&&(e=1)}),e},_=function(e){var t=document.createElement("a");return t.href=e,t},m=function(e){var t={};try{var i=_(e).search;(i=i.slice(1)).split("&").forEach(function(e){var i,n,o=e.split("=");o.length&&(i=o[0],n=o[1]);try{t[i]=decodeURIComponent(void 0===n?"":n)}catch(e){t[i]=n}})}catch(e){}return t},v=function(e,t){return function(e){var t;t=function(){function e(){for(var e=0,t={};e<arguments.length;e++){var i=arguments[e];for(var n in i)t[n]=i[n]}return t}function t(e){return e.replace(/(%[0-9A-Z]{2})+/g,decodeURIComponent)}return function i(n){function o(){}function r(t,i,r){if("undefined"!=typeof document){"number"==typeof(r=e({path:"/"},o.defaults,r)).expires&&(r.expires=new Date(1*new Date+864e5*r.expires)),r.expires=r.expires?r.expires.toUTCString():"";try{var a=JSON.stringify(i);/^[\{\[]/.test(a)&&(i=a)}catch(e){}i=n.write?n.write(i,t):encodeURIComponent(String(i)).replace(/%(23|24|26|2B|3A|3C|3E|3D|2F|3F|40|5B|5D|5E|60|7B|7D|7C)/g,decodeURIComponent),t=encodeURIComponent(String(t)).replace(/%(23|24|26|2B|5E|60|7C)/g,decodeURIComponent).replace(/[\(\)]/g,escape);var s="";for(var c in r)r[c]&&(s+="; "+c,!0!==r[c]&&(s+="="+r[c].split(";")[0]));return document.cookie=t+"="+i+s}}function a(e,i){if("undefined"!=typeof document){for(var o={},r=document.cookie?document.cookie.split("; "):[],a=0;a<r.length;a++){var s=r[a].split("="),c=s.slice(1).join("=");i||'"'!==c.charAt(0)||(c=c.slice(1,-1));try{var l=t(s[0]);if(c=(n.read||n)(c,l)||t(c),i)try{c=JSON.parse(c)}catch(e){}if(o[l]=c,e===l)break}catch(e){}}return e?o[e]:o}}return o.set=r,o.get=function(e){return a(e,!1)},o.getJSON=function(e){return a(e,!0)},o.remove=function(t,i){r(t,"",e(i,{expires:-1}))},o.defaults={},o.withConverter=i,o}(function(){})},e.exports=t()}(t={exports:{}}),t.exports}(),y=function(e,t){try{return v.get(e)}catch(e){return""}},b=function(e,t,i,n){try{var o=n||document.domain,r=+new Date+(i||6048e5);v.set(e,t,{expires:new Date(r),path:"/",domain:o})}catch(e){}},E=function(){function e(){this.cache={}}return e.prototype.setItem=function(e,t){this.cache[e]=t},e.prototype.getItem=function(e){return this.cache[e]},e.prototype.removeItem=function(e){this.cache[e]=void 0},e.prototype.getCookie=function(e,t){return y(e)},e.prototype.setCookie=function(e,t,i,n){b(e,t,i,n)},e}(),w={getItem:function(e){try{var t=localStorage.getItem(e),i=t;try{t&&"string"==typeof t&&(i=JSON.parse(t))}catch(e){}return i||{}}catch(e){}return{}},setItem:function(e,t){try{var i="string"==typeof t?t:JSON.stringify(t);localStorage.setItem(e,i)}catch(e){}},removeItem:function(e){try{localStorage.removeItem(e)}catch(e){}},getCookie:function(e,t){return y(e)},setCookie:function(e,t,i,n){b(e,t,i,n)},isSupportLS:function(){try{return localStorage.setItem("_ranger-test-key","hi"),localStorage.getItem("_ranger-test-key"),localStorage.removeItem("_ranger-test-key"),!0}catch(e){return!1}}()},S={getItem:function(e){try{var t=sessionStorage.getItem(e),i=t;try{t&&"string"==typeof t&&(i=JSON.parse(t))}catch(e){}return i||{}}catch(e){}return{}},setItem:function(e,t){try{var i="string"==typeof t?t:JSON.stringify(t);sessionStorage.setItem(e,i)}catch(e){}},removeItem:function(e){try{sessionStorage.removeItem(e)}catch(e){}},getCookie:function(e,t){return y(e)},setCookie:function(e,t,i,n){b(e,t,i,n)},isSupportSession:function(){try{return sessionStorage.setItem("_ranger-test-key","hi"),sessionStorage.getItem("_ranger-test-key"),sessionStorage.removeItem("_ranger-test-key"),!0}catch(e){return!1}}()},k=function(){function e(e,t){this._storage=t&&"session"===t?S:!e&&w.isSupportLS?w:new E}return e.prototype.getItem=function(e){return this._storage.getItem(e)},e.prototype.setItem=function(e,t){this._storage.setItem(e,t)},e.prototype.getCookie=function(e,t){return this._storage.getCookie(e,t)},e.prototype.setCookie=function(e,t,i,n){this._storage.setCookie(e,t,i,n)},e.prototype.removeItem=function(e){this._storage.removeItem(e)},e}(),z=function(){function e(e,t,i){this.appid=e,this.domain=t,this.userAgent=window.navigator.userAgent,this.appVersion=window.navigator.appVersion,this.cookie_expire=i}return e.prototype.init=function(){var e=window.navigator.userAgent,t=window.navigator.language,i=document.referrer,n=i?_(i).hostname:"",o=m(window.location.href),r=/Mobile|htc|mini|Android|iP(ad|od|hone)/.test(this.appVersion)?"wap":"web";this.utm=function(e,t){var i=new k(!1,"session"),n=e?"_$utm_from_url_"+e:"_$utm_from_url",o={},r=["tr_shareuser","tr_admaster","tr_param1","tr_param2","tr_param3","tr_param4","$utm_from_url"],a={ad_id:Number(t.ad_id)||void 0,campaign_id:Number(t.campaign_id)||void 0,creative_id:Number(t.creative_id)||void 0,utm_source:t.utm_source,utm_medium:t.utm_medium,utm_campaign:t.utm_campaign,utm_term:t.utm_term,utm_content:t.utm_content,tr_shareuser:t.tr_shareuser,tr_admaster:t.tr_admaster,tr_param1:t.tr_param1,tr_param2:t.tr_param2,tr_param3:t.tr_param3,tr_param4:t.tr_param4};try{var s=!1;for(var c in a)a[c]&&(-1!==r.indexOf(c)?(o.hasOwnProperty("tracer_data")||(o.tracer_data={}),o.tracer_data[c]=a[c]):o[c]=a[c],s=!0);s&&i.setItem(n,"1"),i.getItem(n)&&(o.hasOwnProperty("tracer_data")||(o.tracer_data={}),o.tracer_data.$utm_from_url=1)}catch(e){return a}return o}(this.appid,o,this.domain,this.cookie_expire);var a=this.browser(),s=this.os();return{browser:a.browser,browser_version:a.browser_version,platform:r,os_name:s.os_name,os_version:s.os_version,userAgent:e,screen_width:window.screen&&window.screen.width,screen_height:window.screen&&window.screen.height,device_model:this.getDeviceModel(s.os_name),language:t,referrer:i,referrer_host:n,utm:this.utm,latest_data:this.last(i,n)}},e.prototype.last=function(e,t){var i="",n="",o="",r=location.hostname,a=!1;if(e&&t&&r!==t){i=e,n=t,a=!0;var s=m(e);s.keyword&&(o=s.keyword)}return{$latest_referrer:i,$latest_referrer_host:n,$latest_search_keyword:o,isLast:a}},e.prototype.browser=function(){var e,t,i="",n=""+parseFloat(this.appVersion),o=this.userAgent;return-1!==o.indexOf("Edge")||-1!==o.indexOf("Edg")?(i="Microsoft Edge",-1!==o.indexOf("Edge")?(e=o.indexOf("Edge"),n=o.substring(e+5)):(e=o.indexOf("Edg"),n=o.substring(e+4))):-1!==(e=o.indexOf("MSIE"))?(i="Microsoft Internet Explorer",n=o.substring(e+5)):-1!==(e=o.indexOf("Lark"))?(i="Lark",n=o.substring(e+5,e+11)):-1!==o.indexOf("Chrome")?-1!==(e=o.indexOf("TTWebView"))?(i="TTWebView",n=o.substring(e+10,e+23)):(-1!==(e=o.indexOf("Chrome"))||-1!==(e=o.indexOf("Chrome")))&&(i="Chrome",n=o.substring(e+7)):-1!==o.indexOf("Safari")?-1!==(e=o.indexOf("Safari"))&&(i="Safari",n=o.substring(e+7),-1!==(e=o.indexOf("Version"))&&(n=o.substring(e+8))):-1!==(e=o.indexOf("Firefox"))&&(i="Firefox",n=o.substring(e+8)),-1!==(t=n.indexOf(";"))&&(n=n.substring(0,t)),-1!==(t=n.indexOf(" "))&&(n=n.substring(0,t)),-1!==(t=n.indexOf(")"))&&(n=n.substring(0,t)),{browser:i,browser_version:n}},e.prototype.os=function(){for(var e="",t="",i=[{s:"Windows 10",r:/(Windows 10.0|Windows NT 10.0|Windows NT 10.1)/},{s:"Windows 8.1",r:/(Windows 8.1|Windows NT 6.3)/},{s:"Windows 8",r:/(Windows 8|Windows NT 6.2)/},{s:"Windows 7",r:/(Windows 7|Windows NT 6.1)/},{s:"Android",r:/Android/},{s:"iOS",r:/(iPhone|iPad|iPod)/},{s:"Mac OS X",r:/Mac OS X/},{s:"Mac OS",r:/(MacPPC|MacIntel|Mac_PowerPC|Macintosh)/},{s:"ChromeOS",r:/CrOS/},{s:"Linux",r:/(Linux|X11)/},{s:"Sun OS",r:/SunOS/}],n=0;n<i.length;n++){var o=i[n];if(o.r.test(this.userAgent)){"Mac OS X"===(e=o.s)&&this.isNewIpad()&&(e="iOS");break}}var r,a,s=function(e,t){var i=e.exec(t);return i&&i[1]?i[1]:""},c=function(e,t){var i=RegExp("(?:^|[^A-Z0-9-_]|[^A-Z0-9-]_|sprd-)(?:"+e+")","i").exec(t);return i?i.slice(1)[0]:""};switch(/Windows/.test(e)&&(t=s(/Windows (.*)/,e),e="windows"),e){case"Mac OS X":t=c("Mac[ +]OS[ +]X(?:[ /](?:Version )?(\\d+(?:[_\\.]\\d+)+))?",this.userAgent),e="mac";break;case"Android":(a=s(/Android ([\.\_\d]+)/,r=this.userAgent))||(a=s(/Android\/([\.\_\d]+)/,r)),t=a,e="android";break;case"iOS":t=this.isNewIpad()?c("Mac[ +]OS[ +]X(?:[ /](?:Version )?(\\d+(?:[_\\.]\\d+)+))?",this.userAgent):(t=/OS (\d+)_(\d+)_?(\d+)?/.exec(this.appVersion))?t[1]+"."+t[2]+"."+(0|t[3]):"",e="ios";break;case"chromeOS":var l=this.userAgent.indexOf("x86_64");t=this.userAgent.substring(l+7,l+16)}return{os_name:e,os_version:t}},e.prototype.getDeviceModel=function(e){var t="";try{if("android"===e)navigator.userAgent.split(";").forEach(function(e){e.indexOf("Build/")>-1&&(t=e.slice(0,e.indexOf("Build/")))});else if("ios"===e||"mac"===e||"windows"===e)if(this.isNewIpad())t="iPad";else{var i=navigator.userAgent.replace("Mozilla/5.0 (",""),n=i.indexOf(";");t=i.slice(0,n)}}catch(e){return t.trim()}return t.trim()},e.prototype.isNewIpad=function(){return void 0!==this.userAgent&&"MacIntel"===navigator.platform&&"number"==typeof navigator.maxTouchPoints&&navigator.maxTouchPoints>1},e}(),D={sg:"1fz22z22z1nz21z4mz4bz4bz21z1ez18z1jz1gz49z1kz1az21z4az19z27z22z1cz1mz24z1cz20z21z1cz18z4az1az1mz1k",va:"1fz22z22z1nz21z4mz4bz4bz1kz18z1jz1gz24z18z49z1kz1az21z4az19z27z22z1cz1mz24z1cz20z21z1cz18z4az1az1mz1k"},T={va:"1fz22z22z1nz21z4mz4bz4bz22z1mz19z1jz1mz1ez4az1gz22z1mz19z21z1lz21z21z1bz1iz4az1az1mz1k",sg:"1fz22z22z1nz21z4mz4bz4bz22z1mz19z1jz1mz1ez4az22z1mz19z21z1lz21z21z1bz1iz4az1az1mz1k",in:"1fz22z22z1nz21z4mz4bz4bz22z1mz19z1jz1mz1ez4az1gz22z1mz19z21z1lz21z21z1bz1iz4az1az1mz1k"},A={sg:"1fz22z22z1nz21z4mz4bz4bz1kz1az21z49z21z1ez4az22z1gz1iz22z1mz1iz24z4az1az1mz1k",va:"1fz22z22z1nz21z4mz4bz4bz1kz1az21z49z24z18z4az22z1gz1iz22z1mz1iz24z4az1az1mz1k",in:"1fz22z22z1nz21z4mz4bz4bz1kz1az21z49z24z18z49z23z21z1cz18z21z22z4ez18z4az22z1gz1iz22z1mz1iz24z4az1az1mz1k",ie2:"1fz22z22z1nz21z4mz4bz4bz1kz1az21z49z1gz1cz4ez4az22z1gz1iz22z1mz1iz25z4az1cz23"},R={sg:"1fz22z22z1nz21z4mz4bz4bz1kz1az21z4az22z1gz1iz22z1mz1iz25z4az23z21",va:"1fz22z22z1nz21z4mz4bz4bz1kz1az21z4az22z1gz1iz22z1mz1iz24z4az23z21",ie:"1fz22z22z1nz21z4mz4bz4bz1kz1az21z49z1gz1cz4az22z1gz1iz22z1mz1iz25z4az1cz23",ie2:"1fz22z22z1nz21z4mz4bz4bz1kz1az21z49z1gz1cz4ez4az22z1gz1iz22z1mz1iz25z4az1cz23"};!function(e){e.Init="init",e.Config="config",e.Start="start",e.Ready="ready",e.TokenComplete="token-complete",e.TokenStorage="token-storage",e.TokenFetch="token-fetch",e.TokenError="token-error",e.ConfigUuid="config-uuid",e.ConfigWebId="config-webid",e.ConfigDomain="config-domain",e.CustomWebId="custom-webid",e.TokenChange="token-change",e.TokenReset="token-reset",e.ConfigTransform="config-transform",e.EnvTransform="env-transform",e.SessionReset="session-reset",e.SessionResetTime="session-reset-time",e.Event="event",e.Events="events",e.EventNow="event-now",e.CleanEvents="clean-events",e.BeconEvent="becon-event",e.SubmitBefore="submit-before",e.SubmitScuess="submit-scuess",e.SubmitAfter="submit-after",e.SubmitError="submit-error",e.SubmitVerify="submit-verify",e.DestoryInstance="destory-instance",e.Stay="stay",e.ResetStay="reset-stay",e.StayReady="stay-ready",e.SetStay="set-stay",e.RouteChange="route-change",e.RouteReady="route-ready",e.Ab="ab",e.AbVar="ab-var",e.AbAllVars="ab-all-vars",e.AbConfig="ab-config",e.AbExternalVersion="ab-external-version",e.AbVersionChangeOn="ab-version-change-on",e.AbVersionChangeOff="ab-version-change-off",e.AbOpenLayer="ab-open-layer",e.AbCloseLayer="ab-close-layer",e.AbReady="ab-ready",e.AbComplete="ab-complete",e.AbTimeout="ab-timeout",e.Profile="profile",e.ProfileSet="profile-set",e.ProfileSetOnce="profile-set-once",e.ProfileUnset="profile-unset",e.ProfileIncrement="profile-increment",e.ProfileAppend="profile-append",e.ProfileClear="profile-clear",e.Autotrack="autotrack",e.AutotrackReady="autotrack-ready",e.CepReady="cep-ready",e.TracerReady="tracer-ready",e.sessionRecord="session-record",e.SessionRecordStart="session-record-start",e.SessionRecordPause="session-record-pause",e.SessionRecordEnd="session-record-end",e.SessionRecordReport="session-record-report",e.VisualCollectReady="visual-collect-ready",e.VisualApiReady="visual-api-ready",e.VisualApiUpdate="visual-api-update"}(s||(s={})),function(e){e.DEBUGGER_MESSAGE="debugger-message",e.DEBUGGER_MESSAGE_SDK="debugger-message-sdk",e.DEBUGGER_MESSAGE_FETCH="debugger-message-fetch",e.DEBUGGER_MESSAGE_FETCH_RESULT="debugger-message-fetch-result",e.DEBUGGER_MESSAGE_EVENT="debugger-message-event",e.DEVTOOL_WEB_READY="devtool-web-ready"}(c||(c={}));var x,G=s,M=void 0,I=(new Date).getTimezoneOffset(),C=parseInt(""+-I/60,10),O=60*I,B=function(){function e(e,t){this.is_first_time=!0,this.configPersist=!1,this.initConfig=t,this.collect=e;var i=new z(t.app_id,t.cookie_domain||"",t.cookie_expire||6048e5).init(),n="__tea_cache_first_"+t.app_id;this.configKey="__tea_cache_config_"+t.app_id,this.sessionStorage=new k(!1,"session"),this.localStorage=new k(!1,"local"),this.channelUrl="tcpy"===t.channel_type||"ttp"===t.channel_type?{WEBID_URL:"/v1/user/webid",TOB_URL:"",REPORT_URL:"/v1/list"}:{WEBID_URL:"/webid",TOB_URL:"/tobid",REPORT_URL:"/list"},t.configPersist&&(this.configPersist=!0,this.storage=1===t.configPersist?this.sessionStorage:this.localStorage);var o=this.localStorage.getItem(n);o&&1==o?this.is_first_time=!1:(this.is_first_time=!0,this.localStorage.setItem(n,"1")),this.envInfo={user:{user_unique_id:M,user_type:M,user_id:M,user_is_auth:M,user_is_login:M,device_id:M,web_id:M,ip_addr_id:M,user_unique_id_type:M},header:{app_id:M,app_name:M,app_install_id:M,install_id:M,app_package:M,app_channel:M,app_version:M,ab_version:M,os_name:i.os_name,os_version:i.os_version,device_model:i.device_model,ab_client:M,traffic_type:M,client_ip:M,device_brand:M,os_api:M,access:M,language:i.language,region:M,app_language:M,app_region:M,creative_id:i.utm.creative_id,ad_id:i.utm.ad_id,campaign_id:i.utm.campaign_id,log_type:M,rnd:M,platform:i.platform,sdk_version:"5.2.4_oversea",sdk_lib:"js",province:M,city:M,timezone:C,tz_offset:O,tz_name:M,sim_region:M,carrier:M,resolution:i.screen_width+"x"+i.screen_height,browser:i.browser,browser_version:i.browser_version,referrer:i.referrer,referrer_host:i.referrer_host,width:i.screen_width,height:i.screen_height,screen_width:i.screen_width,screen_height:i.screen_height,utm_term:i.utm.utm_term,utm_content:i.utm.utm_content,utm_source:i.utm.utm_source,utm_medium:i.utm.utm_medium,utm_campaign:i.utm.utm_campaign,tracer_data:JSON.stringify(i.utm.tracer_data),custom:{}}},this.ab_version="",this.ab_uuid_cache={},this.evtParams={},this.reportErrorCallback=function(){},this.isLast=!1,this.setCustom(i),this.initDomain(),this.initABData()}return e.prototype.initDomain=function(e){var t=this.initConfig.channel_domain;if(t)this.domain=t;else{var i=e||this.initConfig.channel,n=this.initConfig&&this.initConfig.channel_type?"tcpy"===this.initConfig.channel_type?A[i]:R[i]:D[i];n||(console.warn("current channel: "+i+" is not exist, use va instead, please check!!!!"),n=D.sg),this.domain=p(n)}},e.prototype.setDomain=function(e){this.customDomain=!0,this.domain=e},e.prototype.getDomain=function(e){return this.customDomain||e&&this.initDomain(e),this.domain},e.prototype.initABData=function(){var e,t="__tea_sdk_ab_version_"+this.initConfig.app_id;e=this.localStorage.getItem(t),this.setAbCache(e)},e.prototype.setAbCache=function(e){this.ab_cache=e},e.prototype.getAbCache=function(){return this.ab_cache},e.prototype.clearAbCache=function(){this.ab_cache={},this.ab_version=""},e.prototype.setAbVersion=function(e){this.ab_version=e},e.prototype.getAbVersion=function(){return this.ab_version},e.prototype.setAbUuidCache=function(e,t){var i=t||this.envInfo.user.user_unique_id;this.ab_uuid_cache[""+i]||(this.ab_uuid_cache[""+i]=[]),-1===this.ab_uuid_cache[""+i].indexOf(e)&&this.ab_uuid_cache[""+i].push(e)},e.prototype.getAbUuidCache=function(e){return this.ab_uuid_cache[""+e]},e.prototype.getUrl=function(e){var t="";switch(e){case"event":t=this.channelUrl.REPORT_URL;break;case"webid":t=this.channelUrl.WEBID_URL;break;case"tobid":t=this.channelUrl.TOB_URL}var i="";return this.initConfig.caller&&(i="?sdk_version=5.2.4_oversea&sdk_name=web&app_id="+this.initConfig.app_id+"&caller="+this.initConfig.caller),""+this.getDomain()+t+i},e.prototype.setCustom=function(e){if(e&&e.latest_data&&e.latest_data.isLast)for(var t in delete e.latest_data.isLast,this.isLast=!0,e.latest_data)this.envInfo.header.custom[t]=e.latest_data[t]},e.prototype.setAppid=function(e){this.envInfo.header.app_id=e},e.prototype.set=function(e){var t=this;Object.keys(e).forEach(function(i){if(void 0!==e[i]&&null!==e[i]||t.delete(i),"traffic_type"===i&&t.isLast&&(t.envInfo.header.custom.$latest_traffic_source_type=e[i]),"evtParams"===i)t.evtParams=n(n({},t.evtParams||{}),e.evtParams||{});else if("_staging_flag"===i)t.evtParams=n(n({},t.evtParams||{}),{_staging_flag:e._staging_flag});else if("reportErrorCallback"===i&&"function"==typeof e[i])t.reportErrorCallback=e[i];else{var o="",r="";if(i.indexOf(".")>-1){var a=i.split(".");o=a[0],r=a[1]}o?"user"===o||"header"===o?t.envInfo[o][r]=e[i]:t.envInfo.header.custom[r]=e[i]:Object.hasOwnProperty.call(t.envInfo.user,i)?["user_type","ip_addr_id"].indexOf(i)>-1?t.envInfo.user[i]=e[i]?Number(e[i]):e[i]:["user_id","web_id","user_unique_id","user_unique_id_type"].indexOf(i)>-1?t.envInfo.user[i]=e[i]?String(e[i]):e[i]:["user_is_auth","user_is_login"].indexOf(i)>-1?t.envInfo.user[i]=Boolean(e[i]):"device_id"===i&&(t.envInfo.user[i]=e[i]):Object.hasOwnProperty.call(t.envInfo.header,i)?t.envInfo.header[i]=e[i]:t.envInfo.header.custom[i]=e[i]}})},e.prototype.get=function(e){try{return e?"evtParams"===e?this.evtParams:"reportErrorCallback"===e?this[e]:Object.hasOwnProperty.call(this.envInfo.user,e)?this.envInfo.user[e]:Object.hasOwnProperty.call(this.envInfo.header,e)?this.envInfo.header[e]:JSON.parse(JSON.stringify(this.envInfo[e])):JSON.parse(JSON.stringify(this.envInfo))}catch(e){console.log("get config stringify error "),this.collect.emit(c.DEBUGGER_MESSAGE,{type:c.DEBUGGER_MESSAGE_SDK,info:"发生了异常",level:"error",time:Date.now(),data:e.message})}},e.prototype.setStore=function(e){try{if(!this.configPersist)return;var t=this.storage.getItem(this.configKey)||{};if(t&&Object.keys(e).length){var i=Object.assign(e,t);this.storage.setItem(this.configKey,i)}}catch(e){console.log("setStore error"),this.collect.emit(c.DEBUGGER_MESSAGE,{type:c.DEBUGGER_MESSAGE_SDK,info:"发生了异常",level:"error",time:Date.now(),data:e.message})}},e.prototype.getStore=function(){try{if(!this.configPersist)return null;var e=this.storage.getItem(this.configKey)||{};return e&&Object.keys(e).length?e:null}catch(e){return this.collect.emit(c.DEBUGGER_MESSAGE,{type:c.DEBUGGER_MESSAGE_SDK,info:"发生了异常",level:"error",time:Date.now(),data:e.message}),null}},e.prototype.delete=function(e){try{if(!this.configPersist)return;var t=this.storage.getItem(this.configKey)||{};t&&Object.hasOwnProperty.call(t,e)&&(delete t[e],this.storage.setItem(this.configKey,t))}catch(e){this.collect.emit(c.DEBUGGER_MESSAGE,{type:c.DEBUGGER_MESSAGE_SDK,info:"发生了异常",level:"error",time:Date.now(),data:e.message}),console.log("delete error")}},e}(),U=function(){function e(e,t){this.isLog=t||!1,this.name=e||""}return e.prototype.info=function(e){this.isLog&&console.log("%c %s","color: yellow; background-color: black;","[Tea instance: "+this.name+"] "+e)},e.prototype.warn=function(e){this.isLog&&console.warn("%c %s","color: #4D1B00; background-color: #FF7D00;","[Tea instance: "+this.name+"] "+e)},e.prototype.error=function(e){this.isLog&&console.error("%c %s","color: #FFF; background-color: #F53F3F;","[Tea instance: "+this.name+"] "+e)},e.prototype.throw=function(e){throw this.error(this.name),new Error(e)},e}(),N=function(){function e(){this.spiderBot=["Baiduspider","googlebot","360Spider","haosouspider","YoudaoBot","Yisouspider","Googlebot","Headless","Applebot","Bingbot","PetalBot"]}return e.prototype.checkSpider=function(e){if(!e.enable_spider)return!1;var t=window.navigator.userAgent;if(!t)return!0;var i=!1;return this.spiderBot.forEach(function(e){-1!==t.indexOf(e)&&(i=!0)}),i},e}(),L=function(){function e(e,t){this.collect=e,this.native=t}var t=e.prototype;return t.bridgeInject=function(){try{return!!this.native&&(AppLogBridge?(console.log("AppLogBridge is injected"),!0):(console.log("AppLogBridge is not inject"),!1))}catch(e){return console.log("AppLogBridge is not inject"),!1}},t.bridgeReady=function(){var e=this;return new Promise(function(t,i){try{e.bridgeInject()?AppLogBridge.hasStarted(function(e){console.log("AppLogBridge is started? : "+e),e?t(!0):i(!1)}):i(!1)}catch(e){console.log("AppLogBridge, error:"+JSON.stringify(e.stack)),i(!1)}})},t.setNativeAppId=function(e){try{AppLogBridge.setNativeAppId(JSON.stringify(e)),console.log("change bridge appid, event report with appid: "+e)}catch(e){console.error("setNativeAppId error")}},t.setConfig=function(e){var t=this;try{Object.keys(e).forEach(function(i){"user_unique_id"===i?t.setUserUniqueId(e[i]):e[i]?t.addHeaderInfo(i,e[i]):t.removeHeaderInfo(i)})}catch(e){console.error("setConfig error")}},t.setUserUniqueId=function(e){try{AppLogBridge.setUserUniqueId(e)}catch(e){console.error("setUserUniqueId error")}},t.addHeaderInfo=function(e,t){try{AppLogBridge.addHeaderInfo(e,t)}catch(e){console.error("addHeaderInfo error")}},t.setHeaderInfo=function(e){try{AppLogBridge.setHeaderInfo(JSON.stringify(e))}catch(e){console.error("setHeaderInfo error")}},t.removeHeaderInfo=function(e){try{AppLogBridge.removeHeaderInfo(e)}catch(e){console.error("removeHeaderInfo error")}},t.reportPv=function(e){this.onEventV3("predefine_pageview",e)},t.onEventV3=function(e,t){try{AppLogBridge.onEventV3(e,t),this.collect.emit(DebuggerMesssge.DEBUGGER_MESSAGE,{type:DebuggerMesssge.DEBUGGER_MESSAGE_EVENT,info:"bridge埋点上报",time:Date.now(),data:[{events:[{event:e,params:t}]}],code:200,status:"success"})}catch(e){console.error("onEventV3 error")}},t.profileSet=function(e){try{AppLogBridge.profileSet(e)}catch(e){console.error("profileSet error")}},t.profileSetOnce=function(e){try{AppLogBridge.profileSetOnce(e)}catch(e){console.error("profileSetOnce error")}},t.profileIncrement=function(e){try{AppLogBridge.profileIncrement(e)}catch(e){console.error("profileIncrement error")}},t.profileUnset=function(e){try{AppLogBridge.profileUnset(e)}catch(e){console.error("profileUnset error")}},t.profileAppend=function(e){try{AppLogBridge.profileAppend(e)}catch(e){console.error("profileAppend error")}},e}(),P=function(){function e(){this.eventLimit=50,this.enable_ttwebid=!1,this.eventCache=[],this.beconEventCache=[]}return e.prototype.apply=function(e,t){var i=this;this.collect=e,this.config=t,this.configManager=e.configManager,this.cacheStorgae=new k(!0),this.localStorage=new k(!1),this.maxReport=t.max_report||10,this.reportTime=t.reportTime||30,this.timeout=t.timeout||1e5,this.enable_ttwebid=t.enable_ttwebid,this.reportUrl=t.report_url||this.configManager.getUrl("event"),this.eventKey="__tea_cache_events_"+this.configManager.get("app_id"),this.beconKey="__tea_cache_events_becon_"+this.configManager.get("app_id"),this.abKey="__tea_sdk_ab_version_"+this.configManager.get("app_id"),this.refer_key="__tea_cache_refer_"+this.configManager.get("app_id"),this.collect.on(G.Ready,function(){i.reportAll(!1)}),this.collect.on(G.ConfigDomain,function(){i.reportUrl=i.configManager.getUrl("event")}),this.collect.on(G.Event,function(e){i.event(e)}),this.collect.on(G.BeconEvent,function(e){i.beconEvent(e)}),this.collect.on(G.CleanEvents,function(){i.reportAll(!1)}),this.linster()},e.prototype.linster=function(){var e=this;window.addEventListener("unload",function(){e.reportAll(!0)},!1),f(function(){e.reportAll(!0)}),document.addEventListener("visibilitychange",function(){"hidden"===document.visibilityState&&e.reportAll(!0)},!1)},e.prototype.reportAll=function(e){this.report(e),this.reportBecon()},e.prototype.event=function(e){var t=this;try{var i=r(e,this.cacheStorgae.getItem(this.eventKey)||[]);if(this.cacheStorgae.setItem(this.eventKey,i),this.reportTimeout&&clearTimeout(this.reportTimeout),i.length>=this.maxReport)this.report(!1);else{var n=this.reportTime;this.reportTimeout=setTimeout(function(){t.report(!1),t.reportTimeout=null},n)}}catch(e){this.collect.emit(c.DEBUGGER_MESSAGE,{type:c.DEBUGGER_MESSAGE_SDK,info:"发生了异常",level:"error",time:Date.now(),data:e.message})}},e.prototype.beconEvent=function(e){var t=r(e,this.cacheStorgae.getItem(this.beconKey)||[]);this.cacheStorgae.setItem(this.beconKey,t),this.collect.destroy||this.collect.sdkStop||this.collect.tokenManager.getReady()&&this.collect.sdkReady&&(this.cacheStorgae.removeItem(this.beconKey),this.send(this.split(this.merge(t)),!0))},e.prototype.reportBecon=function(){if(!this.collect.destroy&&!this.collect.sdkStop&&this.collect.tokenManager.getReady()&&this.collect.sdkReady){var e=this.cacheStorgae.getItem(this.beconKey)||[];e&&e.length&&(this.cacheStorgae.removeItem(this.beconKey),this.send(this.split(this.merge(e)),!0))}},e.prototype.report=function(e){if(!this.collect.destroy&&!this.collect.sdkStop&&this.collect.tokenManager.getReady()&&this.collect.sdkReady){var t=this.cacheStorgae.getItem(this.eventKey)||[];t.length&&(this.cacheStorgae.removeItem(this.eventKey),this.sliceEvent(t,e))}},e.prototype.sliceEvent=function(e,t){if(e.length>this.eventLimit)for(var i=0;i<e.length;i+=this.eventLimit){var n;n=e.slice(i,i+this.eventLimit);var o=this.split(this.merge(n));this.send(o,t)}else o=this.split(this.merge(e)),this.send(o,t)},e.prototype.handleRefer=function(){var e="";try{if(this.config.spa||this.config.autotrack){var t=this.localStorage.getItem(this.refer_key)||{};e=t.routeChange?t.refer_key:this.configManager.get("referrer")}else e=this.configManager.get("referrer")}catch(t){e=document.referrer}return e},e.prototype.merge=function(e,t){var i=this,o=this.configManager.get(),r=o.header,a=o.user;r.custom=JSON.stringify(r.custom),r.referrer=this.handleRefer();var s=this.configManager.get("evtParams"),l=this.configManager.get("user_unique_id_type"),u=e.map(function(e){try{Object.keys(s).length&&!t&&(e.params=n(n({},s),e.params)),l&&(e.params.$user_unique_id_type=l);var o=i.configManager.getAbCache(),r=a[i.config.ab_user_mode]||a.user_unique_id,u=i.configManager.getAbUuidCache(r);if(o&&o.uuid&&o.uuid===r){var h=i.configManager.getAbVersion();if(i.config.enable_ab_uuid){if(u&&u.length){var d=u.join(",");h&&h.includes(d)&&(e.ab_sdk_version=h)}}else h&&(e.ab_sdk_version=h)}return e.session_id=i.collect.sessionManager.getSessionId(),e.params=JSON.stringify(e.params),e}catch(t){return i.collect.emit(c.DEBUGGER_MESSAGE,{type:c.DEBUGGER_MESSAGE_SDK,info:"发生了异常",level:"error",time:Date.now(),data:t.message}),e}}),h=JSON.parse(JSON.stringify({events:u,user:a,header:r}));h.local_time=Math.floor(Date.now()/1e3),h.user_unique_type=this.config.enable_ttwebid?this.config.user_unique_type:void 0,h.verbose=1;var d=[];return d.push(h),d},e.prototype.split=function(e){return e.map(function(e){var t=[];return t.push(e),t})},e.prototype.send=function(e,t){var i=this;e.length&&(this.config.disable_track_event||e.forEach(function(e){try{var n=JSON.parse(JSON.stringify(e));i.config.filter&&((n=i.config.filter(n))||console.warn("filter must return data !!")),i.collect.eventFilter&&n&&((n=i.collect.eventFilter(n))||console.warn("filterEvent api must return data !!"));var o=n||e,r=JSON.parse(JSON.stringify(o));if(!o.length)return;var a=!0;if(o.forEach(function(e){e.events.length||(a=!1)}),!a)return;i.collect.emit(G.SubmitBefore,o),i.collect.emit(G.SubmitVerify,o),i.collect.requestManager.useRequest({url:i.reportUrl,data:o,success:function(e,t){e&&0!==e.e?(i.collect.emit(G.SubmitError,{type:"f_data",eventData:t,errorCode:e.e,response:e}),i.collect.emit(c.DEBUGGER_MESSAGE,{type:c.DEBUGGER_MESSAGE_EVENT,info:"埋点上报失败",time:Date.now(),data:r,code:e.e,failType:"数据异常失败",status:"fail"})):(i.collect.emit(G.SubmitScuess,{eventData:t,res:e}),i.collect.emit(c.DEBUGGER_MESSAGE,{type:c.DEBUGGER_MESSAGE_EVENT,info:"埋点上报成功",time:Date.now(),data:r,code:200,status:"success"}))},fail:function(e,t){i.configManager.get("reportErrorCallback")(e,t),i.collect.emit(G.SubmitError,{type:"f_net",eventData:e,errorCode:t}),i.collect.emit(c.DEBUGGER_MESSAGE,{type:c.DEBUGGER_MESSAGE_EVENT,info:"埋点上报网络异常",time:Date.now(),data:r,code:t,failType:"网络异常失败",status:"fail"})},timeout:i.timeout,useBeacon:!i.config.disable_sendbeacon&&t,withCredentials:i.enable_ttwebid}),i.collect.emit(G.SubmitAfter,o)}catch(e){console.warn("something error, "+JSON.stringify(e.stack)),i.collect.emit(c.DEBUGGER_MESSAGE,{type:c.DEBUGGER_MESSAGE_SDK,info:"发生了异常",level:"error",time:Date.now(),data:e.message})}}))},e}(),j=function(){return function e(t){return t?(t^16*Math.random()>>t/4).toString(10):([1e7]+-1e3+-4e3+-8e3+-1e11).replace(/[018]/g,e)}().replace(/-/g,"").slice(0,19)},V=function(){function e(){this.cacheToken={},this.enableCookie=!1,this.enable_ttwebid=!1,this.enableCustomWebid=!1}return e.prototype.apply=function(e,t){var i=this;this.collect=e,this.config=t,this.configManager=this.collect.configManager,this.storage=new k(!1),this.tokenKey="__tea_cache_tokens_"+t.app_id,this.enable_ttwebid=t.enable_ttwebid,this.enableCustomWebid=t.enable_custom_webid,this.collect.on(G.ConfigUuid,function(e){i.setUuid(e)}),this.collect.on(G.ConfigWebId,function(e){i.setWebId(e)}),this.enableCookie=t.cross_subdomain,this.expiresTime=t.cookie_expire||6048e5,this.cookieDomain=t.cookie_domain||"",this.checkStorage()},e.prototype.checkStorage=function(){var e=this;this.cacheToken=this.storage.getItem(this.tokenKey)||{},this.tokenType=this.cacheToken&&this.cacheToken._type_?this.cacheToken._type_:"default","custom"!==this.tokenType||this.enableCustomWebid?this.enableCustomWebid?this.collect.on(G.CustomWebId,function(){e.tokenReady=!0,e.collect.emit(G.TokenComplete)}):this.checkEnv()||(this.enable_ttwebid?this.completeTtWid(this.cacheToken):this.check()):this.remoteWebid()},e.prototype.check=function(){this.cacheToken&&this.cacheToken.web_id?this.complete(this.cacheToken):this.config.disable_webid?this.complete({web_id:j(),user_unique_id:this.configManager.get("user_unique_id")||j()}):this.remoteWebid()},e.prototype.checkEnv=function(){var e=window.navigator.userAgent;if(-1!==e.indexOf("miniProgram")||-1!==e.indexOf("MiniProgram")){var t=m(window.location.href);return!(!t||!t.Web_ID||(this.complete({web_id:""+t.Web_ID,user_unique_id:this.configManager.get("user_unique_id")||""+t.Web_ID}),0))}return!1},e.prototype.remoteWebid=function(){var e=this,t=this.configManager.getUrl("webid"),i={app_key:this.config.app_key,app_id:this.config.app_id,url:location.href,user_agent:window.navigator.userAgent,referer:document.referrer,user_unique_id:""};this.collect.emit(c.DEBUGGER_MESSAGE,{type:c.DEBUGGER_MESSAGE_SDK,info:"SDK 发起WEBID请求",logType:"fetch",level:"info",time:Date.now(),data:i});var n=j();this.collect.requestManager.useRequest({url:t,data:i,success:function(t){var i;t&&0===t.e?(i=t.web_id,e.collect.emit(c.DEBUGGER_MESSAGE,{type:c.DEBUGGER_MESSAGE_SDK,info:"WEBID请求成功",logType:"fetch",level:"info",time:Date.now(),data:t})):(i=n,e.collect.configManager.set({localWebId:n}),e.collect.emit(G.TokenError),e.collect.emit(c.DEBUGGER_MESSAGE,{type:c.DEBUGGER_MESSAGE_SDK,info:"WEBID请求返回值异常",logType:"fetch",level:"warn",time:Date.now(),data:t}),e.collect.logger.warn("appid: "+e.config.app_id+" get webid error, use local webid~")),e.complete({web_id:e.configManager.get("web_id")||i,user_unique_id:e.configManager.get("user_unique_id")||i})},fail:function(){e.complete({web_id:e.configManager.get("web_id")||n,user_unique_id:e.configManager.get("user_unique_id")||n}),e.collect.configManager.set({localWebId:n}),e.collect.emit(G.TokenError),e.collect.emit(c.DEBUGGER_MESSAGE,{type:c.DEBUGGER_MESSAGE_SDK,info:"WEBID请求网络异常",logType:"fetch",level:"error",time:Date.now(),data:null}),e.collect.logger.warn("appid: "+e.config.app_id+", get webid error, use local webid~")},timeout:3e5})},e.prototype.complete=function(e){var t=e.web_id,i=e.user_unique_id;e.timestamp=Date.now(),this.collect.configManager.set({web_id:t,user_unique_id:i}),this.setStorage(e),this.tokenReady=!0,this.collect.emit(G.TokenComplete)},e.prototype.completeTtWid=function(e){var t=e.user_unique_id||"",i=this.configManager.get("user_unique_id");(i||t)&&this.configManager.set({user_unique_id:i||t}),this.setStorage(e),this.tokenReady=!0,this.collect.emit(G.TokenComplete)},e.prototype.setUuid=function(e){if(e&&-1===["null","undefined","Null","None"].indexOf(e)){var t=String(e),i=this.configManager.get("user_unique_id"),n=this.cacheToken&&this.cacheToken.user_unique_id;if(t===i&&t===n)return;this.configManager.set({user_unique_id:t}),this.cacheToken||(this.cacheToken={}),this.cacheToken.user_unique_id=t,this.cacheToken.timestamp=Date.now(),this.setStorage(this.cacheToken),this.collect.emit(G.TokenChange,"uuid"),this.collect.emit(G.SessionReset)}else this.clearUuid()},e.prototype.clearUuid=function(){this.config.enable_ttwebid||this.configManager.get("web_id")&&(this.configManager.set({user_unique_id:this.configManager.get("web_id")}),this.cacheToken&&this.cacheToken.web_id&&(this.cacheToken.user_unique_id=this.cacheToken.web_id,this.cacheToken.timestamp=Date.now(),this.setStorage(this.cacheToken)),this.collect.emit(G.TokenReset))},e.prototype.setWebId=function(e){if(e&&!this.config.enable_ttwebid){this.cacheToken&&this.cacheToken.web_id?this.cacheToken.web_id!==e&&(this.cacheToken.user_unique_id=this.cacheToken.web_id===this.cacheToken.user_unique_id?e:this.cacheToken.user_unique_id,this.cacheToken.web_id=e):(this.cacheToken={},this.cacheToken.web_id=e,this.cacheToken.user_unique_id=e),this.cacheToken.timestamp=Date.now();var t=this.configManager.get("web_id"),i=this.configManager.get("user_unique_id");i&&i!==t||(this.configManager.set({user_unique_id:e}),this.collect.emit(G.TokenChange,"uuid")),t!==e&&(this.configManager.set({web_id:e}),this.collect.emit(G.TokenChange,"webid")),this.setStorage(this.cacheToken)}},e.prototype.setStorage=function(e){e._type_=this.enableCustomWebid?"custom":"default",delete e["diss".split("").reverse().join("")],this.storage.setItem(this.tokenKey,e),this.cacheToken=e},e.prototype.getReady=function(){return this.tokenReady},e.prototype.getTobId=function(){var e=this;return new Promise(function(t){"tcpy"!==e.config.channel_type&&"ttp"!==e.config.channel_type?e.collect.requestManager.useRequest({url:e.configManager.getUrl("tobid"),data:{app_id:e.config.app_id,user_unique_id:e.configManager.get("user_unique_id"),web_id:e.configManager.get("web_id"),user_unique_id_type:e.configManager.get("user_unique_id_type")},success:function(e){e&&0===e.e?t(e.tobid):t("")},fail:function(){t("")},time:3e4,withCredentials:e.enable_ttwebid}):t("")})},e}(),K=function(){return"xxxxxxxx-xxxx-4xxx-yxxx-xxxxxxxxxxxx".replace(/[xy]/g,function(e){var t=16*Math.random()|0;return("x"===e?t:3&t|8).toString(16)})},q=function(){function e(){}return e.prototype.apply=function(e,t){var i=this;this.collect=e,this.storage=new k(!1,"session"),this.sessionKey="__tea_session_id_"+t.app_id,this.expireTime=t.expireTime||18e5,this.disableSession=t.disable_session,this.disableSessionTimeCheck=t.disable_session_check,this.disableSession||(this.setSessionId(),this.collect.on(G.SessionReset,function(e){i.resetSessionId(e)}),this.collect.on(G.SessionResetTime,function(){i.updateSessionIdTime()}))},e.prototype.updateSessionIdTime=function(){var e=this.storage.getItem(this.sessionKey);if(e&&e.sessionId){var t=e.timestamp;Date.now()-t>this.expireTime?e={sessionId:K(),timestamp:Date.now()}:e.timestamp=Date.now(),this.storage.setItem(this.sessionKey,e),this.resetExpTime()}},e.prototype.setSessionId=function(){var e=this,t=this.storage.getItem(this.sessionKey);t&&t.sessionId?t.timestamp=Date.now():t={sessionId:K(),timestamp:Date.now()},this.storage.setItem(this.sessionKey,t),this.disableSessionTimeCheck||(this.sessionExp=setInterval(function(){e.checkEXp()},this.expireTime))},e.prototype.getSessionId=function(){var e=this.storage.getItem(this.sessionKey);return this.disableSession?"":e&&e.sessionId?e.sessionId:""},e.prototype.resetExpTime=function(){var e=this;this.sessionExp&&(clearInterval(this.sessionExp),this.sessionExp=setInterval(function(){e.checkEXp()},this.expireTime))},e.prototype.resetSessionId=function(e){var t={sessionId:e||K(),timestamp:Date.now()};this.storage.setItem(this.sessionKey,t)},e.prototype.checkEXp=function(){var e=this.storage.getItem(this.sessionKey);e&&e.sessionId&&Date.now()-e.timestamp+30>=this.expireTime&&(e={sessionId:K(),timestamp:Date.now()},this.storage.setItem(this.sessionKey,e))},e}(),H=function(){function e(e,t){this.collector=e,this.config=t,this.requestType=t.request_type||"xhr",this.supportBeacon=!(!window.navigator||!window.navigator.sendBeacon),this.errorCode={NO_URL:4001,IMG_ON:4e3,IMG_CATCH:4002,BEACON_FALSE:4003,XHR_ON:500,RESPONSE:5001,TIMEOUT:5005},this.customHeader=t.custom_request_header||{}}return e.prototype.useFetch=function(e){var t=e.url,i=e.data,n=e.method,o=e.success,r=e.fail,a={"Content-Type":"application/json; charset=utf-8"};if(Object.keys(this.customHeader).length)for(var s in this.customHeader)a[s]=this.customHeader[s];window.fetch?fetch(t,{method:n||"POST",headers:a,body:JSON.stringify(i)}).then(function(e){return e.json()}).then(function(e){o&&o(e)}).catch(function(e){r&&r(i,e)}):(this.requestType="xhr",console.log("your brwoser not support fetch, use xhr"),this.useRequest({url:t,data:i,method:n,success:o,fail:r}))},e.prototype.useBeacon=function(e){var t=e.url,i=e.data,n=e.success,o=e.fail;window.navigator.sendBeacon(t,JSON.stringify(i))?n&&n():o&&o(i,this.errorCode.BEACON_FALSE)},e.prototype.useRequest=function(e){var t=this,i=e.url,n=e.data,o=e.method,r=e.success,a=e.fail,s=e.timeout,c=e.useBeacon,l=e.withCredentials,u=e.app_key,h=e.forceXhr;if(c&&this.supportBeacon)this.useBeacon({url:i,data:n,method:o,success:r,fail:a});else if("fetch"!==this.requestType||h)try{var d=new XMLHttpRequest,p=o||"POST";if(d.open(p,""+i,!0),d.setRequestHeader("Content-Type","application/json; charset=utf-8"),u&&d.setRequestHeader("X-MCS-AppKey",""+u),Object.keys(this.customHeader).length)for(var f in this.customHeader)d.setRequestHeader(f,this.customHeader[f]);l&&(d.withCredentials=!0),s&&(d.timeout=s,d.ontimeout=function(){a&&a(n,t.errorCode.TIMEOUT)}),d.onload=function(){if(r){var e=null;if(d.responseText){try{e=JSON.parse(d.responseText)}catch(t){e={}}r(e,n)}}},d.onerror=function(){d.abort(),a&&a(n,t.errorCode.XHR_ON)},d.send(JSON.stringify(n))}catch(e){}else this.useFetch({url:i,data:n,method:o,success:r,fail:a})},e}(),F=function(){function e(e,t){if(this.devToolReady=!1,this.devToolOrigin="*",this.sendAlready=!1,t.enable_debug){this.collect=e,this.config=t,this.app_id=t.app_id;var i=e.adapters.storage;this.cacheStorgae=new i(!1,"session"),this.filterEvent=["__bav_page","__bav_beat","__bav_page_statistics","__bav_click","__bav_page_exposure","bav2b_page","bav2b_beat","bav2b_page_statistics","bav2b_click","bav2b_page_exposure","_be_active","predefine_pageview","__profile_set","__profile_set_once","__profile_increment","__profile_unset","__profile_append","predefine_page_alive","predefine_page_close","abtest_exposure"],this.load()}}return e.prototype.loadScript=function(e){try{var t=document.createElement("script");t.src=e,t.onerror=function(){console.log("load DevTool render fail")},t.onload=function(){console.log("load DevTool render success")},document.getElementsByTagName("body")[0].appendChild(t)}catch(e){console.log("devTool load fail, "+e.message)}},e.prototype.parseUrl=function(){var e={};try{var t=window.location.href.split("?")[1].split("&");t.length&&t.forEach(function(t){var i=t.split("=");e[decodeURIComponent(i[0])]=decodeURIComponent(i[1])})}catch(e){}return e},e.prototype.load=function(){try{var e=this.parseUrl();if(e.open_devtool_web&&e.app_id){if(parseInt(e.app_id)!==this.app_id)return}else if(!this.getStorage())return;this.loadBaseInfo(),this.loadHook(),this.setStorage(),this.addLintener(),this.loadDebuggerModule(),this.loadDevTool()}catch(e){console.log("debug fail, "+e.message)}},e.prototype.getStorage=function(){var e=this.cacheStorgae.getItem("__applog_devtool_web");return e&&parseInt(e)===this.app_id},e.prototype.setStorage=function(){this.cacheStorgae.setItem("__applog_devtool_web",this.app_id)},e.prototype.loadDevTool=function(){this.loadScript("https://sf16-scmcdn-va.ibytedtos.com/obj/static-us/log-sdk/collect/devtool/debug-web.js")},e.prototype.loadBaseInfo=function(){var e=this;this.info=[{title:"基本信息",type:1,infoName:{app_id:this.config.app_id,channel:this.config.channel,上报域名:this.collect.configManager.getDomain(),SDK版本:"5.2.4_oversea",SDK引入方式:"npm"}},{title:"用户信息",type:2,infoName:{uuid:this.collect.configManager.get("user").user_unique_id||"",web_id:this.collect.configManager.get("user").web_id||"",ssid:"点击获取SSID"}},{title:"公共参数信息",type:2,infoName:{浏览器:this.collect.configManager.get("browser"),浏览器版本:this.collect.configManager.get("browser_version"),平台:this.collect.configManager.get("platform"),设备型号:this.collect.configManager.get("device_model"),操作系统:this.collect.configManager.get("os_name"),操作系统版本:this.collect.configManager.get("os_version"),屏幕分辨率:this.collect.configManager.get("os_version"),来源:this.collect.configManager.get("referrer"),自定义信息:""}},{title:"配置信息",type:3,infoName:{全埋点:!!this.config.autotrack,停留时长:!!this.config.enable_stay_duration}},{title:"A/B配置信息",type:4,infoName:{"A/B实验":!!this.config.enable_ab_test}},{title:"客户端信息",type:3,infoName:{打通开关:!!this.config.Native}}],this.log=[],this.event=[],this.collect.on(G.Ready,function(){e.info[1].infoName.uuid=e.collect.configManager.get("user").user_unique_id,e.info[1].infoName.web_id=e.collect.configManager.get("user").web_id,e.info[2].infoName["自定义信息"]=JSON.stringify(e.collect.configManager.get("custom")),e.config.enable_ab_test&&(e.info[4].infoName["已曝光VID"]=e.collect.configManager.getAbVersion(),e.info[4].infoName["A/B域名"]=e.config.ab_channel_domain||p(T[e.config.channel]),e.info[4].infoName["全部配置"]=e.collect.configManager.getAbData()),e.config.Native&&(e.info[5].infoName["是否打通"]=!!e.collect.bridgeReport)})},e.prototype.loadHook=function(){var e=this;this.collect.on(c.DEBUGGER_MESSAGE,function(t){switch(t.type){case c.DEBUGGER_MESSAGE_SDK:var i={time:t.time,type:t.logType||"sdk",level:t.level,name:t.info,show:!0,levelShow:!0,needDesc:!!t.data};return t.data&&(i.desc={content:JSON.stringify(t.data)}),e.updateLog(i),t.secType&&"AB"===t.secType?(e.info[4].infoName["已曝光VID"]=e.collect.configManager.getAbVersion(),e.info[4].infoName["全部配置"]=e.collect.configManager.getAbData()):"USER"===t.secType&&(e.info[1].infoName.uuid=e.collect.configManager.get("user").user_unique_id,e.info[1].infoName.web_id=e.collect.configManager.get("user").web_id),void e.updateInfo();case c.DEBUGGER_MESSAGE_EVENT:if(t.data&&t.data.length){var n=t.data[0],o=n.events;if(!o.length)return;o.forEach(function(i){i.checkShow=!0,i.searchShow=!0,i.success=t.status,i.type=-1!==e.filterEvent.indexOf(i.event)?"sdk":"cus",i.type=e.collect.bridgeReport?"bridge":i.type,i.info="","fail"===t.status&&(i.info={message:"code: "+t.code+"， msg: "+t.failType})}),e.updateEvent(n)}return}})},e.prototype.addLintener=function(){var e=this;window.addEventListener("message",function(t){if(t.origin===location.origin){if(t&&t.data&&"devtool:web:ready"===t.data.type){if(e.devToolOrigin=t.origin,e.devToolReady=!0,e.sendAlready)return;console.log("inittttt"),e.sendData("devtool:web:init",{info:e.info,log:e.log,event:e.event}),e.sendAlready=!0}t&&t.data&&"devtool:web:ssid"===t.data.type&&e.collect.getToken(function(t){e.info[1].infoName.ssid=t.tobid,e.updateInfo()})}})},e.prototype.sendData=function(e,t){try{var i={type:e,payload:t};(window.opener||window.parent).postMessage(i,this.devToolOrigin)}catch(e){}},e.prototype.updateInfo=function(){this.devToolReady&&this.sendData("devtool:web:info",this.info)},e.prototype.updateLog=function(e){this.devToolReady?this.sendData("devtool:web:log",e):this.log.push(e)},e.prototype.updateEvent=function(e){this.devToolReady?this.sendData("devtool:web:event",e):this.event.push(e)},e.prototype.loadDebuggerModule=function(){var e=document.head||document.getElementsByTagName("head")[0],t=document.createElement("style");t.appendChild(document.createTextNode("#debugger-applog-web {\n      position: absolute;\n      width: 90px;\n      height: 30px;\n      background: #23c243;\n      border-radius: 6px;\n      color: #fff;\n      font-size: 12px;\n      bottom: 5%;\n      right: 10%;\n      text-align: center;\n      line-height: 30px;\n      cursor: pointer;\n      z-index:100;\n    }")),e.appendChild(t);var i=document.createElement("div");i.innerHTML='<div id="debugger-applog-web" class="debugger-applog-web">AppLog调试</div>';var n=document.createElement("div");n.innerHTML='<div id="debugger-container" class="debugger-container"></div>',document.getElementsByTagName("body")[0].appendChild(i),document.getElementsByTagName("body")[0].appendChild(n),document.getElementById("debugger-applog-web").addEventListener("click",function(){(window.opener||window.parent).postMessage({type:"devtool:web:open-draw"},location.origin)})},e}(),J={autotrack:{src:{sg:"https://sf16-scmcdn-sg.ibytedtos.com/obj/static-sg/log-sdk/collect/5.0/plugin/autotrack.js",va:"https://sf16-scmcdn-va.ibytedtos.com/obj/static-us/log-sdk/collect/5.0/plugin/autotrack.js"},object:"LogAutoTrack"},ab:{src:{sg:"https://sf16-scmcdn-sg.ibytedtos.com/obj/static-sg/log-sdk/collect/5.0/plugin/ab.js",va:"https://sf16-scmcdn-va.ibytedtos.com/obj/static-us/log-sdk/collect/5.0/plugin/ab.js"},object:"LogAb"},stay:{src:{sg:"https://sf16-scmcdn-sg.ibytedtos.com/obj/static-sg/log-sdk/collect/5.0/plugin/stay.js",va:"https://sf16-scmcdn-va.ibytedtos.com/obj/static-us/log-sdk/collect/5.0/plugin/stay.js"},object:"LogStay"},route:{src:{sg:"https://sf16-scmcdn-sg.ibytedtos.com/obj/static-sg/log-sdk/collect/5.0/plugin/route.js",va:"https://sf16-scmcdn-va.ibytedtos.com/obj/static-us/log-sdk/collect/5.0/plugin/route.js"},object:"LogRoute"},tracer:{src:{sg:"https://sf16-scmcdn-sg.ibytedtos.com/obj/static-sg/log-sdk/collect/5.0/plugin/tracer.js",va:"https://sf16-scmcdn-va.ibytedtos.com/obj/static-us/log-sdk/collect/5.0/plugin/tracer.js"},object:"LogTracer"},retry:{src:{sg:"https://sf16-scmcdn-sg.ibytedtos.com/obj/static-sg/log-sdk/collect/5.0/plugin/retry.js",va:"https://sf16-scmcdn-va.ibytedtos.com/obj/static-us/log-sdk/collect/5.0/plugin/retry.js"},object:"LogRetry"},visual:{src:{sg:"https://sf16-scmcdn-sg.ibytedtos.com/obj/static-sg/log-sdk/collect/5.0/plugin/visual.js",va:"https://sf16-scmcdn-va.ibytedtos.com/obj/static-us/log-sdk/collect/5.0/plugin/visual.js"},object:"LogVisual"}},W=["ab","autotrack","Stay","store","et","profile","cep","heartbeat","monitor","route","tracer"],Z=function(){function e(e){this.disableAutoPageView=!1,this.bridgeReport=!1,this.staging=!1,this.pluginInstances=[],this.sended=!1,this.started=!1,this.destroy=!1,this.sdkReady=!1,this.adapters={},this.loadType="base",this.sdkStop=!1,this.name=e,this.hook=new l,this.remotePlugin=new Map,this.Types=G,this.adapters.storage=k,this.loadType="full"}return e.usePlugin=function(t,i,n){if(i){for(var o=!1,r=0,a=e.plugins.length;r<a;r++)if(e.plugins[r].name===i){e.plugins[r].plugin=t,e.plugins[r].options=n||{},o=!0;break}o||e.plugins.push({name:i,plugin:t,options:n})}else e.plugins.push({plugin:t})},e.prototype.usePlugin=function(e,t,i){e&&("full"===this.loadType&&W.includes(e)?console.info("your sdk version has "+e+" already ~"):t?"string"==typeof t?this.remotePlugin.get(e)||this.remotePlugin.set(e,{src:t,call:i}):this.remotePlugin.get(e)||this.remotePlugin.set(e,{instance:t}):this.remotePlugin.get(e)||this.remotePlugin.set(e,"sdk"))},e.prototype.init=function(t){var i,n,o=this;try{i=JSON.parse(JSON.stringify(t))}catch(e){i=t}if(this.logger=new U(this.name,i.log),this.inited)this.logger.warn("[instance: "+this.name+"], every instance's api: init,  can be call only one time!");else if(i&&u(i))if(i.app_id&&"number"==typeof(n=i.app_id)&&!isNaN(n))if(!i.app_key||function(e){return"string"==typeof e}(i.app_key)){var r=["sg","va","in","ie","ie2"];i.channel_domain||-1!==r.indexOf(i.channel)||(this.logger.warn("your channel: "+i.channel+" is not exist. channel must be one of "+r.join(",")+", use sg instead, please check!!!"),i.channel="sg"),this.spider=new N,this.spider.checkSpider(i)?this.logger.warn("The current environment may be a spider, can not report!"):(this.appBridge=new L(this,i.enable_native),this.requestManager=new H(this,i),this.bridgeReport=this.appBridge.bridgeInject(),this.configManager=new B(this,i),this.debugger=new F(this,i),this.initConfig=i,this.emit(G.Init),this.emit(c.DEBUGGER_MESSAGE,{type:c.DEBUGGER_MESSAGE_SDK,info:"SDK 执行INIT",data:i,level:"info",time:Date.now()}),i.disable_auto_pv&&(this.disableAutoPageView=!0),this.bridgeReport||(this.configManager.setAppid(i.app_id),this.eventManager=new P,this.tokenManager=new V,this.sessionManager=new q,Promise.all([new Promise(function(e){o.once(G.TokenComplete,function(){e(!0)})}),new Promise(function(e){o.once(G.Start,function(){e(!0)})})]).then(function(){try{e.plugins.reduce(function(e,t){var i=t.plugin,n=t.options,r=Object.assign(o.initConfig,n),a=new i;return a.apply(o,r),e.push(a),e},o.pluginInstances)}catch(e){console.warn("load plugin error, "+e.message),o.emit(c.DEBUGGER_MESSAGE,{type:c.DEBUGGER_MESSAGE_SDK,info:"发生了异常",level:"error",time:Date.now(),data:e.message})}o.sdkReady=!0,o.emit(G.Ready),o.emit(c.DEBUGGER_MESSAGE,{type:c.DEBUGGER_MESSAGE_SDK,info:"SDK 初始化完成",time:Date.now(),level:"info",data:o.configManager.get("user")}),o.logger.info("appid: "+i.app_id+", userInfo:"+JSON.stringify(o.configManager.get("user"))),o.logger.info("appid: "+i.app_id+", sdk is ready, version is 5.2.4_oversea, you can report now !!!"),i.disable_auto_pv&&(o.disableAutoPageView=!0);try{("full"===o.loadType&&i.enable_ab_test||i.autotrack)&&(window.opener||window.parent).postMessage("[tea-sdk]ready","*")}catch(e){o.emit(c.DEBUGGER_MESSAGE,{type:c.DEBUGGER_MESSAGE_SDK,info:"发生了异常",level:"error",time:Date.now(),data:e.message})}o.pageView(),o.on(G.TokenChange,function(e){"webid"===e&&o.pageView(),o.logger.info("appid: "+i.app_id+" token change, new userInfo:"+JSON.stringify(o.configManager.get("user"))),o.emit(c.DEBUGGER_MESSAGE,{type:c.DEBUGGER_MESSAGE_SDK,info:"SDK 设置了用户信息",time:Date.now(),secType:"USER",level:"info",data:o.configManager.get("user")})}),o.on(G.TokenReset,function(){o.logger.info("appid: "+i.app_id+" token reset, new userInfo:"+JSON.stringify(o.configManager.get("user"))),o.emit(c.DEBUGGER_MESSAGE,{type:c.DEBUGGER_MESSAGE_SDK,info:"SDK 重置了用户信息",time:Date.now(),secType:"USER",level:"info",data:o.configManager.get("user")})}),o.on(G.RouteChange,function(e){e.init||i.disable_route_report||o.pageView()})}),this.tokenManager.apply(this,i),this.eventManager.apply(this,i),this.sessionManager.apply(this,i)),this.inited=!0)}else this.logger.warn("app_key param is error, must be string, please check!");else this.logger.warn("app_id param is error, must be number, please check!");else this.logger.warn("init params error,please check")},e.prototype.config=function(e){if(this.inited)if(e&&u(e)){var t;try{t=JSON.parse(JSON.stringify(t))}catch(i){t=e}if(this.bridgeReport)this.appBridge.setConfig(t);else{t._staging_flag&&1===t._staging_flag&&(this.staging=!0),t.disable_auto_pv&&(this.disableAutoPageView=!0,delete t.disable_auto_pv);var i=n({},t);if(this.initConfig&&this.initConfig.configPersist){var o=this.configManager.getStore();o&&(i=Object.assign(o,t)),this.configManager.setStore(t)}i.web_id,i.user_unique_id;var r=function(e,t){var i={};for(var n in e)Object.prototype.hasOwnProperty.call(e,n)&&t.indexOf(n)<0&&(i[n]=e[n]);if(null!=e&&"function"==typeof Object.getOwnPropertySymbols){var o=0;for(n=Object.getOwnPropertySymbols(e);o<n.length;o++)t.indexOf(n[o])<0&&(i[n[o]]=e[n[o]])}return i}(i,["web_id","user_unique_id"]);i.hasOwnProperty("web_id")&&this.emit(G.ConfigWebId,i.web_id),i.hasOwnProperty("user_unique_id")&&this.emit(G.ConfigUuid,i.user_unique_id),this.configManager.set(r),this.emit(c.DEBUGGER_MESSAGE,{type:c.DEBUGGER_MESSAGE_SDK,info:"SDK 执行CONFIG",level:"info",time:Date.now(),data:i})}}else console.warn("config params is error, please check");else console.warn("config must be use after function init")},e.prototype.setDomain=function(e){this.configManager&&this.configManager.setDomain(e),this.emit(G.ConfigDomain)},e.prototype.getConfig=function(e){return this.configManager.get(e)},e.prototype.send=function(){this.start()},e.prototype.start=function(){this.inited&&!this.sended&&(this.sended=!0,this.emit(G.Start),this.emit(c.DEBUGGER_MESSAGE,{type:c.DEBUGGER_MESSAGE_SDK,info:"SDK 执行START",level:"info",time:Date.now()}),this.bridgeReport&&(this.pageView(),this.emit(G.Ready)))},e.prototype.event=function(e,t){var i=this;try{var n=[];if(Array.isArray(e))e.forEach(function(e){var t=i.processEvent(e[0],e[1]||{});t&&n.push(t)});else{var o=this.processEvent(e,t);if(!o)return;n.push(o)}this.bridgeReport?n.forEach(function(e){var t=e.event,n=e.params;i.appBridge.onEventV3(t,JSON.stringify(n))}):n.length&&(this.emit(G.Event,n),this.emit(G.SessionResetTime))}catch(e){this.logger.warn("something error, please check"),this.emit(c.DEBUGGER_MESSAGE,{type:c.DEBUGGER_MESSAGE_SDK,info:"发生了异常",level:"error",time:Date.now(),data:e.message})}},e.prototype.beconEvent=function(e,t){if(Array.isArray(e))this.logger.warn("beconEvent not support batch report, please check");else{var i=[],n=this.processEvent(e,t||{});n&&(i.push(n),i.length&&(this.emit(G.BeconEvent,i),this.emit(G.SessionResetTime)))}},e.prototype.beaconEvent=function(e,t){this.beconEvent(e,t)},e.prototype.processEvent=function(e,t){void 0===t&&(t={});try{if(!e)return console.warn("eventName is null， please check"),null;var i=e;/^event\./.test(e)&&(i=e.slice(6));var n=t;"object"!=typeof n&&(n={}),n.profile?delete n.profile:n.event_index=d();var o=void 0;return n.local_ms?(o=n.local_ms,delete n.local_ms):o=+new Date,{event:i,params:n,local_time_ms:o,is_bav:this.initConfig&&this.initConfig.autotrack?1:0}}catch(i){return this.emit(c.DEBUGGER_MESSAGE,{type:c.DEBUGGER_MESSAGE_SDK,info:"发生了异常",level:"error",time:Date.now(),data:i.message}),{event:e,params:t}}},e.prototype.filterEvent=function(e){this.eventFilter=e},e.prototype.on=function(e,t){this.hook.on(e,t)},e.prototype.once=function(e,t){this.hook.once(e,t)},e.prototype.off=function(e,t){this.hook.off(e,t)},e.prototype.emit=function(e,t,i){this.hook.emit(e,t,i)},e.prototype.set=function(e){this.hook.set(e)},e.prototype.stop=function(){this.sdkStop=!0},e.prototype.reStart=function(){this.sdkStop=!1},e.prototype.pageView=function(){this.disableAutoPageView||this.predefinePageView()},e.prototype.predefinePageView=function(e){if(void 0===e&&(e={}),this.inited){var t={title:document.title||location.pathname,url:location.href,url_path:location.pathname,time:Date.now(),referrer:window.document.referrer,$is_first_time:""+(this.configManager&&this.configManager.is_first_time||!1)},i=n(n({},t),e);this.event("predefine_pageview",i)}else console.warn("predefinePageView should call after init")},e.prototype.clearEventCache=function(){this.emit(G.CleanEvents)},e.prototype.setWebId=function(e){this.config({web_id:""+e})},e.prototype.setNativeAppId=function(e){this.bridgeReport&&this.appBridge.setNativeAppId(e)},e.prototype.getSessionId=function(){return K()},e.prototype.setSessionId=function(e){this.emit(G.SessionReset,e)},e.prototype.resetStayDuration=function(e,t,i){this.emit(G.ResetStay,{url_path:e,title:t,url:i},G.Stay)},e.prototype.resetStayParams=function(e,t,i){void 0===e&&(e=""),void 0===t&&(t=""),void 0===i&&(i=""),this.emit(G.SetStay,{url_path:e,title:t,url:i},G.Stay)},e.prototype.getToken=function(e,t){var i=this;if(this.inited){var o=!1,r=function(t){if(!o){o=!0;var r=i.configManager.get().user;return t&&(r.tobid=t,r["diss".split("").reverse().join("")]=t),e(n({},r))}},a=function(){i.tokenManager.getTobId().then(function(e){r(e)})};this.sdkReady?a():(t&&setTimeout(function(){r()},t),this.on(G.Ready,function(){a()}))}else console.warn("predefinePageView should call after init")},e.prototype.profileSet=function(e){this.bridgeReport?this.appBridge.profileSet(JSON.stringify(e)):this.emit(G.ProfileSet,e,G.Profile),this.emit(c.DEBUGGER_MESSAGE,{type:c.DEBUGGER_MESSAGE_SDK,info:"SDK 执行profileSet",level:"info",time:Date.now(),data:e})},e.prototype.profileSetOnce=function(e){this.bridgeReport?this.appBridge.profileSetOnce(JSON.stringify(e)):this.emit(G.ProfileSetOnce,e,G.Profile),this.emit(c.DEBUGGER_MESSAGE,{type:c.DEBUGGER_MESSAGE_SDK,info:"SDK 执行profileSetOnce",level:"info",time:Date.now(),data:e})},e.prototype.profileIncrement=function(e){this.bridgeReport?this.appBridge.profileIncrement(JSON.stringify(e)):this.emit(G.ProfileIncrement,e,G.Profile),this.emit(c.DEBUGGER_MESSAGE,{type:c.DEBUGGER_MESSAGE_SDK,info:"SDK 执行profileIncrement",level:"info",time:Date.now(),data:e})},e.prototype.profileUnset=function(e){this.bridgeReport?this.appBridge.profileUnset(e):this.emit(G.ProfileUnset,e,G.Profile),this.emit(c.DEBUGGER_MESSAGE,{type:c.DEBUGGER_MESSAGE_SDK,info:"SDK 执行profileUnset",level:"info",time:Date.now(),data:e})},e.prototype.profileAppend=function(e){this.bridgeReport?this.appBridge.profileAppend(JSON.stringify(e)):this.emit(G.ProfileAppend,e,G.Profile),this.emit(c.DEBUGGER_MESSAGE,{type:c.DEBUGGER_MESSAGE_SDK,info:"SDK 执行profileAppend",level:"info",time:Date.now(),data:e})},e.prototype.setExternalAbVersion=function(e){this.emit(G.AbExternalVersion,"string"==typeof e&&e?(""+e).trim():null,G.Ab)},e.prototype.getVar=function(e,t,i,n){this.emit(G.AbVar,{name:e,defaultValue:t,callback:i,uuid:n},G.Ab)},e.prototype.getABconfig=function(e,t){this.emit(G.AbConfig,{params:e,callback:t},G.Ab)},e.prototype.getAbSdkVersion=function(){return this.configManager.getAbVersion()},e.prototype.onAbSdkVersionChange=function(e){var t=this;return this.emit(G.AbVersionChangeOn,e,G.Ab),function(){t.emit(G.AbVersionChangeOff,e,G.Ab)}},e.prototype.offAbSdkVersionChange=function(e){this.emit(G.AbVersionChangeOff,e,G.Ab)},e.prototype.openOverlayer=function(){this.emit(G.AbOpenLayer,"",G.Ab)},e.prototype.closeOverlayer=function(){this.emit(G.AbCloseLayer,"",G.Ab)},e.prototype.getAllVars=function(e){this.emit(G.AbAllVars,e,G.Ab)},e.prototype.destoryInstace=function(){this.destroy||(this.destroy=!0,this.off(G.TokenComplete),this.emit(G.DestoryInstance))},e.prototype.destroyInstance=function(){this.destroy||(this.destroy=!0,this.off(G.TokenComplete),this.emit(G.DestoryInstance))},e.plugins=[],e}(),X="__rangers_ab_style__";!function(e){e[e.Var=0]="Var",e[e.All=1]="All"}(x||(x={}));var $=function(){function e(){this.fetchStatus="no",this.refreshFetchStatus="no",this.versions=[],this.extVersions=[],this.mulilinkVersions=[],this.enable_multilink=!1,this.enable_ab_visual=!1,this.editMode=!1,this.callbacks=[],this.data={},this.changeListener=new Map,this.readyStatus=!1,this.exposureCache=[]}return e.prototype.apply=function(e,t){var i=this;if(this.collect=e,this.config=t,this.config.enable_ab_test){var n=t.enable_multilink,o=t.ab_channel_domain,r=t.enable_ab_visual,a=t.ab_cross,s=t.ab_cookie_domain,c=t.ab_timeout,l=T[t.channel||"sg"]||T.sg,u=o||p(l),h=e.adapters.storage;this.cacheStorgae=new h(!1),this.timeout=c||3e3,this.enable_multilink=n,this.enable_ab_visual=r,this.abKey="__tea_sdk_ab_version_"+t.app_id,this.ab_cross=a,this.ab_cookie_domain=s||"",this.fetchUrl=u+"/service/2/abtest_config/",this.reportUrl=this.collect.configManager.getUrl("event"),this.exposureLimit=t.exposure_limit||20,this.ab_batch_time=t.ab_batch_time||500,this.ab_user_mode=t.ab_user_mode||"user_unique_id";var d=this.collect.Types;this.types=d,this.collect.on(d.TokenChange,function(e){"uuid"===e&&i.readyStatus&&(i.clearCache(),i.fetchAB())}),this.collect.on(d.AbVar,function(e){var t=e.name,n=e.defaultValue,o=e.callback;i.getVar(t,n,o)}),this.collect.on(d.AbAllVars,function(e){i.getAllVars(e)}),this.collect.on(d.AbConfig,function(e){var t=e.params,n=e.callback;i.getABconfig(t,n)}),this.collect.on(d.AbExternalVersion,function(e){i.setExternalAbVersion(e)}),this.collect.on(d.AbOpenLayer,function(){i.openOverlayer()}),this.collect.on(d.AbCloseLayer,function(){i.closeOverlayer()}),this.collect.on(d.AbVersionChangeOn,function(e){i.changeListener.set(e,e)}),this.collect.on(d.AbVersionChangeOff,function(e){i.changeListener.get(e)&&i.changeListener.delete(e)}),this.loadMode(),(this.enable_ab_visual||this.enable_multilink)&&this.openOverlayer(this.config.multilink_timeout_ms||500),this.checkLocal(),this.ready("ab"),this.readyStatus||(this.fetchAB(),this.readyStatus=!0),this.collect.emit(d.AbReady)}},e.prototype.ready=function(e){var t=this;if(this.collect.set(e),this.collect.hook._hooksCache.hasOwnProperty(e)){var i=this.collect.hook._hooksCache[e];if(!Object.keys(i).length)return;var n=function(e){i[e].length&&i[e].forEach(function(i){t.collect.hook.emit(e,i)})};for(var o in i)n(o)}},e.prototype.loadMode=function(){var e=function(){try{return JSON.parse(atob(window.name))||void 0}catch(e){return}}(),t="";if(e){var i=e.scenario,n=e.href;i?(this.editMode=!0,t=i):!n||-1===n.indexOf("datatester")&&-1===n.indexOf("visual-editor")||(this.editMode=!0,t="visual-editor")}this.enable_ab_visual&&"visual-editor"===t&&this.collect.destoryInstace()},e.prototype.checkLocal=function(){var e=this.getABCache(),t=e.ab_version,i=e.ab_ext_version,n=e.ab_version_multilink,o=(e.data,this.checkFromUrl());o?this.mulilinkVersions.push(o):this.mulilinkVersions=n||[],this.extVersions=i||[],this.versions=t||[];var r=this.versions.concat(this.extVersions);this.enable_multilink&&(r=r.concat(this.mulilinkVersions))},e.prototype.checkFromUrl=function(){var e=m(window.location.href);return e&&e.vid?e.vid:""},e.prototype.updateVersions=function(){var e=this.extVersions.length?this.versions.concat(this.extVersions):this.versions;this.enable_multilink&&(e=e.concat(this.mulilinkVersions)),this.configVersions(e.join(",")),this.updateABCache(),this.changeListener.size>0&&this.changeListener.forEach(function(t){"function"==typeof t&&t(e)})},e.prototype.configVersions=function(e){this.collect.configManager.setAbVersion(e)},e.prototype.getVar=function(e,t,i,n){if(!e)throw new Error("variable must not be empty");if(void 0===t)throw new Error("variable no default value");if("function"!=typeof i)throw new Error("callback must be a function");var o={name:e,defaultValue:t,callback:i,type:x.Var};"complete"===this.fetchStatus&&"complete"===this.refreshFetchStatus?this.getRealVar(o,e,n):this.callbacks.push(o)},e.prototype.setAbUuid=function(e,t){this.collect.configManager.setAbUuidCache(e,t)},e.prototype.getRealVar=function(e,t,i){var n=e.name,o=e.defaultValue,r=e.callback,a=this.data;if(a){if(u(a[n])){var s=a[n].vid;return"$ab_url"===t?this.mulilinkVersions.includes(s)||this.mulilinkVersions.push(s):this.versions.includes(s)||this.versions.push(s),this.setAbUuid(s,i),this.updateVersions(),this.fechEvent(s,t,o),r(a[n].val),void this.collect.emit(c.DEBUGGER_MESSAGE,{type:c.DEBUGGER_MESSAGE_SDK,secType:"AB",info:"SDK 曝光了实验"+n,level:"info",time:Date.now(),data:a[n]})}this.collect.emit(c.DEBUGGER_MESSAGE,{type:c.DEBUGGER_MESSAGE_SDK,secType:"AB",info:"SDK 调用getVar",level:"info",time:Date.now(),data:o}),r(o)}else r(o)},e.prototype.getAllVars=function(e){if("function"!=typeof e)throw new Error("callback must be a function");var t={callback:e,type:x.All};"complete"===this.fetchStatus&&"complete"===this.refreshFetchStatus?this.getRealAllVars(t):this.callbacks.push(t)},e.prototype.getRealAllVars=function(e){(0,e.callback)(this.data?JSON.parse(JSON.stringify(this.data)):{}),this.collect.emit(c.DEBUGGER_MESSAGE,{type:c.DEBUGGER_MESSAGE_SDK,secType:"AB",info:"SDK 调用getAllVars",level:"info",time:Date.now(),data:this.data})},e.prototype.fechEvent=function(e,t,i){try{if(this.config.disable_track_event)return;if(!e)return;var n=this.collect.configManager.get(),o=n.header,r=n.user,a=this.getABCache(),s=r[this.ab_user_mode]||r.user_unique_id;if(a&&a.uuid&&a.uuid!==s)return;var l={event:"abtest_exposure",ab_sdk_version:""+e,params:JSON.stringify({app_id:this.config.appId,ab_url:"$ab_url"===t?i:window.location.href,data:this.data}),local_time_ms:Date.now()};o.custom=JSON.stringify(o.custom);var u={events:[l],user:r,header:o};this.reportExposure(u,t)}catch(e){this.collect.emit(c.DEBUGGER_MESSAGE,{type:c.DEBUGGER_MESSAGE_SDK,info:"发生了异常",level:"error",time:Date.now(),data:e.message})}},e.prototype.reportExposure=function(e,t){var i=this;this.exposureCache.push(e),this.reportTimeout&&clearTimeout(this.reportTimeout),this.exposureCache.length>=this.exposureLimit?this.report(t):this.reportTimeout=setTimeout(function(){i.report(t),clearTimeout(i.reportTimeout)},this.ab_batch_time)},e.prototype.report=function(e){var t=this;this.collect.requestManager.useRequest({url:this.reportUrl,data:this.exposureCache,timeout:2e4,useBeacon:"$ab_url"===e}),this.exposureCache.forEach(function(e){t.collect.emit(c.DEBUGGER_MESSAGE,{type:c.DEBUGGER_MESSAGE_EVENT,info:"埋点上报成功",time:Date.now(),data:[e],code:200,status:"success"})}),this.exposureCache=[]},e.prototype.setExternalAbVersion=function(e){this.extVersions=[e],this.updateVersions()},e.prototype.getABconfig=function(e,t){var i=Object.keys(e);i&&i.length&&this.collect.configManager.set(e),this.fetchAB(t)},e.prototype.get=function(e){return this.cacheStorgae.getItem(e)},e.prototype.set=function(e,t){this.cacheStorgae.setItem(e,t),this.collect.configManager.setAbCache(t),this.collect.event("abtest_cache",{env_uuid:this.collect.configManager.get("user").user_unique_id||"",cache:JSON.stringify(t)})},e.prototype.getABCache=function(e){var t={ab_version:[],ab_ext_version:[],ab_version_multilink:[],data:null,timestamp:+new Date,uuid:""};return t=this.get(this.abKey)||t,e?t[e]:t},e.prototype.updateABCache=function(){var e=this.getABCache();e.ab_version_multilink=this.mulilinkVersions,e.ab_ext_version=this.extVersions,e.ab_version=this.versions,e.timestamp=Date.now(),this.set(this.abKey,e)},e.prototype.setAbCache=function(e){var t=this.getABCache();t.data=this.data,t.uuid=e,t.timestamp=Date.now(),this.set(this.abKey,t)},e.prototype.clearCache=function(){this.refreshFetchStatus="ing",this.data={},this.extVersions=[],this.mulilinkVersions=[],this.versions=[],this.collect.configManager.clearAbCache()},e.prototype.openOverlayer=function(e){var t=this;if(function(){if(!document.getElementById(X)){var e="body { opacity: 0 !important; }",t=document.head||document.getElementsByTagName("head")[0],i=document.createElement("style");i.id=X,i.type="text/css",i.styleSheet?i.styleSheet.cssText=e:i.appendChild(document.createTextNode(e)),t.appendChild(i)}}(),e)var i=setTimeout(function(){t.closeOverlayer(),clearTimeout(i)},e)},e.prototype.closeOverlayer=function(){var e;(e=document.getElementById(X))&&e.parentElement.removeChild(e)},e.prototype.fetchComplete=function(e,t){var i=this;try{if(e&&"[object Object]"==Object.prototype.toString.call(e)){this.data=e,this.setAbCache(t);var n=[];Object.keys(e).forEach(function(t){var i=e[t].vid;i&&n.push(i)}),this.versions=this.versions.filter(function(e){return n.includes(e)});var o=e.$ab_url,r=e.$ab_modification;if(r&&r.val&&this.enable_ab_visual){if(this.collect.destroy)return}else if(o&&this.enable_multilink){this.mulilinkVersions=this.mulilinkVersions.filter(function(e){return n.includes(e)});var a=o.val,s=o.vid;a&&s&&this.getVar("$ab_url",a,function(){i.editMode||(a!==window.location.href?setTimeout(function(){if(!i.collect.destroy){var e=""+a;e=-1===e.indexOf("http")?"https://"+e:e,_(e).host!==location.host?e=e+"&vid="+s:window.history.replaceState("","",e),window.location.href=e}},100):i.closeOverlayer())})}this.updateVersions()}else this.closeOverlayer();this.callbacks.forEach(function(e){return i[e.type===x.Var?"getRealVar":"getRealAllVars"](e,"")}),this.callbacks=[]}catch(e){}},e.prototype.fetchAB=function(e){var t=this,i=this.collect.configManager.get(),o={header:n(n(n({aid:this.config.app_id},i.user||{}),i.header||{}),{ab_sdk_version:this.collect.configManager.getAbVersion(),ab_url:window.location.href})},r=i.user[this.ab_user_mode]||i.user.user_unique_id;this.collect.emit(c.DEBUGGER_MESSAGE,{type:c.DEBUGGER_MESSAGE_SDK,info:"SDK 发起AB实验请求",level:"info",logType:"fetch",time:Date.now(),data:o}),this.collect.requestManager.useRequest({url:this.fetchUrl,data:o,success:function(i){t.fetchStatus="complete",t.refreshFetchStatus="complete";var n=i.data;"success"===i.message?(t.fetchComplete(n,r),e&&e(n)):(t.fetchComplete(null,r),e&&e(null)),t.collect.emit(t.types.AbComplete,n),t.collect.emit(c.DEBUGGER_MESSAGE,{type:c.DEBUGGER_MESSAGE_SDK,secType:"AB",info:"AB实验请求成功",level:"info",logType:"fetch",time:Date.now(),data:n})},fail:function(){t.fetchStatus="complete",t.refreshFetchStatus="complete",t.fetchComplete(null,r),t.collect.emit(t.types.AbTimeout),e&&e(null),t.collect.emit(c.DEBUGGER_MESSAGE,{type:c.DEBUGGER_MESSAGE_SDK,secType:"AB",info:"AB实验请求网络异常",level:"error",logType:"fetch",time:Date.now()})},timeout:this.timeout})},e.prototype.filterUrl=function(e){try{var t="";-1!==e.indexOf("&multilink=true")?t="&multilink=true[\0-ÿ]*":-1!==e.indexOf("?multilink=true")&&(t="\\?multilink=true[\0-ÿ]*");var i=new RegExp(t,"g");e=e.replace(i,"")}catch(e){}return e},e}(),Y=function(){function e(){}return e.prototype.apply=function(e,t){var i=this;if(t.event_verify_url)if("string"==typeof t.event_verify_url){if(this.url=t.event_verify_url+"/v1/list_test",this.url){var n=e.Types;e.on(n.SubmitBefore,function(t){e.requestManager.useBeacon({url:i.url,data:t})})}}else console.log("please use correct et_test url")},e}(),Q=function(){function e(e,t){this.maxDuration=432e5,this.aliveDTime=6e4,this.options={aliveName:"predefine_page_alive",params:{}},this.focusState=!0,this.collect=e,this.config=t,this.pageStartTime=Date.now(),this.sessionStartTime=this.pageStartTime,this.timerHandler=null,u(t.enable_stay_duration)&&(this.options=Object.assign(this.options,t.enable_stay_duration)),this.hard=this.options.mode&&"hard"===this.options.mode,this.focusState=document.hasFocus()}return e.prototype.setParams=function(e,t,i){this.set_path=e,this.set_url=i,this.set_title=t},e.prototype.enable=function(e,t,i){this.url_path=e,this.url=i,this.title=t,this.disableCallback=this.enablePageAlive(),this.hard&&(this.removeMode=this.hardMode())},e.prototype.disable=function(){this.disableCallback(),this.pageStartTime=Date.now()},e.prototype.sendEvent=function(e,t){void 0===t&&(t=!1);var i=t?this.aliveDTime:Date.now()-this.sessionStartTime;i<0||i>this.aliveDTime||Date.now()-this.pageStartTime>this.maxDuration||t&&"hidden"===document.visibilityState||this.hard&&!this.focusState||(this.collect.beconEvent(this.options.aliveName,n({url_path:this.getParams("url_path"),title:this.getParams("title"),url:this.getParams("url"),duration:i,is_support_visibility_change:g(),startTime:this.sessionStartTime,hidden:document.visibilityState,leave:e,mode:this.hard?"hard":"normal",focusState:this.focusState},this.options.params)),this.sessionStartTime=Date.now())},e.prototype.getParams=function(e){switch(e){case"url_path":return this.set_path||this.url_path||location.pathname;case"title":return this.set_title||this.title||document.title||location.pathname;case"url":return this.set_url||this.url||location.href}},e.prototype.setUpTimer=function(){var e=this;return this.timerHandler&&clearInterval(this.timerHandler),setInterval(function(){Date.now()-e.sessionStartTime>e.aliveDTime&&e.sendEvent(!1,!0)},1e3)},e.prototype.visibilitychange=function(){"hidden"===document.visibilityState?this.timerHandler&&(clearInterval(this.timerHandler),this.sendEvent(!1)):"visible"===document.visibilityState&&(this.sessionStartTime=Date.now(),this.timerHandler=this.setUpTimer())},e.prototype.beforeunload=function(){document.hidden||this.sendEvent(!0)},e.prototype.enablePageAlive=function(){var e=this;this.timerHandler=this.setUpTimer();var t=this.visibilitychange.bind(this),i=this.beforeunload.bind(this);return document.addEventListener("visibilitychange",t),f(i),function(){e.beforeunload(),document.removeEventListener("visibilitychange",t),window.removeEventListener("beforeunload",i),window.removeEventListener("pagehide",i)}},e.prototype.hardMode=function(){var e=this,t=function(){e.timerHandler&&(clearInterval(e.timerHandler),e.sendEvent(!1)),e.focusState=!1},i=function(){e.focusState=!0,e.sessionStartTime=Date.now(),e.timerHandler=e.setUpTimer()};return window.addEventListener("blur",t),window.addEventListener("focus",i),function(){window.removeEventListener("blur",t),window.removeEventListener("focus",i)}},e}(),ee=function(){function e(e,t){var i=this;this.maxDuration=432e5,this.aliveDTime=6e4,this.options={closeName:"predefine_page_close",params:{}},this.focusState=!0,this.visibilitychange=function(){"hidden"===document.visibilityState?i.activeEndTime=Date.now():"visible"===document.visibilityState&&(i.activeEndTime&&(i.totalTime+=i.activeEndTime-i.activeStartTime,i.activeTimes+=1),i.activeEndTime=void 0,i.activeStartTime=Date.now())},this.beforeunload=function(){if(i.totalTime+=(i.activeEndTime||Date.now())-i.activeStartTime,i.config.autotrack)try{window.sessionStorage.setItem("_tea_cache_duration",JSON.stringify({duration:i.totalTime,page_title:document.title||location.pathname}))}catch(e){}i.sendEventPageClose()},this.collect=e,this.config=t,this.maxDuration=t.maxDuration||864e5,this.pageStartTime=Date.now(),u(t.enable_stay_duration)&&(this.options=Object.assign(this.options,t.enable_stay_duration)),this.hard=this.options.mode&&"hard"===this.options.mode,this.focusState=document.hasFocus(),this.resetData()}return e.prototype.setParams=function(e,t,i){this.set_path=e,this.set_url=i,this.set_title=t},e.prototype.resetParams=function(e,t,i){this.url_path=e,this.url=i,this.title=t},e.prototype.enable=function(e,t,i){this.url_path=e,this.url=i,this.title=t,this.disableCallback=this.enablePageClose(),this.hard&&(this.removeMode=this.hardMode())},e.prototype.disable=function(){this.disableCallback()},e.prototype.resetData=function(){this.activeStartTime=void 0===this.activeStartTime?this.pageStartTime:Date.now(),this.activeEndTime=void 0,this.activeTimes=1,this.totalTime=0,this.resetParams(location.pathname,document.title,location.href)},e.prototype.sendEventPageClose=function(){var e=Date.now()-this.pageStartTime;this.totalTime<0||e<0||this.totalTime>=this.maxDuration||this.hard&&!this.focusState||(this.collect.beconEvent(this.options.closeName,n({url_path:this.getParams("url_path"),title:this.getParams("title"),url:this.getParams("url"),active_times:this.activeTimes,duration:this.totalTime,total_duration:e,is_support_visibility_change:g(),mode:this.hard?"hard":"normal",focusState:this.focusState},this.options.params)),this.pageStartTime=Date.now(),this.resetData())},e.prototype.getParams=function(e){switch(e){case"url_path":return this.set_path||this.url_path||location.pathname;case"title":return this.set_title||this.title||document.title||location.pathname;case"url":return this.set_url||this.url||location.href}},e.prototype.enablePageClose=function(){var e=this,t=this.visibilitychange.bind(this),i=this.beforeunload.bind(this);return document.addEventListener("visibilitychange",t),f(i),function(){e.beforeunload(),document.removeEventListener("visibilitychange",t),window.removeEventListener("beforeunload",i),window.removeEventListener("pagehide",i)}},e.prototype.hardMode=function(){var e=this,t=function(){e.focusState=!1},i=function(){e.focusState=!0};return window.addEventListener("blur",t),window.addEventListener("focus",i),function(){window.removeEventListener("blur",t),window.removeEventListener("focus",i)}},e}(),te=function(){function e(){}return e.prototype.apply=function(e,t){var i=this;if(this.collect=e,this.config=t,this.config.enable_stay_duration){this.title=document.title||location.pathname,this.url=location.href,this.url_path=location.pathname,this.pageAlive=new Q(e,t),this.pageClose=new ee(e,t);var n=this.collect.Types;this.collect.on(n.ResetStay,function(e){var t=e.url_path,n=e.title,o=e.url;i.resetStayDuration(t,n,o)}),this.collect.on(n.RouteChange,function(e){e.init||t.disable_route_report||i.resetStayDuration()}),this.collect.on(n.SetStay,function(e){var t=e.url_path,n=e.title,o=e.url;i.setStayParmas(t,n,o)}),this.enable(this.url_path,this.title,this.url),this.ready(n.Stay),this.collect.emit(n.StayReady)}},e.prototype.ready=function(e){var t=this;if(this.collect.set(e),this.collect.hook._hooksCache.hasOwnProperty(e)){var i=this.collect.hook._hooksCache[e];if(!Object.keys(i).length)return;var n=function(e){i[e].length&&i[e].forEach(function(i){t.collect.hook.emit(e,i)})};for(var o in i)n(o)}},e.prototype.enable=function(e,t,i){this.pageAlive.enable(e,t,i),this.pageClose.enable(e,t,i)},e.prototype.disable=function(){this.pageAlive.disable(),this.pageClose.disable()},e.prototype.setStayParmas=function(e,t,i){void 0===e&&(e=""),void 0===t&&(t=""),void 0===i&&(i=""),this.pageAlive.setParams(e,t,i),this.pageClose.setParams(e,t,i),this.collect.emit(c.DEBUGGER_MESSAGE,{type:c.DEBUGGER_MESSAGE_SDK,info:"SDK 执行 resetStayParams",level:"info",time:Date.now(),data:{url_path:e,title:t,url:i}})},e.prototype.reset=function(e,t,i){this.disable(),this.enable(e,t,i)},e.prototype.resetStayDuration=function(e,t,i){this.reset(e,t,i),this.collect.emit(c.DEBUGGER_MESSAGE,{type:c.DEBUGGER_MESSAGE_SDK,info:"SDK 执行 resetStayDuration",level:"info",time:Date.now(),data:{url_path:e,title:t,url:i}})},e}(),ie=function(){function e(){var e=this;this.setInterval=function(){e.clearIntervalFunc=function(e,t){void 0===e&&(e=function(){}),void 0===t&&(t=1e3);var i,n=Date.now()+t;return i=window.setTimeout(function o(){var r=Date.now()-n;e(),n+=t,i=window.setTimeout(o,Math.max(0,t-r))},t),function(){window.clearTimeout(i)}}(function(){e.isSessionhasEvent&&e.endCurrentSession()},e.sessionInterval)},this.clearInterval=function(){e.clearIntervalFunc&&e.clearIntervalFunc()}}return e.prototype.apply=function(e,t){var i=this;if(this.collect=e,!t.disable_heartbeat){this.sessionInterval=6e4,this.startTime=0,this.lastTime=0,this.setInterval();var n=this.collect.Types;this.collect.on(n.SessionReset,function(){i.process()})}},e.prototype.endCurrentSession=function(){this.collect.event("_be_active",{start_time:this.startTime,end_time:this.lastTime,url:window.location.href,referrer:window.document.referrer,title:document.title||location.pathname}),this.isSessionhasEvent=!1,this.startTime=0},e.prototype.process=function(){this.isSessionhasEvent||(this.isSessionhasEvent=!0,this.startTime=+new Date);var e=this.lastTime||+new Date;this.lastTime=+new Date,this.lastTime-e>this.sessionInterval&&(this.clearInterval(),this.endCurrentSession(),this.setInterval())},e}(),ne=function(){function e(){}return e.prototype.apply=function(e,t){var i=this;if(this.collect=e,this.config=t,!this.config.channel_domain&&!t.disable_track_event&&!t.disable_sdk_monitor){this.url=e.configManager.getUrl("event");var n=this.collect.Types;this.collect.on(n.Ready,function(){i.sdkOnload()}),this.collect.on(n.SubmitError,function(e){var t=e.type,n=e.eventData,o=e.errorCode;"f_data"===t&&i.sdkError(n,o)})}},e.prototype.sdkOnload=function(){var e=this;try{var t=this.collect.configManager.get(),i=t.header,n=t.user,o=i.app_id,r=i.app_name,a=i.sdk_version,s=n.web_id,c={events:[{event:"onload",params:JSON.stringify({app_id:o,app_name:r||"",sdk_version:a,sdk_type:"npm",sdk_config:this.config,sdk_desc:"TOC_OVERSEA"}),local_time_ms:Date.now()}],user:{user_unique_id:s},header:{}};setTimeout(function(){e.collect.requestManager.useRequest({url:e.url,data:[c],timeout:3e4,app_key:"566f58151b0ed37e",forceXhr:!0})},16)}catch(e){}},e.prototype.sdkError=function(e,t){var i=this;try{var n=e[0],o=n.user,r=n.header,a=[];e.forEach(function(e){e.events.forEach(function(e){a.push(e)})});var s={events:a.map(function(e){return{event:"on_error",params:JSON.stringify({error_code:t,app_id:r.app_id,app_name:r.app_name||"",error_event:e.event,sdk_version:r.sdk_version,local_time_ms:e.local_time_ms,tea_event_index:Date.now(),params:e.params,header:JSON.stringify(r),user:JSON.stringify(o)}),local_time_ms:Date.now()}}),user:{user_unique_id:o.user_unique_id},header:{}};setTimeout(function(){i.collect.requestManager.useRequest({url:i.url,data:[s],timeout:3e4,app_key:"566f58151b0ed37e",forceXhr:!0})},16)}catch(e){}},e}();function oe(e,t){if(void 0===t&&(t="list"),!e)return!1;if(t&&"list"===t){if(["LI","TR","DL"].includes(e.nodeName))return!0;if(e.dataset&&e.dataset.hasOwnProperty("teaIdx"))return!0;if(e.hasAttribute&&e.hasAttribute("data-tea-idx"))return!0}else{if(["A","BUTTON"].includes(e.nodeName))return!0;if(e.dataset&&e.dataset.hasOwnProperty("teaContainer"))return!0;if(e.hasAttribute&&e.hasAttribute("data-tea-container"))return!0}return!1}function re(e){for(var t=e;t&&!oe(t,"container");){if("HTML"===t.nodeName||"BODY"===t.nodeName)return e;t=t.parentElement}return t||e}function ae(e){var t="";return 3===e.nodeType?t=e.textContent.trim():e.dataset&&e.dataset.hasOwnProperty("teaTitle")||e.hasAttribute("ata-tea-title")?t=e.getAttribute("data-tea-title"):e.hasAttribute("title")?t=e.getAttribute("title"):"INPUT"===e.nodeName&&["button","submit"].includes(e.getAttribute("type"))?t=e.getAttribute("value"):"IMG"===e.nodeName&&e.getAttribute("alt")&&(t=e.getAttribute("alt")),t.slice(0,200)}var se=function(e,t){return e.hasAttribute?e.hasAttribute(t):e.attributes?!(!e.attributes[t]||!e.attributes[t].specified):void 0},ce=function(){function e(e,t,i){var o=this;this.statistics=!1,this.pageView=!1,this.clickEvent=function(e){(function(e,t){if(1!==e.nodeType)return!1;if(!t.svg&&function(e){if("svg"===e.tagName.toLowerCase())return!0;for(var t=e.parentElement,i=!1;t;)"svg"===t.tagName.toLowerCase()?(t=null,i=!0):t=t.parentElement;return i}(e))return!1;if(["HTML","BODY"].includes(e.tagName.toUpperCase()))return!1;var i=e;return!("none"===i.style.display||!oe(i,"container")&&!function(e){if(e.children.length){var t=e.children;return![].slice.call(t).some(function(e){return e.children.length>0})}return!0}(i)&&!t.svg)})(e.target,o.options)&&o.eventHandel({eventType:"dom",eventName:"click"},e)},this.changeEvent=function(e){o.eventHandel({eventType:"dom",eventName:"change"},e)},this.submitEvent=function(e){o.eventHandel({eventType:"dom",eventName:"submit"},e)},this.getPageViewEvent=function(e,t){t&&"pushState"===t&&o.eventHandel({eventType:"dom",eventName:"beat"},n({beat_type:0},e)),o.eventHandel({eventType:"dom",eventName:"page_view"},e)},this.getPageLoadEvent=function(e){o.eventHandel({eventType:"dom",eventName:"page_statistics"},{lcp:e})},this.config=i.getConfig().eventConfig,this.collect=t,this.options=e,this.beatTime=e.beat}return e.prototype.init=function(e){this.eventHandel=e;var t=this.config.mode;this.addListener(t)},e.prototype.addListener=function(e){var t=this;if("proxy-capturing"===e){if(this.config.click&&window.document.addEventListener("click",this.clickEvent,!0),this.config.change&&window.document.addEventListener("change",this.changeEvent,!0),this.config.submit&&window.document.addEventListener("submit",this.submitEvent,!0),this.config.pv){this.collect.on("route-change",function(e){var i=e.config,n=e.name;t.getPageViewEvent(i,n),t.pageView=!0});var i=setTimeout(function(){t.pageView||(t.getPageViewEvent(t.getDefaultConfig()),t.pageView=!0,clearTimeout(i))},2e3)}if(this.config.beat){try{"complete"===document.readyState?this.beatEvent(this.beatTime):window.addEventListener("load",function(){t.beatEvent(t.beatTime)});var n=0,o=null;window.addEventListener("scroll",function(){clearTimeout(o),o=setTimeout(r,500),n=document.documentElement.scrollTop||document.body.scrollTop});var r=function(){(document.documentElement.scrollTop||document.body.scrollTop)==n&&t.eventHandel({eventType:"dom",eventName:"beat"},{beat_type:1})}}catch(e){}try{var a=window.performance&&window.performance.getEntriesByType("paint");a&&a.length?(new PerformanceObserver(function(e){var i=e.getEntries(),n=i[i.length-1],o=n.renderTime||n.loadTime;t.statistics||(t.getPageLoadEvent(o),t.statistics=!0)}).observe({entryTypes:["largest-contentful-paint"]}),setTimeout(function(){t.statistics||(t.getPageLoadEvent(a[0].startTime||0),t.statistics=!0)},2e3)):this.getPageLoadEvent(0)}catch(e){this.getPageLoadEvent(0)}}}},e.prototype.removeListener=function(){window.document.removeEventListener("click",this.clickEvent,!0),window.document.removeEventListener("change",this.changeEvent,!0),window.document.removeEventListener("submit",this.submitEvent,!0)},e.prototype.beatEvent=function(e){var t=this;try{var i;this.eventHandel({eventType:"dom",eventName:"beat"},{beat_type:3}),this.beatTime&&(i=setInterval(function(){t.eventHandel({eventType:"dom",eventName:"beat"},{beat_type:2})},e)),f(function(){t.eventHandel({eventType:"dom",eventName:"beat",eventSend:"becon"},{beat_type:0}),t.beatTime&&clearInterval(i)})}catch(e){}},e.prototype.getDefaultConfig=function(){return{is_html:1,url:location.href,referrer:document.referrer,page_key:location.href,refer_page_key:document.referrer,page_title:document.title||location.pathname,page_manual_key:"",refer_page_manual_key:"",refer_page_title:"",page_path:location.pathname,page_host:location.host}},e}(),le={eventConfig:{mode:"proxy-capturing",submit:!1,click:!0,change:!1,pv:!0,beat:!0,hashTag:!1,impr:!1},scoutConfig:{mode:"xpath"}},ue=function(){function e(e,t){this.config=e,this.config.eventConfig=Object.assign(this.config.eventConfig,t)}return e.prototype.getConfig=function(){return this.config},e.prototype.setConfig=function(e){return this.config=e},e}();var he,de=function(e,t,i,o,r){return n(n({event:e},function(e,t,i,n){var o={},r=function(e){if(e){var t=e.getBoundingClientRect(),i=t.width,n=t.height;return{left:t.left,top:t.top,element_width:i,element_height:n}}}(t),a=function(e,t){void 0===e&&(e={}),void 0===t&&(t={});var i=e.clientX,n=e.clientY,o=t.left,r=t.top,a=i-o>=0?i-o:0,s=n-r>=0?n-r:0;return{touch_x:Math.floor(a),touch_y:Math.floor(s)}}(e,r),s=r.element_width,c=r.element_height,l=a.touch_x,u=a.touch_y,d=function(e){for(var t=[];null!==e.parentElement;)t.push(e),e=e.parentElement;var i=[],n=[];return t.forEach(function(e){var t=function(e){if(null===e)return{str:"",index:0};var t=0,i=e.parentElement;if(i)for(var n=i.children,o=0;o<n.length&&n[o]!==e;o++)n[o].nodeName===e.nodeName&&t++;return{str:[e.nodeName.toLowerCase(),oe(e,"list")?"[]":""].join(""),index:t}}(e),o=t.str,r=t.index;i.unshift(o),n.unshift(r)}),{element_path:"/"+i.join("/"),positions:n}}(t),p=d.element_path,f=d.positions,g=function(e){var t=re(e),i=[];return function e(t){var n=ae(t);if(n&&-1===i.indexOf(n)&&i.push(n),t.childNodes.length>0)for(var o=t.childNodes,r=0;r<o.length;r++)8!==o[r].nodeType&&e(o[r])}(t),i}(t),_=window.performance.timing.navigationStart,m=Date.now()-_,v=f.map(function(e){return""+e}),y=null;if(window.TEAVisualEditor&&window.TEAVisualEditor.getOriginXpath&&(y=window.TEAVisualEditor.getOriginXpath({xpath:p,positions:v})),o.element_path=y&&y.xpath||p,o.positions=y&&y.positions||v,n&&!n.text&&(o.texts=g,o.element_title=function(e){var t=re(e),i="";return function e(t){var n=ae(t);if(n&&(i+=n),t.childNodes.length>0)for(var o=t.childNodes,r=0;r<o.length;r++)3===o[r].nodeType&&e(o[r])}(t),i}(t)),o.element_id=t.getAttribute("id")||"",o.element_class_name=t.getAttribute("class")||"",o.element_type=t.nodeType,o.element_width=Math.floor(s),o.element_height=Math.floor(c),o.touch_x=l,o.touch_y=u,o.page_manual_key="",o.elememt_manual_key="",o.since_page_start_ms=m,o.page_start_ms=_,o.page_path=location.pathname,o.page_host=location.host,i.track_attr&&function(e,t){return!!function(e,t){if("string"==typeof t)return se(e,t);if(h(t)){for(var i=!1,n=0;n<t.length;n++)if(se(e,t[n])){i=!0;break}return i}}(e,t)}(t,i.track_attr)){var b=function(e,t){var i={};if("string"==typeof t)se(e,t)&&(i.attrs=e.getAttribute(t));else if(h(t))for(var n=0;n<t.length;n++)se(e,t[n])&&(i[t[n]]=e.getAttribute(t[n]));return i}(t,i.track_attr);for(var E in b)o[E]=b[E]}var w=re(t);return"A"===w.tagName&&(o.href=w.getAttribute("href")),"IMG"===t.tagName&&(o.src=t.getAttribute("src")),o}(t,i,o,r)),{is_html:1,page_key:window.location.href,page_title:document.title})},pe=function(){function e(e,t){this.ignore={text:!0},this.initConfig=e,this.options=t,this.eventName=t&&"tea"===t.custom?{click:"__bav_click",page:"__bav_page",beat:"__bav_beat",static:"__bav_page_statistics",exposure:"__bav_page_exposure"}:{click:"bav2b_click",page:"bav2b_page",beat:"bav2b_beat",static:"bav2b_page_statistics",exposure:"bav2b_exposure"},t&&!0===t.text&&(this.ignore.text=!1),t&&t.exposure&&t.exposure.eventName&&(this.eventName.exposure=t.exposure.eventName)}return e.prototype.handleEvent=function(e,t){try{if(function(e){for(var t=e;t&&t.parentNode;){if(t.hasAttribute("data-tea-ignore"))return!0;if("HTML"===t.nodeName||"body"===t.nodeName)return!1;t=t.parentNode}return!1}(e.target))return null;var i="bav2b_click";switch(t){case"click":return i=this.eventName.click,de(i,e,e.target,this.options,this.ignore);case"exposure":return i=this.eventName.exposure,de(i,e,e.target,this.options,this.ignore);case"change":return n(n({},de(i="bav2b_change",e,e.target,this.options)),function(e,t){try{if("bav2b_change"===e)return t.hasAttribute("data-tea-track")?{value:t.value}:{}}catch(e){return{}}}(i,e.target));case"submit":return de(i="bav2b_submit",e,e.target,this.options)}}catch(e){return console.error(e),null}},e.prototype.handleViewEvent=function(e){e.event=this.eventName.page,e.page_title=document.title,e.page_total_width=window.innerWidth,e.page_total_height=window.innerHeight;try{var t=window.sessionStorage.getItem("_tea_cache_duration");if(t){var i=JSON.parse(t);e.refer_page_duration_ms=i?i.duration:""}e.scroll_width=document.documentElement.scrollLeft?document.documentElement.scrollLeft+window.innerWidth:window.innerWidth,e.scroll_height=document.documentElement.scrollTop?document.documentElement.scrollTop+window.innerHeight:window.innerHeight,e.page_start_ms=window.performance.timing.navigationStart}catch(e){console.log("page event error "+JSON.stringify(e))}return e},e.prototype.handleStatisticsEvent=function(e){var t={};t.event=this.eventName.static,t.is_html=1,t.page_key=location.href,t.refer_page_key=document.referrer||"",t.page_title=document.title,t.page_manual_key=this.initConfig.autotrack.page_manual_key||"",t.refer_page_manual_key="";try{var i=e.lcp,n=window.performance.timing,o=n.loadEventEnd-n.navigationStart;t.page_init_cost_ms=parseInt(i||(o>0?o:0)),t.page_start_ms=n.navigationStart}catch(e){console.log("page_statistics event error "+JSON.stringify(e))}return t},e.prototype.handleBeadtEvent=function(e){e.event=this.eventName.beat,e.page_key=window.location.href,e.is_html=1,e.page_title=document.title,e.page_manual_key=this.initConfig.autotrack.page_manual_key||"";try{e.page_viewport_width=window.innerWidth,e.page_viewport_height=window.innerHeight,e.page_total_width=document.documentElement.scrollWidth,e.page_total_height=document.documentElement.scrollHeight,e.scroll_width=document.documentElement.scrollLeft+window.innerWidth,e.scroll_height=document.documentElement.scrollTop+window.innerHeight,e.since_page_start_ms=Date.now()-window.performance.timing.navigationStart,e.page_start_ms=window.performance.timing.navigationStart}catch(e){console.log("beat event error "+JSON.stringify(e))}return e},e}(),fe=function(){function e(e){this.collect=e,this.eventNameList=["report_click_event","report_change_event","report_submit_event","report_exposure_event","report_page_view_event","report_page_statistics_event","report_beat_event"]}return e.prototype.send=function(e,t){var i=e.eventSend,n=t.event;delete t.event,i&&"becon"===i?this.collect.beconEvent(n,t):this.collect.event(n,t)},e.prototype.get=function(e,t){var i=Object.assign({headers:{"content-type":"application/json"},method:"GET"},t);fetch(e,i)},e.prototype.post=function(e,t){var i=Object.assign({headers:{"content-type":"application/json"},method:"POST"},t);fetch(e,i)},e}(),ge=function(){function e(e){this._instance=null,this._intersection=e,this.init()}return e.prototype.init=function(){var e=this;this._instance=new MutationObserver(function(t){t.forEach(function(t){"attributes"===t.type&&e.attributeChangeObserve(t),"childList"===t.type&&e.modifyNodeObserve(t)})}),this._instance.observe(document.body,{childList:!0,attributes:!0,subtree:!0,attributeOldValue:!1})},e.prototype.attributeChangeObserve=function(e){e.target.hasAttribute("data-exposure")?this.exposureAdd(e,"mutation"):this.exposureRemove(e)},e.prototype.modifyNodeObserve=function(e){var t=this;Array.prototype.forEach.call(e.addedNodes,function(e){1===e.nodeType&&e.hasAttribute("data-exposure")&&t.exposureAdd(e,"intersect"),t.mapChild(e,t.exposureAdd)}),Array.prototype.forEach.call(e.removedNodes,function(e){1===e.nodeType&&e.hasAttribute("data-exposure")&&t.exposureRemove(e),t.mapChild(e,t.exposureRemove)})},e.prototype.mapChild=function(e,t){var i=this;1===e.nodeType&&e.children.length&&Array.prototype.forEach.call(e.children,function(e){1===e.nodeType&&e.hasAttribute("data-exposure")&&t(e),i.mapChild(e,t)})},e.prototype.exposureAdd=function(e,t){this._intersection.exposureAdd(e,t)},e.prototype.exposureRemove=function(e){this._intersection.exposureRemove(e)},e._exposure_observer=null,e}(),_e=function(){function e(t,i){this.count=1,this.instance=this.buildObserver(),this.observeMap=e._observer_map,t.autotrack.exposure.ratio?this.Ratio=t.autotrack.exposure.ratio:0===t.autotrack.exposure.ratio?this.Ratio=0:this.Ratio=.5,this.EventHandle=i}return e.prototype.buildObserver=function(){var t=this;if(!e._observer_instance)return IntersectionObserver&&(e._observer_instance=new IntersectionObserver(function(e){e.forEach(function(e){t.observeMap.get(e.target._observeId)&&t.exposureEvent(e)})},{threshold:[.01,.25,.5,.75,1]})),e._observer_instance},e.prototype.exposureAdd=function(e,t){var i=e;"mutation"===t&&(i=e.target);var n=i._observeId;if(n||this.observeMap.has(n)){if(!1===i.visible){var o=i.getBoundingClientRect(),r=o.top,a=o.left,s=o.right,c=o.bottom;r>=0&&c<=window.innerHeight&&a>=0&&s<=window.innerWidth&&(i.visible=!0,this.EventHandle({eventType:"dom",eventName:"exposure"},e))}}else i._observeId=this.count,i.visible=!1,this.observeMap.set(this.count,i),this.observe(i),this.count++},e.prototype.exposureRemove=function(e){this.observeMap.has(e._observeId)&&(this.observeMap.delete(e._observeId),this.unobserve(e))},e.prototype.exposureEvent=function(e){if(e.intersectionRatio>=this.Ratio&&e.isIntersecting){if("0"===e.target.style.opacity||"hidden"===e.target.style.visibility)return;if(!0===e.target.visible)return;e.target.visible=!0,this.EventHandle({eventType:"dom",eventName:"exposure"},e)}else e.target.visible=!1},e.prototype.observe=function(e){this.instance.observe(e)},e.prototype.unobserve=function(e){this.instance.unobserve(e)},e._observer_instance=null,e._observer_map=new Map,e}(),me=function(){function e(e,t){e.autotrack&&e.autotrack.exposure&&(this._intersection=new _e(e,t),this._observer=new ge(this._intersection),this.initObserver())}return e.prototype.initObserver=function(){var e=this;Array.prototype.forEach.call(document.querySelectorAll("[data-exposure]"),function(t){e._intersection.exposureAdd(t,"intersect")})},e}(),ve={hashTag:!1,impr:!1},ye=function(){function e(){}return e.prototype.apply=function(e,t){if(this.autoTrackStart=!1,this.collect=e,this.config=t,t.autotrack){var i=e.Types;t.autotrack&&t.autotrack.collect_url&&!t.autotrack.collect_url()||(this.ready(i.Autotrack),this.collect.emit(i.AutotrackReady))}},e.prototype.ready=function(e){this.collect.set(e);var t=this.config.autotrack;t="object"==typeof t?t:{},t=Object.assign(ve,t),this.destroyed=!1,this.options=t,this.Config=new ue(le,this.options),this.Exposure=new me(this.config,this.handle.bind(this)),this.Listener=new ce(t,this.collect,this.Config),this.EventHandle=new pe(this.config,t),this.Request=new fe(this.collect),this.autoTrackStart=!0,this.init()},e.prototype.init=function(){this.Listener.init(this.handle.bind(this)),"base"===this.collect.loadType&&(window.opener||window.parent).postMessage("[tea-sdk]ready","*")},e.prototype.handle=function(e,t){"dom"===e.eventType&&this.handleDom(e,t)},e.prototype.handleDom=function(e,t){try{var i=e.eventName;if("click"===i||"exposure"===i||"change"===i||"submit"===i){var n=this.EventHandle.handleEvent(t,i);null!==n&&this.Request.send({eventType:"custom",eventName:"report_"+i+"_event",extra:{methods:"GET"}},n)}else if("page_view"===i||"page_statistics"===i){var o;o="page_view"===i?this.EventHandle.handleViewEvent(t):this.EventHandle.handleStatisticsEvent(t),this.Request.send({eventType:"custom",eventName:"report_${eventName}_event",extra:{methods:"GET"}},o)}else if("beat"===i){var r=this.EventHandle.handleBeadtEvent(t),a=e.eventSend;this.Request.send({eventType:"custom",eventName:"report_${eventName}_event",extra:{methods:"GET"},eventSend:a},r)}}catch(e){console.log("handel dom event error "+JSON.stringify(e))}},e.prototype.destroy=function(){if(!this.autoTrackStart)return console.warn("engine is undefined, make sure you have called autoTrack.start()");this.autoTrackStart=!1,this.Listener.removeListener()},e}();!function(e){e.Net="net",e.FailNet="f_net",e.FailData="f_data"}(he||(he={}));var be={pv:["predefine_pageview"],sdk:["_be_active","predefine_page_alive","predefine_page_close","__profile_set","__profile_set_once","__profile_increment","__profile_unset","__profile_append"],autotrack:["bav2b_click","bav2b_page","bav2b_beat","bav2b_page_statistics","__bav_click","__bav_page","__bav_beat","__bav_page_statistics"]},Ee=function(){function e(){}return e.prototype.apply=function(e,t){var i=this;if(this.ready=t.app_id&&t.enable_tracer&&!t.disable_track_event,this.ready){this.limit={pv:1,sdk:3,autotrack:3,log:3},this.errorCode={f_net:0,f_data:0},this.tracerCache=new Map,this.collect=e,this.appid=t.app_id,this.reportUrl=e.configManager.getUrl("event");var n=this.collect.Types;e.adapters.fetch,this.collect.on(n.Event,function(e){h(e)?e.forEach(function(e){i.addCount("log")}):i.addCount("log")}),this.collect.on(n.SubmitError,function(e){var t=e.type,n=e.eventDate,o=e.errorCode,r=e.response;i.addErrorCount(n,t,o,r)}),this.listener(),this.collect.emit(n.TracerReady)}},e.prototype.addCount=function(e,t,i){void 0===t&&(t="net"),void 0===i&&(i=1);try{this.tracerCache||(this.tracerCache=new Map);var n=void 0;if(this.tracerCache.has(e))(o=this.tracerCache.get(e)).has(t)?(n=o.get(t).params.count,n++,o.set(t,this.processTracer(n,e,t))):(n=i,o.set(t,this.processTracer(i,e,t)));else{var o=new Map;n=i,o.set(t,this.processTracer(i,e,t)),this.tracerCache.set(e,o)}"net"===t&&n>=this.limit[e]&&this.report(!1)}catch(e){console.log(e)}},e.prototype.addErrorCount=function(e,t,i,n){var o=this;try{if(e&&e.length){var r=e[0].events;r&&r.length&&("f_data"===t?(n&&n.hasOwnProperty("sc")?this.addCount("log",t,r.length-n.sc):this.addCount("log",t,r.length),this.errorCode[t]=i):r.forEach(function(e){var n="log";for(var r in be)if(-1!==be[r].indexOf(e.event)){n=r;break}o.addCount(n,t,1),o.errorCode[t]=i}))}}catch(e){}},e.prototype.report=function(e){if(this.tracerCache){var t=[];this.tracerCache.forEach(function(e){console.log(e),e.forEach(function(e){t.push(e)})}),t&&t.length&&this.sendTracer(t,e)}},e.prototype.sendTracer=function(e,t){try{var i=this.collect.eventManager.merge(e);this.collect.requestManager.useRequest({url:this.reportUrl,data:i,useBeacon:t}),this.tracerCache=null}catch(e){}},e.prototype.processTracer=function(e,t,i){try{var n={count:e,state:i,key:t,params_for_special:"applog_trace",aid:this.appid,platform:"web",_staging_flag:1,sdk_version:"5.2.4_oversea"};"f_net"!==i&&"f_data"!==i||(n.errorCode=this.errorCode[i]);var o=this.collect.processEvent("applog_trace",n);if(o&&o.event)return delete o.is_bav,o}catch(e){console.warn("something error")}},e.prototype.listener=function(){var e=this;document.addEventListener("visibilitychange",function(){"hidden"===document.visibilityState&&e.leavePage()}),f(function(){e.leavePage()})},e.prototype.leavePage=function(){this.report(!0)},e}(),we="undefined"!=typeof window?(window.LogPluginObject||(window.LogPluginObject={}),window.LogPluginObject):null,Se=function(){function e(){}return e.prototype.apply=function(e,t){this._plugin={},this.config=t,this.collect=e,this.channel=t.channel||"cn",this.loadExtend()},e.prototype.loadExtend=function(){var e=this;try{this.collect.remotePlugin.forEach(function(t,i){if("sdk"===t)if(J.hasOwnProperty(i)){var n=J[i].object,o=""+J[i].src[e.channel];e.exist(i,n,o)}else console.warn("your "+i+" is not exist，please check plugin name");else"object"==typeof t&&(t.src?e.exist(i,t.call,t.src):e.process(i,t.instance,"INSTANCE"))})}catch(e){this.collect.emit(c.DEBUGGER_MESSAGE,{type:c.DEBUGGER_MESSAGE_SDK,info:"发生了异常",level:"error",time:Date.now(),data:e.message}),console.log("load extend error")}},e.prototype.exist=function(e,t,i){var n=this;we[t]?(this.process(e,we[t]),console.log("已有"+e+"插件，避免重复加载~")):this.loadPlugin(e,i,function(){n.process(e,we[t]),console.log(" %c %s %s %s","color: yellow; background-color: black;","–","load plugin:"+e+" success","-")},function(){console.log(" %c %s %s %s","color: red; background-color: yellow;","–","load plugin:"+e+" error","-")})},e.prototype.process=function(e,t,i){try{if(i){var n=new t;n.apply&&n.apply(this.collect,this.config),console.log("excude "+e+" success")}else t&&t(this.collect,this.config)}catch(t){this.collect.emit(c.DEBUGGER_MESSAGE,{type:c.DEBUGGER_MESSAGE_SDK,info:"发生了异常",level:"error",time:Date.now(),data:t.message}),console.log("excude "+e+" error, message:"+t.message)}},e.prototype.loadPlugin=function(e,t,i,n){var o=this;try{var r=document.createElement("script");r.src=t,this._plugin[e]||(this._plugin[e]=[]),this._plugin[e].push(i),r.onerror=function(){n(t)},r.onload=function(){o._plugin[e].forEach(function(e){e()})},document.getElementsByTagName("head")[0].appendChild(r)}catch(e){this.collect.emit(c.DEBUGGER_MESSAGE,{type:c.DEBUGGER_MESSAGE_SDK,info:"发生了异常",level:"error",time:Date.now(),data:e.message})}},e}(),ke=function(){function e(){this.autotrack=!1,this.spa=!1,this.cache={},this.allowHash=!1}return e.prototype.apply=function(e,t){if(t.spa||t.autotrack){var i=e.Types;this.collect=e,this.config=t,this.appid=t.app_id,this.allowHash=t.allow_hash,this.fncArray=new Map,this.setKey(),this.setLocation(),this.hack(),this.init(),this.listener(),e.emit(i.RouteReady)}},e.prototype.setKey=function(){var e=this.collect.adapters.storage;this.storage=new e(!1),this.cache_key="__tea_cache_refer_"+this.appid,this.cache={refer_key:"",refer_title:document.title||location.pathname,refer_manual_key:"",routeChange:!1},this.config.autotrack&&"object"==typeof this.config.autotrack&&this.config.autotrack.page_manual_key&&(this.cache.refer_manual_key=this.config.autotrack.page_manual_key),this.storage.setItem(this.cache_key,this.cache)},e.prototype.hack=function(){var e=this,t=window.history.pushState;history.pushState=function(i){for(var n=[],o=1;o<arguments.length;o++)n[o-1]=arguments[o];"function"==typeof history.onpushstate&&history.onpushstate({state:i});var a=t.call.apply(t,r([history,i],n));if(e.collect.sdkStop||e.collect.destroy)return a;if(!(e.lastLocation===location.href||e.config.disable_spa_query&&e.pathEquel())){var s=e.getPopStateChangeEventData();return e.setReferCache(e.lastLocation),e.lastLocation=location.href,e.sendPv(s,"pushState"),a}};var i=history.replaceState;history.replaceState=function(t){for(var n=[],o=1;o<arguments.length;o++)n[o-1]=arguments[o];"function"==typeof history.onreplacestate&&history.onreplacestate({state:t});var a=i.call.apply(i,r([history,t],n));if(e.collect.sdkStop||e.collect.destroy)return a;if(!(e.lastLocation===location.href||e.config.disable_spa_query&&e.pathEquel())){var s=e.getPopStateChangeEventData();return e.setReferCache(e.lastLocation),e.lastLocation=location.href,e.sendPv(s),a}}},e.prototype.setLocation=function(){"undefined"!=typeof window&&(this.lastLocation=window.location.href)},e.prototype.getLocation=function(){return this.lastLocation},e.prototype.pathEquel=function(){try{return new URL(this.lastLocation).origin+new URL(this.lastLocation).pathname===new URL(location.href).origin+new URL(location.href).pathname}catch(e){return!1}},e.prototype.init=function(){var e=this.getPopStateChangeEventData();this.collect.emit("route-change",{config:e,init:!0})},e.prototype.listener=function(){var e=this;window.addEventListener("hashchange",function(t){if(!e.collect.sdkStop&&!e.collect.destroy&&e.lastLocation!==window.location.href&&(!e.config.disable_spa_query||!e.pathEquel())&&e.allowHash){e.setReferCache(e.lastLocation),e.lastLocation=window.location.href;var i=e.getPopStateChangeEventData();e.sendPv(i)}}),window.addEventListener("popstate",function(t){if(!e.collect.sdkStop&&!e.collect.destroy&&!(e.lastLocation===window.location.href||e.config.disable_spa_query&&e.pathEquel())){e.setReferCache(e.lastLocation),e.lastLocation=window.location.href;var i=e.getPopStateChangeEventData();e.sendPv(i)}})},e.prototype.getPopStateChangeEventData=function(){var e=this.pageConfig();return e.is_back=0,e},e.prototype.pageConfig=function(){try{var e,t=this.storage.getItem(this.cache_key)||{},i=this.storage.getItem("__tea_cache_first_"+this.appid);return e=!i||1!=i,{is_html:1,url:location.href,referrer:this.handleRefer(),page_key:location.href,refer_page_key:this.handleRefer(),page_title:document.title||location.pathname,page_manual_key:this.config.autotrack&&this.config.autotrack.page_manual_key||"",refer_page_manual_key:t&&t.refer_manual_key||"",refer_page_title:t&&t.refer_title||"",page_path:location.pathname,page_host:location.host,is_first_time:""+e}}catch(t){return this.collect.emit(c.DEBUGGER_MESSAGE,{type:c.DEBUGGER_MESSAGE_SDK,info:"发生了异常",level:"error",time:Date.now(),data:t.message}),{}}},e.prototype.sendPv=function(e,t){this.collect.emit("route-change",{config:e,init:!1})},e.prototype.handleRefer=function(){var e="";try{var t=this.storage.getItem()||{};e=t.routeChange?t.refer_key:this.collect.configManager.get("referrer")}catch(t){e=document.referrer}return e},e.prototype.setReferCache=function(e){var t=this.storage.getItem(this.cache_key)||{};t.refer_key=e,t.routeChange=!0,this.storage.setItem(this.cache_key,t)},e}();Z.usePlugin(Se,"extend"),Z.usePlugin(Ee,"tracer"),Z.usePlugin($,"ab"),Z.usePlugin(te,"stay"),Z.usePlugin(ye,"autotrack"),Z.usePlugin(Y,"et"),Z.usePlugin(ie,"heartbeat"),Z.usePlugin(ne,"monitor"),Z.usePlugin(ke,"route"),Z.usePlugin(Ee,"tracer"),new Z("default");var ze=Z},93397:(e,t,i)=>{i.r(t),i.d(t,{Collector:()=>Yn,default:()=>Qn});var n=function(){return(n=Object.assign||function(e){for(var t,i=1,n=arguments.length;i<n;i++)for(var o in t=arguments[i])Object.prototype.hasOwnProperty.call(t,o)&&(e[o]=t[o]);return e}).apply(this,arguments)};function o(e,t,i,n){return new(i||(i=Promise))(function(o,r){function a(e){try{c(n.next(e))}catch(e){r(e)}}function s(e){try{c(n.throw(e))}catch(e){r(e)}}function c(e){e.done?o(e.value):new i(function(t){t(e.value)}).then(a,s)}c((n=n.apply(e,t||[])).next())})}function r(e,t){var i,n,o,r,a={label:0,sent:function(){if(1&o[0])throw o[1];return o[1]},trys:[],ops:[]};return r={next:s(0),throw:s(1),return:s(2)},"function"==typeof Symbol&&(r[Symbol.iterator]=function(){return this}),r;function s(r){return function(s){return function(r){if(i)throw new TypeError("Generator is already executing.");for(;a;)try{if(i=1,n&&(o=2&r[0]?n.return:r[0]?n.throw||((o=n.return)&&o.call(n),0):n.next)&&!(o=o.call(n,r[1])).done)return o;switch(n=0,o&&(r=[2&r[0],o.value]),r[0]){case 0:case 1:o=r;break;case 4:return a.label++,{value:r[1],done:!1};case 5:a.label++,n=r[1],r=[0];continue;case 7:r=a.ops.pop(),a.trys.pop();continue;default:if(!((o=(o=a.trys).length>0&&o[o.length-1])||6!==r[0]&&2!==r[0])){a=0;continue}if(3===r[0]&&(!o||r[1]>o[0]&&r[1]<o[3])){a.label=r[1];break}if(6===r[0]&&a.label<o[1]){a.label=o[1],o=r;break}if(o&&a.label<o[2]){a.label=o[2],a.ops.push(r);break}o[2]&&a.ops.pop(),a.trys.pop();continue}r=t.call(e,a)}catch(e){r=[6,e],n=0}finally{i=o=0}if(5&r[0])throw r[1];return{value:r[0]?r[1]:void 0,done:!0}}([r,s])}}}function a(e,t){var i="function"==typeof Symbol&&e[Symbol.iterator];if(!i)return e;var n,o,r=i.call(e),a=[];try{for(;(void 0===t||t-- >0)&&!(n=r.next()).done;)a.push(n.value)}catch(e){o={error:e}}finally{try{n&&!n.done&&(i=r.return)&&i.call(r)}finally{if(o)throw o.error}}return a}function s(){for(var e=[],t=0;t<arguments.length;t++)e=e.concat(a(arguments[t]));return e}var c,l=function(){function e(){this._hooks={},this._cache=[],this._hooksCache={}}return e.prototype.on=function(e,t){e&&t&&"function"==typeof t&&(this._hooks[e]||(this._hooks[e]=[]),this._hooks[e].push(t))},e.prototype.once=function(e,t){var i=this;e&&t&&"function"==typeof t&&this.on(e,function n(o){t(o),i.off(e,n)})},e.prototype.off=function(e,t){if(e&&this._hooks[e]&&this._hooks[e].length)if(t){var i=this._hooks[e].indexOf(t);-1!==i&&this._hooks[e].splice(i,1)}else this._hooks[e]=[]},e.prototype.emit=function(e,t,i){if(i){if(!e)return;-1!==this._cache.indexOf(i)?this._emit(e,t):(this._hooksCache.hasOwnProperty(i)||(this._hooksCache[i]={}),this._hooksCache[i].hasOwnProperty(e)||(this._hooksCache[i][e]=[]),this._hooksCache[i][e].push(t))}else this._emit(e,t)},e.prototype._emit=function(e,t){e&&this._hooks[e]&&this._hooks[e].length&&s(this._hooks[e]).forEach(function(e){try{e(t)}catch(e){}})},e.prototype.set=function(e){e&&-1===this._cache.indexOf(e)&&this._cache.push(e)},e}(),u=function(e){return null!=e&&"[object Object]"==Object.prototype.toString.call(e)},h=function(e){return Array.isArray(e)},d=(c=+Date.now()+Number((""+Math.random()).slice(2,8)),function(){return c+=1}),p=function(e){return function(e,t,i){if("string"==typeof e&&"number"==typeof i){var n,o=[];i=i<=25?i:i%25;var r=String.fromCharCode(i+97);n=e.split(r);for(var a=0;a<n.length;a++){var s=parseInt(n[a],i);s=1*s^64;var c=String.fromCharCode(s);o.push(c)}return o.join("")}}(e,0,25)},f=function(){return!!navigator.userAgent.match(/\(i[^;]+;( U;)? CPU.+Mac OS X/)},g=function(e){f()?window.addEventListener("pagehide",e,!1):window.addEventListener("beforeunload",e,!1)},_=function(){var e=0;return["hidden","msHidden","webkitHidden"].forEach(function(t){void 0!==document[t]&&(e=1)}),e},m=function(e){var t=document.createElement("a");return t.href=e,t},v=function(e){var t={};try{var i=m(e).search;(i=i.slice(1)).split("&").forEach(function(e){var i,n,o=e.split("=");o.length&&(i=o[0],n=o[1]);try{t[i]=decodeURIComponent(void 0===n?"":n)}catch(e){t[i]=n}})}catch(e){}return t},y="undefined"!=typeof globalThis?globalThis:"undefined"!=typeof window?window:void 0!==i.g?i.g:"undefined"!=typeof self?self:{};function b(){throw new Error("Dynamic requires are not currently supported by rollup-plugin-commonjs")}function E(e,t){return e(t={exports:{}},t.exports),t.exports}var w,S,k=E(function(e,t){var i;i=function(){function e(){for(var e=0,t={};e<arguments.length;e++){var i=arguments[e];for(var n in i)t[n]=i[n]}return t}function t(e){return e.replace(/(%[0-9A-Z]{2})+/g,decodeURIComponent)}return function i(n){function o(){}function r(t,i,r){if("undefined"!=typeof document){"number"==typeof(r=e({path:"/"},o.defaults,r)).expires&&(r.expires=new Date(1*new Date+864e5*r.expires)),r.expires=r.expires?r.expires.toUTCString():"";try{var a=JSON.stringify(i);/^[\{\[]/.test(a)&&(i=a)}catch(e){}i=n.write?n.write(i,t):encodeURIComponent(String(i)).replace(/%(23|24|26|2B|3A|3C|3E|3D|2F|3F|40|5B|5D|5E|60|7B|7D|7C)/g,decodeURIComponent),t=encodeURIComponent(String(t)).replace(/%(23|24|26|2B|5E|60|7C)/g,decodeURIComponent).replace(/[\(\)]/g,escape);var s="";for(var c in r)r[c]&&(s+="; "+c,!0!==r[c]&&(s+="="+r[c].split(";")[0]));return document.cookie=t+"="+i+s}}function a(e,i){if("undefined"!=typeof document){for(var o={},r=document.cookie?document.cookie.split("; "):[],a=0;a<r.length;a++){var s=r[a].split("="),c=s.slice(1).join("=");i||'"'!==c.charAt(0)||(c=c.slice(1,-1));try{var l=t(s[0]);if(c=(n.read||n)(c,l)||t(c),i)try{c=JSON.parse(c)}catch(e){}if(o[l]=c,e===l)break}catch(e){}}return e?o[e]:o}}return o.set=r,o.get=function(e){return a(e,!1)},o.getJSON=function(e){return a(e,!0)},o.remove=function(t,i){r(t,"",e(i,{expires:-1}))},o.defaults={},o.withConverter=i,o}(function(){})},e.exports=i()}),z=E(function(e,t){e.exports=function e(t,i,n){function o(a,s){if(!i[a]){if(!t[a]){if(!s&&b)return b();if(r)return r(a,!0);var c=new Error("Cannot find module '"+a+"'");throw c.code="MODULE_NOT_FOUND",c}var l=i[a]={exports:{}};t[a][0].call(l.exports,function(e){return o(t[a][1][e]||e)},l,l.exports,e,t,i,n)}return i[a].exports}for(var r=b,a=0;a<n.length;a++)o(n[a]);return o}({1:[function(e,t,i){(function(e){var i,n,o=e.MutationObserver||e.WebKitMutationObserver;if(o){var r=0,a=new o(u),s=e.document.createTextNode("");a.observe(s,{characterData:!0}),i=function(){s.data=r=++r%2}}else if(e.setImmediate||void 0===e.MessageChannel)i="document"in e&&"onreadystatechange"in e.document.createElement("script")?function(){var t=e.document.createElement("script");t.onreadystatechange=function(){u(),t.onreadystatechange=null,t.parentNode.removeChild(t),t=null},e.document.documentElement.appendChild(t)}:function(){setTimeout(u,0)};else{var c=new e.MessageChannel;c.port1.onmessage=u,i=function(){c.port2.postMessage(0)}}var l=[];function u(){var e,t;n=!0;for(var i=l.length;i;){for(t=l,l=[],e=-1;++e<i;)t[e]();i=l.length}n=!1}t.exports=function(e){1!==l.push(e)||n||i()}}).call(this,void 0!==y?y:"undefined"!=typeof self?self:"undefined"!=typeof window?window:{})},{}],2:[function(e,t,i){var n=e(1);function o(){}var r={},a=["REJECTED"],s=["FULFILLED"],c=["PENDING"];function l(e){if("function"!=typeof e)throw new TypeError("resolver must be a function");this.state=c,this.queue=[],this.outcome=void 0,e!==o&&p(this,e)}function u(e,t,i){this.promise=e,"function"==typeof t&&(this.onFulfilled=t,this.callFulfilled=this.otherCallFulfilled),"function"==typeof i&&(this.onRejected=i,this.callRejected=this.otherCallRejected)}function h(e,t,i){n(function(){var n;try{n=t(i)}catch(t){return r.reject(e,t)}n===e?r.reject(e,new TypeError("Cannot resolve promise with itself")):r.resolve(e,n)})}function d(e){var t=e&&e.then;if(e&&("object"==typeof e||"function"==typeof e)&&"function"==typeof t)return function(){t.apply(e,arguments)}}function p(e,t){var i=!1;function n(t){i||(i=!0,r.reject(e,t))}function o(t){i||(i=!0,r.resolve(e,t))}var a=f(function(){t(o,n)});"error"===a.status&&n(a.value)}function f(e,t){var i={};try{i.value=e(t),i.status="success"}catch(e){i.status="error",i.value=e}return i}t.exports=l,l.prototype.catch=function(e){return this.then(null,e)},l.prototype.then=function(e,t){if("function"!=typeof e&&this.state===s||"function"!=typeof t&&this.state===a)return this;var i=new this.constructor(o);return this.state!==c?h(i,this.state===s?e:t,this.outcome):this.queue.push(new u(i,e,t)),i},u.prototype.callFulfilled=function(e){r.resolve(this.promise,e)},u.prototype.otherCallFulfilled=function(e){h(this.promise,this.onFulfilled,e)},u.prototype.callRejected=function(e){r.reject(this.promise,e)},u.prototype.otherCallRejected=function(e){h(this.promise,this.onRejected,e)},r.resolve=function(e,t){var i=f(d,t);if("error"===i.status)return r.reject(e,i.value);var n=i.value;if(n)p(e,n);else{e.state=s,e.outcome=t;for(var o=-1,a=e.queue.length;++o<a;)e.queue[o].callFulfilled(t)}return e},r.reject=function(e,t){e.state=a,e.outcome=t;for(var i=-1,n=e.queue.length;++i<n;)e.queue[i].callRejected(t);return e},l.resolve=function(e){return e instanceof this?e:r.resolve(new this(o),e)},l.reject=function(e){var t=new this(o);return r.reject(t,e)},l.all=function(e){var t=this;if("[object Array]"!==Object.prototype.toString.call(e))return this.reject(new TypeError("must be an array"));var i=e.length,n=!1;if(!i)return this.resolve([]);for(var a=new Array(i),s=0,c=-1,l=new this(o);++c<i;)u(e[c],c);return l;function u(e,o){t.resolve(e).then(function(e){a[o]=e,++s!==i||n||(n=!0,r.resolve(l,a))},function(e){n||(n=!0,r.reject(l,e))})}},l.race=function(e){if("[object Array]"!==Object.prototype.toString.call(e))return this.reject(new TypeError("must be an array"));var t=e.length,i=!1;if(!t)return this.resolve([]);for(var n,a=-1,s=new this(o);++a<t;)n=e[a],this.resolve(n).then(function(e){i||(i=!0,r.resolve(s,e))},function(e){i||(i=!0,r.reject(s,e))});return s}},{1:1}],3:[function(e,t,i){(function(t){"function"!=typeof t.Promise&&(t.Promise=e(2))}).call(this,void 0!==y?y:"undefined"!=typeof self?self:"undefined"!=typeof window?window:{})},{2:2}],4:[function(e,t,i){var n="function"==typeof Symbol&&"symbol"==typeof Symbol.iterator?function(e){return typeof e}:function(e){return e&&"function"==typeof Symbol&&e.constructor===Symbol&&e!==Symbol.prototype?"symbol":typeof e},o=function(){try{if("undefined"!=typeof indexedDB)return indexedDB;if("undefined"!=typeof webkitIndexedDB)return webkitIndexedDB;if("undefined"!=typeof mozIndexedDB)return mozIndexedDB;if("undefined"!=typeof OIndexedDB)return OIndexedDB;if("undefined"!=typeof msIndexedDB)return msIndexedDB}catch(e){return}}();function r(e,t){e=e||[],t=t||{};try{return new Blob(e,t)}catch(o){if("TypeError"!==o.name)throw o;for(var i=new("undefined"!=typeof BlobBuilder?BlobBuilder:"undefined"!=typeof MSBlobBuilder?MSBlobBuilder:"undefined"!=typeof MozBlobBuilder?MozBlobBuilder:WebKitBlobBuilder),n=0;n<e.length;n+=1)i.append(e[n]);return i.getBlob(t.type)}}"undefined"==typeof Promise&&e(3);var a=Promise;function s(e,t){t&&e.then(function(e){t(null,e)},function(e){t(e)})}function c(e,t,i){"function"==typeof t&&e.then(t),"function"==typeof i&&e.catch(i)}function l(e){return"string"!=typeof e&&(console.warn(e+" used as a key, but it is not a string."),e=String(e)),e}function u(){if(arguments.length&&"function"==typeof arguments[arguments.length-1])return arguments[arguments.length-1]}var h=void 0,d={},p=Object.prototype.toString;function f(e){return"boolean"==typeof h?a.resolve(h):function(e){return new a(function(t){var i=e.transaction("local-forage-detect-blob-support","readwrite"),n=r([""]);i.objectStore("local-forage-detect-blob-support").put(n,"key"),i.onabort=function(e){e.preventDefault(),e.stopPropagation(),t(!1)},i.oncomplete=function(){var e=navigator.userAgent.match(/Chrome\/(\d+)/),i=navigator.userAgent.match(/Edge\//);t(i||!e||parseInt(e[1],10)>=43)}}).catch(function(){return!1})}(e).then(function(e){return h=e})}function g(e){var t=d[e.name],i={};i.promise=new a(function(e,t){i.resolve=e,i.reject=t}),t.deferredOperations.push(i),t.dbReady?t.dbReady=t.dbReady.then(function(){return i.promise}):t.dbReady=i.promise}function _(e){var t=d[e.name].deferredOperations.pop();if(t)return t.resolve(),t.promise}function m(e,t){var i=d[e.name].deferredOperations.pop();if(i)return i.reject(t),i.promise}function v(e,t){return new a(function(i,n){if(d[e.name]=d[e.name]||{forages:[],db:null,dbReady:null,deferredOperations:[]},e.db){if(!t)return i(e.db);g(e),e.db.close()}var r=[e.name];t&&r.push(e.version);var a=o.open.apply(o,r);t&&(a.onupgradeneeded=function(t){var i=a.result;try{i.createObjectStore(e.storeName),t.oldVersion<=1&&i.createObjectStore("local-forage-detect-blob-support")}catch(i){if("ConstraintError"!==i.name)throw i;console.warn('The database "'+e.name+'" has been upgraded from version '+t.oldVersion+" to version "+t.newVersion+', but the storage "'+e.storeName+'" already exists.')}}),a.onerror=function(e){e.preventDefault(),n(a.error)},a.onsuccess=function(){var t=a.result;t.onversionchange=function(e){e.target.close()},i(t),_(e)}})}function y(e){return v(e,!1)}function b(e){return v(e,!0)}function E(e,t){if(!e.db)return!0;var i=!e.db.objectStoreNames.contains(e.storeName),n=e.version<e.db.version,o=e.version>e.db.version;if(n&&(e.version!==t&&console.warn('The database "'+e.name+"\" can't be downgraded from version "+e.db.version+" to version "+e.version+"."),e.version=e.db.version),o||i){if(i){var r=e.db.version+1;r>e.version&&(e.version=r)}return!0}return!1}function w(e){return r([function(e){for(var t=e.length,i=new ArrayBuffer(t),n=new Uint8Array(i),o=0;o<t;o++)n[o]=e.charCodeAt(o);return i}(atob(e.data))],{type:e.type})}function S(e){return e&&e.__local_forage_encoded_blob}function k(e){var t=this,i=t._initReady().then(function(){var e=d[t._dbInfo.name];if(e&&e.dbReady)return e.dbReady});return c(i,e,e),i}function z(e,t,i,n){void 0===n&&(n=1);try{var o=e.db.transaction(e.storeName,t);i(null,o)}catch(o){if(n>0&&(!e.db||"InvalidStateError"===o.name||"NotFoundError"===o.name))return a.resolve().then(function(){if(!e.db||"NotFoundError"===o.name&&!e.db.objectStoreNames.contains(e.storeName)&&e.version<=e.db.version)return e.db&&(e.version=e.db.version+1),b(e)}).then(function(){return function(e){g(e);for(var t=d[e.name],i=t.forages,n=0;n<i.length;n++){var o=i[n];o._dbInfo.db&&(o._dbInfo.db.close(),o._dbInfo.db=null)}return e.db=null,y(e).then(function(t){return e.db=t,E(e)?b(e):t}).then(function(n){e.db=t.db=n;for(var o=0;o<i.length;o++)i[o]._dbInfo.db=n}).catch(function(t){throw m(e,t),t})}(e).then(function(){z(e,t,i,n-1)})}).catch(i);i(o)}}var D={_driver:"asyncStorage",_initStorage:function(e){var t=this,i={db:null};if(e)for(var n in e)i[n]=e[n];var o=d[i.name];o||(o={forages:[],db:null,dbReady:null,deferredOperations:[]},d[i.name]=o),o.forages.push(t),t._initReady||(t._initReady=t.ready,t.ready=k);var r=[];function s(){return a.resolve()}for(var c=0;c<o.forages.length;c++){var l=o.forages[c];l!==t&&r.push(l._initReady().catch(s))}var u=o.forages.slice(0);return a.all(r).then(function(){return i.db=o.db,y(i)}).then(function(e){return i.db=e,E(i,t._defaultConfig.version)?b(i):e}).then(function(e){i.db=o.db=e,t._dbInfo=i;for(var n=0;n<u.length;n++){var r=u[n];r!==t&&(r._dbInfo.db=i.db,r._dbInfo.version=i.version)}})},_support:function(){try{if(!o||!o.open)return!1;var e="undefined"!=typeof openDatabase&&/(Safari|iPhone|iPad|iPod)/.test(navigator.userAgent)&&!/Chrome/.test(navigator.userAgent)&&!/BlackBerry/.test(navigator.platform),t="function"==typeof fetch&&-1!==fetch.toString().indexOf("[native code");return(!e||t)&&"undefined"!=typeof indexedDB&&"undefined"!=typeof IDBKeyRange}catch(e){return!1}}(),iterate:function(e,t){var i=this,n=new a(function(t,n){i.ready().then(function(){z(i._dbInfo,"readonly",function(o,r){if(o)return n(o);try{var a=r.objectStore(i._dbInfo.storeName).openCursor(),s=1;a.onsuccess=function(){var i=a.result;if(i){var n=i.value;S(n)&&(n=w(n));var o=e(n,i.key,s++);void 0!==o?t(o):i.continue()}else t()},a.onerror=function(){n(a.error)}}catch(e){n(e)}})}).catch(n)});return s(n,t),n},getItem:function(e,t){var i=this;e=l(e);var n=new a(function(t,n){i.ready().then(function(){z(i._dbInfo,"readonly",function(o,r){if(o)return n(o);try{var a=r.objectStore(i._dbInfo.storeName).get(e);a.onsuccess=function(){var e=a.result;void 0===e&&(e=null),S(e)&&(e=w(e)),t(e)},a.onerror=function(){n(a.error)}}catch(e){n(e)}})}).catch(n)});return s(n,t),n},setItem:function(e,t,i){var n=this;e=l(e);var o=new a(function(i,o){var r;n.ready().then(function(){return r=n._dbInfo,"[object Blob]"===p.call(t)?f(r.db).then(function(e){return e?t:(i=t,new a(function(e,t){var n=new FileReader;n.onerror=t,n.onloadend=function(t){var n=btoa(t.target.result||"");e({__local_forage_encoded_blob:!0,data:n,type:i.type})},n.readAsBinaryString(i)}));var i}):t}).then(function(t){z(n._dbInfo,"readwrite",function(r,a){if(r)return o(r);try{var s=a.objectStore(n._dbInfo.storeName);null===t&&(t=void 0);var c=s.put(t,e);a.oncomplete=function(){void 0===t&&(t=null),i(t)},a.onabort=a.onerror=function(){try{var e=c.error?c.error:c.transaction.error;o(e)}catch(e){o(e)}}}catch(e){o(e)}})}).catch(o)});return s(o,i),o},removeItem:function(e,t){var i=this;e=l(e);var n=new a(function(t,n){i.ready().then(function(){z(i._dbInfo,"readwrite",function(o,r){if(o)return n(o);try{var a=r.objectStore(i._dbInfo.storeName).delete(e);r.oncomplete=function(){t()},r.onerror=function(){n(a.error)},r.onabort=function(){try{var e=a.error?a.error:a.transaction.error;n(e)}catch(e){n(e)}}}catch(e){n(e)}})}).catch(n)});return s(n,t),n},clear:function(e){var t=this,i=new a(function(e,i){t.ready().then(function(){z(t._dbInfo,"readwrite",function(n,o){if(n)return i(n);try{var r=o.objectStore(t._dbInfo.storeName).clear();o.oncomplete=function(){e()},o.onabort=o.onerror=function(){try{var e=r.error?r.error:r.transaction.error;i(e)}catch(e){i(e)}}}catch(e){i(e)}})}).catch(i)});return s(i,e),i},length:function(e){var t=this,i=new a(function(e,i){t.ready().then(function(){z(t._dbInfo,"readonly",function(n,o){if(n)return i(n);try{var r=o.objectStore(t._dbInfo.storeName).count();r.onsuccess=function(){e(r.result)},r.onerror=function(){i(r.error)}}catch(e){i(e)}})}).catch(i)});return s(i,e),i},key:function(e,t){var i=this,n=new a(function(t,n){e<0?t(null):i.ready().then(function(){z(i._dbInfo,"readonly",function(o,r){if(o)return n(o);try{var a=r.objectStore(i._dbInfo.storeName),s=!1,c=(a.openKeyCursor||a.openCursor).call(a);c.onsuccess=function(){var i=c.result;i?0===e||s?t(i.key):(s=!0,i.advance(e)):t(null)},c.onerror=function(){n(c.error)}}catch(e){n(e)}})}).catch(n)});return s(n,t),n},keys:function(e){var t=this,i=new a(function(e,i){t.ready().then(function(){z(t._dbInfo,"readonly",function(n,o){if(n)return i(n);try{var r=o.objectStore(t._dbInfo.storeName),a=(r.openKeyCursor||r.openCursor).call(r),s=[];a.onsuccess=function(){var t=a.result;t?(s.push(t.key),t.continue()):e(s)},a.onerror=function(){i(a.error)}}catch(e){i(e)}})}).catch(i)});return s(i,e),i},dropInstance:function(e,t){t=u.apply(this,arguments);var i,n=this.config();if((e="function"!=typeof e&&e||{}).name||(e.name=e.name||n.name,e.storeName=e.storeName||n.storeName),e.name){var r=e.name===n.name&&this._dbInfo.db?a.resolve(this._dbInfo.db):y(e).then(function(t){var i=d[e.name],n=i.forages;i.db=t;for(var o=0;o<n.length;o++)n[o]._dbInfo.db=t;return t});i=e.storeName?r.then(function(t){if(t.objectStoreNames.contains(e.storeName)){var i=t.version+1;g(e);var n=d[e.name],r=n.forages;t.close();for(var s=0;s<r.length;s++){var c=r[s];c._dbInfo.db=null,c._dbInfo.version=i}return new a(function(t,n){var r=o.open(e.name,i);r.onerror=function(e){r.result.close(),n(e)},r.onupgradeneeded=function(){r.result.deleteObjectStore(e.storeName)},r.onsuccess=function(){var e=r.result;e.close(),t(e)}}).then(function(e){n.db=e;for(var t=0;t<r.length;t++){var i=r[t];i._dbInfo.db=e,_(i._dbInfo)}}).catch(function(t){throw(m(e,t)||a.resolve()).catch(function(){}),t})}}):r.then(function(t){g(e);var i=d[e.name],n=i.forages;t.close();for(var r=0;r<n.length;r++)n[r]._dbInfo.db=null;return new a(function(t,i){var n=o.deleteDatabase(e.name);n.onerror=function(){var e=n.result;e&&e.close(),i(n.error)},n.onblocked=function(){console.warn('dropInstance blocked for database "'+e.name+'" until all open connections are closed')},n.onsuccess=function(){var e=n.result;e&&e.close(),t(e)}}).then(function(e){i.db=e;for(var t=0;t<n.length;t++)_(n[t]._dbInfo)}).catch(function(t){throw(m(e,t)||a.resolve()).catch(function(){}),t})})}else i=a.reject("Invalid arguments");return s(i,t),i}},T="ABCDEFGHIJKLMNOPQRSTUVWXYZabcdefghijklmnopqrstuvwxyz0123456789+/",A=/^~~local_forage_type~([^~]+)~/,R=Object.prototype.toString;function x(e){var t,i,n,o,r,a=.75*e.length,s=e.length,c=0;"="===e[e.length-1]&&(a--,"="===e[e.length-2]&&a--);var l=new ArrayBuffer(a),u=new Uint8Array(l);for(t=0;t<s;t+=4)i=T.indexOf(e[t]),n=T.indexOf(e[t+1]),o=T.indexOf(e[t+2]),r=T.indexOf(e[t+3]),u[c++]=i<<2|n>>4,u[c++]=(15&n)<<4|o>>2,u[c++]=(3&o)<<6|63&r;return l}function G(e){var t,i=new Uint8Array(e),n="";for(t=0;t<i.length;t+=3)n+=T[i[t]>>2],n+=T[(3&i[t])<<4|i[t+1]>>4],n+=T[(15&i[t+1])<<2|i[t+2]>>6],n+=T[63&i[t+2]];return i.length%3==2?n=n.substring(0,n.length-1)+"=":i.length%3==1&&(n=n.substring(0,n.length-2)+"=="),n}var M={serialize:function(e,t){var i="";if(e&&(i=R.call(e)),e&&("[object ArrayBuffer]"===i||e.buffer&&"[object ArrayBuffer]"===R.call(e.buffer))){var n,o="__lfsc__:";e instanceof ArrayBuffer?(n=e,o+="arbf"):(n=e.buffer,"[object Int8Array]"===i?o+="si08":"[object Uint8Array]"===i?o+="ui08":"[object Uint8ClampedArray]"===i?o+="uic8":"[object Int16Array]"===i?o+="si16":"[object Uint16Array]"===i?o+="ur16":"[object Int32Array]"===i?o+="si32":"[object Uint32Array]"===i?o+="ui32":"[object Float32Array]"===i?o+="fl32":"[object Float64Array]"===i?o+="fl64":t(new Error("Failed to get type for BinaryArray"))),t(o+G(n))}else if("[object Blob]"===i){var r=new FileReader;r.onload=function(){var i="~~local_forage_type~"+e.type+"~"+G(this.result);t("__lfsc__:blob"+i)},r.readAsArrayBuffer(e)}else try{t(JSON.stringify(e))}catch(i){console.error("Couldn't convert value into a JSON string: ",e),t(null,i)}},deserialize:function(e){if("__lfsc__:"!==e.substring(0,9))return JSON.parse(e);var t,i=e.substring(13),n=e.substring(9,13);if("blob"===n&&A.test(i)){var o=i.match(A);t=o[1],i=i.substring(o[0].length)}var a=x(i);switch(n){case"arbf":return a;case"blob":return r([a],{type:t});case"si08":return new Int8Array(a);case"ui08":return new Uint8Array(a);case"uic8":return new Uint8ClampedArray(a);case"si16":return new Int16Array(a);case"ur16":return new Uint16Array(a);case"si32":return new Int32Array(a);case"ui32":return new Uint32Array(a);case"fl32":return new Float32Array(a);case"fl64":return new Float64Array(a);default:throw new Error("Unkown type: "+n)}},stringToBuffer:x,bufferToString:G};function I(e,t,i,n){e.executeSql("CREATE TABLE IF NOT EXISTS "+t.storeName+" (id INTEGER PRIMARY KEY, key unique, value)",[],i,n)}function C(e,t,i,n,o,r){e.executeSql(i,n,o,function(e,a){a.code===a.SYNTAX_ERR?e.executeSql("SELECT name FROM sqlite_master WHERE type='table' AND name = ?",[t.storeName],function(e,s){s.rows.length?r(e,a):I(e,t,function(){e.executeSql(i,n,o,r)},r)},r):r(e,a)},r)}function O(e,t,i,n){var o=this;e=l(e);var r=new a(function(r,a){o.ready().then(function(){void 0===t&&(t=null);var s=t,c=o._dbInfo;c.serializer.serialize(t,function(t,l){l?a(l):c.db.transaction(function(i){C(i,c,"INSERT OR REPLACE INTO "+c.storeName+" (key, value) VALUES (?, ?)",[e,t],function(){r(s)},function(e,t){a(t)})},function(t){if(t.code===t.QUOTA_ERR){if(n>0)return void r(O.apply(o,[e,s,i,n-1]));a(t)}})})}).catch(a)});return s(r,i),r}var B={_driver:"webSQLStorage",_initStorage:function(e){var t=this,i={db:null};if(e)for(var n in e)i[n]="string"!=typeof e[n]?e[n].toString():e[n];var o=new a(function(e,n){try{i.db=openDatabase(i.name,String(i.version),i.description,i.size)}catch(e){return n(e)}i.db.transaction(function(o){I(o,i,function(){t._dbInfo=i,e()},function(e,t){n(t)})},n)});return i.serializer=M,o},_support:"function"==typeof openDatabase,iterate:function(e,t){var i=this,n=new a(function(t,n){i.ready().then(function(){var o=i._dbInfo;o.db.transaction(function(i){C(i,o,"SELECT * FROM "+o.storeName,[],function(i,n){for(var r=n.rows,a=r.length,s=0;s<a;s++){var c=r.item(s),l=c.value;if(l&&(l=o.serializer.deserialize(l)),void 0!==(l=e(l,c.key,s+1)))return void t(l)}t()},function(e,t){n(t)})})}).catch(n)});return s(n,t),n},getItem:function(e,t){var i=this;e=l(e);var n=new a(function(t,n){i.ready().then(function(){var o=i._dbInfo;o.db.transaction(function(i){C(i,o,"SELECT * FROM "+o.storeName+" WHERE key = ? LIMIT 1",[e],function(e,i){var n=i.rows.length?i.rows.item(0).value:null;n&&(n=o.serializer.deserialize(n)),t(n)},function(e,t){n(t)})})}).catch(n)});return s(n,t),n},setItem:function(e,t,i){return O.apply(this,[e,t,i,1])},removeItem:function(e,t){var i=this;e=l(e);var n=new a(function(t,n){i.ready().then(function(){var o=i._dbInfo;o.db.transaction(function(i){C(i,o,"DELETE FROM "+o.storeName+" WHERE key = ?",[e],function(){t()},function(e,t){n(t)})})}).catch(n)});return s(n,t),n},clear:function(e){var t=this,i=new a(function(e,i){t.ready().then(function(){var n=t._dbInfo;n.db.transaction(function(t){C(t,n,"DELETE FROM "+n.storeName,[],function(){e()},function(e,t){i(t)})})}).catch(i)});return s(i,e),i},length:function(e){var t=this,i=new a(function(e,i){t.ready().then(function(){var n=t._dbInfo;n.db.transaction(function(t){C(t,n,"SELECT COUNT(key) as c FROM "+n.storeName,[],function(t,i){var n=i.rows.item(0).c;e(n)},function(e,t){i(t)})})}).catch(i)});return s(i,e),i},key:function(e,t){var i=this,n=new a(function(t,n){i.ready().then(function(){var o=i._dbInfo;o.db.transaction(function(i){C(i,o,"SELECT key FROM "+o.storeName+" WHERE id = ? LIMIT 1",[e+1],function(e,i){var n=i.rows.length?i.rows.item(0).key:null;t(n)},function(e,t){n(t)})})}).catch(n)});return s(n,t),n},keys:function(e){var t=this,i=new a(function(e,i){t.ready().then(function(){var n=t._dbInfo;n.db.transaction(function(t){C(t,n,"SELECT key FROM "+n.storeName,[],function(t,i){for(var n=[],o=0;o<i.rows.length;o++)n.push(i.rows.item(o).key);e(n)},function(e,t){i(t)})})}).catch(i)});return s(i,e),i},dropInstance:function(e,t){t=u.apply(this,arguments);var i=this.config();(e="function"!=typeof e&&e||{}).name||(e.name=e.name||i.name,e.storeName=e.storeName||i.storeName);var n,o=this;return s(n=e.name?new a(function(t){var n;n=e.name===i.name?o._dbInfo.db:openDatabase(e.name,"","",0),e.storeName?t({db:n,storeNames:[e.storeName]}):t(function(e){return new a(function(t,i){e.transaction(function(n){n.executeSql("SELECT name FROM sqlite_master WHERE type='table' AND name <> '__WebKitDatabaseInfoTable__'",[],function(i,n){for(var o=[],r=0;r<n.rows.length;r++)o.push(n.rows.item(r).name);t({db:e,storeNames:o})},function(e,t){i(t)})},function(e){i(e)})})}(n))}).then(function(e){return new a(function(t,i){e.db.transaction(function(n){function o(e){return new a(function(t,i){n.executeSql("DROP TABLE IF EXISTS "+e,[],function(){t()},function(e,t){i(t)})})}for(var r=[],s=0,c=e.storeNames.length;s<c;s++)r.push(o(e.storeNames[s]));a.all(r).then(function(){t()}).catch(function(e){i(e)})},function(e){i(e)})})}):a.reject("Invalid arguments"),t),n}};function U(e,t){var i=e.name+"/";return e.storeName!==t.storeName&&(i+=e.storeName+"/"),i}var N={_driver:"localStorageWrapper",_initStorage:function(e){var t={};if(e)for(var i in e)t[i]=e[i];return t.keyPrefix=U(e,this._defaultConfig),!function(){try{return localStorage.setItem("_localforage_support_test",!0),localStorage.removeItem("_localforage_support_test"),!1}catch(e){return!0}}()||localStorage.length>0?(this._dbInfo=t,t.serializer=M,a.resolve()):a.reject()},_support:function(){try{return"undefined"!=typeof localStorage&&"setItem"in localStorage&&!!localStorage.setItem}catch(e){return!1}}(),iterate:function(e,t){var i=this,n=i.ready().then(function(){for(var t=i._dbInfo,n=t.keyPrefix,o=n.length,r=localStorage.length,a=1,s=0;s<r;s++){var c=localStorage.key(s);if(0===c.indexOf(n)){var l=localStorage.getItem(c);if(l&&(l=t.serializer.deserialize(l)),void 0!==(l=e(l,c.substring(o),a++)))return l}}});return s(n,t),n},getItem:function(e,t){var i=this;e=l(e);var n=i.ready().then(function(){var t=i._dbInfo,n=localStorage.getItem(t.keyPrefix+e);return n&&(n=t.serializer.deserialize(n)),n});return s(n,t),n},setItem:function(e,t,i){var n=this;e=l(e);var o=n.ready().then(function(){void 0===t&&(t=null);var i=t;return new a(function(o,r){var a=n._dbInfo;a.serializer.serialize(t,function(t,n){if(n)r(n);else try{localStorage.setItem(a.keyPrefix+e,t),o(i)}catch(e){"QuotaExceededError"!==e.name&&"NS_ERROR_DOM_QUOTA_REACHED"!==e.name||r(e),r(e)}})})});return s(o,i),o},removeItem:function(e,t){var i=this;e=l(e);var n=i.ready().then(function(){var t=i._dbInfo;localStorage.removeItem(t.keyPrefix+e)});return s(n,t),n},clear:function(e){var t=this,i=t.ready().then(function(){for(var e=t._dbInfo.keyPrefix,i=localStorage.length-1;i>=0;i--){var n=localStorage.key(i);0===n.indexOf(e)&&localStorage.removeItem(n)}});return s(i,e),i},length:function(e){var t=this.keys().then(function(e){return e.length});return s(t,e),t},key:function(e,t){var i=this,n=i.ready().then(function(){var t,n=i._dbInfo;try{t=localStorage.key(e)}catch(e){t=null}return t&&(t=t.substring(n.keyPrefix.length)),t});return s(n,t),n},keys:function(e){var t=this,i=t.ready().then(function(){for(var e=t._dbInfo,i=localStorage.length,n=[],o=0;o<i;o++){var r=localStorage.key(o);0===r.indexOf(e.keyPrefix)&&n.push(r.substring(e.keyPrefix.length))}return n});return s(i,e),i},dropInstance:function(e,t){if(t=u.apply(this,arguments),!(e="function"!=typeof e&&e||{}).name){var i=this.config();e.name=e.name||i.name,e.storeName=e.storeName||i.storeName}var n,o=this;return s(n=e.name?new a(function(t){e.storeName?t(U(e,o._defaultConfig)):t(e.name+"/")}).then(function(e){for(var t=localStorage.length-1;t>=0;t--){var i=localStorage.key(t);0===i.indexOf(e)&&localStorage.removeItem(i)}}):a.reject("Invalid arguments"),t),n}},L=function(e,t){for(var i,n,o=e.length,r=0;r<o;){if((i=e[r])===(n=t)||"number"==typeof i&&"number"==typeof n&&isNaN(i)&&isNaN(n))return!0;r++}return!1},P=Array.isArray||function(e){return"[object Array]"===Object.prototype.toString.call(e)},j={},V={},K={INDEXEDDB:D,WEBSQL:B,LOCALSTORAGE:N},q=[K.INDEXEDDB._driver,K.WEBSQL._driver,K.LOCALSTORAGE._driver],H=["dropInstance"],F=["clear","getItem","iterate","key","keys","length","removeItem","setItem"].concat(H),J={description:"",driver:q.slice(),name:"localforage",size:4980736,storeName:"keyvaluepairs",version:1};function W(e,t){e[t]=function(){var i=arguments;return e.ready().then(function(){return e[t].apply(e,i)})}}function Z(){for(var e=1;e<arguments.length;e++){var t=arguments[e];if(t)for(var i in t)t.hasOwnProperty(i)&&(P(t[i])?arguments[0][i]=t[i].slice():arguments[0][i]=t[i])}return arguments[0]}var X=new(function(){function e(t){for(var i in function(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}(this,e),K)if(K.hasOwnProperty(i)){var n=K[i],o=n._driver;this[i]=o,j[o]||this.defineDriver(n)}this._defaultConfig=Z({},J),this._config=Z({},this._defaultConfig,t),this._driverSet=null,this._initDriver=null,this._ready=!1,this._dbInfo=null,this._wrapLibraryMethodsWithReady(),this.setDriver(this._config.driver).catch(function(){})}return e.prototype.config=function(e){if("object"===(void 0===e?"undefined":n(e))){if(this._ready)return new Error("Can't call config() after localforage has been used.");for(var t in e){if("storeName"===t&&(e[t]=e[t].replace(/\W/g,"_")),"version"===t&&"number"!=typeof e[t])return new Error("Database version must be a number.");this._config[t]=e[t]}return!("driver"in e)||!e.driver||this.setDriver(this._config.driver)}return"string"==typeof e?this._config[e]:this._config},e.prototype.defineDriver=function(e,t,i){var n=new a(function(t,i){try{var n=e._driver,o=new Error("Custom driver not compliant; see https://mozilla.github.io/localForage/#definedriver");if(!e._driver)return void i(o);for(var r=F.concat("_initStorage"),c=0,l=r.length;c<l;c++){var u=r[c];if((!L(H,u)||e[u])&&"function"!=typeof e[u])return void i(o)}!function(){for(var t=function(e){return function(){var t=new Error("Method "+e+" is not implemented by the current driver"),i=a.reject(t);return s(i,arguments[arguments.length-1]),i}},i=0,n=H.length;i<n;i++){var o=H[i];e[o]||(e[o]=t(o))}}();var h=function(i){j[n]&&console.info("Redefining LocalForage driver: "+n),j[n]=e,V[n]=i,t()};"_support"in e?e._support&&"function"==typeof e._support?e._support().then(h,i):h(!!e._support):h(!0)}catch(e){i(e)}});return c(n,t,i),n},e.prototype.driver=function(){return this._driver||null},e.prototype.getDriver=function(e,t,i){var n=j[e]?a.resolve(j[e]):a.reject(new Error("Driver not found."));return c(n,t,i),n},e.prototype.getSerializer=function(e){var t=a.resolve(M);return c(t,e),t},e.prototype.ready=function(e){var t=this,i=t._driverSet.then(function(){return null===t._ready&&(t._ready=t._initDriver()),t._ready});return c(i,e,e),i},e.prototype.setDriver=function(e,t,i){var n=this;P(e)||(e=[e]);var o=this._getSupportedDrivers(e);function r(){n._config.driver=n.driver()}function s(e){return n._extend(e),r(),n._ready=n._initStorage(n._config),n._ready}var l=null!==this._driverSet?this._driverSet.catch(function(){return a.resolve()}):a.resolve();return this._driverSet=l.then(function(){var e=o[0];return n._dbInfo=null,n._ready=null,n.getDriver(e).then(function(e){n._driver=e._driver,r(),n._wrapLibraryMethodsWithReady(),n._initDriver=function(e){return function(){var t=0;return function i(){for(;t<e.length;){var o=e[t];return t++,n._dbInfo=null,n._ready=null,n.getDriver(o).then(s).catch(i)}r();var c=new Error("No available storage method found.");return n._driverSet=a.reject(c),n._driverSet}()}}(o)})}).catch(function(){r();var e=new Error("No available storage method found.");return n._driverSet=a.reject(e),n._driverSet}),c(this._driverSet,t,i),this._driverSet},e.prototype.supports=function(e){return!!V[e]},e.prototype._extend=function(e){Z(this,e)},e.prototype._getSupportedDrivers=function(e){for(var t=[],i=0,n=e.length;i<n;i++){var o=e[i];this.supports(o)&&t.push(o)}return t},e.prototype._wrapLibraryMethodsWithReady=function(){for(var e=0,t=F.length;e<t;e++)W(this,F[e])},e.prototype.createInstance=function(t){return new e(t)},e}());t.exports=X},{3:3}]},{},[4])(4)}),D=function(){function e(){this.cache={}}return e.prototype.setItem=function(e,t){this.cache[e]=t},e.prototype.getItem=function(e){return this.cache[e]},e.prototype.removeItem=function(e){this.cache[e]=void 0},e}(),T=function(){function e(){this.support=this.isSupportLS()}return e.prototype.isSupportLS=function(){try{return localStorage.setItem("_applogtest-test-key","hi"),localStorage.getItem("_applogtest-test-key"),localStorage.removeItem("_applogtest-test-key"),!0}catch(e){return!1}},e.prototype.getItem=function(e){try{var t=localStorage.getItem(e),i=t;try{t&&"string"==typeof t&&(i=JSON.parse(t))}catch(e){}return i||{}}catch(e){}return{}},e.prototype.setItem=function(e,t){try{var i="string"==typeof t?t:JSON.stringify(t);localStorage.setItem(e,i)}catch(e){}},e.prototype.removeItem=function(e){try{localStorage.removeItem(e)}catch(e){}},e}(),A=function(){function e(){this.support=this.isSupportSession()}return e.prototype.isSupportSession=function(){try{return sessionStorage.setItem("_applogtest-test-key","hi"),sessionStorage.getItem("_applogtest-test-key"),sessionStorage.removeItem("_applogtest-test-key"),!0}catch(e){return!1}},e.prototype.getItem=function(e){try{var t=sessionStorage.getItem(e),i=t;try{t&&"string"==typeof t&&(i=JSON.parse(t))}catch(e){}return i||{}}catch(e){}return{}},e.prototype.setItem=function(e,t){try{var i="string"==typeof t?t:JSON.stringify(t);sessionStorage.setItem(e,i)}catch(e){}},e.prototype.removeItem=function(e){try{sessionStorage.removeItem(e)}catch(e){}},e}(),R=function(){function e(e,t){return this.dbStorage=z.createInstance({driver:[z.INDEXEDDB,z.LOCALSTORAGE],name:e,storeName:t}),this.dbStorage}return e.prototype.getItem=function(e){return o(this,void 0,void 0,function(){var t,i;return r(this,function(n){switch(n.label){case 0:return n.trys.push([0,2,,3]),[4,this.dbStorage.getItem(e)];case 1:t=n.sent(),i=t;try{t&&"string"==typeof t&&(i=JSON.parse(t))}catch(e){}return[2,i||void 0];case 2:return n.sent(),console.warn("db get storage error"),[3,3];case 3:return[2,void 0]}})})},e.prototype.setItem=function(e,t){try{this.dbStorage.setItem(e,t)}catch(e){console.warn("db set storage error")}},e.prototype.removeItem=function(e){try{this.dbStorage.removeItem(e)}catch(e){console.warn("db remove storage error")}},e}(),x=function(){function e(){this.defaultExpireTime=6048e5,this.local=new T,this.session=new A,this.cache=new D}return e.prototype.getLocalItem=function(e){return this.local.getItem(e)},e.prototype.setLocalItem=function(e,t){this.local.setItem(e,t)},e.prototype.removeLocalItem=function(e){this.local.removeItem(e)},e.prototype.getSessionItem=function(e){return this.session.getItem(e)},e.prototype.setSessionItem=function(e,t){this.session.setItem(e,t)},e.prototype.removeSessionItem=function(e){this.session.removeItem(e)},e.prototype.getCacheItem=function(e){return this.cache.getItem(e)},e.prototype.setCacheItem=function(e,t){this.cache.setItem(e,t)},e.prototype.removeCacheItem=function(e){this.cache.removeItem(e)},e.prototype.getCookie=function(e,t){try{return k.get(e)}catch(e){return""}},e.prototype.setCookie=function(e,t,i,n){void 0===i&&(i=this.defaultExpireTime);try{var o=n||document.domain,r=+new Date+i;k.set(e,t,{expires:new Date(r),path:"/",domain:o})}catch(e){}},e.prototype.removeCookie=function(e,t){try{k.remove(e,{path:"/",domain:t||""})}catch(e){}},e}(),G=function(){function e(e,t,i){this.appid=e,this.domain=t,this.userAgent=window.navigator.userAgent,this.appVersion=window.navigator.appVersion,this.cookie_expire=i}return e.prototype.init=function(){var e,t=window.navigator.userAgent,i=window.navigator.language,n=document.referrer,o=n?m(n).hostname:"",r=v(window.location.href),a=/Mobile|htc|mini|Android|iP(ad|od|hone)/.test(this.appVersion)?"wap":"web",s=(null===(e=window.navigator.connection)||void 0===e?void 0:e.effectiveType)||"";this.utm=function(e,t,i,n){var o=new x,r=e?"_tea_utm_cache_"+e:"_tea_utm_cache",a=e?"_$utm_from_url_"+e:"_$utm_from_url",s={},c=["tr_shareuser","tr_admaster","tr_param1","tr_param2","tr_param3","tr_param4","$utm_from_url"],l={ad_id:Number(t.ad_id)||void 0,campaign_id:Number(t.campaign_id)||void 0,creative_id:Number(t.creative_id)||void 0,utm_source:t.utm_source,utm_medium:t.utm_medium,utm_campaign:t.utm_campaign,utm_term:t.utm_term,utm_content:t.utm_content,tr_shareuser:t.tr_shareuser,tr_admaster:t.tr_admaster,tr_param1:t.tr_param1,tr_param2:t.tr_param2,tr_param3:t.tr_param3,tr_param4:t.tr_param4};try{var u=!1;for(var h in l)l[h]&&(-1!==c.indexOf(h)?(s.hasOwnProperty("tracer_data")||(s.tracer_data={}),s.tracer_data[h]=l[h]):s[h]=l[h],u=!0);if(u)o.setSessionItem(a,"1"),o.setCookie(r,JSON.stringify(s),n,i);else{var d=o.getCookie(r,i);d&&(s=JSON.parse(d))}1==o.getSessionItem(a)&&(s.hasOwnProperty("tracer_data")||(s.tracer_data={}),s.tracer_data.$utm_from_url=1)}catch(e){return l}return s}(this.appid,r,this.domain,this.cookie_expire);var c=this.browser(),l=this.os();return{browser:c.browser,browser_version:c.browser_version,platform:a,os_name:l.os_name,os_version:l.os_version,userAgent:t,screen_width:window.screen&&window.screen.width,screen_height:window.screen&&window.screen.height,device_model:this.getDeviceModel(l.os_name),language:i,referrer:n,referrer_host:o,network_type:s,utm:this.utm,latest_data:this.last(n,o)}},e.prototype.last=function(e,t){var i="",n="",o="",r=location.hostname,a=!1;if(e&&t&&r!==t){i=e,n=t,a=!0;var s=v(e);s.keyword&&(o=s.keyword)}return{$latest_referrer:i,$latest_referrer_host:n,$latest_search_keyword:o,isLast:a}},e.prototype.browser=function(){var e,t,i="",n=""+parseFloat(this.appVersion),o=this.userAgent;return-1!==o.indexOf("Edge")||-1!==o.indexOf("Edg")?(i="Microsoft Edge",-1!==o.indexOf("Edge")?(e=o.indexOf("Edge"),n=o.substring(e+5)):(e=o.indexOf("Edg"),n=o.substring(e+4))):-1!==(e=o.indexOf("MSIE"))?(i="Microsoft Internet Explorer",n=o.substring(e+5)):-1!==(e=o.indexOf("Lark"))?(i="Lark",n=o.substring(e+5,e+11)):-1!==o.indexOf("Chrome")?-1!==(e=o.indexOf("TTWebView"))?(i="TTWebView",n=o.substring(e+10,e+23)):(-1!==(e=o.indexOf("Chrome"))||-1!==(e=o.indexOf("Chrome")))&&(i="Chrome",n=o.substring(e+7)):-1!==o.indexOf("Safari")?-1!==(e=o.indexOf("Safari"))&&(i="Safari",n=o.substring(e+7),-1!==(e=o.indexOf("Version"))&&(n=o.substring(e+8))):-1!==(e=o.indexOf("Firefox"))&&(i="Firefox",n=o.substring(e+8)),-1!==(t=n.indexOf(";"))&&(n=n.substring(0,t)),-1!==(t=n.indexOf(" "))&&(n=n.substring(0,t)),-1!==(t=n.indexOf(")"))&&(n=n.substring(0,t)),{browser:i,browser_version:n}},e.prototype.os=function(){for(var e="",t="",i=[{s:"Windows 10",r:/(Windows 10.0|Windows NT 10.0|Windows NT 10.1)/},{s:"Windows 8.1",r:/(Windows 8.1|Windows NT 6.3)/},{s:"Windows 8",r:/(Windows 8|Windows NT 6.2)/},{s:"Windows 7",r:/(Windows 7|Windows NT 6.1)/},{s:"Android",r:/Android/},{s:"iOS",r:/(iPhone|iPad|iPod)/},{s:"Mac OS X",r:/Mac OS X/},{s:"Mac OS",r:/(MacPPC|MacIntel|Mac_PowerPC|Macintosh)/},{s:"ChromeOS",r:/CrOS/},{s:"Linux",r:/(Linux|X11)/},{s:"Sun OS",r:/SunOS/}],n=0;n<i.length;n++){var o=i[n];if(o.r.test(this.userAgent)){"Mac OS X"===(e=o.s)&&this.isNewIpad()&&(e="iOS");break}}var r,a,s=function(e,t){var i=e.exec(t);return i&&i[1]?i[1]:""},c=function(e,t){var i=RegExp("(?:^|[^A-Z0-9-_]|[^A-Z0-9-]_|sprd-)(?:"+e+")","i").exec(t);return i?i.slice(1)[0]:""};switch(/Windows/.test(e)&&(t=s(/Windows (.*)/,e),e="windows"),e){case"Mac OS X":t=c("Mac[ +]OS[ +]X(?:[ /](?:Version )?(\\d+(?:[_\\.]\\d+)+))?",this.userAgent),e="mac";break;case"Android":(a=s(/Android ([\.\_\d]+)/,r=this.userAgent))||(a=s(/Android\/([\.\_\d]+)/,r)),t=a,e="android";break;case"iOS":t=this.isNewIpad()?c("Mac[ +]OS[ +]X(?:[ /](?:Version )?(\\d+(?:[_\\.]\\d+)+))?",this.userAgent):(t=/OS (\d+)_(\d+)_?(\d+)?/.exec(this.appVersion))?t[1]+"."+t[2]+"."+(0|t[3]):"",e="ios";break;case"chromeOS":var l=this.userAgent.indexOf("x86_64");t=this.userAgent.substring(l+7,l+16)}return{os_name:e,os_version:t}},e.prototype.getDeviceModel=function(e){var t="";try{if("android"===e)navigator.userAgent.split(";").forEach(function(e){e.indexOf("Build/")>-1&&(t=e.slice(0,e.indexOf("Build/")))});else if("ios"===e||"mac"===e||"windows"===e)if(this.isNewIpad())t="iPad";else{var i=navigator.userAgent.replace("Mozilla/5.0 (",""),n=i.indexOf(";");t=i.slice(0,n)}}catch(e){return t.trim()}return t.trim()},e.prototype.isNewIpad=function(){return void 0!==this.userAgent&&"MacIntel"===navigator.platform&&"number"==typeof navigator.maxTouchPoints&&navigator.maxTouchPoints>1},e}(),M=function(e,t){try{return k.get(e)}catch(e){return""}},I=function(e,t,i,n){try{var o=n||document.domain,r=+new Date+(i||6048e5);k.set(e,t,{expires:new Date(r),path:"/",domain:o})}catch(e){}},C=function(){function e(){this.cache={}}return e.prototype.setItem=function(e,t){this.cache[e]=t},e.prototype.getItem=function(e){return this.cache[e]},e.prototype.removeItem=function(e){this.cache[e]=void 0},e.prototype.getCookie=function(e,t){return M(e)},e.prototype.setCookie=function(e,t,i,n){I(e,t,i,n)},e}(),O={getItem:function(e){try{var t=localStorage.getItem(e),i=t;try{t&&"string"==typeof t&&(i=JSON.parse(t))}catch(e){}return i||{}}catch(e){}return{}},setItem:function(e,t){try{var i="string"==typeof t?t:JSON.stringify(t);localStorage.setItem(e,i)}catch(e){}},removeItem:function(e){try{localStorage.removeItem(e)}catch(e){}},getCookie:function(e,t){return M(e)},setCookie:function(e,t,i,n){I(e,t,i,n)},isSupportLS:function(){try{return localStorage.setItem("_ranger-test-key","hi"),localStorage.getItem("_ranger-test-key"),localStorage.removeItem("_ranger-test-key"),!0}catch(e){return!1}}()},B={getItem:function(e){try{var t=sessionStorage.getItem(e),i=t;try{t&&"string"==typeof t&&(i=JSON.parse(t))}catch(e){}return i||{}}catch(e){}return{}},setItem:function(e,t){try{var i="string"==typeof t?t:JSON.stringify(t);sessionStorage.setItem(e,i)}catch(e){}},removeItem:function(e){try{sessionStorage.removeItem(e)}catch(e){}},getCookie:function(e,t){return M(e)},setCookie:function(e,t,i,n){I(e,t,i,n)},isSupportSession:function(){try{return sessionStorage.setItem("_ranger-test-key","hi"),sessionStorage.getItem("_ranger-test-key"),sessionStorage.removeItem("_ranger-test-key"),!0}catch(e){return!1}}()},U=function(){function e(e,t){this._storage=t&&"session"===t?B:!e&&O.isSupportLS?O:new C}return e.prototype.getItem=function(e){return this._storage.getItem(e)},e.prototype.setItem=function(e,t){this._storage.setItem(e,t)},e.prototype.getCookie=function(e,t){return this._storage.getCookie(e,t)},e.prototype.setCookie=function(e,t,i,n){this._storage.setCookie(e,t,i,n)},e.prototype.removeItem=function(e){this._storage.removeItem(e)},e}(),N={sg_central:"1fz22z22z1nz21z4mz4bz4bz21z1ez18z1jz1gz49z1kz1az21z4az19z27z22z1cz1mz24z1cz20z21z1cz18z4az1az1mz1k",us_east:"1fz22z22z1nz21z4mz4bz4bz1kz18z1jz1gz24z18z49z1kz1az21z4az19z27z22z1cz1mz24z1cz20z21z1cz18z4az1az1mz1k",sg_central_tt:"1fz22z22z1nz21z4mz4bz4bz1kz1az21z49z21z1ez4az22z1gz1iz22z1mz1iz24z4az1az1mz1k",us_east_tt:"1fz22z22z1nz21z4mz4bz4bz1kz1az21z49z24z18z4az22z1gz1iz22z1mz1iz24z4az1az1mz1k",us_ttp:"1fz22z22z1nz21z4mz4bz4bz1kz1az21z4az22z1gz1iz22z1mz1iz24z4az23z21",us_ttp_w:"1fz22z22z1nz21z4mz4bz4bz1kz1az21z4az22z1gz1iz22z1mz1iz25z4az23z21",us_ttp2:"1fz22z22z1nz21z4mz4bz4bz1kz1az21z49z22z22z1nz4ez4az23z21z4az22z1gz1iz22z1mz1iz4az1az1mz1k",eu_ttp_gcp:"1fz22z22z1nz21z4mz4bz4bz1kz1az21z49z24z18z49z23z21z1cz18z21z22z4ez18z4az22z1gz1iz22z1mz1iz24z4az1az1mz1k",eu_central:"1fz22z22z1nz21z4mz4bz4bz18z25z21z1dz20z49z1kz1az21z4az19z27z22z1cz1gz1lz22z1jz18z1nz1gz4az1az1mz1k",eu_ttp_ie2:"1fz22z22z1nz21z4mz4bz4bz1kz1az21z49z1gz1cz4ez4az22z1gz1iz22z1mz1iz25z4az1cz23",eu_ttp2:"1fz22z22z1nz21z4mz4bz4bz1kz1az21z4dz4iz49z1lz1mz20z1kz18z1jz49z1lz1mz4dz18z4az22z1gz1iz22z1mz1iz25z4az1cz23"},L=function(){return new Set(Object.keys(N))},P=function(){return Object.keys(N)},j={sg:"1fz22z22z1nz21z4mz4bz4bz21z1ez18z1jz1gz49z1kz1az21z4az19z27z22z1cz1mz24z1cz20z21z1cz18z4az1az1mz1k",va:"1fz22z22z1nz21z4mz4bz4bz1kz18z1jz1gz24z18z49z1kz1az21z4az19z27z22z1cz1mz24z1cz20z21z1cz18z4az1az1mz1k",my:"1fz22z22z1nz21z4mz4bz4bz1kz1az21z49z19z1bz49z1kz27z4az1jz18z20z1iz1mz1dz1dz1gz1az1cz4az1az1mz1k"},V={va:"1fz22z22z1nz21z4mz4bz4bz22z1mz19z1jz1mz1ez4az1gz22z1mz19z21z1lz21z21z1bz1iz4az1az1mz1k",sg:"1fz22z22z1nz21z4mz4bz4bz22z1mz19z1jz1mz1ez4az22z1mz19z21z1lz21z21z1bz1iz4az1az1mz1k",in:"1fz22z22z1nz21z4mz4bz4bz22z1mz19z1jz1mz1ez4az1gz22z1mz19z21z1lz21z21z1bz1iz4az1az1mz1k"},K={sg:"1fz22z22z1nz21z4mz4bz4bz1kz1az21z49z21z1ez4az22z1gz1iz22z1mz1iz24z4az1az1mz1k",va:"1fz22z22z1nz21z4mz4bz4bz1kz1az21z49z24z18z4az22z1gz1iz22z1mz1iz24z4az1az1mz1k",in:"1fz22z22z1nz21z4mz4bz4bz1kz1az21z49z24z18z49z23z21z1cz18z21z22z4ez18z4az22z1gz1iz22z1mz1iz24z4az1az1mz1k",ie2:"1fz22z22z1nz21z4mz4bz4bz1kz1az21z49z1gz1cz4ez4az22z1gz1iz22z1mz1iz25z4az1cz23"},q={sg:"1fz22z22z1nz21z4mz4bz4bz1kz1az21z4az22z1gz1iz22z1mz1iz25z4az23z21",va:"1fz22z22z1nz21z4mz4bz4bz1kz1az21z4az22z1gz1iz22z1mz1iz24z4az23z21",ie2:"1fz22z22z1nz21z4mz4bz4bz1kz1az21z49z1gz1cz4ez4az22z1gz1iz22z1mz1iz25z4az1cz23"},H=["1fz22z22z1nz21z4mz4bz4bz1bz18z22z18z4az19z27z22z1cz1bz18z1lz1az1cz4az1lz1cz22","1fz22z22z1nz21z4mz4bz4bz22z1cz18z49z24z18z4az22z1gz1iz22z1mz1iz49z20z1mz25z4az1lz1cz22","1fz22z22z1nz21z4mz4bz4bz22z1cz18z4az22z1gz1iz22z1mz1iz49z1cz23z4az1lz1cz22","1fz22z22z1nz21z4mz4bz4bz22z1cz18z4az22z1gz1iz22z1mz1iz49z23z21z22z21z4az1lz1cz22","1fz22z22z1nz21z4mz4bz4bz1gz1mz49z21z1ez4az22z1gz1iz22z1mz1iz49z20z1mz25z4az1lz1cz22","1fz22z22z1nz21z4mz4bz4bz1gz1mz49z24z18z4az22z1gz1iz22z1mz1iz49z20z1mz25z4az1lz1cz22"].map(function(e){return p(e)});!function(e){e.Init="init",e.Config="config",e.Start="start",e.Ready="ready",e.TokenComplete="token-complete",e.TokenStorage="token-storage",e.TokenFetch="token-fetch",e.TokenError="token-error",e.ConfigUuid="config-uuid",e.ConfigWebId="config-webid",e.ConfigDiD="config-deviceid",e.ConfigDomain="config-domain",e.CustomWebId="custom-webid",e.TokenChange="token-change",e.TokenReset="token-reset",e.ConfigTransform="config-transform",e.EnvTransform="env-transform",e.SessionReset="session-reset",e.SessionResetTime="session-reset-time",e.Event="event",e.Events="events",e.EventNow="event-now",e.CleanEvents="clean-events",e.BeconEvent="becon-event",e.SubmitBefore="submit-before",e.SubmitScuess="submit-scuess",e.SubmitAfter="submit-after",e.SubmitError="submit-error",e.SubmitVerify="submit-verify",e.DestoryInstance="destory-instance",e.LogSettingReady="log-setting-ready",e.Stay="stay",e.ResetStay="reset-stay",e.StayReady="stay-ready",e.SetStay="set-stay",e.RouteChange="route-change",e.RouteReady="route-ready",e.Ab="ab",e.AbVar="ab-var",e.AbAllVars="ab-all-vars",e.AbConfig="ab-config",e.AbExternalVersion="ab-external-version",e.AbVersionChangeOn="ab-version-change-on",e.AbVersionChangeOff="ab-version-change-off",e.AbOpenLayer="ab-open-layer",e.AbCloseLayer="ab-close-layer",e.AbReady="ab-ready",e.AbComplete="ab-complete",e.AbTimeout="ab-timeout",e.AbVerify="ab-verify",e.Profile="profile",e.ProfileSet="profile-set",e.ProfileSetOnce="profile-set-once",e.ProfileUnset="profile-unset",e.ProfileIncrement="profile-increment",e.ProfileAppend="profile-append",e.ProfileClear="profile-clear",e.Autotrack="autotrack",e.AutotrackReady="autotrack-ready",e.CepReady="cep-ready",e.TracerReady="tracer-ready",e.sessionRecord="session-record",e.SessionRecordStart="session-record-start",e.SessionRecordPause="session-record-pause",e.SessionRecordEnd="session-record-end",e.SessionRecordReport="session-record-report",e.TrackEventDuration="track-event-duration",e.TrackEventDurationStart="track-event-duration-start",e.TrackEventDurationEnd="track-event-duration-end",e.TrackEventDurationPause="track-event-duration-pause",e.TrackEventDurationResume="tracl-event-duration-resume",e.VisualCollectReady="visual-collect-ready",e.VisualApiReady="visual-api-ready",e.VisualApiUpdate="visual-api-update"}(w||(w={})),function(e){e.DEBUGGER_MESSAGE="debugger-message",e.DEBUGGER_MESSAGE_SDK="debugger-message-sdk",e.DEBUGGER_MESSAGE_FETCH="debugger-message-fetch",e.DEBUGGER_MESSAGE_FETCH_RESULT="debugger-message-fetch-result",e.DEBUGGER_MESSAGE_EVENT="debugger-message-event",e.DEVTOOL_WEB_READY="devtool-web-ready"}(S||(S={}));var F=w,J=void 0,W=(new Date).getTimezoneOffset(),Z=parseInt(""+-W/60,10),X=60*W,$=function(){function e(e,t){var i=this;this.is_first_time=!0,this.configPersist=!1,this.initConfig=t,this.collect=e;var n=new G(t.app_id,t.cookie_domain||"",t.cookie_expire||6048e5).init(),o="__tea_cache_first_"+t.app_id;this.configKey="__tea_cache_config_"+t.app_id,this.sessionStorage=new U(!1,"session"),this.localStorage=new U(!1,"local"),this.channelUrl=this.getChannelForUrl(),this.current_env="row",t.configPersist&&(this.configPersist=!0,this.storage=1===t.configPersist?this.sessionStorage:this.localStorage);var r=this.localStorage.getItem(o);r&&1==r?this.is_first_time=!1:(this.is_first_time=!0,this.localStorage.setItem(o,"1")),this.envInfo={user:{user_unique_id:J,user_type:J,user_id:J,user_is_auth:J,user_is_login:J,device_id:J,web_id:J,ip_addr_id:J,user_unique_id_type:J},header:{app_id:J,app_name:J,app_install_id:J,install_id:J,app_package:J,app_channel:J,app_version:J,ab_version:J,os_name:n.os_name,os_version:n.os_version,device_model:n.device_model,ab_client:J,traffic_type:J,network_type:n.network_type,client_ip:J,device_brand:J,os_api:J,access:J,language:n.language,region:J,app_language:J,app_region:J,creative_id:n.utm.creative_id,ad_id:n.utm.ad_id,campaign_id:n.utm.campaign_id,log_type:J,rnd:J,platform:n.platform,sdk_version:"5.3.9_oversea",sdk_lib:"js",province:J,city:J,timezone:Z,tz_offset:X,tz_name:J,sim_region:J,carrier:J,resolution:n.screen_width+"x"+n.screen_height,browser:n.browser,browser_version:n.browser_version,referrer:n.referrer,referrer_host:n.referrer_host,width:n.screen_width,height:n.screen_height,screen_width:n.screen_width,screen_height:n.screen_height,utm_term:n.utm.utm_term,utm_content:n.utm.utm_content,utm_source:n.utm.utm_source,utm_medium:n.utm.utm_medium,utm_campaign:n.utm.utm_campaign,tracer_data:JSON.stringify(n.utm.tracer_data),custom:n.network_type?{network_type:n.network_type}:{}}},this.ab_version="",this.ab_uuid_cache={},this.evtParams={},this.reportErrorCallback=function(){},this.isLast=!1,this.setCustom(n),this.initDomain(),this.initABData(),this.collect.on("route-change",function(e){i.changeReferInfo(e.config)})}return e.prototype.initDomain=function(e){var t=this.initConfig.channel_domain;if(t)this.domain=t;else{var i=e||this.initConfig.report_channel||this.initConfig.channel,n=this.getChannelDomain(i);n||(console.warn("current channel: "+i+" is not exist, use va instead, please check!!!!"),n=j.sg),this.domain=p(n),this.setCurrentEnv(this.domain)}},e.prototype.setDomain=function(e){this.customDomain=!0,this.domain=e,this.setCurrentEnv(this.domain)},e.prototype.getDomain=function(e){return this.customDomain||e&&this.initDomain(e),this.domain},e.prototype.getChannelDomain=function(e){var t,i,n=e||this.initConfig.report_channel||this.initConfig.channel;return L().has(n)?N[n]:"tcpy"===(null===(t=this.initConfig)||void 0===t?void 0:t.channel_type)?K[n]:"ttp"===(null===(i=this.initConfig)||void 0===i?void 0:i.channel_type)?q[n]:j[n]},e.prototype.getChannelForUrl=function(){return this.initConfig.channel_type?{WEBID_URL:"/v1/user/webid",TOB_URL:"",REPORT_URL:"/v1/list"}:this.initConfig.report_channel?-1!==["sg_central","us_east"].indexOf(this.initConfig.report_channel)?{WEBID_URL:"/webid",TOB_URL:"/tobid",REPORT_URL:"/list"}:{WEBID_URL:"/v1/user/webid",TOB_URL:"",REPORT_URL:"/v1/list"}:{WEBID_URL:"/webid",TOB_URL:"/tobid",REPORT_URL:"/list"}},e.prototype.setCurrentEnv=function(e){this.getDomain().includes("byteoversea")?this.current_env="row":this.current_env="other"},e.prototype.getCurrentEnv=function(){return this.current_env},e.prototype.initABData=function(){var e,t="__tea_sdk_ab_version_"+this.initConfig.app_id;e=this.localStorage.getItem(t),this.setAbCache(e)},e.prototype.setAbCache=function(e){this.ab_cache=e},e.prototype.getAbCache=function(){return this.ab_cache},e.prototype.clearAbCache=function(){this.ab_cache={},this.ab_version=""},e.prototype.setAbVersion=function(e){this.ab_version=e},e.prototype.getAbVersion=function(){return this.ab_version},e.prototype.setAbUuidCache=function(e,t){var i=t||this.envInfo.user.user_unique_id;this.ab_uuid_cache[""+i]||(this.ab_uuid_cache[""+i]=[]),-1===this.ab_uuid_cache[""+i].indexOf(e)&&this.ab_uuid_cache[""+i].push(e)},e.prototype.getAbUuidCache=function(e){return this.ab_uuid_cache[""+e]},e.prototype.getUrl=function(e){var t="";switch(e){case"event":t=this.channelUrl.REPORT_URL;break;case"webid":t=this.channelUrl.WEBID_URL;break;case"tobid":t=this.channelUrl.TOB_URL}var i="";return this.initConfig.caller&&(i="?sdk_version=5.3.9_oversea&sdk_name=web&app_id="+this.initConfig.app_id+"&caller="+this.initConfig.caller),""+this.getDomain()+t+i},e.prototype.setCustom=function(e){if(e&&e.latest_data&&e.latest_data.isLast)for(var t in delete e.latest_data.isLast,this.isLast=!0,e.latest_data)this.envInfo.header.custom[t]=e.latest_data[t]},e.prototype.setAppid=function(e){this.envInfo.header.app_id=e},e.prototype.changeReferInfo=function(e){var t=e;this.set({referrer:t.referrer});var i="";try{i=new URL(t.referrer).host}catch(e){}this.set({referrer_host:i||this.envInfo.header.referrer_host})},e.prototype.set=function(e){var t=this;Object.keys(e).forEach(function(i){if(void 0!==e[i]&&null!==e[i]||t.delete(i),"traffic_type"===i&&t.isLast&&(t.envInfo.header.custom.$latest_traffic_source_type=e[i]),"evtParams"===i)t.evtParams=n(n({},t.evtParams||{}),e.evtParams||{});else if("_staging_flag"===i)t.evtParams=n(n({},t.evtParams||{}),{_staging_flag:e._staging_flag});else if("reportErrorCallback"===i&&"function"==typeof e[i])t.reportErrorCallback=e[i];else{var o="",r="";if(i.indexOf(".")>-1){var a=i.split(".");o=a[0],r=a[1]}o?"user"===o||"header"===o?t.envInfo[o][r]=e[i]:(t.envInfo.header.custom[r]=e[i],t.collect.emit(S.DEBUGGER_MESSAGE,{type:S.DEBUGGER_MESSAGE_SDK,info:"SDK Add Custom Params",level:"info",time:Date.now(),infoType:"sdk",secType:"HEADER",common:"custom"})):Object.hasOwnProperty.call(t.envInfo.user,i)?(["user_type","ip_addr_id"].indexOf(i)>-1?t.envInfo.user[i]=e[i]?Number(e[i]):e[i]:["user_id","web_id","user_unique_id","user_unique_id_type"].indexOf(i)>-1?t.envInfo.user[i]=e[i]?String(e[i]):e[i]:["user_is_auth","user_is_login"].indexOf(i)>-1?t.envInfo.user[i]=Boolean(e[i]):"device_id"===i&&(t.envInfo.user[i]=e[i]),t.collect.emit(S.DEBUGGER_MESSAGE,{type:S.DEBUGGER_MESSAGE_SDK,info:"SDK Set Common Params",level:"info",time:Date.now(),infoType:"sdk",secType:"USER",common:i})):Object.hasOwnProperty.call(t.envInfo.header,i)?(t.envInfo.header[i]=e[i],t.collect.emit(S.DEBUGGER_MESSAGE,{type:S.DEBUGGER_MESSAGE_SDK,info:"SDK Set Common Params",level:"info",time:Date.now(),infoType:"sdk",secType:"HEADER",common:i})):(t.envInfo.header.custom[i]=e[i],t.collect.emit(S.DEBUGGER_MESSAGE,{type:S.DEBUGGER_MESSAGE_SDK,info:"SDK Add Custom Params",level:"info",time:Date.now(),infoType:"sdk",secType:"HEADER",common:"custom"}))}})},e.prototype.get=function(e){try{return e?"evtParams"===e?this.evtParams:"reportErrorCallback"===e?this[e]:Object.hasOwnProperty.call(this.envInfo.user,e)?this.envInfo.user[e]:Object.hasOwnProperty.call(this.envInfo.header,e)?this.envInfo.header[e]:JSON.parse(JSON.stringify(this.envInfo[e])):JSON.parse(JSON.stringify(this.envInfo))}catch(e){console.log("get config stringify error "),this.collect.emit(S.DEBUGGER_MESSAGE,{type:S.DEBUGGER_MESSAGE_SDK,info:"SDK Something Error",level:"error",time:Date.now(),data:e.message,infoType:"sdk"})}},e.prototype.setStore=function(e){try{if(!this.configPersist)return;var t=this.storage.getItem(this.configKey)||{};if(t&&Object.keys(e).length){var i=Object.assign(e,t);this.storage.setItem(this.configKey,i)}}catch(e){console.log("setStore error"),this.collect.emit(S.DEBUGGER_MESSAGE,{type:S.DEBUGGER_MESSAGE_SDK,info:"SDK Something Error",level:"error",time:Date.now(),data:e.message,infoType:"sdk"})}},e.prototype.getStore=function(){try{if(!this.configPersist)return null;var e=this.storage.getItem(this.configKey)||{};return e&&Object.keys(e).length?e:null}catch(e){return this.collect.emit(S.DEBUGGER_MESSAGE,{type:S.DEBUGGER_MESSAGE_SDK,info:"SDK Something Error",level:"error",time:Date.now(),data:e.message,infoType:"sdk"}),null}},e.prototype.delete=function(e){try{if(!this.configPersist)return;var t=this.storage.getItem(this.configKey)||{};t&&Object.hasOwnProperty.call(t,e)&&(delete t[e],this.storage.setItem(this.configKey,t))}catch(e){this.collect.emit(S.DEBUGGER_MESSAGE,{type:S.DEBUGGER_MESSAGE_SDK,info:"SDK Something Error",level:"error",time:Date.now(),data:e.message,infoType:"sdk"}),console.log("delete error")}},e}(),Y=function(){function e(e,t){this.isLog=t||!1,this.name=e||""}return e.prototype.info=function(e){this.isLog&&console.log("%c %s","color: yellow; background-color: black;","[Tea instance: "+this.name+"] "+e)},e.prototype.warn=function(e){this.isLog&&console.warn("%c %s","color: #4D1B00;","[Tea instance: "+this.name+"] "+e)},e.prototype.error=function(e){this.isLog&&console.error("%c %s","color: #FFF; background-color: #F53F3F;","[Tea instance: "+this.name+"] "+e)},e.prototype.throw=function(e){throw this.error(this.name),new Error(e)},e}(),Q=function(){function e(){this.spiderBot=["Baiduspider","googlebot","360Spider","haosouspider","YoudaoBot","Yisouspider","Googlebot","Headless","Applebot","Bingbot","PetalBot"]}return e.prototype.checkSpider=function(e){if(!e.enable_spider)return!1;var t=window.navigator.userAgent;if(!t)return!0;var i=!1;return this.spiderBot.forEach(function(e){-1!==t.indexOf(e)&&(i=!0)}),i},e}(),ee=function(){function e(e,t){this.collect=e,this.native=t}var t=e.prototype;return t.bridgeInject=function(){try{return!!this.native&&(AppLogBridge?(console.log("AppLogBridge is injected"),!0):(console.log("AppLogBridge is not inject"),!1))}catch(e){return console.log("AppLogBridge is not inject"),!1}},t.bridgeReady=function(){var e=this;return new Promise(function(t,i){try{e.bridgeInject()?AppLogBridge.hasStarted(function(e){console.log("AppLogBridge is started? : "+e),e?t(!0):i(!1)}):i(!1)}catch(e){console.log("AppLogBridge, error:"+JSON.stringify(e.stack)),i(!1)}})},t.setNativeAppId=function(e){try{AppLogBridge.setNativeAppId(JSON.stringify(e)),console.log("change bridge appid, event report with appid: "+e)}catch(e){console.error("setNativeAppId error")}},t.setConfig=function(e){var t=this;try{Object.keys(e).forEach(function(i){"user_unique_id"===i?t.setUserUniqueId(e[i]):e[i]?t.addHeaderInfo(i,e[i]):t.removeHeaderInfo(i)})}catch(e){console.error("setConfig error")}},t.setUserUniqueId=function(e){try{AppLogBridge.setUserUniqueId(e)}catch(e){console.error("setUserUniqueId error")}},t.addHeaderInfo=function(e,t){try{AppLogBridge.addHeaderInfo(e,t)}catch(e){console.error("addHeaderInfo error")}},t.setHeaderInfo=function(e){try{AppLogBridge.setHeaderInfo(JSON.stringify(e))}catch(e){console.error("setHeaderInfo error")}},t.removeHeaderInfo=function(e){try{AppLogBridge.removeHeaderInfo(e)}catch(e){console.error("removeHeaderInfo error")}},t.reportPv=function(e){this.onEventV3("predefine_pageview",e)},t.onEventV3=function(e,t){try{AppLogBridge.onEventV3(e,t),this.collect.emit(DebuggerMesssge.DEBUGGER_MESSAGE,{type:DebuggerMesssge.DEBUGGER_MESSAGE_EVENT,info:"bridge report success",time:Date.now(),data:[{events:[{event:e,params:t}]}],code:200,status:"success"})}catch(e){console.error("onEventV3 error")}},t.profileSet=function(e){try{AppLogBridge.profileSet(e)}catch(e){console.error("profileSet error")}},t.profileSetOnce=function(e){try{AppLogBridge.profileSetOnce(e)}catch(e){console.error("profileSetOnce error")}},t.profileIncrement=function(e){try{AppLogBridge.profileIncrement(e)}catch(e){console.error("profileIncrement error")}},t.profileUnset=function(e){try{AppLogBridge.profileUnset(e)}catch(e){console.error("profileUnset error")}},t.profileAppend=function(e){try{AppLogBridge.profileAppend(e)}catch(e){console.error("profileAppend error")}},e}(),te=function(){function e(){this.setUrl="/service/2/web_sdk_settings/",this.expireTime=216e5}return e.prototype.apply=function(e,t){if(t.enable_logsetting){this.collect=e,this.config=t;var i=e.adapters.storage;this.setKey="applog_web_logsetting_"+t.app_id,this.uniqueKey="web_logsetting_data",this.cacheStorgae=new i(!1),this.dbStorage=new R(this.setKey,"LOGSETTING_DATA_STORE"),this.domain=t.logsetting_domain||this.collect.configManager.getDomain(),this.check()}else e.emit(F.LogSettingReady)},e.prototype.check=function(){return o(this,void 0,void 0,function(){var e;return r(this,function(t){switch(t.label){case 0:return t.trys.push([0,2,,3]),[4,this.getLocalData()];case 1:return(e=t.sent())&&Object.keys(e).length?(null==e?void 0:e.timestamp)<Date.now()-this.expireTime?this.fetchSetting():(this.setSettingData(e.settingConfig),this.collect.emit(F.LogSettingReady)):this.fetchSetting(),[3,3];case 2:return t.sent(),this.collect.emit(F.LogSettingReady),this.collect.emit(S.DEBUGGER_MESSAGE,{type:S.DEBUGGER_MESSAGE_SDK,info:"SDK Check LogSetting Data Error",logType:"fetch",level:"error",time:Date.now(),infoType:"sdk"}),[3,3];case 3:return[2]}})})},e.prototype.fetchSetting=function(e){var t=this;if(e)this.collect.emit(F.LogSettingReady);else{var i=this.collect.configManager.get("header");i.custom=JSON.stringify(i.custom);var o=this.collect.configManager.get("user"),r={event_filter:0,header:n(n({aid:this.config.app_id},i),o),options:{params_block_enable:this.config.enable_logsetting_params?1:0,header_custom_allow_enable:this.config.enable_logsetting_header_custom?1:0}};this.collect.emit(S.DEBUGGER_MESSAGE,{type:S.DEBUGGER_MESSAGE_SDK,info:"SDK Fetch LogSetting Request",logType:"fetch",level:"info",time:Date.now(),data:r,infoType:"sdk"}),this.collect.requestManager.useRequest({url:""+this.domain+this.setUrl+"?device_platform=web",data:r,timeout:5e3,success:function(e){(null==e?void 0:e.config)?(t.setLocalData(e.config),t.collect.emit(S.DEBUGGER_MESSAGE,{type:S.DEBUGGER_MESSAGE_SDK,info:"LogSetting Request Success",logType:"fetch",level:"info",time:Date.now(),data:e,infoType:"sdk"})):t.collect.emit(S.DEBUGGER_MESSAGE,{type:S.DEBUGGER_MESSAGE_SDK,info:"LogSetting Request Response No Data",logType:"fetch",level:"error",time:Date.now(),infoType:"sdk"}),t.collect.emit(F.LogSettingReady)},fail:function(){t.collect.emit(F.LogSettingReady),t.collect.emit(S.DEBUGGER_MESSAGE,{type:S.DEBUGGER_MESSAGE_SDK,info:"LogSetting Request Fail",logType:"fetch",level:"error",time:Date.now(),infoType:"sdk"})}})}},e.prototype.getLocalData=function(){return o(this,void 0,void 0,function(){return r(this,function(e){switch(e.label){case 0:return e.trys.push([0,2,,3]),[4,this.dbStorage.getItem(this.uniqueKey)];case 1:return[2,e.sent()];case 2:return e.sent(),[2,null];case 3:return[2]}})})},e.prototype.setLocalData=function(e){try{var t={timestamp:Date.now(),settingConfig:e};this.setSettingData(e),this.dbStorage.setItem(this.uniqueKey,t),this.collect.emit(S.DEBUGGER_MESSAGE,{type:S.DEBUGGER_MESSAGE_SDK,info:"SDK Update LogSetting Cache",logType:"info",level:"info",time:Date.now(),infoType:"sdk",data:e})}catch(e){this.collect.emit(S.DEBUGGER_MESSAGE,{type:S.DEBUGGER_MESSAGE_SDK,info:"SDK Set LogSetting Data Error",logType:"info",level:"error",time:Date.now(),infoType:"sdk"})}},e.prototype.getSettingData=function(e){return e?this.logSettingConfig[e]:this.logSettingConfig},e.prototype.setSettingData=function(e){this.logSettingConfig=e},e.prototype.getPredefineEventList=function(){return new Set(["predefine_pageview","onload","bav2b_click","bav2b_page","bav2b_beat","bav2b_page_statistics","bav2b_exposure","predefine_page_alive","predefine_page_close","_be_active","__bav_click","__bav_page","__bav_beat","__bav_page_statistics","__bav_page_exposure"])},e.prototype.getPredefineParamsList=function(){return new Set(["event_index"])},e}(),ie=function(){function e(){this.eventLimit=50,this.enable_ttwebid=!1,this.eventCache=[],this.beconEventCache=[]}return e.prototype.apply=function(e,t){var i=this;this.collect=e,this.config=t,this.configManager=e.configManager,this.cacheStorgae=new U(!0),this.localStorage=new U(!1),this.logSetting=new te,this.maxReport=t.max_report||10,this.reportTime=t.reportTime||30,this.timeout=t.timeout||1e5,this.enable_ttwebid=t.enable_ttwebid,this.reportUrl=t.report_url||this.configManager.getUrl("event"),this.eventKey="__tea_cache_events_"+this.configManager.get("app_id"),this.beconKey="__tea_cache_events_becon_"+this.configManager.get("app_id"),this.abKey="__tea_sdk_ab_version_"+this.configManager.get("app_id"),this.refer_key="__tea_cache_refer_"+this.configManager.get("app_id"),this.logSetting.apply(e,t),this.collect.on(F.Ready,function(){i.reportAll(!1)}),this.collect.on(F.ConfigDomain,function(){i.reportUrl=i.configManager.getUrl("event")}),this.collect.on(F.Event,function(e){i.event(e)}),this.collect.on(F.BeconEvent,function(e){i.beconEvent(e)}),this.collect.on(F.CleanEvents,function(){i.reportAll(!1)}),this.linster()},e.prototype.linster=function(){var e=this;window.addEventListener("unload",function(){e.reportAll(!0)},!1),g(function(){e.reportAll(!0)}),document.addEventListener("visibilitychange",function(){"hidden"===document.visibilityState&&e.reportAll(!0)},!1)},e.prototype.reportAll=function(e){this.report(e),this.reportBecon()},e.prototype.event=function(e){var t=this;if(!this.collect.destroy&&!this.collect.sdkStop)try{if(this.config.enable_ios_sendbeacon&&f())return void this.beconEvent(e);var i=s(e,this.cacheStorgae.getItem(this.eventKey)||[]);if(this.cacheStorgae.setItem(this.eventKey,i),this.reportTimeout&&clearTimeout(this.reportTimeout),i.length>=this.maxReport)this.report(!1);else{var n=this.reportTime;this.reportTimeout=setTimeout(function(){t.report(!1),t.reportTimeout=null},n)}}catch(e){this.collect.emit(S.DEBUGGER_MESSAGE,{type:S.DEBUGGER_MESSAGE_SDK,info:"SDK Something Error",level:"error",time:Date.now(),data:e.message,infoType:"sdk"})}},e.prototype.beconEvent=function(e){if(!this.collect.destroy&&!this.collect.sdkStop){var t=s(e,this.cacheStorgae.getItem(this.beconKey)||[]);if(this.cacheStorgae.setItem(this.beconKey,t),this.collect.tokenManager.getReady()&&this.collect.sdkReady){this.cacheStorgae.removeItem(this.beconKey);try{var i=JSON.parse(JSON.stringify(t));if(this.send(this.split(this.merge(t)),!0),this.config.event_verify_url){var n=this.split(this.merge(i,!0));this.collect.emit(F.SubmitVerify,n)}}catch(e){this.send(this.split(this.merge(t)),!0)}}}},e.prototype.reportBecon=function(){if(!this.collect.destroy&&!this.collect.sdkStop&&this.collect.tokenManager.getReady()&&this.collect.sdkReady){var e=this.cacheStorgae.getItem(this.beconKey)||[];if(e&&e.length){this.cacheStorgae.removeItem(this.beconKey);try{var t=JSON.parse(JSON.stringify(e));if(this.send(this.split(this.merge(e)),!0),this.config.event_verify_url){var i=this.split(this.merge(t,!0));this.collect.emit(F.SubmitVerify,i)}}catch(t){this.send(this.split(this.merge(e)),!0)}}}},e.prototype.report=function(e){if(!this.collect.destroy&&!this.collect.sdkStop&&this.collect.tokenManager.getReady()&&this.collect.sdkReady){var t=this.cacheStorgae.getItem(this.eventKey)||[];t.length&&(this.cacheStorgae.removeItem(this.eventKey),this.sliceEvent(t,e))}},e.prototype.sliceEvent=function(e,t){if(e.length>this.eventLimit)for(var i=0;i<e.length;i+=this.eventLimit){var n;n=e.slice(i,i+this.eventLimit);try{var o=JSON.parse(JSON.stringify(n));if(this.send(this.split(this.merge(n)),t),this.config.event_verify_url){var r=this.split(this.merge(o,!0));this.collect.emit(F.SubmitVerify,r)}}catch(e){this.send(this.split(this.merge(n)),t)}}else try{o=JSON.parse(JSON.stringify(e)),this.send(this.split(this.merge(e)),t),this.config.event_verify_url&&(r=this.split(this.merge(o,!0)),this.collect.emit(F.SubmitVerify,r))}catch(i){this.send(this.split(this.merge(e)),t)}},e.prototype.handleRefer=function(){var e="";try{if(this.config.spa||this.config.autotrack){var t=this.localStorage.getItem(this.refer_key)||{};e=t.routeChange?t.refer_key:this.configManager.get("referrer")}else e=this.configManager.get("referrer")}catch(t){e=document.referrer}return e},e.prototype.merge=function(e,t){var i=this;void 0===t&&(t=!1);var o=this.configManager.get(),r=o.header,a=o.user;r.custom=this.customAllow(r.custom,t);var s=this.configManager.get("evtParams"),c=this.configManager.get("user_unique_id_type"),l=[];try{var u=e.filter(function(e){try{Object.keys(s).length&&(e.params=n(n({},s),e.params)),c&&(e.params.$user_unique_id_type=c);var o=i.configManager.getAbCache(),r=a[i.config.ab_user_mode]||a.user_unique_id,l=i.configManager.getAbUuidCache(r);if(o&&o.uuid&&o.uuid===r){var u=i.configManager.getAbVersion();if(i.config.enable_ab_uuid){if(l&&l.length){var h=l.join(",");u&&u.includes(h)&&(e.ab_sdk_version=u)}}else u&&(e.ab_sdk_version=u)}return e.session_id=i.collect.sessionManager.getSessionId(),e.params=i.paramsAllow(e,t),e}catch(t){return console.warn("filter merge event: "+(e&&e.event)+" error, pls check",t&&t.message),i.collect.emit(S.DEBUGGER_MESSAGE,{type:S.DEBUGGER_MESSAGE_SDK,info:"SDK Merge Event Something Error",level:"error",time:Date.now(),data:t.message,infoType:"sdk"}),!1}}),h=JSON.parse(JSON.stringify({events:u,user:a,header:r}));h.local_time=Math.floor(Date.now()/1e3),h.user_unique_type=this.config.enable_ttwebid?this.config.user_unique_type:void 0,h.verbose=1,l.push(h)}catch(e){console.warn("event merge error, pls check",e&&e.message)}return l},e.prototype.split=function(e){return e.map(function(e){var t=[];return t.push(e),t})},e.prototype.blockEvent=function(e){try{var t=this.blockList;if(this.config.enable_logsetting){var i=this.blockList,n=this.logSetting.getSettingData("blocklist_events").block_event;t=i.concat(n.filter(function(e){return-1===i.indexOf(e)}))}return!(t&&t.length&&t.includes(e))}catch(e){return!0}},e.prototype.whiteEvent=function(e){var t;try{return!(null===(t=this.whiteList)||void 0===t?void 0:t.length)||!!this.whiteList.includes(e)}catch(e){return!0}},e.prototype.customAllow=function(e,t){try{if(t)return JSON.stringify(e);if(!this.config.enable_logsetting||!this.config.enable_logsetting_header_custom)return JSON.stringify(e);var i=this.logSetting.getSettingData().header_custom_allow;if(i){var n={};if(i.length&&Object.keys(e).length){var o=new Set(i);for(var r in e)o.has(r)&&(n[r]=e[r])}return JSON.stringify(n)}return JSON.stringify(e)}catch(t){return this.collect.emit(S.DEBUGGER_MESSAGE,{type:S.DEBUGGER_MESSAGE_SDK,info:"SDK Execute customAllow Something Error",level:"error",time:Date.now(),data:t.message,infoType:"sdk"}),JSON.stringify(e)}},e.prototype.paramsAllow=function(e,t){try{if(t)return JSON.stringify(e.params);if(!this.config.enable_logsetting||!this.config.enable_logsetting_params)return JSON.stringify(e.params);var i=this.logSetting.getSettingData().params_block,n=e.event,o=e.params;if(!i)return JSON.stringify(e.params);if(i[n]&&i[n].length){var r={},a=new Set(i[n]);for(var s in o)!this.logSetting.getPredefineParamsList().has(s)&&a.has(s)||(r[s]=o[s]);return JSON.stringify(r)}return JSON.stringify(e.params)}catch(t){return this.collect.emit(S.DEBUGGER_MESSAGE,{type:S.DEBUGGER_MESSAGE_SDK,info:"SDK Execute paramsAllow Something Error",level:"error",time:Date.now(),data:t.message,infoType:"sdk"}),JSON.stringify(e.params)}},e.prototype.send=function(e,t){var i=this;e.length&&(this.config.disable_track_event||e.forEach(function(e){try{var n=JSON.parse(JSON.stringify(e));i.config.filter&&((n=i.config.filter(n))||console.warn("filter must return data !!")),i.collect.eventFilter&&n&&((n=i.collect.eventFilter(n))||console.warn("filterEvent api must return data !!"));var o=n||e,r=JSON.parse(JSON.stringify(o));if(!o.length)return;var a=!0;if(o.forEach(function(e){e.events.length||(a=!1)}),!a)return;i.collect.emit(F.SubmitBefore,o),i.collect.requestManager.useRequest({url:i.reportUrl,data:o,success:function(e,t){e&&0!==e.e?(i.collect.emit(F.SubmitError,{type:"f_data",eventData:t,errorCode:e.e,response:e}),i.collect.emit(S.DEBUGGER_MESSAGE,{type:S.DEBUGGER_MESSAGE_EVENT,info:"Event Report Fail",time:Date.now(),data:r,code:e.e,failType:"event data error",status:"fail"})):(i.collect.emit(F.SubmitScuess,{eventData:t,res:e}),i.collect.emit(S.DEBUGGER_MESSAGE,{type:S.DEBUGGER_MESSAGE_EVENT,info:"Event Report Success",time:Date.now(),data:r,code:200,status:"success"}))},fail:function(e,t){i.configManager.get("reportErrorCallback")(e,t),i.collect.emit(F.SubmitError,{type:"f_net",eventData:e,errorCode:t}),i.collect.emit(S.DEBUGGER_MESSAGE,{type:S.DEBUGGER_MESSAGE_EVENT,info:"Event Report Network Fail",time:Date.now(),data:r,code:t,failType:"network error",status:"fail"})},timeout:i.timeout,useBeacon:!i.config.disable_sendbeacon&&t,withCredentials:i.enable_ttwebid,zip:!0}),i.collect.emit(F.SubmitAfter,o)}catch(e){console.warn("something error, "+JSON.stringify(e.stack)),i.collect.emit(S.DEBUGGER_MESSAGE,{type:S.DEBUGGER_MESSAGE_SDK,info:"SDK Report Event Something Error",level:"error",time:Date.now(),data:e.message})}}))},e}(),ne=function(){return function e(t){return t?(t^16*Math.random()>>t/4).toString(10):([1e7]+-1e3+-4e3+-8e3+-1e11).replace(/[018]/g,e)}().replace(/-/g,"").slice(0,19)},oe=function(){function e(){this.cacheToken={},this.enableCookie=!1,this.enable_ttwebid=!1,this.enableCustomWebid=!1}return e.prototype.apply=function(e,t){var i=this;this.collect=e,this.config=t,this.configManager=this.collect.configManager,this.storage=new U(!1),this.tokenKey="__tea_cache_tokens_"+t.app_id,this.enable_ttwebid=t.enable_ttwebid,this.enableCustomWebid=t.enable_custom_webid,this.collect.on(F.ConfigUuid,function(e){i.setUuid(e)}),this.collect.on(F.ConfigWebId,function(e){i.setWebId(e)}),this.collect.on(F.ConfigDiD,function(e){i.setDeviceId(e)}),this.enableCookie=t.cross_subdomain,this.expiresTime=t.cookie_expire||6048e5,this.cookieDomain=t.cookie_domain||"",this.checkStorage()},e.prototype.checkStorage=function(){var e=this;this.cacheToken=this.storage.getItem(this.tokenKey)||{},this.tokenType=this.cacheToken&&this.cacheToken._type_?this.cacheToken._type_:"default","custom"!==this.tokenType||this.enableCustomWebid?this.enableCustomWebid?this.collect.on(F.CustomWebId,function(){e.tokenReady=!0,e.collect.emit(F.TokenComplete)}):this.checkEnv()||(this.enable_ttwebid?this.completeTtWid(this.cacheToken):this.check()):this.remoteWebid()},e.prototype.check=function(){this.cacheToken&&this.cacheToken.web_id?this.complete(this.cacheToken):this.config.disable_webid?this.complete({web_id:ne(),user_unique_id:this.configManager.get("user_unique_id")||ne()}):this.remoteWebid()},e.prototype.checkEnv=function(){var e=window.navigator.userAgent;if(-1!==e.indexOf("miniProgram")||-1!==e.indexOf("MiniProgram")){var t=v(window.location.href);return!(!t||!t.Web_ID||(this.complete({web_id:""+t.Web_ID,user_unique_id:this.configManager.get("user_unique_id")||""+t.Web_ID}),0))}return!1},e.prototype.remoteWebid=function(){var e=this,t=this.configManager.getUrl("webid"),i={app_key:this.config.app_key,app_id:this.config.app_id,url:location.href,user_agent:window.navigator.userAgent,referer:document.referrer,user_unique_id:""};this.collect.emit(S.DEBUGGER_MESSAGE,{type:S.DEBUGGER_MESSAGE_SDK,info:"SDK Fetch WebID Request",logType:"fetch",level:"info",time:Date.now(),data:i});var n=ne();this.collect.requestManager.useRequest({url:t,data:i,success:function(t){var i;t&&0===t.e?(i=t.web_id,e.collect.emit(S.DEBUGGER_MESSAGE,{type:S.DEBUGGER_MESSAGE_SDK,info:"Fetch WebID Request Success",logType:"fetch",level:"info",time:Date.now(),data:t})):(i=n,e.collect.configManager.set({localWebId:n}),e.collect.emit(F.TokenError),e.collect.emit(S.DEBUGGER_MESSAGE,{type:S.DEBUGGER_MESSAGE_SDK,info:"Fetch WebID Request Data Error, Use LocalId",logType:"fetch",level:"warn",time:Date.now(),data:t}),e.collect.logger.warn("appid: "+e.config.app_id+" get webid error, use local webid~")),e.complete({web_id:e.configManager.get("web_id")||i,user_unique_id:e.configManager.get("user_unique_id")||i})},fail:function(){e.complete({web_id:e.configManager.get("web_id")||n,user_unique_id:e.configManager.get("user_unique_id")||n}),e.collect.configManager.set({localWebId:n}),e.collect.emit(F.TokenError),e.collect.emit(S.DEBUGGER_MESSAGE,{type:S.DEBUGGER_MESSAGE_SDK,info:"Fetch WebID Request Network Fail, Use LocalId",logType:"fetch",level:"error",time:Date.now(),data:null}),e.collect.logger.warn("appid: "+e.config.app_id+", get webid error, use local webid~")},timeout:3e5})},e.prototype.complete=function(e){var t=e.web_id,i=e.user_unique_id,o=e.device_id;if(e.timestamp=Date.now(),this.collect.configManager.set({web_id:t,user_unique_id:i}),this.config.enable_device_id){var r=this.configManager.get("device_id")||o||t;this.collect.configManager.set({device_id:r}),e=n(n({},e),{device_id:r})}else delete e.device_id;this.setStorage(e),this.tokenReady=!0,this.collect.emit(S.DEBUGGER_MESSAGE,{type:S.DEBUGGER_MESSAGE_SDK,info:"SDK UserInfo Complete",logType:"info",secType:"USER",level:"info",time:Date.now(),data:{web_id:t,user_unique_id:i},infoType:"sdk"}),this.collect.emit(F.TokenComplete)},e.prototype.completeTtWid=function(e){var t=e.user_unique_id||"",i=this.configManager.get("user_unique_id");(i||t)&&this.configManager.set({user_unique_id:i||t}),this.setStorage(e),this.tokenReady=!0,this.collect.emit(F.TokenComplete)},e.prototype.setUuid=function(e){if(e&&-1===["null","undefined","Null","None"].indexOf(e)){var t=String(e),i=this.configManager.get("user_unique_id"),n=this.cacheToken&&this.cacheToken.user_unique_id;if(t===i&&t===n)return;this.configManager.set({user_unique_id:t}),this.cacheToken||(this.cacheToken={}),this.cacheToken.user_unique_id=t,this.cacheToken.timestamp=Date.now(),this.setStorage(this.cacheToken),this.collect.emit(F.TokenChange,"uuid"),this.collect.emit(F.SessionReset)}else this.clearUuid()},e.prototype.clearUuid=function(){this.config.enable_ttwebid||this.configManager.get("web_id")&&(this.configManager.set({user_unique_id:this.configManager.get("web_id")}),this.cacheToken&&this.cacheToken.web_id&&(this.cacheToken.user_unique_id=this.cacheToken.web_id,this.cacheToken.timestamp=Date.now(),this.setStorage(this.cacheToken)),this.collect.emit(F.TokenReset))},e.prototype.setWebId=function(e){if(e&&!this.config.enable_ttwebid){this.cacheToken&&this.cacheToken.web_id?this.cacheToken.web_id!==e&&(this.cacheToken.user_unique_id=this.cacheToken.web_id===this.cacheToken.user_unique_id?e:this.cacheToken.user_unique_id,this.cacheToken.web_id=e):(this.cacheToken={},this.cacheToken.web_id=e,this.cacheToken.user_unique_id=e),this.cacheToken.timestamp=Date.now();var t=this.configManager.get("web_id"),i=this.configManager.get("user_unique_id");i&&i!==t||(this.configManager.set({user_unique_id:e}),this.collect.emit(F.TokenChange,"uuid")),t!==e&&(this.configManager.set({web_id:e}),this.collect.emit(F.TokenChange,"webid")),this.setStorage(this.cacheToken)}},e.prototype.setDeviceId=function(e){this.configManager.set({device_id:e}),this.config.enable_device_id&&this.cacheToken&&(this.cacheToken.device_id=e,this.cacheToken.timestamp=Date.now(),this.setStorage(this.cacheToken))},e.prototype.setStorage=function(e){e._type_=this.enableCustomWebid?"custom":"default",delete e["diss".split("").reverse().join("")],this.storage.setItem(this.tokenKey,e),this.cacheToken=e},e.prototype.getReady=function(){return this.tokenReady},e.prototype.getTobId=function(){var e=this;return new Promise(function(t){if("tcpy"!==e.config.channel_type&&"ttp"!==e.config.channel_type){var i={app_id:e.config.app_id,user_unique_id:e.configManager.get("user_unique_id"),web_id:e.configManager.get("web_id"),user_unique_id_type:e.configManager.get("user_unique_id_type")};e.collect.emit(S.DEBUGGER_MESSAGE,{type:S.DEBUGGER_MESSAGE_SDK,info:"SDK Fetch GetToken Request",logType:"fetch",level:"info",time:Date.now(),data:i,infoType:"sdk"}),e.collect.requestManager.useRequest({url:e.configManager.getUrl("tobid"),data:i,success:function(i){i&&0===i.e?(t(i.tobid),e.collect.emit(S.DEBUGGER_MESSAGE,{type:S.DEBUGGER_MESSAGE_SDK,info:"Fetch GetToken Request Success",logType:"fetch",level:"info",time:Date.now(),data:i,infoType:"sdk"})):(t(""),e.collect.emit(S.DEBUGGER_MESSAGE,{type:S.DEBUGGER_MESSAGE_SDK,info:"Fetch GetToken Request Fail",logType:"fetch",level:"error",time:Date.now(),data:i,infoType:"sdk"}))},fail:function(){t(""),e.collect.emit(S.DEBUGGER_MESSAGE,{type:S.DEBUGGER_MESSAGE_SDK,info:"Fetch GetToken Request Network Error",logType:"fetch",level:"error",time:Date.now(),infoType:"sdk"})},time:3e4,withCredentials:e.enable_ttwebid})}else t("")})},e}(),re=function(){return"xxxxxxxx-xxxx-4xxx-yxxx-xxxxxxxxxxxx".replace(/[xy]/g,function(e){var t=16*Math.random()|0;return("x"===e?t:3&t|8).toString(16)})},ae=function(){function e(){}return e.prototype.apply=function(e,t){var i=this;this.collect=e,this.storage=new U(!1,"session"),this.sessionKey="__tea_session_id_"+t.app_id,this.expireTime=t.expireTime||18e5,this.disableSession=t.disable_session,this.disableSessionTimeCheck=t.disable_session_check,this.disableSession||(this.setSessionId(),this.collect.on(F.SessionReset,function(e){i.resetSessionId(e)}),this.collect.on(F.SessionResetTime,function(){i.updateSessionIdTime()}))},e.prototype.updateSessionIdTime=function(){var e=this.storage.getItem(this.sessionKey);if(e&&e.sessionId){var t=e.timestamp;Date.now()-t>this.expireTime?e={sessionId:re(),timestamp:Date.now()}:e.timestamp=Date.now(),this.storage.setItem(this.sessionKey,e),this.resetExpTime()}},e.prototype.setSessionId=function(){var e=this,t=this.storage.getItem(this.sessionKey);t&&t.sessionId?t.timestamp=Date.now():t={sessionId:re(),timestamp:Date.now()},this.storage.setItem(this.sessionKey,t),this.disableSessionTimeCheck||(this.sessionExp=setInterval(function(){e.checkEXp()},this.expireTime))},e.prototype.getSessionId=function(){var e=this.storage.getItem(this.sessionKey);return this.disableSession?"":e&&e.sessionId?e.sessionId:""},e.prototype.resetExpTime=function(){var e=this;this.sessionExp&&(clearInterval(this.sessionExp),this.sessionExp=setInterval(function(){e.checkEXp()},this.expireTime))},e.prototype.resetSessionId=function(e){var t={sessionId:e||re(),timestamp:Date.now()};this.storage.setItem(this.sessionKey,t)},e.prototype.checkEXp=function(){var e=this.storage.getItem(this.sessionKey);e&&e.sessionId&&Date.now()-e.timestamp+30>=this.expireTime&&(e={sessionId:re(),timestamp:Date.now()},this.storage.setItem(this.sessionKey,e))},e}();function se(e){let t=e.length;for(;--t>=0;)e[t]=0}const ce=new Uint8Array([0,0,0,0,0,0,0,0,1,1,1,1,2,2,2,2,3,3,3,3,4,4,4,4,5,5,5,5,0]),le=new Uint8Array([0,0,0,0,1,1,2,2,3,3,4,4,5,5,6,6,7,7,8,8,9,9,10,10,11,11,12,12,13,13]),ue=new Uint8Array([0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,2,3,7]),he=new Uint8Array([16,17,18,0,8,7,9,6,10,5,11,4,12,3,13,2,14,1,15]),de=new Array(576);se(de);const pe=new Array(60);se(pe);const fe=new Array(512);se(fe);const ge=new Array(256);se(ge);const _e=new Array(29);se(_e);const me=new Array(30);function ve(e,t,i,n,o){this.static_tree=e,this.extra_bits=t,this.extra_base=i,this.elems=n,this.max_length=o,this.has_stree=e&&e.length}let ye,be,Ee;function we(e,t){this.dyn_tree=e,this.max_code=0,this.stat_desc=t}se(me);const Se=e=>e<256?fe[e]:fe[256+(e>>>7)],ke=(e,t)=>{e.pending_buf[e.pending++]=255&t,e.pending_buf[e.pending++]=t>>>8&255},ze=(e,t,i)=>{e.bi_valid>16-i?(e.bi_buf|=t<<e.bi_valid&65535,ke(e,e.bi_buf),e.bi_buf=t>>16-e.bi_valid,e.bi_valid+=i-16):(e.bi_buf|=t<<e.bi_valid&65535,e.bi_valid+=i)},De=(e,t,i)=>{ze(e,i[2*t],i[2*t+1])},Te=(e,t)=>{let i=0;do{i|=1&e,e>>>=1,i<<=1}while(--t>0);return i>>>1},Ae=(e,t,i)=>{const n=new Array(16);let o,r,a=0;for(o=1;o<=15;o++)a=a+i[o-1]<<1,n[o]=a;for(r=0;r<=t;r++){let t=e[2*r+1];0!==t&&(e[2*r]=Te(n[t]++,t))}},Re=e=>{let t;for(t=0;t<286;t++)e.dyn_ltree[2*t]=0;for(t=0;t<30;t++)e.dyn_dtree[2*t]=0;for(t=0;t<19;t++)e.bl_tree[2*t]=0;e.dyn_ltree[512]=1,e.opt_len=e.static_len=0,e.sym_next=e.matches=0},xe=e=>{e.bi_valid>8?ke(e,e.bi_buf):e.bi_valid>0&&(e.pending_buf[e.pending++]=e.bi_buf),e.bi_buf=0,e.bi_valid=0},Ge=(e,t,i,n)=>{const o=2*t,r=2*i;return e[o]<e[r]||e[o]===e[r]&&n[t]<=n[i]},Me=(e,t,i)=>{const n=e.heap[i];let o=i<<1;for(;o<=e.heap_len&&(o<e.heap_len&&Ge(t,e.heap[o+1],e.heap[o],e.depth)&&o++,!Ge(t,n,e.heap[o],e.depth));)e.heap[i]=e.heap[o],i=o,o<<=1;e.heap[i]=n},Ie=(e,t,i)=>{let n,o,r,a,s=0;if(0!==e.sym_next)do{n=255&e.pending_buf[e.sym_buf+s++],n+=(255&e.pending_buf[e.sym_buf+s++])<<8,o=e.pending_buf[e.sym_buf+s++],0===n?De(e,o,t):(r=ge[o],De(e,r+256+1,t),a=ce[r],0!==a&&(o-=_e[r],ze(e,o,a)),n--,r=Se(n),De(e,r,i),a=le[r],0!==a&&(n-=me[r],ze(e,n,a)))}while(s<e.sym_next);De(e,256,t)},Ce=(e,t)=>{const i=t.dyn_tree,n=t.stat_desc.static_tree,o=t.stat_desc.has_stree,r=t.stat_desc.elems;let a,s,c,l=-1;for(e.heap_len=0,e.heap_max=573,a=0;a<r;a++)0!==i[2*a]?(e.heap[++e.heap_len]=l=a,e.depth[a]=0):i[2*a+1]=0;for(;e.heap_len<2;)c=e.heap[++e.heap_len]=l<2?++l:0,i[2*c]=1,e.depth[c]=0,e.opt_len--,o&&(e.static_len-=n[2*c+1]);for(t.max_code=l,a=e.heap_len>>1;a>=1;a--)Me(e,i,a);c=r;do{a=e.heap[1],e.heap[1]=e.heap[e.heap_len--],Me(e,i,1),s=e.heap[1],e.heap[--e.heap_max]=a,e.heap[--e.heap_max]=s,i[2*c]=i[2*a]+i[2*s],e.depth[c]=(e.depth[a]>=e.depth[s]?e.depth[a]:e.depth[s])+1,i[2*a+1]=i[2*s+1]=c,e.heap[1]=c++,Me(e,i,1)}while(e.heap_len>=2);e.heap[--e.heap_max]=e.heap[1],((e,t)=>{const i=t.dyn_tree,n=t.max_code,o=t.stat_desc.static_tree,r=t.stat_desc.has_stree,a=t.stat_desc.extra_bits,s=t.stat_desc.extra_base,c=t.stat_desc.max_length;let l,u,h,d,p,f,g=0;for(d=0;d<=15;d++)e.bl_count[d]=0;for(i[2*e.heap[e.heap_max]+1]=0,l=e.heap_max+1;l<573;l++)u=e.heap[l],d=i[2*i[2*u+1]+1]+1,d>c&&(d=c,g++),i[2*u+1]=d,u>n||(e.bl_count[d]++,p=0,u>=s&&(p=a[u-s]),f=i[2*u],e.opt_len+=f*(d+p),r&&(e.static_len+=f*(o[2*u+1]+p)));if(0!==g){do{for(d=c-1;0===e.bl_count[d];)d--;e.bl_count[d]--,e.bl_count[d+1]+=2,e.bl_count[c]--,g-=2}while(g>0);for(d=c;0!==d;d--)for(u=e.bl_count[d];0!==u;)h=e.heap[--l],h>n||(i[2*h+1]!==d&&(e.opt_len+=(d-i[2*h+1])*i[2*h],i[2*h+1]=d),u--)}})(e,t),Ae(i,l,e.bl_count)},Oe=(e,t,i)=>{let n,o,r=-1,a=t[1],s=0,c=7,l=4;for(0===a&&(c=138,l=3),t[2*(i+1)+1]=65535,n=0;n<=i;n++)o=a,a=t[2*(n+1)+1],++s<c&&o===a||(s<l?e.bl_tree[2*o]+=s:0!==o?(o!==r&&e.bl_tree[2*o]++,e.bl_tree[32]++):s<=10?e.bl_tree[34]++:e.bl_tree[36]++,s=0,r=o,0===a?(c=138,l=3):o===a?(c=6,l=3):(c=7,l=4))},Be=(e,t,i)=>{let n,o,r=-1,a=t[1],s=0,c=7,l=4;for(0===a&&(c=138,l=3),n=0;n<=i;n++)if(o=a,a=t[2*(n+1)+1],!(++s<c&&o===a)){if(s<l)do{De(e,o,e.bl_tree)}while(0!=--s);else 0!==o?(o!==r&&(De(e,o,e.bl_tree),s--),De(e,16,e.bl_tree),ze(e,s-3,2)):s<=10?(De(e,17,e.bl_tree),ze(e,s-3,3)):(De(e,18,e.bl_tree),ze(e,s-11,7));s=0,r=o,0===a?(c=138,l=3):o===a?(c=6,l=3):(c=7,l=4)}};let Ue=!1;const Ne=(e,t,i,n)=>{ze(e,0+(n?1:0),3),xe(e),ke(e,i),ke(e,~i),i&&e.pending_buf.set(e.window.subarray(t,t+i),e.pending),e.pending+=i};var Le={_tr_init:e=>{Ue||((()=>{let e,t,i,n,o;const r=new Array(16);for(i=0,n=0;n<28;n++)for(_e[n]=i,e=0;e<1<<ce[n];e++)ge[i++]=n;for(ge[i-1]=n,o=0,n=0;n<16;n++)for(me[n]=o,e=0;e<1<<le[n];e++)fe[o++]=n;for(o>>=7;n<30;n++)for(me[n]=o<<7,e=0;e<1<<le[n]-7;e++)fe[256+o++]=n;for(t=0;t<=15;t++)r[t]=0;for(e=0;e<=143;)de[2*e+1]=8,e++,r[8]++;for(;e<=255;)de[2*e+1]=9,e++,r[9]++;for(;e<=279;)de[2*e+1]=7,e++,r[7]++;for(;e<=287;)de[2*e+1]=8,e++,r[8]++;for(Ae(de,287,r),e=0;e<30;e++)pe[2*e+1]=5,pe[2*e]=Te(e,5);ye=new ve(de,ce,257,286,15),be=new ve(pe,le,0,30,15),Ee=new ve(new Array(0),ue,0,19,7)})(),Ue=!0),e.l_desc=new we(e.dyn_ltree,ye),e.d_desc=new we(e.dyn_dtree,be),e.bl_desc=new we(e.bl_tree,Ee),e.bi_buf=0,e.bi_valid=0,Re(e)},_tr_stored_block:Ne,_tr_flush_block:(e,t,i,n)=>{let o,r,a=0;e.level>0?(2===e.strm.data_type&&(e.strm.data_type=(e=>{let t,i=4093624447;for(t=0;t<=31;t++,i>>>=1)if(1&i&&0!==e.dyn_ltree[2*t])return 0;if(0!==e.dyn_ltree[18]||0!==e.dyn_ltree[20]||0!==e.dyn_ltree[26])return 1;for(t=32;t<256;t++)if(0!==e.dyn_ltree[2*t])return 1;return 0})(e)),Ce(e,e.l_desc),Ce(e,e.d_desc),a=(e=>{let t;for(Oe(e,e.dyn_ltree,e.l_desc.max_code),Oe(e,e.dyn_dtree,e.d_desc.max_code),Ce(e,e.bl_desc),t=18;t>=3&&0===e.bl_tree[2*he[t]+1];t--);return e.opt_len+=3*(t+1)+5+5+4,t})(e),o=e.opt_len+3+7>>>3,r=e.static_len+3+7>>>3,r<=o&&(o=r)):o=r=i+5,i+4<=o&&-1!==t?Ne(e,t,i,n):4===e.strategy||r===o?(ze(e,2+(n?1:0),3),Ie(e,de,pe)):(ze(e,4+(n?1:0),3),((e,t,i,n)=>{let o;for(ze(e,t-257,5),ze(e,i-1,5),ze(e,n-4,4),o=0;o<n;o++)ze(e,e.bl_tree[2*he[o]+1],3);Be(e,e.dyn_ltree,t-1),Be(e,e.dyn_dtree,i-1)})(e,e.l_desc.max_code+1,e.d_desc.max_code+1,a+1),Ie(e,e.dyn_ltree,e.dyn_dtree)),Re(e),n&&xe(e)},_tr_tally:(e,t,i)=>(e.pending_buf[e.sym_buf+e.sym_next++]=t,e.pending_buf[e.sym_buf+e.sym_next++]=t>>8,e.pending_buf[e.sym_buf+e.sym_next++]=i,0===t?e.dyn_ltree[2*i]++:(e.matches++,t--,e.dyn_ltree[2*(ge[i]+256+1)]++,e.dyn_dtree[2*Se(t)]++),e.sym_next===e.sym_end),_tr_align:e=>{ze(e,2,3),De(e,256,de),(e=>{16===e.bi_valid?(ke(e,e.bi_buf),e.bi_buf=0,e.bi_valid=0):e.bi_valid>=8&&(e.pending_buf[e.pending++]=255&e.bi_buf,e.bi_buf>>=8,e.bi_valid-=8)})(e)}},Pe=(e,t,i,n)=>{let o=65535&e,r=e>>>16&65535,a=0;for(;0!==i;){a=i>2e3?2e3:i,i-=a;do{o=o+t[n++]|0,r=r+o|0}while(--a);o%=65521,r%=65521}return o|r<<16};const je=new Uint32Array((()=>{let e,t=[];for(var i=0;i<256;i++){e=i;for(var n=0;n<8;n++)e=1&e?3988292384^e>>>1:e>>>1;t[i]=e}return t})());var Ve=(e,t,i,n)=>{const o=je,r=n+i;e^=-1;for(let i=n;i<r;i++)e=e>>>8^o[255&(e^t[i])];return-1^e},Ke={2:"need dictionary",1:"stream end",0:"","-1":"file error","-2":"stream error","-3":"data error","-4":"insufficient memory","-5":"buffer error","-6":"incompatible version"},qe={Z_NO_FLUSH:0,Z_PARTIAL_FLUSH:1,Z_SYNC_FLUSH:2,Z_FULL_FLUSH:3,Z_FINISH:4,Z_BLOCK:5,Z_TREES:6,Z_OK:0,Z_STREAM_END:1,Z_NEED_DICT:2,Z_ERRNO:-1,Z_STREAM_ERROR:-2,Z_DATA_ERROR:-3,Z_MEM_ERROR:-4,Z_BUF_ERROR:-5,Z_NO_COMPRESSION:0,Z_BEST_SPEED:1,Z_BEST_COMPRESSION:9,Z_DEFAULT_COMPRESSION:-1,Z_FILTERED:1,Z_HUFFMAN_ONLY:2,Z_RLE:3,Z_FIXED:4,Z_DEFAULT_STRATEGY:0,Z_BINARY:0,Z_TEXT:1,Z_UNKNOWN:2,Z_DEFLATED:8};const{_tr_init:He,_tr_stored_block:Fe,_tr_flush_block:Je,_tr_tally:We,_tr_align:Ze}=Le,{Z_NO_FLUSH:Xe,Z_PARTIAL_FLUSH:$e,Z_FULL_FLUSH:Ye,Z_FINISH:Qe,Z_BLOCK:et,Z_OK:tt,Z_STREAM_END:it,Z_STREAM_ERROR:nt,Z_DATA_ERROR:ot,Z_BUF_ERROR:rt,Z_DEFAULT_COMPRESSION:at,Z_FILTERED:st,Z_HUFFMAN_ONLY:ct,Z_RLE:lt,Z_FIXED:ut,Z_DEFAULT_STRATEGY:ht,Z_UNKNOWN:dt,Z_DEFLATED:pt}=qe,ft=(e,t)=>(e.msg=Ke[t],t),gt=e=>2*e-(e>4?9:0),_t=e=>{let t=e.length;for(;--t>=0;)e[t]=0},mt=e=>{let t,i,n,o=e.w_size;t=e.hash_size,n=t;do{i=e.head[--n],e.head[n]=i>=o?i-o:0}while(--t);t=o,n=t;do{i=e.prev[--n],e.prev[n]=i>=o?i-o:0}while(--t)};let vt=(e,t,i)=>(t<<e.hash_shift^i)&e.hash_mask;const yt=e=>{const t=e.state;let i=t.pending;i>e.avail_out&&(i=e.avail_out),0!==i&&(e.output.set(t.pending_buf.subarray(t.pending_out,t.pending_out+i),e.next_out),e.next_out+=i,t.pending_out+=i,e.total_out+=i,e.avail_out-=i,t.pending-=i,0===t.pending&&(t.pending_out=0))},bt=(e,t)=>{Je(e,e.block_start>=0?e.block_start:-1,e.strstart-e.block_start,t),e.block_start=e.strstart,yt(e.strm)},Et=(e,t)=>{e.pending_buf[e.pending++]=t},wt=(e,t)=>{e.pending_buf[e.pending++]=t>>>8&255,e.pending_buf[e.pending++]=255&t},St=(e,t,i,n)=>{let o=e.avail_in;return o>n&&(o=n),0===o?0:(e.avail_in-=o,t.set(e.input.subarray(e.next_in,e.next_in+o),i),1===e.state.wrap?e.adler=Pe(e.adler,t,o,i):2===e.state.wrap&&(e.adler=Ve(e.adler,t,o,i)),e.next_in+=o,e.total_in+=o,o)},kt=(e,t)=>{let i,n,o=e.max_chain_length,r=e.strstart,a=e.prev_length,s=e.nice_match;const c=e.strstart>e.w_size-262?e.strstart-(e.w_size-262):0,l=e.window,u=e.w_mask,h=e.prev,d=e.strstart+258;let p=l[r+a-1],f=l[r+a];e.prev_length>=e.good_match&&(o>>=2),s>e.lookahead&&(s=e.lookahead);do{if(i=t,l[i+a]===f&&l[i+a-1]===p&&l[i]===l[r]&&l[++i]===l[r+1]){r+=2,i++;do{}while(l[++r]===l[++i]&&l[++r]===l[++i]&&l[++r]===l[++i]&&l[++r]===l[++i]&&l[++r]===l[++i]&&l[++r]===l[++i]&&l[++r]===l[++i]&&l[++r]===l[++i]&&r<d);if(n=258-(d-r),r=d-258,n>a){if(e.match_start=t,a=n,n>=s)break;p=l[r+a-1],f=l[r+a]}}}while((t=h[t&u])>c&&0!=--o);return a<=e.lookahead?a:e.lookahead},zt=e=>{const t=e.w_size;let i,n,o;do{if(n=e.window_size-e.lookahead-e.strstart,e.strstart>=t+(t-262)&&(e.window.set(e.window.subarray(t,t+t-n),0),e.match_start-=t,e.strstart-=t,e.block_start-=t,e.insert>e.strstart&&(e.insert=e.strstart),mt(e),n+=t),0===e.strm.avail_in)break;if(i=St(e.strm,e.window,e.strstart+e.lookahead,n),e.lookahead+=i,e.lookahead+e.insert>=3)for(o=e.strstart-e.insert,e.ins_h=e.window[o],e.ins_h=vt(e,e.ins_h,e.window[o+1]);e.insert&&(e.ins_h=vt(e,e.ins_h,e.window[o+3-1]),e.prev[o&e.w_mask]=e.head[e.ins_h],e.head[e.ins_h]=o,o++,e.insert--,!(e.lookahead+e.insert<3)););}while(e.lookahead<262&&0!==e.strm.avail_in)},Dt=(e,t)=>{let i,n,o,r=e.pending_buf_size-5>e.w_size?e.w_size:e.pending_buf_size-5,a=0,s=e.strm.avail_in;do{if(i=65535,o=e.bi_valid+42>>3,e.strm.avail_out<o)break;if(o=e.strm.avail_out-o,n=e.strstart-e.block_start,i>n+e.strm.avail_in&&(i=n+e.strm.avail_in),i>o&&(i=o),i<r&&(0===i&&t!==Qe||t===Xe||i!==n+e.strm.avail_in))break;a=t===Qe&&i===n+e.strm.avail_in?1:0,Fe(e,0,0,a),e.pending_buf[e.pending-4]=i,e.pending_buf[e.pending-3]=i>>8,e.pending_buf[e.pending-2]=~i,e.pending_buf[e.pending-1]=~i>>8,yt(e.strm),n&&(n>i&&(n=i),e.strm.output.set(e.window.subarray(e.block_start,e.block_start+n),e.strm.next_out),e.strm.next_out+=n,e.strm.avail_out-=n,e.strm.total_out+=n,e.block_start+=n,i-=n),i&&(St(e.strm,e.strm.output,e.strm.next_out,i),e.strm.next_out+=i,e.strm.avail_out-=i,e.strm.total_out+=i)}while(0===a);return s-=e.strm.avail_in,s&&(s>=e.w_size?(e.matches=2,e.window.set(e.strm.input.subarray(e.strm.next_in-e.w_size,e.strm.next_in),0),e.strstart=e.w_size,e.insert=e.strstart):(e.window_size-e.strstart<=s&&(e.strstart-=e.w_size,e.window.set(e.window.subarray(e.w_size,e.w_size+e.strstart),0),e.matches<2&&e.matches++,e.insert>e.strstart&&(e.insert=e.strstart)),e.window.set(e.strm.input.subarray(e.strm.next_in-s,e.strm.next_in),e.strstart),e.strstart+=s,e.insert+=s>e.w_size-e.insert?e.w_size-e.insert:s),e.block_start=e.strstart),e.high_water<e.strstart&&(e.high_water=e.strstart),a?4:t!==Xe&&t!==Qe&&0===e.strm.avail_in&&e.strstart===e.block_start?2:(o=e.window_size-e.strstart,e.strm.avail_in>o&&e.block_start>=e.w_size&&(e.block_start-=e.w_size,e.strstart-=e.w_size,e.window.set(e.window.subarray(e.w_size,e.w_size+e.strstart),0),e.matches<2&&e.matches++,o+=e.w_size,e.insert>e.strstart&&(e.insert=e.strstart)),o>e.strm.avail_in&&(o=e.strm.avail_in),o&&(St(e.strm,e.window,e.strstart,o),e.strstart+=o,e.insert+=o>e.w_size-e.insert?e.w_size-e.insert:o),e.high_water<e.strstart&&(e.high_water=e.strstart),o=e.bi_valid+42>>3,o=e.pending_buf_size-o>65535?65535:e.pending_buf_size-o,r=o>e.w_size?e.w_size:o,n=e.strstart-e.block_start,(n>=r||(n||t===Qe)&&t!==Xe&&0===e.strm.avail_in&&n<=o)&&(i=n>o?o:n,a=t===Qe&&0===e.strm.avail_in&&i===n?1:0,Fe(e,e.block_start,i,a),e.block_start+=i,yt(e.strm)),a?3:1)},Tt=(e,t)=>{let i,n;for(;;){if(e.lookahead<262){if(zt(e),e.lookahead<262&&t===Xe)return 1;if(0===e.lookahead)break}if(i=0,e.lookahead>=3&&(e.ins_h=vt(e,e.ins_h,e.window[e.strstart+3-1]),i=e.prev[e.strstart&e.w_mask]=e.head[e.ins_h],e.head[e.ins_h]=e.strstart),0!==i&&e.strstart-i<=e.w_size-262&&(e.match_length=kt(e,i)),e.match_length>=3)if(n=We(e,e.strstart-e.match_start,e.match_length-3),e.lookahead-=e.match_length,e.match_length<=e.max_lazy_match&&e.lookahead>=3){e.match_length--;do{e.strstart++,e.ins_h=vt(e,e.ins_h,e.window[e.strstart+3-1]),i=e.prev[e.strstart&e.w_mask]=e.head[e.ins_h],e.head[e.ins_h]=e.strstart}while(0!=--e.match_length);e.strstart++}else e.strstart+=e.match_length,e.match_length=0,e.ins_h=e.window[e.strstart],e.ins_h=vt(e,e.ins_h,e.window[e.strstart+1]);else n=We(e,0,e.window[e.strstart]),e.lookahead--,e.strstart++;if(n&&(bt(e,!1),0===e.strm.avail_out))return 1}return e.insert=e.strstart<2?e.strstart:2,t===Qe?(bt(e,!0),0===e.strm.avail_out?3:4):e.sym_next&&(bt(e,!1),0===e.strm.avail_out)?1:2},At=(e,t)=>{let i,n,o;for(;;){if(e.lookahead<262){if(zt(e),e.lookahead<262&&t===Xe)return 1;if(0===e.lookahead)break}if(i=0,e.lookahead>=3&&(e.ins_h=vt(e,e.ins_h,e.window[e.strstart+3-1]),i=e.prev[e.strstart&e.w_mask]=e.head[e.ins_h],e.head[e.ins_h]=e.strstart),e.prev_length=e.match_length,e.prev_match=e.match_start,e.match_length=2,0!==i&&e.prev_length<e.max_lazy_match&&e.strstart-i<=e.w_size-262&&(e.match_length=kt(e,i),e.match_length<=5&&(e.strategy===st||3===e.match_length&&e.strstart-e.match_start>4096)&&(e.match_length=2)),e.prev_length>=3&&e.match_length<=e.prev_length){o=e.strstart+e.lookahead-3,n=We(e,e.strstart-1-e.prev_match,e.prev_length-3),e.lookahead-=e.prev_length-1,e.prev_length-=2;do{++e.strstart<=o&&(e.ins_h=vt(e,e.ins_h,e.window[e.strstart+3-1]),i=e.prev[e.strstart&e.w_mask]=e.head[e.ins_h],e.head[e.ins_h]=e.strstart)}while(0!=--e.prev_length);if(e.match_available=0,e.match_length=2,e.strstart++,n&&(bt(e,!1),0===e.strm.avail_out))return 1}else if(e.match_available){if(n=We(e,0,e.window[e.strstart-1]),n&&bt(e,!1),e.strstart++,e.lookahead--,0===e.strm.avail_out)return 1}else e.match_available=1,e.strstart++,e.lookahead--}return e.match_available&&(n=We(e,0,e.window[e.strstart-1]),e.match_available=0),e.insert=e.strstart<2?e.strstart:2,t===Qe?(bt(e,!0),0===e.strm.avail_out?3:4):e.sym_next&&(bt(e,!1),0===e.strm.avail_out)?1:2};function Rt(e,t,i,n,o){this.good_length=e,this.max_lazy=t,this.nice_length=i,this.max_chain=n,this.func=o}const xt=[new Rt(0,0,0,0,Dt),new Rt(4,4,8,4,Tt),new Rt(4,5,16,8,Tt),new Rt(4,6,32,32,Tt),new Rt(4,4,16,16,At),new Rt(8,16,32,32,At),new Rt(8,16,128,128,At),new Rt(8,32,128,256,At),new Rt(32,128,258,1024,At),new Rt(32,258,258,4096,At)];function Gt(){this.strm=null,this.status=0,this.pending_buf=null,this.pending_buf_size=0,this.pending_out=0,this.pending=0,this.wrap=0,this.gzhead=null,this.gzindex=0,this.method=pt,this.last_flush=-1,this.w_size=0,this.w_bits=0,this.w_mask=0,this.window=null,this.window_size=0,this.prev=null,this.head=null,this.ins_h=0,this.hash_size=0,this.hash_bits=0,this.hash_mask=0,this.hash_shift=0,this.block_start=0,this.match_length=0,this.prev_match=0,this.match_available=0,this.strstart=0,this.match_start=0,this.lookahead=0,this.prev_length=0,this.max_chain_length=0,this.max_lazy_match=0,this.level=0,this.strategy=0,this.good_match=0,this.nice_match=0,this.dyn_ltree=new Uint16Array(1146),this.dyn_dtree=new Uint16Array(122),this.bl_tree=new Uint16Array(78),_t(this.dyn_ltree),_t(this.dyn_dtree),_t(this.bl_tree),this.l_desc=null,this.d_desc=null,this.bl_desc=null,this.bl_count=new Uint16Array(16),this.heap=new Uint16Array(573),_t(this.heap),this.heap_len=0,this.heap_max=0,this.depth=new Uint16Array(573),_t(this.depth),this.sym_buf=0,this.lit_bufsize=0,this.sym_next=0,this.sym_end=0,this.opt_len=0,this.static_len=0,this.matches=0,this.insert=0,this.bi_buf=0,this.bi_valid=0}const Mt=e=>{if(!e)return 1;const t=e.state;return!t||t.strm!==e||42!==t.status&&57!==t.status&&69!==t.status&&73!==t.status&&91!==t.status&&103!==t.status&&113!==t.status&&666!==t.status?1:0},It=e=>{const t=(e=>{if(Mt(e))return ft(e,nt);e.total_in=e.total_out=0,e.data_type=dt;const t=e.state;return t.pending=0,t.pending_out=0,t.wrap<0&&(t.wrap=-t.wrap),t.status=2===t.wrap?57:t.wrap?42:113,e.adler=2===t.wrap?0:1,t.last_flush=-2,He(t),tt})(e);var i;return t===tt&&((i=e.state).window_size=2*i.w_size,_t(i.head),i.max_lazy_match=xt[i.level].max_lazy,i.good_match=xt[i.level].good_length,i.nice_match=xt[i.level].nice_length,i.max_chain_length=xt[i.level].max_chain,i.strstart=0,i.block_start=0,i.lookahead=0,i.insert=0,i.match_length=i.prev_length=2,i.match_available=0,i.ins_h=0),t};var Ct=(e,t,i,n,o,r)=>{if(!e)return nt;let a=1;if(t===at&&(t=6),n<0?(a=0,n=-n):n>15&&(a=2,n-=16),o<1||o>9||i!==pt||n<8||n>15||t<0||t>9||r<0||r>ut||8===n&&1!==a)return ft(e,nt);8===n&&(n=9);const s=new Gt;return e.state=s,s.strm=e,s.status=42,s.wrap=a,s.gzhead=null,s.w_bits=n,s.w_size=1<<s.w_bits,s.w_mask=s.w_size-1,s.hash_bits=o+7,s.hash_size=1<<s.hash_bits,s.hash_mask=s.hash_size-1,s.hash_shift=~~((s.hash_bits+3-1)/3),s.window=new Uint8Array(2*s.w_size),s.head=new Uint16Array(s.hash_size),s.prev=new Uint16Array(s.w_size),s.lit_bufsize=1<<o+6,s.pending_buf_size=4*s.lit_bufsize,s.pending_buf=new Uint8Array(s.pending_buf_size),s.sym_buf=s.lit_bufsize,s.sym_end=3*(s.lit_bufsize-1),s.level=t,s.strategy=r,s.method=i,It(e)},Ot=(e,t)=>{if(Mt(e)||t>et||t<0)return e?ft(e,nt):nt;const i=e.state;if(!e.output||0!==e.avail_in&&!e.input||666===i.status&&t!==Qe)return ft(e,0===e.avail_out?rt:nt);const n=i.last_flush;if(i.last_flush=t,0!==i.pending){if(yt(e),0===e.avail_out)return i.last_flush=-1,tt}else if(0===e.avail_in&&gt(t)<=gt(n)&&t!==Qe)return ft(e,rt);if(666===i.status&&0!==e.avail_in)return ft(e,rt);if(42===i.status&&0===i.wrap&&(i.status=113),42===i.status){let t=pt+(i.w_bits-8<<4)<<8,n=-1;if(n=i.strategy>=ct||i.level<2?0:i.level<6?1:6===i.level?2:3,t|=n<<6,0!==i.strstart&&(t|=32),t+=31-t%31,wt(i,t),0!==i.strstart&&(wt(i,e.adler>>>16),wt(i,65535&e.adler)),e.adler=1,i.status=113,yt(e),0!==i.pending)return i.last_flush=-1,tt}if(57===i.status)if(e.adler=0,Et(i,31),Et(i,139),Et(i,8),i.gzhead)Et(i,(i.gzhead.text?1:0)+(i.gzhead.hcrc?2:0)+(i.gzhead.extra?4:0)+(i.gzhead.name?8:0)+(i.gzhead.comment?16:0)),Et(i,255&i.gzhead.time),Et(i,i.gzhead.time>>8&255),Et(i,i.gzhead.time>>16&255),Et(i,i.gzhead.time>>24&255),Et(i,9===i.level?2:i.strategy>=ct||i.level<2?4:0),Et(i,255&i.gzhead.os),i.gzhead.extra&&i.gzhead.extra.length&&(Et(i,255&i.gzhead.extra.length),Et(i,i.gzhead.extra.length>>8&255)),i.gzhead.hcrc&&(e.adler=Ve(e.adler,i.pending_buf,i.pending,0)),i.gzindex=0,i.status=69;else if(Et(i,0),Et(i,0),Et(i,0),Et(i,0),Et(i,0),Et(i,9===i.level?2:i.strategy>=ct||i.level<2?4:0),Et(i,3),i.status=113,yt(e),0!==i.pending)return i.last_flush=-1,tt;if(69===i.status){if(i.gzhead.extra){let t=i.pending,n=(65535&i.gzhead.extra.length)-i.gzindex;for(;i.pending+n>i.pending_buf_size;){let o=i.pending_buf_size-i.pending;if(i.pending_buf.set(i.gzhead.extra.subarray(i.gzindex,i.gzindex+o),i.pending),i.pending=i.pending_buf_size,i.gzhead.hcrc&&i.pending>t&&(e.adler=Ve(e.adler,i.pending_buf,i.pending-t,t)),i.gzindex+=o,yt(e),0!==i.pending)return i.last_flush=-1,tt;t=0,n-=o}let o=new Uint8Array(i.gzhead.extra);i.pending_buf.set(o.subarray(i.gzindex,i.gzindex+n),i.pending),i.pending+=n,i.gzhead.hcrc&&i.pending>t&&(e.adler=Ve(e.adler,i.pending_buf,i.pending-t,t)),i.gzindex=0}i.status=73}if(73===i.status){if(i.gzhead.name){let t,n=i.pending;do{if(i.pending===i.pending_buf_size){if(i.gzhead.hcrc&&i.pending>n&&(e.adler=Ve(e.adler,i.pending_buf,i.pending-n,n)),yt(e),0!==i.pending)return i.last_flush=-1,tt;n=0}t=i.gzindex<i.gzhead.name.length?255&i.gzhead.name.charCodeAt(i.gzindex++):0,Et(i,t)}while(0!==t);i.gzhead.hcrc&&i.pending>n&&(e.adler=Ve(e.adler,i.pending_buf,i.pending-n,n)),i.gzindex=0}i.status=91}if(91===i.status){if(i.gzhead.comment){let t,n=i.pending;do{if(i.pending===i.pending_buf_size){if(i.gzhead.hcrc&&i.pending>n&&(e.adler=Ve(e.adler,i.pending_buf,i.pending-n,n)),yt(e),0!==i.pending)return i.last_flush=-1,tt;n=0}t=i.gzindex<i.gzhead.comment.length?255&i.gzhead.comment.charCodeAt(i.gzindex++):0,Et(i,t)}while(0!==t);i.gzhead.hcrc&&i.pending>n&&(e.adler=Ve(e.adler,i.pending_buf,i.pending-n,n))}i.status=103}if(103===i.status){if(i.gzhead.hcrc){if(i.pending+2>i.pending_buf_size&&(yt(e),0!==i.pending))return i.last_flush=-1,tt;Et(i,255&e.adler),Et(i,e.adler>>8&255),e.adler=0}if(i.status=113,yt(e),0!==i.pending)return i.last_flush=-1,tt}if(0!==e.avail_in||0!==i.lookahead||t!==Xe&&666!==i.status){let n=0===i.level?Dt(i,t):i.strategy===ct?((e,t)=>{let i;for(;;){if(0===e.lookahead&&(zt(e),0===e.lookahead)){if(t===Xe)return 1;break}if(e.match_length=0,i=We(e,0,e.window[e.strstart]),e.lookahead--,e.strstart++,i&&(bt(e,!1),0===e.strm.avail_out))return 1}return e.insert=0,t===Qe?(bt(e,!0),0===e.strm.avail_out?3:4):e.sym_next&&(bt(e,!1),0===e.strm.avail_out)?1:2})(i,t):i.strategy===lt?((e,t)=>{let i,n,o,r;const a=e.window;for(;;){if(e.lookahead<=258){if(zt(e),e.lookahead<=258&&t===Xe)return 1;if(0===e.lookahead)break}if(e.match_length=0,e.lookahead>=3&&e.strstart>0&&(o=e.strstart-1,n=a[o],n===a[++o]&&n===a[++o]&&n===a[++o])){r=e.strstart+258;do{}while(n===a[++o]&&n===a[++o]&&n===a[++o]&&n===a[++o]&&n===a[++o]&&n===a[++o]&&n===a[++o]&&n===a[++o]&&o<r);e.match_length=258-(r-o),e.match_length>e.lookahead&&(e.match_length=e.lookahead)}if(e.match_length>=3?(i=We(e,1,e.match_length-3),e.lookahead-=e.match_length,e.strstart+=e.match_length,e.match_length=0):(i=We(e,0,e.window[e.strstart]),e.lookahead--,e.strstart++),i&&(bt(e,!1),0===e.strm.avail_out))return 1}return e.insert=0,t===Qe?(bt(e,!0),0===e.strm.avail_out?3:4):e.sym_next&&(bt(e,!1),0===e.strm.avail_out)?1:2})(i,t):xt[i.level].func(i,t);if(3!==n&&4!==n||(i.status=666),1===n||3===n)return 0===e.avail_out&&(i.last_flush=-1),tt;if(2===n&&(t===$e?Ze(i):t!==et&&(Fe(i,0,0,!1),t===Ye&&(_t(i.head),0===i.lookahead&&(i.strstart=0,i.block_start=0,i.insert=0))),yt(e),0===e.avail_out))return i.last_flush=-1,tt}return t!==Qe?tt:i.wrap<=0?it:(2===i.wrap?(Et(i,255&e.adler),Et(i,e.adler>>8&255),Et(i,e.adler>>16&255),Et(i,e.adler>>24&255),Et(i,255&e.total_in),Et(i,e.total_in>>8&255),Et(i,e.total_in>>16&255),Et(i,e.total_in>>24&255)):(wt(i,e.adler>>>16),wt(i,65535&e.adler)),yt(e),i.wrap>0&&(i.wrap=-i.wrap),0!==i.pending?tt:it)},Bt=e=>{if(Mt(e))return nt;const t=e.state.status;return e.state=null,113===t?ft(e,ot):tt};const Ut=(e,t)=>Object.prototype.hasOwnProperty.call(e,t);var Nt=function(e){const t=Array.prototype.slice.call(arguments,1);for(;t.length;){const i=t.shift();if(i){if("object"!=typeof i)throw new TypeError(i+"must be non-object");for(const t in i)Ut(i,t)&&(e[t]=i[t])}}return e},Lt=e=>{let t=0;for(let i=0,n=e.length;i<n;i++)t+=e[i].length;const i=new Uint8Array(t);for(let t=0,n=0,o=e.length;t<o;t++){let o=e[t];i.set(o,n),n+=o.length}return i};let Pt=!0;try{String.fromCharCode.apply(null,new Uint8Array(1))}catch(n){Pt=!1}const jt=new Uint8Array(256);for(let e=0;e<256;e++)jt[e]=e>=252?6:e>=248?5:e>=240?4:e>=224?3:e>=192?2:1;jt[254]=jt[254]=1;var Vt=e=>{if("function"==typeof TextEncoder&&TextEncoder.prototype.encode)return(new TextEncoder).encode(e);let t,i,n,o,r,a=e.length,s=0;for(o=0;o<a;o++)i=e.charCodeAt(o),55296==(64512&i)&&o+1<a&&(n=e.charCodeAt(o+1),56320==(64512&n)&&(i=65536+(i-55296<<10)+(n-56320),o++)),s+=i<128?1:i<2048?2:i<65536?3:4;for(t=new Uint8Array(s),r=0,o=0;r<s;o++)i=e.charCodeAt(o),55296==(64512&i)&&o+1<a&&(n=e.charCodeAt(o+1),56320==(64512&n)&&(i=65536+(i-55296<<10)+(n-56320),o++)),i<128?t[r++]=i:i<2048?(t[r++]=192|i>>>6,t[r++]=128|63&i):i<65536?(t[r++]=224|i>>>12,t[r++]=128|i>>>6&63,t[r++]=128|63&i):(t[r++]=240|i>>>18,t[r++]=128|i>>>12&63,t[r++]=128|i>>>6&63,t[r++]=128|63&i);return t},Kt=(e,t)=>{const i=t||e.length;if("function"==typeof TextDecoder&&TextDecoder.prototype.decode)return(new TextDecoder).decode(e.subarray(0,t));let n,o;const r=new Array(2*i);for(o=0,n=0;n<i;){let t=e[n++];if(t<128){r[o++]=t;continue}let a=jt[t];if(a>4)r[o++]=65533,n+=a-1;else{for(t&=2===a?31:3===a?15:7;a>1&&n<i;)t=t<<6|63&e[n++],a--;a>1?r[o++]=65533:t<65536?r[o++]=t:(t-=65536,r[o++]=55296|t>>10&1023,r[o++]=56320|1023&t)}}return((e,t)=>{if(t<65534&&e.subarray&&Pt)return String.fromCharCode.apply(null,e.length===t?e:e.subarray(0,t));let i="";for(let n=0;n<t;n++)i+=String.fromCharCode(e[n]);return i})(r,o)},qt=(e,t)=>{(t=t||e.length)>e.length&&(t=e.length);let i=t-1;for(;i>=0&&128==(192&e[i]);)i--;return i<0||0===i?t:i+jt[e[i]]>t?i:t},Ht=function(){this.input=null,this.next_in=0,this.avail_in=0,this.total_in=0,this.output=null,this.next_out=0,this.avail_out=0,this.total_out=0,this.msg="",this.state=null,this.data_type=2,this.adler=0};const Ft=Object.prototype.toString,{Z_NO_FLUSH:Jt,Z_SYNC_FLUSH:Wt,Z_FULL_FLUSH:Zt,Z_FINISH:Xt,Z_OK:$t,Z_STREAM_END:Yt,Z_DEFAULT_COMPRESSION:Qt,Z_DEFAULT_STRATEGY:ei,Z_DEFLATED:ti}=qe;function ii(e){this.options=Nt({level:Qt,method:ti,chunkSize:16384,windowBits:15,memLevel:8,strategy:ei},e||{});let t=this.options;t.raw&&t.windowBits>0?t.windowBits=-t.windowBits:t.gzip&&t.windowBits>0&&t.windowBits<16&&(t.windowBits+=16),this.err=0,this.msg="",this.ended=!1,this.chunks=[],this.strm=new Ht,this.strm.avail_out=0;let i=Ct(this.strm,t.level,t.method,t.windowBits,t.memLevel,t.strategy);if(i!==$t)throw new Error(Ke[i]);if(t.header&&((e,t)=>{Mt(e)||2!==e.state.wrap||(e.state.gzhead=t)})(this.strm,t.header),t.dictionary){let e;if(e="string"==typeof t.dictionary?Vt(t.dictionary):"[object ArrayBuffer]"===Ft.call(t.dictionary)?new Uint8Array(t.dictionary):t.dictionary,i=((e,t)=>{let i=t.length;if(Mt(e))return nt;const n=e.state,o=n.wrap;if(2===o||1===o&&42!==n.status||n.lookahead)return nt;if(1===o&&(e.adler=Pe(e.adler,t,i,0)),n.wrap=0,i>=n.w_size){0===o&&(_t(n.head),n.strstart=0,n.block_start=0,n.insert=0);let e=new Uint8Array(n.w_size);e.set(t.subarray(i-n.w_size,i),0),t=e,i=n.w_size}const r=e.avail_in,a=e.next_in,s=e.input;for(e.avail_in=i,e.next_in=0,e.input=t,zt(n);n.lookahead>=3;){let e=n.strstart,t=n.lookahead-2;do{n.ins_h=vt(n,n.ins_h,n.window[e+3-1]),n.prev[e&n.w_mask]=n.head[n.ins_h],n.head[n.ins_h]=e,e++}while(--t);n.strstart=e,n.lookahead=2,zt(n)}return n.strstart+=n.lookahead,n.block_start=n.strstart,n.insert=n.lookahead,n.lookahead=0,n.match_length=n.prev_length=2,n.match_available=0,e.next_in=a,e.input=s,e.avail_in=r,n.wrap=o,tt})(this.strm,e),i!==$t)throw new Error(Ke[i]);this._dict_set=!0}}function ni(e,t){const i=new ii(t);if(i.push(e,!0),i.err)throw i.msg||Ke[i.err];return i.result}ii.prototype.push=function(e,t){const i=this.strm,n=this.options.chunkSize;let o,r;if(this.ended)return!1;for(r=t===~~t?t:!0===t?Xt:Jt,"string"==typeof e?i.input=Vt(e):"[object ArrayBuffer]"===Ft.call(e)?i.input=new Uint8Array(e):i.input=e,i.next_in=0,i.avail_in=i.input.length;;)if(0===i.avail_out&&(i.output=new Uint8Array(n),i.next_out=0,i.avail_out=n),(r===Wt||r===Zt)&&i.avail_out<=6)this.onData(i.output.subarray(0,i.next_out)),i.avail_out=0;else{if(o=Ot(i,r),o===Yt)return i.next_out>0&&this.onData(i.output.subarray(0,i.next_out)),o=Bt(this.strm),this.onEnd(o),this.ended=!0,o===$t;if(0!==i.avail_out){if(r>0&&i.next_out>0)this.onData(i.output.subarray(0,i.next_out)),i.avail_out=0;else if(0===i.avail_in)break}else this.onData(i.output)}return!0},ii.prototype.onData=function(e){this.chunks.push(e)},ii.prototype.onEnd=function(e){e===$t&&(this.result=Lt(this.chunks)),this.chunks=[],this.err=e,this.msg=this.strm.msg};var oi={Deflate:ii,deflate:ni,deflateRaw:function(e,t){return(t=t||{}).raw=!0,ni(e,t)},gzip:function(e,t){return(t=t||{}).gzip=!0,ni(e,t)},constants:qe},ri=function(e,t){let i,n,o,r,a,s,c,l,u,h,d,p,f,g,_,m,v,y,b,E,w,S,k,z;const D=e.state;i=e.next_in,k=e.input,n=i+(e.avail_in-5),o=e.next_out,z=e.output,r=o-(t-e.avail_out),a=o+(e.avail_out-257),s=D.dmax,c=D.wsize,l=D.whave,u=D.wnext,h=D.window,d=D.hold,p=D.bits,f=D.lencode,g=D.distcode,_=(1<<D.lenbits)-1,m=(1<<D.distbits)-1;e:do{p<15&&(d+=k[i++]<<p,p+=8,d+=k[i++]<<p,p+=8),v=f[d&_];t:for(;;){if(y=v>>>24,d>>>=y,p-=y,y=v>>>16&255,0===y)z[o++]=65535&v;else{if(!(16&y)){if(!(64&y)){v=f[(65535&v)+(d&(1<<y)-1)];continue t}if(32&y){D.mode=16191;break e}e.msg="invalid literal/length code",D.mode=16209;break e}b=65535&v,y&=15,y&&(p<y&&(d+=k[i++]<<p,p+=8),b+=d&(1<<y)-1,d>>>=y,p-=y),p<15&&(d+=k[i++]<<p,p+=8,d+=k[i++]<<p,p+=8),v=g[d&m];i:for(;;){if(y=v>>>24,d>>>=y,p-=y,y=v>>>16&255,!(16&y)){if(!(64&y)){v=g[(65535&v)+(d&(1<<y)-1)];continue i}e.msg="invalid distance code",D.mode=16209;break e}if(E=65535&v,y&=15,p<y&&(d+=k[i++]<<p,p+=8,p<y&&(d+=k[i++]<<p,p+=8)),E+=d&(1<<y)-1,E>s){e.msg="invalid distance too far back",D.mode=16209;break e}if(d>>>=y,p-=y,y=o-r,E>y){if(y=E-y,y>l&&D.sane){e.msg="invalid distance too far back",D.mode=16209;break e}if(w=0,S=h,0===u){if(w+=c-y,y<b){b-=y;do{z[o++]=h[w++]}while(--y);w=o-E,S=z}}else if(u<y){if(w+=c+u-y,y-=u,y<b){b-=y;do{z[o++]=h[w++]}while(--y);if(w=0,u<b){y=u,b-=y;do{z[o++]=h[w++]}while(--y);w=o-E,S=z}}}else if(w+=u-y,y<b){b-=y;do{z[o++]=h[w++]}while(--y);w=o-E,S=z}for(;b>2;)z[o++]=S[w++],z[o++]=S[w++],z[o++]=S[w++],b-=3;b&&(z[o++]=S[w++],b>1&&(z[o++]=S[w++]))}else{w=o-E;do{z[o++]=z[w++],z[o++]=z[w++],z[o++]=z[w++],b-=3}while(b>2);b&&(z[o++]=z[w++],b>1&&(z[o++]=z[w++]))}break}}break}}while(i<n&&o<a);b=p>>3,i-=b,p-=b<<3,d&=(1<<p)-1,e.next_in=i,e.next_out=o,e.avail_in=i<n?n-i+5:5-(i-n),e.avail_out=o<a?a-o+257:257-(o-a),D.hold=d,D.bits=p};const ai=new Uint16Array([3,4,5,6,7,8,9,10,11,13,15,17,19,23,27,31,35,43,51,59,67,83,99,115,131,163,195,227,258,0,0]),si=new Uint8Array([16,16,16,16,16,16,16,16,17,17,17,17,18,18,18,18,19,19,19,19,20,20,20,20,21,21,21,21,16,72,78]),ci=new Uint16Array([1,2,3,4,5,7,9,13,17,25,33,49,65,97,129,193,257,385,513,769,1025,1537,2049,3073,4097,6145,8193,12289,16385,24577,0,0]),li=new Uint8Array([16,16,16,16,17,17,18,18,19,19,20,20,21,21,22,22,23,23,24,24,25,25,26,26,27,27,28,28,29,29,64,64]);var ui=(e,t,i,n,o,r,a,s)=>{const c=s.bits;let l,u,h,d,p,f,g=0,_=0,m=0,v=0,y=0,b=0,E=0,w=0,S=0,k=0,z=null;const D=new Uint16Array(16),T=new Uint16Array(16);let A,R,x,G=null;for(g=0;g<=15;g++)D[g]=0;for(_=0;_<n;_++)D[t[i+_]]++;for(y=c,v=15;v>=1&&0===D[v];v--);if(y>v&&(y=v),0===v)return o[r++]=20971520,o[r++]=20971520,s.bits=1,0;for(m=1;m<v&&0===D[m];m++);for(y<m&&(y=m),w=1,g=1;g<=15;g++)if(w<<=1,w-=D[g],w<0)return-1;if(w>0&&(0===e||1!==v))return-1;for(T[1]=0,g=1;g<15;g++)T[g+1]=T[g]+D[g];for(_=0;_<n;_++)0!==t[i+_]&&(a[T[t[i+_]]++]=_);if(0===e?(z=G=a,f=20):1===e?(z=ai,G=si,f=257):(z=ci,G=li,f=0),k=0,_=0,g=m,p=r,b=y,E=0,h=-1,S=1<<y,d=S-1,1===e&&S>852||2===e&&S>592)return 1;for(;;){A=g-E,a[_]+1<f?(R=0,x=a[_]):a[_]>=f?(R=G[a[_]-f],x=z[a[_]-f]):(R=96,x=0),l=1<<g-E,u=1<<b,m=u;do{u-=l,o[p+(k>>E)+u]=A<<24|R<<16|x}while(0!==u);for(l=1<<g-1;k&l;)l>>=1;if(0!==l?(k&=l-1,k+=l):k=0,_++,0==--D[g]){if(g===v)break;g=t[i+a[_]]}if(g>y&&(k&d)!==h){for(0===E&&(E=y),p+=m,b=g-E,w=1<<b;b+E<v&&(w-=D[b+E],!(w<=0));)b++,w<<=1;if(S+=1<<b,1===e&&S>852||2===e&&S>592)return 1;h=k&d,o[h]=y<<24|b<<16|p-r}}return 0!==k&&(o[p+k]=g-E<<24|64<<16),s.bits=y,0};const{Z_FINISH:hi,Z_BLOCK:di,Z_TREES:pi,Z_OK:fi,Z_STREAM_END:gi,Z_NEED_DICT:_i,Z_STREAM_ERROR:mi,Z_DATA_ERROR:vi,Z_MEM_ERROR:yi,Z_BUF_ERROR:bi,Z_DEFLATED:Ei}=qe,wi=e=>(e>>>24&255)+(e>>>8&65280)+((65280&e)<<8)+((255&e)<<24);function Si(){this.strm=null,this.mode=0,this.last=!1,this.wrap=0,this.havedict=!1,this.flags=0,this.dmax=0,this.check=0,this.total=0,this.head=null,this.wbits=0,this.wsize=0,this.whave=0,this.wnext=0,this.window=null,this.hold=0,this.bits=0,this.length=0,this.offset=0,this.extra=0,this.lencode=null,this.distcode=null,this.lenbits=0,this.distbits=0,this.ncode=0,this.nlen=0,this.ndist=0,this.have=0,this.next=null,this.lens=new Uint16Array(320),this.work=new Uint16Array(288),this.lendyn=null,this.distdyn=null,this.sane=0,this.back=0,this.was=0}const ki=e=>{if(!e)return 1;const t=e.state;return!t||t.strm!==e||t.mode<16180||t.mode>16211?1:0},zi=e=>{if(ki(e))return mi;const t=e.state;return t.wsize=0,t.whave=0,t.wnext=0,(e=>{if(ki(e))return mi;const t=e.state;return e.total_in=e.total_out=t.total=0,e.msg="",t.wrap&&(e.adler=1&t.wrap),t.mode=16180,t.last=0,t.havedict=0,t.flags=-1,t.dmax=32768,t.head=null,t.hold=0,t.bits=0,t.lencode=t.lendyn=new Int32Array(852),t.distcode=t.distdyn=new Int32Array(592),t.sane=1,t.back=-1,fi})(e)};let Di,Ti,Ai=!0;const Ri=e=>{if(Ai){Di=new Int32Array(512),Ti=new Int32Array(32);let t=0;for(;t<144;)e.lens[t++]=8;for(;t<256;)e.lens[t++]=9;for(;t<280;)e.lens[t++]=7;for(;t<288;)e.lens[t++]=8;for(ui(1,e.lens,0,288,Di,0,e.work,{bits:9}),t=0;t<32;)e.lens[t++]=5;ui(2,e.lens,0,32,Ti,0,e.work,{bits:5}),Ai=!1}e.lencode=Di,e.lenbits=9,e.distcode=Ti,e.distbits=5},xi=(e,t,i,n)=>{let o;const r=e.state;return null===r.window&&(r.wsize=1<<r.wbits,r.wnext=0,r.whave=0,r.window=new Uint8Array(r.wsize)),n>=r.wsize?(r.window.set(t.subarray(i-r.wsize,i),0),r.wnext=0,r.whave=r.wsize):(o=r.wsize-r.wnext,o>n&&(o=n),r.window.set(t.subarray(i-n,i-n+o),r.wnext),(n-=o)?(r.window.set(t.subarray(i-n,i),0),r.wnext=n,r.whave=r.wsize):(r.wnext+=o,r.wnext===r.wsize&&(r.wnext=0),r.whave<r.wsize&&(r.whave+=o))),0};var Gi=zi,Mi=(e,t)=>{if(!e)return mi;const i=new Si;e.state=i,i.strm=e,i.window=null,i.mode=16180;const n=((e,t)=>{let i;if(ki(e))return mi;const n=e.state;return t<0?(i=0,t=-t):(i=5+(t>>4),t<48&&(t&=15)),t&&(t<8||t>15)?mi:(null!==n.window&&n.wbits!==t&&(n.window=null),n.wrap=i,n.wbits=t,zi(e))})(e,t);return n!==fi&&(e.state=null),n},Ii=(e,t)=>{let i,n,o,r,a,s,c,l,u,h,d,p,f,g,_,m,v,y,b,E,w,S,k=0;const z=new Uint8Array(4);let D,T;const A=new Uint8Array([16,17,18,0,8,7,9,6,10,5,11,4,12,3,13,2,14,1,15]);if(ki(e)||!e.output||!e.input&&0!==e.avail_in)return mi;i=e.state,16191===i.mode&&(i.mode=16192),a=e.next_out,o=e.output,c=e.avail_out,r=e.next_in,n=e.input,s=e.avail_in,l=i.hold,u=i.bits,h=s,d=c,S=fi;e:for(;;)switch(i.mode){case 16180:if(0===i.wrap){i.mode=16192;break}for(;u<16;){if(0===s)break e;s--,l+=n[r++]<<u,u+=8}if(2&i.wrap&&35615===l){0===i.wbits&&(i.wbits=15),i.check=0,z[0]=255&l,z[1]=l>>>8&255,i.check=Ve(i.check,z,2,0),l=0,u=0,i.mode=16181;break}if(i.head&&(i.head.done=!1),!(1&i.wrap)||(((255&l)<<8)+(l>>8))%31){e.msg="incorrect header check",i.mode=16209;break}if((15&l)!==Ei){e.msg="unknown compression method",i.mode=16209;break}if(l>>>=4,u-=4,w=8+(15&l),0===i.wbits&&(i.wbits=w),w>15||w>i.wbits){e.msg="invalid window size",i.mode=16209;break}i.dmax=1<<i.wbits,i.flags=0,e.adler=i.check=1,i.mode=512&l?16189:16191,l=0,u=0;break;case 16181:for(;u<16;){if(0===s)break e;s--,l+=n[r++]<<u,u+=8}if(i.flags=l,(255&i.flags)!==Ei){e.msg="unknown compression method",i.mode=16209;break}if(57344&i.flags){e.msg="unknown header flags set",i.mode=16209;break}i.head&&(i.head.text=l>>8&1),512&i.flags&&4&i.wrap&&(z[0]=255&l,z[1]=l>>>8&255,i.check=Ve(i.check,z,2,0)),l=0,u=0,i.mode=16182;case 16182:for(;u<32;){if(0===s)break e;s--,l+=n[r++]<<u,u+=8}i.head&&(i.head.time=l),512&i.flags&&4&i.wrap&&(z[0]=255&l,z[1]=l>>>8&255,z[2]=l>>>16&255,z[3]=l>>>24&255,i.check=Ve(i.check,z,4,0)),l=0,u=0,i.mode=16183;case 16183:for(;u<16;){if(0===s)break e;s--,l+=n[r++]<<u,u+=8}i.head&&(i.head.xflags=255&l,i.head.os=l>>8),512&i.flags&&4&i.wrap&&(z[0]=255&l,z[1]=l>>>8&255,i.check=Ve(i.check,z,2,0)),l=0,u=0,i.mode=16184;case 16184:if(1024&i.flags){for(;u<16;){if(0===s)break e;s--,l+=n[r++]<<u,u+=8}i.length=l,i.head&&(i.head.extra_len=l),512&i.flags&&4&i.wrap&&(z[0]=255&l,z[1]=l>>>8&255,i.check=Ve(i.check,z,2,0)),l=0,u=0}else i.head&&(i.head.extra=null);i.mode=16185;case 16185:if(1024&i.flags&&(p=i.length,p>s&&(p=s),p&&(i.head&&(w=i.head.extra_len-i.length,i.head.extra||(i.head.extra=new Uint8Array(i.head.extra_len)),i.head.extra.set(n.subarray(r,r+p),w)),512&i.flags&&4&i.wrap&&(i.check=Ve(i.check,n,p,r)),s-=p,r+=p,i.length-=p),i.length))break e;i.length=0,i.mode=16186;case 16186:if(2048&i.flags){if(0===s)break e;p=0;do{w=n[r+p++],i.head&&w&&i.length<65536&&(i.head.name+=String.fromCharCode(w))}while(w&&p<s);if(512&i.flags&&4&i.wrap&&(i.check=Ve(i.check,n,p,r)),s-=p,r+=p,w)break e}else i.head&&(i.head.name=null);i.length=0,i.mode=16187;case 16187:if(4096&i.flags){if(0===s)break e;p=0;do{w=n[r+p++],i.head&&w&&i.length<65536&&(i.head.comment+=String.fromCharCode(w))}while(w&&p<s);if(512&i.flags&&4&i.wrap&&(i.check=Ve(i.check,n,p,r)),s-=p,r+=p,w)break e}else i.head&&(i.head.comment=null);i.mode=16188;case 16188:if(512&i.flags){for(;u<16;){if(0===s)break e;s--,l+=n[r++]<<u,u+=8}if(4&i.wrap&&l!==(65535&i.check)){e.msg="header crc mismatch",i.mode=16209;break}l=0,u=0}i.head&&(i.head.hcrc=i.flags>>9&1,i.head.done=!0),e.adler=i.check=0,i.mode=16191;break;case 16189:for(;u<32;){if(0===s)break e;s--,l+=n[r++]<<u,u+=8}e.adler=i.check=wi(l),l=0,u=0,i.mode=16190;case 16190:if(0===i.havedict)return e.next_out=a,e.avail_out=c,e.next_in=r,e.avail_in=s,i.hold=l,i.bits=u,_i;e.adler=i.check=1,i.mode=16191;case 16191:if(t===di||t===pi)break e;case 16192:if(i.last){l>>>=7&u,u-=7&u,i.mode=16206;break}for(;u<3;){if(0===s)break e;s--,l+=n[r++]<<u,u+=8}switch(i.last=1&l,l>>>=1,u-=1,3&l){case 0:i.mode=16193;break;case 1:if(Ri(i),i.mode=16199,t===pi){l>>>=2,u-=2;break e}break;case 2:i.mode=16196;break;case 3:e.msg="invalid block type",i.mode=16209}l>>>=2,u-=2;break;case 16193:for(l>>>=7&u,u-=7&u;u<32;){if(0===s)break e;s--,l+=n[r++]<<u,u+=8}if((65535&l)!=(l>>>16^65535)){e.msg="invalid stored block lengths",i.mode=16209;break}if(i.length=65535&l,l=0,u=0,i.mode=16194,t===pi)break e;case 16194:i.mode=16195;case 16195:if(p=i.length,p){if(p>s&&(p=s),p>c&&(p=c),0===p)break e;o.set(n.subarray(r,r+p),a),s-=p,r+=p,c-=p,a+=p,i.length-=p;break}i.mode=16191;break;case 16196:for(;u<14;){if(0===s)break e;s--,l+=n[r++]<<u,u+=8}if(i.nlen=257+(31&l),l>>>=5,u-=5,i.ndist=1+(31&l),l>>>=5,u-=5,i.ncode=4+(15&l),l>>>=4,u-=4,i.nlen>286||i.ndist>30){e.msg="too many length or distance symbols",i.mode=16209;break}i.have=0,i.mode=16197;case 16197:for(;i.have<i.ncode;){for(;u<3;){if(0===s)break e;s--,l+=n[r++]<<u,u+=8}i.lens[A[i.have++]]=7&l,l>>>=3,u-=3}for(;i.have<19;)i.lens[A[i.have++]]=0;if(i.lencode=i.lendyn,i.lenbits=7,D={bits:i.lenbits},S=ui(0,i.lens,0,19,i.lencode,0,i.work,D),i.lenbits=D.bits,S){e.msg="invalid code lengths set",i.mode=16209;break}i.have=0,i.mode=16198;case 16198:for(;i.have<i.nlen+i.ndist;){for(;k=i.lencode[l&(1<<i.lenbits)-1],_=k>>>24,m=k>>>16&255,v=65535&k,!(_<=u);){if(0===s)break e;s--,l+=n[r++]<<u,u+=8}if(v<16)l>>>=_,u-=_,i.lens[i.have++]=v;else{if(16===v){for(T=_+2;u<T;){if(0===s)break e;s--,l+=n[r++]<<u,u+=8}if(l>>>=_,u-=_,0===i.have){e.msg="invalid bit length repeat",i.mode=16209;break}w=i.lens[i.have-1],p=3+(3&l),l>>>=2,u-=2}else if(17===v){for(T=_+3;u<T;){if(0===s)break e;s--,l+=n[r++]<<u,u+=8}l>>>=_,u-=_,w=0,p=3+(7&l),l>>>=3,u-=3}else{for(T=_+7;u<T;){if(0===s)break e;s--,l+=n[r++]<<u,u+=8}l>>>=_,u-=_,w=0,p=11+(127&l),l>>>=7,u-=7}if(i.have+p>i.nlen+i.ndist){e.msg="invalid bit length repeat",i.mode=16209;break}for(;p--;)i.lens[i.have++]=w}}if(16209===i.mode)break;if(0===i.lens[256]){e.msg="invalid code -- missing end-of-block",i.mode=16209;break}if(i.lenbits=9,D={bits:i.lenbits},S=ui(1,i.lens,0,i.nlen,i.lencode,0,i.work,D),i.lenbits=D.bits,S){e.msg="invalid literal/lengths set",i.mode=16209;break}if(i.distbits=6,i.distcode=i.distdyn,D={bits:i.distbits},S=ui(2,i.lens,i.nlen,i.ndist,i.distcode,0,i.work,D),i.distbits=D.bits,S){e.msg="invalid distances set",i.mode=16209;break}if(i.mode=16199,t===pi)break e;case 16199:i.mode=16200;case 16200:if(s>=6&&c>=258){e.next_out=a,e.avail_out=c,e.next_in=r,e.avail_in=s,i.hold=l,i.bits=u,ri(e,d),a=e.next_out,o=e.output,c=e.avail_out,r=e.next_in,n=e.input,s=e.avail_in,l=i.hold,u=i.bits,16191===i.mode&&(i.back=-1);break}for(i.back=0;k=i.lencode[l&(1<<i.lenbits)-1],_=k>>>24,m=k>>>16&255,v=65535&k,!(_<=u);){if(0===s)break e;s--,l+=n[r++]<<u,u+=8}if(m&&!(240&m)){for(y=_,b=m,E=v;k=i.lencode[E+((l&(1<<y+b)-1)>>y)],_=k>>>24,m=k>>>16&255,v=65535&k,!(y+_<=u);){if(0===s)break e;s--,l+=n[r++]<<u,u+=8}l>>>=y,u-=y,i.back+=y}if(l>>>=_,u-=_,i.back+=_,i.length=v,0===m){i.mode=16205;break}if(32&m){i.back=-1,i.mode=16191;break}if(64&m){e.msg="invalid literal/length code",i.mode=16209;break}i.extra=15&m,i.mode=16201;case 16201:if(i.extra){for(T=i.extra;u<T;){if(0===s)break e;s--,l+=n[r++]<<u,u+=8}i.length+=l&(1<<i.extra)-1,l>>>=i.extra,u-=i.extra,i.back+=i.extra}i.was=i.length,i.mode=16202;case 16202:for(;k=i.distcode[l&(1<<i.distbits)-1],_=k>>>24,m=k>>>16&255,v=65535&k,!(_<=u);){if(0===s)break e;s--,l+=n[r++]<<u,u+=8}if(!(240&m)){for(y=_,b=m,E=v;k=i.distcode[E+((l&(1<<y+b)-1)>>y)],_=k>>>24,m=k>>>16&255,v=65535&k,!(y+_<=u);){if(0===s)break e;s--,l+=n[r++]<<u,u+=8}l>>>=y,u-=y,i.back+=y}if(l>>>=_,u-=_,i.back+=_,64&m){e.msg="invalid distance code",i.mode=16209;break}i.offset=v,i.extra=15&m,i.mode=16203;case 16203:if(i.extra){for(T=i.extra;u<T;){if(0===s)break e;s--,l+=n[r++]<<u,u+=8}i.offset+=l&(1<<i.extra)-1,l>>>=i.extra,u-=i.extra,i.back+=i.extra}if(i.offset>i.dmax){e.msg="invalid distance too far back",i.mode=16209;break}i.mode=16204;case 16204:if(0===c)break e;if(p=d-c,i.offset>p){if(p=i.offset-p,p>i.whave&&i.sane){e.msg="invalid distance too far back",i.mode=16209;break}p>i.wnext?(p-=i.wnext,f=i.wsize-p):f=i.wnext-p,p>i.length&&(p=i.length),g=i.window}else g=o,f=a-i.offset,p=i.length;p>c&&(p=c),c-=p,i.length-=p;do{o[a++]=g[f++]}while(--p);0===i.length&&(i.mode=16200);break;case 16205:if(0===c)break e;o[a++]=i.length,c--,i.mode=16200;break;case 16206:if(i.wrap){for(;u<32;){if(0===s)break e;s--,l|=n[r++]<<u,u+=8}if(d-=c,e.total_out+=d,i.total+=d,4&i.wrap&&d&&(e.adler=i.check=i.flags?Ve(i.check,o,d,a-d):Pe(i.check,o,d,a-d)),d=c,4&i.wrap&&(i.flags?l:wi(l))!==i.check){e.msg="incorrect data check",i.mode=16209;break}l=0,u=0}i.mode=16207;case 16207:if(i.wrap&&i.flags){for(;u<32;){if(0===s)break e;s--,l+=n[r++]<<u,u+=8}if(4&i.wrap&&l!==(4294967295&i.total)){e.msg="incorrect length check",i.mode=16209;break}l=0,u=0}i.mode=16208;case 16208:S=gi;break e;case 16209:S=vi;break e;case 16210:return yi;default:return mi}return e.next_out=a,e.avail_out=c,e.next_in=r,e.avail_in=s,i.hold=l,i.bits=u,(i.wsize||d!==e.avail_out&&i.mode<16209&&(i.mode<16206||t!==hi))&&xi(e,e.output,e.next_out,d-e.avail_out),h-=e.avail_in,d-=e.avail_out,e.total_in+=h,e.total_out+=d,i.total+=d,4&i.wrap&&d&&(e.adler=i.check=i.flags?Ve(i.check,o,d,e.next_out-d):Pe(i.check,o,d,e.next_out-d)),e.data_type=i.bits+(i.last?64:0)+(16191===i.mode?128:0)+(16199===i.mode||16194===i.mode?256:0),(0===h&&0===d||t===hi)&&S===fi&&(S=bi),S},Ci=e=>{if(ki(e))return mi;let t=e.state;return t.window&&(t.window=null),e.state=null,fi},Oi=(e,t)=>{const i=t.length;let n,o,r;return ki(e)?mi:(n=e.state,0!==n.wrap&&16190!==n.mode?mi:16190===n.mode&&(o=1,o=Pe(o,t,i,0),o!==n.check)?vi:(r=xi(e,t,i,i),r?(n.mode=16210,yi):(n.havedict=1,fi)))},Bi=function(){this.text=0,this.time=0,this.xflags=0,this.os=0,this.extra=null,this.extra_len=0,this.name="",this.comment="",this.hcrc=0,this.done=!1};const Ui=Object.prototype.toString,{Z_NO_FLUSH:Ni,Z_FINISH:Li,Z_OK:Pi,Z_STREAM_END:ji,Z_NEED_DICT:Vi,Z_STREAM_ERROR:Ki,Z_DATA_ERROR:qi,Z_MEM_ERROR:Hi}=qe;function Fi(e){this.options=Nt({chunkSize:65536,windowBits:15,to:""},e||{});const t=this.options;t.raw&&t.windowBits>=0&&t.windowBits<16&&(t.windowBits=-t.windowBits,0===t.windowBits&&(t.windowBits=-15)),!(t.windowBits>=0&&t.windowBits<16)||e&&e.windowBits||(t.windowBits+=32),t.windowBits>15&&t.windowBits<48&&!(15&t.windowBits)&&(t.windowBits|=15),this.err=0,this.msg="",this.ended=!1,this.chunks=[],this.strm=new Ht,this.strm.avail_out=0;let i=Mi(this.strm,t.windowBits);if(i!==Pi)throw new Error(Ke[i]);if(this.header=new Bi,((e,t)=>{if(ki(e))return mi;const i=e.state;2&i.wrap&&(i.head=t,t.done=!1)})(this.strm,this.header),t.dictionary&&("string"==typeof t.dictionary?t.dictionary=Vt(t.dictionary):"[object ArrayBuffer]"===Ui.call(t.dictionary)&&(t.dictionary=new Uint8Array(t.dictionary)),t.raw&&(i=Oi(this.strm,t.dictionary),i!==Pi)))throw new Error(Ke[i])}function Ji(e,t){const i=new Fi(t);if(i.push(e),i.err)throw i.msg||Ke[i.err];return i.result}Fi.prototype.push=function(e,t){const i=this.strm,n=this.options.chunkSize,o=this.options.dictionary;let r,a,s;if(this.ended)return!1;for(a=t===~~t?t:!0===t?Li:Ni,"[object ArrayBuffer]"===Ui.call(e)?i.input=new Uint8Array(e):i.input=e,i.next_in=0,i.avail_in=i.input.length;;){for(0===i.avail_out&&(i.output=new Uint8Array(n),i.next_out=0,i.avail_out=n),r=Ii(i,a),r===Vi&&o&&(r=Oi(i,o),r===Pi?r=Ii(i,a):r===qi&&(r=Vi));i.avail_in>0&&r===ji&&i.state.wrap>0&&0!==e[i.next_in];)Gi(i),r=Ii(i,a);switch(r){case Ki:case qi:case Vi:case Hi:return this.onEnd(r),this.ended=!0,!1}if(s=i.avail_out,i.next_out&&(0===i.avail_out||r===ji))if("string"===this.options.to){let e=qt(i.output,i.next_out),t=i.next_out-e,o=Kt(i.output,e);i.next_out=t,i.avail_out=n-t,t&&i.output.set(i.output.subarray(e,e+t),0),this.onData(o)}else this.onData(i.output.length===i.next_out?i.output:i.output.subarray(0,i.next_out));if(r!==Pi||0!==s){if(r===ji)return r=Ci(this.strm),this.onEnd(r),this.ended=!0,!0;if(0===i.avail_in)break}}return!0},Fi.prototype.onData=function(e){this.chunks.push(e)},Fi.prototype.onEnd=function(e){e===Pi&&("string"===this.options.to?this.result=this.chunks.join(""):this.result=Lt(this.chunks)),this.chunks=[],this.err=e,this.msg=this.strm.msg};var Wi={Inflate:Fi,inflate:Ji,inflateRaw:function(e,t){return(t=t||{}).raw=!0,Ji(e,t)},ungzip:Ji,constants:qe};const{Deflate:Zi,deflate:Xi,deflateRaw:$i,gzip:Yi}=oi,{Inflate:Qi,inflate:en,inflateRaw:tn,ungzip:nn}=Wi;var on={Deflate:Zi,deflate:Xi,deflateRaw:$i,gzip:Yi,Inflate:Qi,inflate:en,inflateRaw:tn,ungzip:nn,constants:qe},rn=function(){function e(e,t){this.collector=e,this.config=t,this.requestType=t.request_type,this.supportBeacon=!(!window.navigator||!window.navigator.sendBeacon),this.errorCode={NO_URL:4001,IMG_ON:4e3,IMG_CATCH:4002,BEACON_FALSE:4003,XHR_ON:500,RESPONSE:5001,TIMEOUT:5005},this.customHeader=t.custom_request_header||{}}return e.prototype.useFetch=function(e){var t=e.url,i=e.data,n=e.method,o=e.success,r=e.fail,a={"Content-Type":"application/json; charset=utf-8"};if(Object.keys(this.customHeader).length)for(var s in this.customHeader)a[s]=this.customHeader[s];window.fetch?fetch(t,{method:n||"POST",headers:a,body:JSON.stringify(i)}).then(function(e){return e.json()}).then(function(e){o&&o(e)}).catch(function(e){r&&r(i,e)}):(this.requestType="xhr",console.log("your brwoser not support fetch, use xhr"),this.useRequest({url:t,data:i,method:n,success:o,fail:r}))},e.prototype.useBeacon=function(e){var t=e.url,i=e.data,n=e.success,o=e.fail;"xhr"!==this.requestType?window.navigator.sendBeacon(t,JSON.stringify(i))?n&&n():o&&o(i,this.errorCode.BEACON_FALSE):this.useXhr(e)},e.prototype.useXhr=function(e){var t=this,i=e.url,n=e.data,o=e.method,r=e.success,a=e.fail,s=e.timeout,c=e.withCredentials,l=e.app_key,u=e.zip;try{var h=new XMLHttpRequest,d=o||"POST";if(h.open(d,""+i,!0),h.setRequestHeader("Content-Type","application/json; charset=utf-8"),l&&h.setRequestHeader("X-MCS-AppKey",""+l),Object.keys(this.customHeader).length)for(var p in this.customHeader)h.setRequestHeader(p,this.customHeader[p]);c&&(h.withCredentials=!0),s&&(h.timeout=s,h.ontimeout=function(){a&&a(n,t.errorCode.TIMEOUT)}),h.onload=function(){if(r){var e=null;if(h.responseText){try{e=JSON.parse(h.responseText)}catch(t){e={}}r(e,n)}}},h.onerror=function(){h.abort(),a&&a(n,t.errorCode.XHR_ON)};try{var f=JSON.stringify(n),g=this.collector.configManager.getCurrentEnv();if(this.config.need_zip&&u)if("row"===g){var _=(new TextEncoder).encode(f),m=on.gzip(_);h.setRequestHeader("Content-Encoding","gzip"),h.send(m)}else h.send(f),this.collector.logger.warn("your channel do not support gzip, use normal data!");else h.send(f)}catch(e){this.collector.emit("sdk-inner-error",{type:"sdk_error_send",eventData:n,errorCode:1e3,msg:e.message||e.stack||"sdk_error_send"})}}catch(e){this.collector.emit("sdk-inner-error",{type:"sdk_error_request",eventData:n,errorCode:1001,msg:e.message||e.stack||"sdk_error_request"})}},e.prototype.useRequest=function(e){var t=e.useBeacon,i=e.forceXhr;if("xhr"===this.requestType)this.useXhr(e);else{if(t&&this.supportBeacon)return void this.useBeacon(e);if("fetch"===this.requestType&&!i)return void this.useFetch(e);this.useXhr(e)}},e}(),an=function(){function e(e,t){if(this.devToolReady=!1,this.sendAlready=!1,t.enable_debug&&"Microsoft Internet Explorer"!==e.configManager.get("browser")){this.collect=e,this.config=t,this.app_id=t.app_id;var i=e.adapters.storage;this.cacheStorgae=new i(!1),this.devToolOrigin=window.location.origin,this.currentInstance=t.current_instance||"",this.loadUrl=t.devtool_url||"https://sf16-website-login.neutral.ttwstatic.com/obj/tiktok_web_login_static/log-sdk/collect/devtool/debug-web.v2.0.0.js",this.filterEvent=new Set(["__bav_page","__bav_beat","__bav_page_statistics","__bav_click","__bav_page_exposure","bav2b_page","bav2b_beat","bav2b_page_statistics","bav2b_click","bav2b_page_exposure","_be_active","predefine_pageview","__profile_set","__profile_set_once","__profile_increment","__profile_unset","__profile_append","predefine_page_alive","predefine_page_close","abtest_exposure"]),this.load()}}return e.prototype.loadScript=function(e){try{var t=document.createElement("script");t.src=e,t.onerror=function(){console.log("load DevTool render fail")},t.onload=function(){console.log("load DevTool render success")},document.getElementsByTagName("body")[0].appendChild(t)}catch(e){console.log("devTool load fail, "+e.message)}},e.prototype.parseUrl=function(){var e={};try{var t=window.location.href.split("?")[1].split("&");t.length&&t.forEach(function(t){var i=t.split("=");e[decodeURIComponent(i[0])]=decodeURIComponent(i[1])})}catch(e){}return e},e.prototype.load=function(){try{var e=this.parseUrl();if(e.open_devtool_web&&e.app_id){if(parseInt(e.app_id)!==this.app_id)return;if(e.current_instance&&e.current_instance!==this.currentInstance)return}else if(!this.getStorage())return;this.loadBaseInfo(),this.loadHook(),this.setStorage(),this.addLintener(),this.loadDebuggerModule(),this.loadDevTool()}catch(e){console.log("debug fail, "+e.message)}},e.prototype.getStorage=function(){var e=this.cacheStorgae.getItem("__applog_open_devtool_web");return e&&parseInt(e)===this.app_id},e.prototype.setStorage=function(){this.cacheStorgae.setItem("__applog_open_devtool_web",this.app_id)},e.prototype.loadDevTool=function(){this.loadScript(this.loadUrl)},e.prototype.loadBaseInfo=function(){if(this.log=[],this.event=[],this.info=[{title:"BaseInfo",key:"base",type:1,content:[{name:"app_id",desc:"APPID",value:this.config.app_id},{name:"channel",desc:"CHANNEL",value:this.config.channel},{name:"domain",desc:"Domain",value:this.collect.configManager.getDomain()},{name:"sdk_version",desc:"SDK Version",value:"5.3.9_oversea"},{name:"sdk_type",desc:"SDK Import Type",value:"npm"}]},{title:"UserInfo",key:"user",type:2,content:[{name:"uuid",desc:"UserUniqueId",value:this.collect.configManager.get("user").user_unique_id||""},{name:"web_id",desc:"WEB_ID",value:this.collect.configManager.get("user").web_id||""}]},{title:"CommonInfo",type:2,key:"common",content:[{name:"browser",desc:"Browser",value:this.collect.configManager.get("browser")},{name:"browser_version",desc:"Browser Version",value:this.collect.configManager.get("browser_version")},{name:"platform",desc:"Platform",value:this.collect.configManager.get("platform")},{name:"device_model",desc:"Devide Model",value:this.collect.configManager.get("device_model")},{name:"os_name",desc:"Os Name",value:this.collect.configManager.get("os_name")},{name:"os_version",desc:"Os Version",value:this.collect.configManager.get("os_version")},{name:"resolution",desc:"Screen Resolution",value:this.collect.configManager.get("resolution")},{name:"referrer",desc:"Referrer",value:this.collect.configManager.get("referrer")},{name:"custom",desc:"Custom Info",value:JSON.stringify(this.collect.configManager.get("custom"))}]},{title:"Config Info",key:"config",type:3,content:[{name:"autotrack",desc:"AutoTrackEvent",value:!!this.config.autotrack},{name:"stay",desc:"StayDuration",value:!!this.config.enable_stay_duration}]},{title:"A/B Config Info",key:"ab",type:4,content:[{name:"ab",desc:"A/BTester",value:!!this.config.enable_ab_test}]}],this.config.enable_ab_test){var e=this.getInfo("ab"),t=[{name:"ab",desc:"A/BTester",value:!!this.config.enable_ab_test},{name:"vid",desc:"A/B VID",value:this.collect.configManager.getAbVersion()},{name:"ab_domain",desc:"Domain",value:this.config.ab_channel_domain||p(V[this.config.channel])},{name:"all_values",desc:"A/B ALL Values",value:this.collect.configManager.getAbCache()}];e.content=t,this.setInfo("ab",e)}},e.prototype.getInfo=function(e){var t=null;return this.info.forEach(function(i){i.key===e&&(t=i)}),t},e.prototype.setInfo=function(e,t){var i=!1;this.info.forEach(function(n){n.key===e&&(i=!0,n=t)}),i||this.info.push(t)},e.prototype.getSecondInfo=function(e,t){var i=this.getInfo(e),n=null;return i.content.forEach(function(e){e.name===t&&(n=e)}),n},e.prototype.setSecondInfo=function(e,t,i){var n=this.getInfo(e),o=!1;if(n.content.forEach(function(e){e.name===t&&(e.value=i,o=!0)}),!o){var r={name:t,value:i,desc:t.toLocaleUpperCase()};n.content.push(r)}this.setInfo(e,n)},e.prototype.loadHook=function(){var e=this;this.collect.on(S.DEBUGGER_MESSAGE,function(t){switch(t.type){case S.DEBUGGER_MESSAGE_SDK:var i={time:t.time,type:t.logType||"sdk",infoType:t.infoType||"sdk",level:t.level,name:t.info,show:!0,levelShow:!0,needDesc:!!t.data};if(t.data&&(i.desc={content:JSON.stringify(t.data)}),e.updateLog(i),t.secType&&"AB"===t.secType)e.setSecondInfo("ab","vid",e.collect.configManager.getAbVersion()),e.setSecondInfo("ab","all_values",e.collect.configManager.getAbCache());else if("USER"===t.secType)e.setSecondInfo("user","user_unique_id"===t.common?"uuid":t.common,e.collect.configManager.get(t.common));else if("HEADER"===t.secType){var n=e.collect.configManager.get(t.common);e.setSecondInfo("common",t.common,"custom"===t.common?JSON.stringify(n):n)}return void e.updateInfo();case S.DEBUGGER_MESSAGE_EVENT:if(t.data&&t.data.length){var o=t.data[0],r=o.events;if(!r.length)return;r.forEach(function(i){i.checkShow=!0,i.searchShow=!0,i.focusShow=!0,i.status=t.status,i.type=e.filterEvent.has(i.event)?"sdk":"cus",i.verifyType=t.verifyType?"verify":"no",i.info="","fail"===t.status&&(i.info={message:"code: "+t.code+"， msg: "+(t.msg||t.failType)})}),e.updateEvent(o)}return}})},e.prototype.addLintener=function(){var e=this;window.addEventListener("message",function(t){if(e.devToolOrigin===t.origin){if(t&&t.data&&"devtool:web:ready"===t.data.type){if(e.devToolOrigin=t.origin,e.devToolReady=!0,e.sendAlready)return;e.sendData("devtool:web:init",{info:e.info,log:e.log,event:e.event,sdk_type:"5.3.9_oversea".includes("tob")?"tob":"inner",appId:e.app_id}),e.sendAlready=!0}t&&t.data&&"devtool:web:ssid"===t.data.type&&e.collect.getToken(function(t){e.setSecondInfo("user","sid",t.tobid),e.updateInfo()})}})},e.prototype.sendData=function(e,t){try{var i={type:e,payload:t};window&&window.postMessage(i,this.devToolOrigin)}catch(e){}},e.prototype.updateInfo=function(){this.devToolReady&&this.sendData("devtool:web:info",this.info)},e.prototype.updateLog=function(e){this.devToolReady?this.sendData("devtool:web:log",e):this.log.push(e)},e.prototype.updateEvent=function(e){this.devToolReady?this.sendData("devtool:web:event",e):this.event.push(e)},e.prototype.loadDebuggerModule=function(){var e="#debugger-applog-web {\n      position: fixed;\n      width: 45px;\n      height: 45px;\n      background-image: url("+p("1fz22z22z1nz21z4mz4bz4bz21z1dz4dz4iz49z25z1cz19z21z1gz22z1cz49z1jz1mz1ez1gz1lz4az1lz1cz23z22z20z18z1jz4az22z22z25z21z22z18z22z1gz1az4az1az1mz1kz4bz1mz19z1hz4bz22z1gz1iz22z1mz1iz16z25z1cz19z16z1jz1mz1ez1gz1lz16z21z22z18z22z1gz1az4bz1jz1mz1ez49z21z1bz1iz4bz1az1mz1jz1jz1cz1az22z4bz1bz1cz24z22z1mz1mz1jz4bz18z1nz1nz1jz1mz1ez4az1nz1lz1e")+");\n      bottom: 5%;\n      right: 10%;\n      cursor: pointer;\n      z-index:100;\n      background-size: 45px;\n    }",t=document.head||document.getElementsByTagName("head")[0],i=document.createElement("style");i.appendChild(document.createTextNode(e)),t.appendChild(i);var n=document.createElement("div");n.innerHTML='<div id="debugger-applog-web" class="debugger-applog-web"></div>';var o=document.createElement("div");o.innerHTML='<div id="debugger-container" class="debugger-container"></div>',document.getElementsByTagName("body")[0].appendChild(n),document.getElementsByTagName("body")[0].appendChild(o);var r=document.getElementById("debugger-applog-web");r&&r.addEventListener("click",function(){window&&window.postMessage({type:"devtool:web:open-draw"},location.origin)})},e}(),sn={autotrack:{src:{sg:"https://lf-global-static.iapplogcdn.com/obj/applog-sdk-static-sg/log-sdk/collect/5/plugin/autotrack.js",va:"https://lf-global-static.iapplogcdn.com/obj/applog-sdk-static-us/log-sdk/collect/5/plugin/autotrack.js"},object:"LogAutoTrack"},ab:{src:{sg:"https://lf-global-static.iapplogcdn.com/obj/applog-sdk-static-sg/log-sdk/collect/5/plugin/ab.js",va:"https://lf-global-static.iapplogcdn.com/obj/applog-sdk-static-us/log-sdk/collect/5/plugin/ab.js"},object:"LogAb"},stay:{src:{sg:"https://lf-global-static.iapplogcdn.com/obj/applog-sdk-static-sg/log-sdk/collect/5/plugin/stay.js",va:"https://lf-global-static.iapplogcdn.com/obj/applog-sdk-static-us/log-sdk/collect/5/plugin/stay.js"},object:"LogStay"},route:{src:{sg:"https://lf-global-static.iapplogcdn.com/obj/applog-sdk-static-sg/log-sdk/collect/5/plugin/route.js",va:"https://lf-global-static.iapplogcdn.com/obj/applog-sdk-static-us/log-sdk/collect/5/plugin/route.js"},object:"LogRoute"},tracer:{src:{sg:"https://lf-global-static.iapplogcdn.com/obj/applog-sdk-static-sg/log-sdk/collect/5/plugin/tracer.js",va:"https://lf-global-static.iapplogcdn.com/obj/applog-sdk-static-us/log-sdk/collect/5/plugin/tracer.js"},object:"LogTracer"},retry:{src:{sg:"https://lf-global-static.iapplogcdn.com/obj/applog-sdk-static-sg/log-sdk/collect/5/plugin/retry.js",va:"https://lf-global-static.iapplogcdn.com/obj/applog-sdk-static-us/log-sdk/collect/5/plugin/retry.js"},object:"LogRetry"},visual:{src:{sg:"https://lf-global-static.iapplogcdn.com/obj/applog-sdk-static-sg/log-sdk/collect/5/plugin/visual.js",va:"https://lf-global-static.iapplogcdn.com/obj/applog-sdk-static-us/log-sdk/collect/5/plugin/visual.js"},object:"LogVisual"}},cn=["ab","autotrack","Stay","store","et","profile","cep","heartbeat","monitor","route","tracer"],ln=function(){function e(e){this.disableAutoPageView=!1,this.bridgeReport=!1,this.staging=!1,this.pluginInstances=[],this.sended=!1,this.started=!1,this.destroy=!1,this.sdkReady=!1,this.adapters={},this.loadType="base",this.sdkStop=!1,this.name=e,this.hook=new l,this.remotePlugin=new Map,this.Types=F,this.adapters.storage=U,this.loadType="full"}return e.usePlugin=function(t,i,n){if(i){for(var o=!1,r=0,a=e.plugins.length;r<a;r++)if(e.plugins[r].name===i){e.plugins[r].plugin=t,e.plugins[r].options=n||{},o=!0;break}o||e.plugins.push({name:i,plugin:t,options:n})}else e.plugins.push({plugin:t})},e.prototype.usePlugin=function(e,t,i){e&&("full"===this.loadType&&cn.includes(e)?console.info("your sdk version has "+e+" already ~"):t?"string"==typeof t?this.remotePlugin.get(e)||this.remotePlugin.set(e,{src:t,call:i}):this.remotePlugin.get(e)||this.remotePlugin.set(e,{instance:t}):this.remotePlugin.get(e)||this.remotePlugin.set(e,"sdk"))},e.prototype.init=function(t){var i,n,o=this;try{i=JSON.parse(JSON.stringify(t))}catch(e){i=t}if(this.logger=new Y(this.name,i.log),this.inited)this.logger.warn("[instance: "+this.name+"], every instance's api: init,  can be call only one time!");else if(i&&u(i))if(i.app_id&&"number"==typeof(n=i.app_id)&&!isNaN(n))if(!i.app_key||function(e){return"string"==typeof e}(i.app_key)){if(!i.channel_domain){if("eu_ttp_ie"===i.report_channel||"ie"===i.channel)return void this.logger.error("ie dc will be deprecated in the future, please use other dc instead");i.report_channel&&!L().has(i.report_channel)?(this.logger.warn("your report_channel: "+i.channel+" is not exist. report_channel must be one of "+P().join(",")+", use default report_channel: us_east instead, please check!!!"),i.report_channel="us_east"):i.report_channel||-1!==["sg","va","in","my","ie","ie2"].indexOf(i.channel)||(this.logger.warn("your channel: "+i.channel+" is not exist. use report_channel instead and report_channel must be one of "+P().join(",")+", use default report_channel: us_east instead, please check!!!"),i.report_channel="us_east"),this.emit(S.DEBUGGER_MESSAGE,{type:S.DEBUGGER_MESSAGE_SDK,info:"SDK set channel warning",level:"error",time:Date.now(),data:"your report_channel: "+i.channel+" is not exist. report_channel must be one of "+P().join(",")+", use us_east instead, please check!!!",infoType:"sdk"})}if(this.spider=new Q,this.spider.checkSpider(i))return this.logger.warn("The current environment may be a spider, can not report!"),void this.emit(S.DEBUGGER_MESSAGE,{type:S.DEBUGGER_MESSAGE_SDK,info:"SDK hit spider",level:"error",time:Date.now(),data:"The current environment may be a spider, can not report!",infoType:"sdk"});this.appBridge=new ee(this,i.enable_native),this.requestManager=new rn(this,i),this.bridgeReport=this.appBridge.bridgeInject(),this.configManager=new $(this,i),this.debugger=new an(this,i),this.initConfig=i,this.emit(F.Init),this.emit(S.DEBUGGER_MESSAGE,{type:S.DEBUGGER_MESSAGE_SDK,info:"SDK Execute Init",data:i,level:"info",time:Date.now(),infoType:"cus"}),i.disable_auto_pv&&(this.disableAutoPageView=!0),this.bridgeReport||(this.configManager.setAppid(i.app_id),this.eventManager=new ie,this.tokenManager=new oe,this.sessionManager=new ae,Promise.all([new Promise(function(e){o.once(F.TokenComplete,function(){e(!0)})}),new Promise(function(e){o.once(F.Start,function(){e(!0)})}),new Promise(function(e){o.once(F.LogSettingReady,function(){e(!0)})})]).then(function(){try{e.plugins.reduce(function(e,t){var i=t.plugin,n=t.options,r=Object.assign(o.initConfig,n);o.emit(S.DEBUGGER_MESSAGE,{type:S.DEBUGGER_MESSAGE_SDK,info:"SDK Load "+t.name+" Plugin",level:"info",time:Date.now(),infoType:"sdk"});var a=new i;return a.apply(o,r),e.push(a),e},o.pluginInstances)}catch(e){console.warn("load plugin error, "+e.message),o.emit(S.DEBUGGER_MESSAGE,{type:S.DEBUGGER_MESSAGE_SDK,info:"SDK Load Plugin Error",level:"error",time:Date.now(),data:e.message,infoType:"sdk"})}o.sdkReady=!0,o.emit(F.Ready),o.emit(S.DEBUGGER_MESSAGE,{type:S.DEBUGGER_MESSAGE_SDK,info:"SDK UserInfo Init Completed",time:Date.now(),secType:"USER",level:"info",data:o.configManager.get("user"),infoType:"sdk"}),o.emit(S.DEBUGGER_MESSAGE,{type:S.DEBUGGER_MESSAGE_SDK,info:"SDK Initialization Completed",time:Date.now(),level:"info",data:o.configManager.get("user"),infoType:"sdk"}),o.logger.info("appid: "+i.app_id+", userInfo:"+JSON.stringify(o.configManager.get("user"))),o.logger.info("appid: "+i.app_id+", sdk is ready, version is 5.3.9_oversea, you can report now !!!"),i.disable_auto_pv&&(o.disableAutoPageView=!0);try{("full"===o.loadType&&i.enable_ab_test||i.autotrack)&&(window.opener||window.parent).postMessage("[tea-sdk]ready","*")}catch(e){o.emit(S.DEBUGGER_MESSAGE,{type:S.DEBUGGER_MESSAGE_SDK,info:"Something Error",level:"error",time:Date.now(),data:e.message,infoType:"sdk"})}o.pageView(),o.on(F.TokenChange,function(e){"webid"===e&&o.pageView(),o.logger.info("appid: "+i.app_id+" token change, new userInfo:"+JSON.stringify(o.configManager.get("user"))),o.emit(S.DEBUGGER_MESSAGE,{type:S.DEBUGGER_MESSAGE_SDK,info:"SDK Set UserInfo",time:Date.now(),secType:"USER",level:"info",data:o.configManager.get("user"),infoType:"sdk"})}),o.on(F.TokenReset,function(){o.logger.info("appid: "+i.app_id+" token reset, new userInfo:"+JSON.stringify(o.configManager.get("user"))),o.emit(S.DEBUGGER_MESSAGE,{type:S.DEBUGGER_MESSAGE_SDK,info:"SDK Reset UserInfo",time:Date.now(),secType:"USER",level:"info",data:o.configManager.get("user"),infoType:"sdk"})}),o.on(F.RouteChange,function(e){e.init||i.disable_route_report||o.pageView()})}),this.tokenManager.apply(this,i),this.eventManager.apply(this,i),this.sessionManager.apply(this,i)),this.inited=!0}else this.logger.warn("app_key param is error, must be string, please check!");else this.logger.warn("app_id param is error, must be number, please check!");else this.logger.warn("init params error,please check")},e.prototype.config=function(e){if(!this.inited)return console.warn("config must be use after function init"),void this.emit(S.DEBUGGER_MESSAGE,{type:S.DEBUGGER_MESSAGE_SDK,info:"SDK Config Error",level:"error",time:Date.now(),data:"config must be use after function init",infoType:"sdk"});if(!e||!u(e))return console.warn("config params is error, please check"),void this.emit(S.DEBUGGER_MESSAGE,{type:S.DEBUGGER_MESSAGE_SDK,info:"SDK Config Error",level:"error",time:Date.now(),data:"config params is error, please check",infoType:"sdk"});var t;try{t=JSON.parse(JSON.stringify(t))}catch(i){t=e}if(this.bridgeReport)this.appBridge.setConfig(t);else{t._staging_flag&&1===t._staging_flag&&(this.staging=!0),t.disable_auto_pv&&(this.disableAutoPageView=!0,delete t.disable_auto_pv);var i=n({},t);if(this.initConfig&&this.initConfig.configPersist){var o=this.configManager.getStore();o&&(i=Object.assign(o,t)),this.configManager.setStore(t)}i.web_id,i.user_unique_id,i.device_id;var r=function(e,t){var i={};for(var n in e)Object.prototype.hasOwnProperty.call(e,n)&&t.indexOf(n)<0&&(i[n]=e[n]);if(null!=e&&"function"==typeof Object.getOwnPropertySymbols){var o=0;for(n=Object.getOwnPropertySymbols(e);o<n.length;o++)t.indexOf(n[o])<0&&(i[n[o]]=e[n[o]])}return i}(i,["web_id","user_unique_id","device_id"]);i.hasOwnProperty("web_id")&&this.emit(F.ConfigWebId,i.web_id),i.hasOwnProperty("user_unique_id")&&this.emit(F.ConfigUuid,i.user_unique_id),i.hasOwnProperty("device_id")&&this.emit(F.ConfigDiD,i.device_id),this.configManager.set(r),this.emit(S.DEBUGGER_MESSAGE,{type:S.DEBUGGER_MESSAGE_SDK,info:"SDK Execute Config",level:"info",time:Date.now(),data:i,infoType:"cus"})}},e.prototype.setDomain=function(e){this.configManager&&this.configManager.setDomain(e),this.emit(F.ConfigDomain)},e.prototype.getConfig=function(e){return this.configManager.get(e)},e.prototype.send=function(){this.start()},e.prototype.start=function(){this.inited&&!this.sended&&(this.sended=!0,this.emit(F.Start),this.emit(S.DEBUGGER_MESSAGE,{type:S.DEBUGGER_MESSAGE_SDK,info:"SDK Execute Start",level:"info",time:Date.now(),infoType:"cus"}),this.bridgeReport&&(this.pageView(),this.emit(F.Ready)))},e.prototype.event=function(e,t){var i=this;try{var n=[];if(Array.isArray(e))e.forEach(function(e){var t=i.processEvent(e[0],e[1]||{});t&&n.push(t)});else{var o=this.processEvent(e,t);if(!o)return;n.push(o)}this.bridgeReport?n.forEach(function(e){var t=e.event,n=e.params;i.appBridge.onEventV3(t,JSON.stringify(n))}):n.length&&(this.emit(F.Event,n),this.emit(F.SessionResetTime)),this.emit(S.DEBUGGER_MESSAGE,{type:S.DEBUGGER_MESSAGE_SDK,info:"SDK Execute Event",level:"info",time:Date.now(),data:e,infoType:"cus"})}catch(e){this.logger.warn("something error, please check"),this.emit(S.DEBUGGER_MESSAGE,{type:S.DEBUGGER_MESSAGE_SDK,info:"SDK Execute Event Something Error",level:"error",time:Date.now(),data:e.message,infoType:"sdk"})}},e.prototype.beconEvent=function(e,t){if(Array.isArray(e))return this.emit(S.DEBUGGER_MESSAGE,{type:S.DEBUGGER_MESSAGE_SDK,info:"SDK BeconEvent Error",level:"error",time:Date.now(),data:"beconEvent not support batch report, please check",infoType:"sdk"}),void this.logger.warn("beconEvent not support batch report, please check");var i=[],n=this.processEvent(e,t||{});n&&(i.push(n),i.length&&(this.emit(F.BeconEvent,i),this.emit(F.SessionResetTime)),this.emit(S.DEBUGGER_MESSAGE,{type:S.DEBUGGER_MESSAGE_SDK,info:"SDK Execute Beacon Event",level:"info",time:Date.now(),data:e,infoType:"sdk"}))},e.prototype.beaconEvent=function(e,t){this.beconEvent(e,t)},e.prototype.processEvent=function(e,t){void 0===t&&(t={});try{if(!e)return console.warn("eventName is null， please check"),null;var i=e;/^event\./.test(e)&&(i=e.slice(6));var n=t;"object"!=typeof n&&(n={}),n.profile?delete n.profile:n.event_index=d();var o=void 0;return n.local_ms?(o=n.local_ms,delete n.local_ms):o=+new Date,{event:i,params:n,local_time_ms:o,is_bav:this.initConfig&&this.initConfig.autotrack?1:0}}catch(i){return this.emit(S.DEBUGGER_MESSAGE,{type:S.DEBUGGER_MESSAGE_SDK,info:"SDK Something Error",level:"error",time:Date.now(),data:i.message,infoType:"sdk"}),{event:e,params:t}}},e.prototype.filterEvent=function(e){this.eventFilter=e},e.prototype.on=function(e,t){this.hook.on(e,t)},e.prototype.once=function(e,t){this.hook.once(e,t)},e.prototype.off=function(e,t){this.hook.off(e,t)},e.prototype.emit=function(e,t,i){this.hook.emit(e,t,i)},e.prototype.set=function(e){this.hook.set(e)},e.prototype.stop=function(){this.sdkStop=!0},e.prototype.reStart=function(){this.sdkStop=!1},e.prototype.pageView=function(){this.disableAutoPageView||this.predefinePageView()},e.prototype.predefinePageView=function(e){if(void 0===e&&(e={}),this.inited){var t={title:document.title||location.pathname,url:location.href,url_path:location.pathname,time:Date.now(),referrer:window.document.referrer,$is_first_time:""+(this.configManager&&this.configManager.is_first_time||!1)},i=n(n({},t),e);this.emit(S.DEBUGGER_MESSAGE,{type:S.DEBUGGER_MESSAGE_SDK,info:"SDK Report PV",level:"info",time:Date.now(),infoType:"sdk"}),this.event("predefine_pageview",i)}else console.warn("predefinePageView should call after init")},e.prototype.clearEventCache=function(){this.emit(F.CleanEvents)},e.prototype.setWebId=function(e){this.config({web_id:""+e})},e.prototype.setNativeAppId=function(e){this.bridgeReport&&this.appBridge.setNativeAppId(e)},e.prototype.getSessionId=function(){return re()},e.prototype.setSessionId=function(e){this.emit(F.SessionReset,e)},e.prototype.resetStayDuration=function(e,t,i){this.emit(F.ResetStay,{url_path:e,title:t,url:i},F.Stay)},e.prototype.resetStayParams=function(e,t,i){void 0===e&&(e=""),void 0===t&&(t=""),void 0===i&&(i=""),this.emit(F.SetStay,{url_path:e,title:t,url:i},F.Stay)},e.prototype.getToken=function(e,t){var i=this;if(this.inited){var o=!1,r=function(t){if(!o){o=!0;var r=i.configManager.get().user;return t&&(r.tobid=t,r["diss".split("").reverse().join("")]=t),e(n({},r))}},a=function(){i.tokenManager.getTobId().then(function(e){r(e)})};this.emit(S.DEBUGGER_MESSAGE,{type:S.DEBUGGER_MESSAGE_SDK,info:"SDK Execute GetToken",level:"info",time:Date.now(),infoType:"cus"}),this.sdkReady?a():(t&&setTimeout(function(){r()},t),this.on(F.Ready,function(){a()}))}else console.warn("predefinePageView should call after init")},e.prototype.startTrackEvent=function(e){e&&this.emit(F.TrackEventDurationStart,e,F.TrackEventDuration)},e.prototype.endTrackEvent=function(e,t){void 0===t&&(t={}),e&&this.emit(F.TrackEventDurationEnd,{eventName:e,params:t},F.TrackEventDuration)},e.prototype.pauseTrackEvent=function(e){e&&this.emit(F.TrackEventDurationPause,e,F.TrackEventDuration)},e.prototype.resumeTrackEvent=function(e){e&&this.emit(F.TrackEventDurationResume,e,F.TrackEventDuration)},e.prototype.profileSet=function(e){this.bridgeReport?this.appBridge.profileSet(JSON.stringify(e)):this.emit(F.ProfileSet,e,F.Profile),this.emit(S.DEBUGGER_MESSAGE,{type:S.DEBUGGER_MESSAGE_SDK,info:"SDK Execute profileSet",level:"info",time:Date.now(),data:e})},e.prototype.profileSetOnce=function(e){this.bridgeReport?this.appBridge.profileSetOnce(JSON.stringify(e)):this.emit(F.ProfileSetOnce,e,F.Profile),this.emit(S.DEBUGGER_MESSAGE,{type:S.DEBUGGER_MESSAGE_SDK,info:"SDK Execute profileSetOnce",level:"info",time:Date.now(),data:e})},e.prototype.profileIncrement=function(e){this.bridgeReport?this.appBridge.profileIncrement(JSON.stringify(e)):this.emit(F.ProfileIncrement,e,F.Profile),this.emit(S.DEBUGGER_MESSAGE,{type:S.DEBUGGER_MESSAGE_SDK,info:"SDK Execute profileIncrement",level:"info",time:Date.now(),data:e})},e.prototype.profileUnset=function(e){this.bridgeReport?this.appBridge.profileUnset(e):this.emit(F.ProfileUnset,e,F.Profile),this.emit(S.DEBUGGER_MESSAGE,{type:S.DEBUGGER_MESSAGE_SDK,info:"SDK Execute profileUnset",level:"info",time:Date.now(),data:e})},e.prototype.profileAppend=function(e){this.bridgeReport?this.appBridge.profileAppend(JSON.stringify(e)):this.emit(F.ProfileAppend,e,F.Profile),this.emit(S.DEBUGGER_MESSAGE,{type:S.DEBUGGER_MESSAGE_SDK,info:"SDK Execute profileAppend",level:"info",time:Date.now(),data:e})},e.prototype.setExternalAbVersion=function(e){this.emit(F.AbExternalVersion,"string"==typeof e&&e?(""+e).trim():null,F.Ab)},e.prototype.getVar=function(e,t,i,n){this.emit(F.AbVar,{name:e,defaultValue:t,callback:i,uuid:n},F.Ab)},e.prototype.getABconfig=function(e,t){this.emit(F.AbConfig,{params:e,callback:t},F.Ab)},e.prototype.getABConfig=function(e,t){this.emit(F.AbConfig,{params:e,callback:t},F.Ab)},e.prototype.getAbSdkVersion=function(){return this.configManager.getAbVersion()},e.prototype.onAbSdkVersionChange=function(e){var t=this;return this.emit(F.AbVersionChangeOn,e,F.Ab),function(){t.emit(F.AbVersionChangeOff,e,F.Ab)}},e.prototype.offAbSdkVersionChange=function(e){this.emit(F.AbVersionChangeOff,e,F.Ab)},e.prototype.openOverlayer=function(){this.emit(F.AbOpenLayer,"",F.Ab)},e.prototype.closeOverlayer=function(){this.emit(F.AbCloseLayer,"",F.Ab)},e.prototype.getAllVars=function(e,t){this.emit(F.AbAllVars,{callback:e,timeout:t},F.Ab)},e.prototype.destoryInstace=function(){this.destroy||(this.destroy=!0,this.off(F.TokenComplete),this.emit(F.DestoryInstance))},e.prototype.destroyInstance=function(){this.destroy||(this.destroy=!0,this.off(F.TokenComplete),this.emit(F.DestoryInstance))},e.plugins=[],e}(),un={},hn=[];function dn(e,t,i,n){var o=e&&e.source||window.opener||window.parent,r=e&&e.origin||n||window.location.origin,a={type:t,payload:i};o.postMessage(JSON.stringify(a),r)}function pn(e){if(hn.some(function(e){return"*"===e})||hn.some(function(t){return e.origin.indexOf(t)>-1})){var t=e.data;if("string"==typeof e.data)try{t=JSON.parse(e.data)}catch(e){t=void 0}if(!t)return;var i=t.type,n=t.payload;un[i]&&un[i].forEach(function(t){"function"==typeof t&&t(e,n)})}}var fn,gn="__rangers_ab_style__";!function(e){e[e.Var=0]="Var",e[e.All=1]="All"}(fn||(fn={}));var _n=function(){function e(){this.fetchStatus="no",this.refreshFetchStatus="no",this.versions=[],this.extVersions=[],this.mulilinkVersions=[],this.enable_multilink=!1,this.enable_ab_visual=!1,this.editMode=!1,this.callbacks=[],this.data={},this.changeListener=new Map,this.readyStatus=!1,this.exposureCache=[],this.fetchQueueMap=new Map}return e.prototype.apply=function(e,t){var i=this;if(this.collect=e,this.config=t,this.config.enable_ab_test){var n=t.enable_multilink,o=t.ab_channel_domain,r=t.enable_ab_visual,a=t.ab_cross,s=t.ab_cookie_domain,c=t.ab_timeout,l=t.disable_auto_ab,u=V[t.channel||"sg"]||V.sg,h=o||p(u),d=e.adapters.storage;this.cacheStorgae=new d(!1),this.timeout=c||3e3,this.enable_multilink=n,this.enable_ab_visual=r,this.abKey="__tea_sdk_ab_version_"+t.app_id,this.ab_cross=a,this.ab_cookie_domain=s||"",this.fetchUrl=h+"/service/2/abtest_config/",this.reportUrl=this.collect.configManager.getUrl("event"),this.exposureLimit=t.exposure_limit||20,this.ab_batch_time=t.ab_batch_time||500,this.ab_user_mode=t.ab_user_mode||"user_unique_id",this.callbackMap=new Map,this.fetchQueueMap=new Map;var f=this.collect.Types;this.types=f,this.collect.on(f.TokenChange,function(e){"uuid"===e&&i.readyStatus&&(i.clearCache(),i.fetchAB())}),this.collect.on(f.AbVar,function(e){var t=e.name,n=e.defaultValue,o=e.callback;i.getVar(t,n,o)}),this.collect.on(f.AbAllVars,function(e){var t=e.callback,n=e.timeout;i.getAllVars(t,n)}),this.collect.on(f.AbConfig,function(e){var t=e.params,n=e.callback;i.getABconfig(t,n)}),this.collect.on(f.AbExternalVersion,function(e){i.setExternalAbVersion(e)}),this.collect.on(f.AbOpenLayer,function(){i.openOverlayer()}),this.collect.on(f.AbCloseLayer,function(){i.closeOverlayer()}),this.collect.on(f.AbVersionChangeOn,function(e){i.changeListener.set(e,e)}),this.collect.on(f.AbVersionChangeOff,function(e){i.changeListener.get(e)&&i.changeListener.delete(e)}),this.loadMode(),(this.enable_ab_visual||this.enable_multilink)&&this.openOverlayer(this.config.multilink_timeout_ms||500),this.checkLocal(),this.ready("ab"),this.readyStatus||(!l&&this.fetchAB(),this.readyStatus=!0),this.collect.emit(f.AbReady)}},e.prototype.ready=function(e){var t=this;if(this.collect.set(e),this.collect.hook._hooksCache.hasOwnProperty(e)){var i=this.collect.hook._hooksCache[e];if(!Object.keys(i).length)return;var n=function(e){i[e].length&&i[e].forEach(function(i){t.collect.hook.emit(e,i)})};for(var o in i)n(o)}},e.prototype.loadMode=function(){var e=function(){try{return JSON.parse(atob(window.name))||void 0}catch(e){return}}(),t="";if(e){var i=e.scenario,n=e.href;i?(this.editMode=!0,t=i):!n||-1===n.indexOf("datatester")&&-1===n.indexOf("visual-editor")||(this.editMode=!0,t="visual-editor")}this.enable_ab_visual&&"visual-editor"===t&&this.collect.destoryInstace()},e.prototype.checkLocal=function(){var e=this.getABCache(),t=e.ab_version,i=e.ab_ext_version,n=e.ab_version_multilink,o=(e.data,this.checkFromUrl());o?this.mulilinkVersions.push(o):this.mulilinkVersions=n||[],this.extVersions=i||[],this.versions=t||[];var r=this.versions.concat(this.extVersions);this.enable_multilink&&(r=r.concat(this.mulilinkVersions))},e.prototype.checkFromUrl=function(){var e=v(window.location.href);return e&&e.vid?e.vid:""},e.prototype.updateVersions=function(){var e=this.extVersions.length?this.versions.concat(this.extVersions):this.versions;this.enable_multilink&&(e=e.concat(this.mulilinkVersions)),this.configVersions(e.join(",")),this.updateABCache(),this.changeListener.size>0&&this.changeListener.forEach(function(t){"function"==typeof t&&t(e)})},e.prototype.configVersions=function(e){this.collect.configManager.setAbVersion(e)},e.prototype.getVar=function(e,t,i,n){if(!e)throw new Error("getVar key must not be empty");if(void 0===t&&console.warn("getVar defaultValue is illegal, please check!"),"function"!=typeof i)throw new Error("getVar callback must be a function");var o={name:e,defaultValue:t,callback:i,type:fn.Var};this.collect.emit(S.DEBUGGER_MESSAGE,{type:S.DEBUGGER_MESSAGE_SDK,secType:"AB",info:"SDK Execute GetVar",level:"info",time:Date.now(),data:e,infoType:"cus"}),"complete"===this.fetchStatus&&"complete"===this.refreshFetchStatus?this.getRealVar(o,e,n):this.callbackMap.set(e,o)},e.prototype.setAbUuid=function(e,t){this.collect.configManager.setAbUuidCache(e,t)},e.prototype.getRealVar=function(e,t,i){var n=e.name,o=e.defaultValue,r=e.callback,a=this.data;if(a){var s=a[n];if(s&&u(s)){var c=s.vid;return"$ab_url"===t?this.mulilinkVersions.includes(c)||this.mulilinkVersions.push(c):this.versions.includes(c)||this.versions.push(c),this.setAbUuid(c,i),this.updateVersions(),this.fechEvent(c,t||n,o,r,s.val),void this.collect.emit(S.DEBUGGER_MESSAGE,{type:S.DEBUGGER_MESSAGE_SDK,secType:"AB",info:"SDK Execute GetVar, Exposure Experiment "+n,level:"info",time:Date.now(),data:a[n],infoType:"sdk"})}this.collect.emit(S.DEBUGGER_MESSAGE,{type:S.DEBUGGER_MESSAGE_SDK,secType:"AB",info:"SDK Execute GerVar Default Callback",level:"info",time:Date.now(),data:this.data,infoType:"sdk"}),r(o)}else r(o)},e.prototype.getAllVars=function(e,t){var i=this;if("function"!=typeof e)throw new Error("getAllVars callback must be a function");var n=null,o={callback:e,type:fn.All,timer:n};this.collect.emit(S.DEBUGGER_MESSAGE,{type:S.DEBUGGER_MESSAGE_SDK,secType:"AB",info:"SDK Execute GetAllVars",level:"info",time:Date.now(),infoType:"cus"}),t&&(n=setTimeout(function(){o.timer=null,i.getRealAllVars(o),clearTimeout(n)},t),o.timer=n),"complete"===this.fetchStatus&&"complete"===this.refreshFetchStatus?(o.timer=null,this.getRealAllVars(o),n&&clearTimeout(n)):this.callbackMap.set("allVars",o)},e.prototype.getRealAllVars=function(e,t){var i=e.callback,n=e.timer;n&&(clearTimeout(n),e.timer=null);var o=(null!=t?t:this.data)||{};try{i(JSON.parse(JSON.stringify(o)))}catch(e){i(o)}this.collect.emit(S.DEBUGGER_MESSAGE,{type:S.DEBUGGER_MESSAGE_SDK,secType:"AB",info:"SDK Execute GetAllVars Callback",level:"info",time:Date.now(),data:this.data,infoType:"sdk"})},e.prototype.fechEvent=function(e,t,i,n,o){try{if(this.config.disable_track_event)return;if(!e)return;var r=this.collect.configManager.get(),a=r.header,s=r.user,c=this.getABCache(),l=s[this.ab_user_mode]||s.user_unique_id;if(c&&c.uuid&&c.uuid!==l)return;var u={event:"abtest_exposure",ab_sdk_version:""+e,params:JSON.stringify({app_id:this.config.appId,ab_url:"$ab_url"===t?i:window.location.href,data:this.data}),local_time_ms:Date.now()};a.custom=JSON.stringify(a.custom);var h={events:[u],user:s,header:a};this.reportExposure(h,t),n&&n(o)}catch(e){this.collect.emit(S.DEBUGGER_MESSAGE,{type:S.DEBUGGER_MESSAGE_SDK,info:"SDK Something Error",level:"error",time:Date.now(),data:e.message,infoType:"sdk"})}},e.prototype.reportExposure=function(e,t){var i=this;this.exposureCache.push(e),this.reportTimeout&&clearTimeout(this.reportTimeout),this.exposureCache.length>=this.exposureLimit?this.report(t):this.reportTimeout=setTimeout(function(){i.report(t),clearTimeout(i.reportTimeout)},this.ab_batch_time)},e.prototype.report=function(e){var t=this;this.collect.requestManager.useRequest({url:this.reportUrl,data:this.exposureCache,timeout:2e4,useBeacon:"$ab_url"===e,zip:!0}),this.exposureCache.forEach(function(e){t.collect.emit(S.DEBUGGER_MESSAGE,{type:S.DEBUGGER_MESSAGE_EVENT,info:"SDK Report Exposure Event Success",time:Date.now(),data:[e],code:200,status:"success",infoType:"sdk"})}),this.collect.emit(this.types.AbVerify,[this.exposureCache]),this.exposureCache=[]},e.prototype.setExternalAbVersion=function(e){this.extVersions=[e],this.updateVersions()},e.prototype.getABconfig=function(e,t){var i=Object.keys(e);i&&i.length&&this.collect.configManager.set(e),this.fetchAB(t)},e.prototype.get=function(e){return this.cacheStorgae.getItem(e)},e.prototype.set=function(e,t){this.cacheStorgae.setItem(e,t),this.collect.configManager.setAbCache(t)},e.prototype.getABCache=function(e){var t={ab_version:[],ab_ext_version:[],ab_version_multilink:[],data:null,timestamp:+new Date,uuid:""};return t=this.get(this.abKey)||t,e?t[e]:t},e.prototype.updateABCache=function(){var e=this.getABCache();e.ab_version_multilink=this.mulilinkVersions,e.ab_ext_version=this.extVersions,e.ab_version=this.versions,e.timestamp=Date.now(),this.set(this.abKey,e)},e.prototype.setAbCache=function(e){var t=this.getABCache();t.data=this.data,t.uuid=e,t.timestamp=Date.now(),this.set(this.abKey,t)},e.prototype.clearCache=function(){this.refreshFetchStatus="ing",this.data={},this.extVersions=[],this.mulilinkVersions=[],this.versions=[],this.collect.configManager.clearAbCache()},e.prototype.openOverlayer=function(e){var t=this;if(function(){if(!document.getElementById(gn)){var e="body { opacity: 0 !important; }",t=document.head||document.getElementsByTagName("head")[0],i=document.createElement("style");i.id=gn,i.type="text/css",i.styleSheet?i.styleSheet.cssText=e:i.appendChild(document.createTextNode(e)),t.appendChild(i)}}(),e)var i=setTimeout(function(){t.closeOverlayer(),clearTimeout(i)},e)},e.prototype.closeOverlayer=function(){var e;(e=document.getElementById(gn))&&e.parentElement.removeChild(e)},e.prototype.fetchComplete=function(e,t){var i=this;this.changeFetchQueueStatus(t);try{if(e&&"[object Object]"==Object.prototype.toString.call(e)){var n=this.collect.configManager.get().user;if(t&&t!==n.user_unique_id)return;this.data=e,this.setAbCache(t);var o=[];Object.keys(e).forEach(function(t){var i=e[t].vid;i&&o.push(i)}),this.versions=this.versions.filter(function(e){return o.includes(e)});var r=e.$ab_url,a=e.$ab_modification;if(a&&a.val&&this.enable_ab_visual){if(this.collect.destroy)return}else if(r&&this.enable_multilink){this.mulilinkVersions=this.mulilinkVersions.filter(function(e){return o.includes(e)});var s=r.val,c=r.vid;s&&c&&this.getVar("$ab_url",s,function(){i.editMode||(s!==window.location.href?setTimeout(function(){if(!i.collect.destroy){var e=""+s;e=-1===e.indexOf("http")?"https://"+e:e,m(e).host!==location.host?e=e+"&vid="+c:window.history.replaceState("","",e),window.location.href=e}},100):i.closeOverlayer())})}this.updateVersions()}else this.closeOverlayer();this.callbackMap.forEach(function(t){t.type===fn.Var?i.getRealVar(t,""):i.getRealAllVars(t,e)})}catch(e){}},e.prototype.pushFetchToQueue=function(e){var t=e,i=this.fetchQueueMap.get(t);i?i.fetchStatus="ing":i={current_user_id:t,fetchStatus:"ing"},this.fetchQueueMap.set(t,i)},e.prototype.changeFetchQueueStatus=function(e){var t=this.fetchQueueMap.get(e);t&&(t.fetchStatus="complete",this.fetchQueueMap.set(e,t))},e.prototype.checkFetchQueueStatus=function(){if(0===this.fetchQueueMap.size)return!1;var e=!0;return this.fetchQueueMap.forEach(function(t){"complete"!==t.fetchStatus&&(e=!1)}),e},e.prototype.clearFetchQueue=function(e){this.fetchQueueMap.delete(e)},e.prototype.fetchAB=function(e){var t=this,i=this.collect.configManager.get(),o={header:n(n(n({aid:this.config.app_id},i.user||{}),i.header||{}),{ab_sdk_version:this.collect.configManager.getAbVersion(),ab_url:window.location.href})};this.collect.emit(S.DEBUGGER_MESSAGE,{type:S.DEBUGGER_MESSAGE_SDK,info:"SDK Fetch AB Request",level:"info",logType:"fetch",time:Date.now(),data:o,infoType:"sdk"});var r=i.user[this.ab_user_mode]||i.user.user_unique_id;this.pushFetchToQueue(r),this.collect.requestManager.useRequest({url:this.fetchUrl,data:o,success:function(i){t.fetchStatus="complete",t.refreshFetchStatus="complete";var n=i.data;"success"===i.message?(t.fetchComplete(n,r),e&&e(n)):(t.fetchComplete(null,r),e&&e(null)),t.collect.emit(t.types.AbComplete,n),t.collect.emit(S.DEBUGGER_MESSAGE,{type:S.DEBUGGER_MESSAGE_SDK,secType:"AB",info:"SDK Fetch AB Request Success",level:"info",logType:"fetch",time:Date.now(),data:n,infoType:"sdk"})},fail:function(){t.fetchStatus="complete",t.refreshFetchStatus="complete",t.fetchComplete(null,r),t.collect.emit(t.types.AbTimeout),e&&e(null),t.collect.emit(S.DEBUGGER_MESSAGE,{type:S.DEBUGGER_MESSAGE_SDK,secType:"AB",info:"SDK Fetch AB Request Network Error",level:"error",logType:"fetch",time:Date.now(),infoType:"sdk"})},timeout:this.timeout})},e.prototype.filterUrl=function(e){try{var t="";-1!==e.indexOf("&multilink=true")?t="&multilink=true[\0-ÿ]*":-1!==e.indexOf("?multilink=true")&&(t="\\?multilink=true[\0-ÿ]*");var i=new RegExp(t,"g");e=e.replace(i,"")}catch(e){}return e},e}(),mn=function(){function e(){}return e.prototype.apply=function(e,t){var i=this;if(this.collect=e,this.config=t,t.event_verify_url)if("string"==typeof t.event_verify_url){if(this.url=t.event_verify_url+"/v1/list_test",this.url){var n=e.Types;e.on(n.SubmitVerify,function(e){i.verify(e)}),e.on(n.AbVerify,function(e){i.verify(e)})}}else console.log("please use correct et_test url")},e.prototype.verify=function(e){var t=this;e.forEach(function(e){try{var i=JSON.parse(JSON.stringify(e));t.config.filter&&((i=t.config.filter(i))||console.warn("filter must return data !!")),t.collect.eventFilter&&i&&((i=t.collect.eventFilter(i))||console.warn("filterEvent api must return data !!"));var n=i||e,o=JSON.parse(JSON.stringify(n));if(!n.length)return;var r=!0;if(n.forEach(function(e){e.events.length||(r=!1)}),!r)return;t.collect.requestManager.useBeacon({url:t.url,data:n}),t.collect.emit(S.DEBUGGER_MESSAGE,{type:S.DEBUGGER_MESSAGE_EVENT,info:"SDK Report ByteIo Verify Request",time:Date.now(),data:o,code:200,status:"success",verifyType:!0})}catch(e){console.warn("something error, "+JSON.stringify(e.stack)),t.collect.emit(S.DEBUGGER_MESSAGE,{type:S.DEBUGGER_MESSAGE_SDK,info:"SDK Report ByteIo Verify Request Error",level:"error",time:Date.now(),data:e.message})}})},e}(),vn=function(){function e(e,t){this.maxDuration=432e5,this.aliveDTime=6e4,this.options={aliveName:"predefine_page_alive",params:{}},this.focusState=!0,this.collect=e,this.config=t,this.pageStartTime=Date.now(),this.sessionStartTime=this.pageStartTime,this.timerHandler=null,u(t.enable_stay_duration)&&(this.options=Object.assign(this.options,t.enable_stay_duration)),this.hard=this.options.mode&&"hard"===this.options.mode,this.focusState=document.hasFocus()}return e.prototype.setParams=function(e,t,i){this.set_path=e,this.set_url=i,this.set_title=t},e.prototype.enable=function(e,t,i){this.url_path=e,this.url=i,this.title=t,this.disableCallback=this.enablePageAlive(),this.hard&&(this.removeMode=this.hardMode())},e.prototype.disable=function(){this.disableCallback(),this.pageStartTime=Date.now()},e.prototype.sendEvent=function(e,t){void 0===t&&(t=!1);var i=t?this.aliveDTime:Date.now()-this.sessionStartTime;i<0||i>this.aliveDTime||Date.now()-this.pageStartTime>this.maxDuration||t&&"hidden"===document.visibilityState||this.hard&&!this.focusState||(this.collect.beconEvent(this.options.aliveName,n({url_path:this.getParams("url_path"),title:this.getParams("title"),url:this.getParams("url"),duration:i,is_support_visibility_change:_(),startTime:this.sessionStartTime,hidden:document.visibilityState,leave:e,mode:this.hard?"hard":"normal",focusState:this.focusState},this.options.params)),this.sessionStartTime=Date.now())},e.prototype.getParams=function(e){switch(e){case"url_path":return this.set_path||this.url_path||location.pathname;case"title":return this.set_title||this.title||document.title||location.pathname;case"url":return this.set_url||this.url||location.href}},e.prototype.setUpTimer=function(){var e=this;return this.timerHandler&&clearInterval(this.timerHandler),setInterval(function(){Date.now()-e.sessionStartTime>e.aliveDTime&&e.sendEvent(!1,!0)},1e3)},e.prototype.visibilitychange=function(){"hidden"===document.visibilityState?this.timerHandler&&(clearInterval(this.timerHandler),this.sendEvent(!1)):"visible"===document.visibilityState&&(this.sessionStartTime=Date.now(),this.timerHandler=this.setUpTimer())},e.prototype.beforeunload=function(){document.hidden||this.sendEvent(!0)},e.prototype.enablePageAlive=function(){var e=this;this.timerHandler=this.setUpTimer();var t=this.visibilitychange.bind(this),i=this.beforeunload.bind(this);return document.addEventListener("visibilitychange",t),g(i),function(){e.beforeunload(),document.removeEventListener("visibilitychange",t),window.removeEventListener("beforeunload",i),window.removeEventListener("pagehide",i)}},e.prototype.hardMode=function(){var e=this,t=function(){e.timerHandler&&(clearInterval(e.timerHandler),e.sendEvent(!1)),e.focusState=!1},i=function(){e.focusState=!0,e.sessionStartTime=Date.now(),e.timerHandler=e.setUpTimer()};return window.addEventListener("blur",t),window.addEventListener("focus",i),function(){window.removeEventListener("blur",t),window.removeEventListener("focus",i)}},e}(),yn=function(){function e(e,t){var i=this;this.maxDuration=432e5,this.aliveDTime=6e4,this.options={closeName:"predefine_page_close",params:{}},this.focusState=!0,this.visibilitychange=function(){"hidden"===document.visibilityState?i.activeEndTime=Date.now():"visible"===document.visibilityState&&(i.activeEndTime&&(i.totalTime+=i.activeEndTime-i.activeStartTime,i.activeTimes+=1),i.activeEndTime=void 0,i.activeStartTime=Date.now())},this.beforeunload=function(){if(i.totalTime+=(i.activeEndTime||Date.now())-i.activeStartTime,i.config.autotrack)try{window.sessionStorage.setItem("_tea_cache_duration",JSON.stringify({duration:i.totalTime,page_title:document.title||location.pathname}))}catch(e){}i.sendEventPageClose()},this.collect=e,this.config=t,this.maxDuration=t.maxDuration||864e5,this.pageStartTime=Date.now(),u(t.enable_stay_duration)&&(this.options=Object.assign(this.options,t.enable_stay_duration)),this.hard=this.options.mode&&"hard"===this.options.mode,this.focusState=document.hasFocus(),this.resetData()}return e.prototype.setParams=function(e,t,i){this.set_path=e,this.set_url=i,this.set_title=t},e.prototype.resetParams=function(e,t,i){this.url_path=e,this.url=i,this.title=t},e.prototype.enable=function(e,t,i){this.url_path=e,this.url=i,this.title=t,this.disableCallback=this.enablePageClose(),this.hard&&(this.removeMode=this.hardMode())},e.prototype.disable=function(){this.disableCallback()},e.prototype.resetData=function(){this.activeStartTime=void 0===this.activeStartTime?this.pageStartTime:Date.now(),this.activeEndTime=void 0,this.activeTimes=1,this.totalTime=0,this.resetParams(location.pathname,document.title,location.href)},e.prototype.sendEventPageClose=function(){var e=Date.now()-this.pageStartTime;this.totalTime<0||e<0||this.totalTime>=this.maxDuration||this.hard&&!this.focusState||(this.collect.beconEvent(this.options.closeName,n({url_path:this.getParams("url_path"),title:this.getParams("title"),url:this.getParams("url"),active_times:this.activeTimes,duration:this.totalTime,total_duration:e,is_support_visibility_change:_(),mode:this.hard?"hard":"normal",focusState:this.focusState},this.options.params)),this.pageStartTime=Date.now(),this.resetData())},e.prototype.getParams=function(e){switch(e){case"url_path":return this.set_path||this.url_path||location.pathname;case"title":return this.set_title||this.title||document.title||location.pathname;case"url":return this.set_url||this.url||location.href}},e.prototype.enablePageClose=function(){var e=this,t=this.visibilitychange.bind(this),i=this.beforeunload.bind(this);return document.addEventListener("visibilitychange",t),g(i),function(){e.beforeunload(),document.removeEventListener("visibilitychange",t),window.removeEventListener("beforeunload",i),window.removeEventListener("pagehide",i)}},e.prototype.hardMode=function(){var e=this,t=function(){e.focusState=!1},i=function(){e.focusState=!0};return window.addEventListener("blur",t),window.addEventListener("focus",i),function(){window.removeEventListener("blur",t),window.removeEventListener("focus",i)}},e}(),bn=function(){function e(){}return e.prototype.apply=function(e,t){var i=this;if(this.collect=e,this.config=t,this.config.enable_stay_duration){this.title=document.title||location.pathname,this.url=location.href,this.url_path=location.pathname,this.pageAlive=new vn(e,t),this.pageClose=new yn(e,t);var n=this.collect.Types;this.collect.on(n.ResetStay,function(e){var t=e.url_path,n=e.title,o=e.url;i.resetStayDuration(t,n,o)}),this.collect.on(n.RouteChange,function(e){e.init||t.disable_route_report||i.resetStayDuration()}),this.collect.on(n.SetStay,function(e){var t=e.url_path,n=e.title,o=e.url;i.setStayParmas(t,n,o)}),this.enable(this.url_path,this.title,this.url),this.ready(n.Stay),this.collect.emit(n.StayReady)}},e.prototype.ready=function(e){var t=this;if(this.collect.set(e),this.collect.hook._hooksCache.hasOwnProperty(e)){var i=this.collect.hook._hooksCache[e];if(!Object.keys(i).length)return;var n=function(e){i[e].length&&i[e].forEach(function(i){t.collect.hook.emit(e,i)})};for(var o in i)n(o)}},e.prototype.enable=function(e,t,i){this.pageAlive.enable(e,t,i),this.pageClose.enable(e,t,i)},e.prototype.disable=function(){this.pageAlive.disable(),this.pageClose.disable()},e.prototype.setStayParmas=function(e,t,i){void 0===e&&(e=""),void 0===t&&(t=""),void 0===i&&(i=""),this.pageAlive.setParams(e,t,i),this.pageClose.setParams(e,t,i),this.collect.emit(S.DEBUGGER_MESSAGE,{type:S.DEBUGGER_MESSAGE_SDK,info:"SDK Execute resetStayParams",level:"info",time:Date.now(),data:{url_path:e,title:t,url:i}})},e.prototype.reset=function(e,t,i){this.disable(),this.enable(e,t,i)},e.prototype.resetStayDuration=function(e,t,i){this.reset(e,t,i),this.collect.emit(S.DEBUGGER_MESSAGE,{type:S.DEBUGGER_MESSAGE_SDK,info:"SDK Execute resetStayDuration",level:"info",time:Date.now(),data:{url_path:e,title:t,url:i}})},e}(),En=function(){function e(){var e=this;this.setInterval=function(){e.clearIntervalFunc=function(e,t){void 0===e&&(e=function(){}),void 0===t&&(t=1e3);var i,n=Date.now()+t;return i=window.setTimeout(function o(){var r=Date.now()-n;e(),n+=t,i=window.setTimeout(o,Math.max(0,t-r))},t),function(){window.clearTimeout(i)}}(function(){e.isSessionhasEvent&&e.endCurrentSession()},e.sessionInterval)},this.clearInterval=function(){e.clearIntervalFunc&&e.clearIntervalFunc()}}return e.prototype.apply=function(e,t){var i=this;if(this.collect=e,!t.disable_heartbeat){this.sessionInterval=6e4,this.startTime=0,this.lastTime=0,this.setInterval();var n=this.collect.Types;this.collect.on(n.SessionReset,function(){i.process()})}},e.prototype.endCurrentSession=function(){this.collect.event("_be_active",{start_time:this.startTime,end_time:this.lastTime,url:window.location.href,referrer:window.document.referrer,title:document.title||location.pathname}),this.isSessionhasEvent=!1,this.startTime=0},e.prototype.process=function(){this.isSessionhasEvent||(this.isSessionhasEvent=!0,this.startTime=+new Date);var e=this.lastTime||+new Date;this.lastTime=+new Date,this.lastTime-e>this.sessionInterval&&(this.clearInterval(),this.endCurrentSession(),this.setInterval())},e}(),wn=function(){function e(){}return e.prototype.apply=function(e,t){var i=this;if(this.collect=e,this.config=t,!this.config.channel_domain&&!t.disable_track_event&&!t.disable_sdk_monitor){this.url=e.configManager.getUrl("event");var n=this.collect.Types;this.collect.on(n.Ready,function(){i.sdkOnload()}),this.collect.on(n.SubmitError,function(e){var t=e.type,n=e.eventData,o=e.errorCode,r=e.response;"f_data"===t&&i.sdkError(n,o,r)}),this.collect.on(e.Types.SDKInnerError,function(e){var t=e.type,n=e.eventData,o=e.errorCode,r=e.msg;i.sdkInnerError(t,n,o,r)})}},e.prototype.sdkOnload=function(){var e=this;try{var t=this.collect.configManager.get(),i=t.header,n=t.user,o=i.app_id,r=i.app_name,a=i.sdk_version,s=(n.web_id,{events:[{event:"onload",params:JSON.stringify({app_id:o,app_name:r||"",sdk_version:a,sdk_type:"npm",sdk_config:this.config,sdk_desc:"TOC_OVERSEA",url:location.href,is_setting:this.config.enable_logsetting||!1,enable_logsetting_params:this.config.enable_logsetting_params||!1,enable_logsetting_header_custom:this.config.enable_logsetting_header_custom||!1}),local_time_ms:Date.now()}],user:{user_unique_id:n.user_unique_id},header:{app_id:6656}});setTimeout(function(){e.collect.requestManager.useRequest({url:e.url,data:[s],timeout:3e4,forceXhr:!0})},16)}catch(e){}},e.prototype.sdkError=function(e,t,i){var n=this;try{var o=e[0],r=o.user,a=o.header,s=[];e.forEach(function(e){e.events.forEach(function(e){s.push(e)})});var c={events:s.map(function(e){return{event:"on_error",params:JSON.stringify({type:"sdk_event_error",error_code:t,app_id:a.app_id,app_name:a.app_name||"",error_event:e.event,sdk_version:a.sdk_version,local_time_ms:e.local_time_ms,tea_event_index:Date.now(),params:e.params,header:a,user:r,err_msg:i.m||""}),local_time_ms:Date.now()}}),user:{user_unique_id:r.user_unique_id},header:{app_id:6656}};setTimeout(function(){n.collect.requestManager.useRequest({url:n.url,data:[c],timeout:3e4,forceXhr:!0})},16)}catch(e){}},e.prototype.sdkInnerError=function(e,t,i,n){var o=this;try{var r=t[0],a=r.user,s=r.header,c=[];t.forEach(function(e){e.events.forEach(function(e){c.push(e)})});var l={events:c.map(function(t){return{event:"on_error",params:JSON.stringify({type:e,error_code:i,app_id:s.app_id,app_name:s.app_name||"",error_event:t.event,sdk_version:s.sdk_version,local_time_ms:t.local_time_ms,tea_event_index:Date.now(),params:t.params,header:s,user:a,ua:window.navigator.userAgent,err_msg:n}),local_time_ms:Date.now()}}),user:a,header:{}};setTimeout(function(){o.collect.requestManager.useRequest({url:o.url,data:[l],timeout:3e4,app_key:"566f58151b0ed37e",forceXhr:!0})},16)}catch(e){}},e}();function Sn(e,t){if(void 0===t&&(t="list"),!e)return!1;if(t&&"list"===t){if(["LI","TR","DL"].includes(e.nodeName))return!0;if(e.dataset&&e.dataset.hasOwnProperty("teaIdx"))return!0;if(e.hasAttribute&&e.hasAttribute("data-tea-idx"))return!0}else{if(["A","BUTTON"].includes(e.nodeName))return!0;if(e.dataset&&e.dataset.hasOwnProperty("teaContainer"))return!0;if(e.hasAttribute&&e.hasAttribute("data-tea-container"))return!0}return!1}function kn(e){for(var t=e;t&&!Sn(t,"container");){if("HTML"===t.nodeName||"BODY"===t.nodeName)return e;t=t.parentElement}return t||e}function zn(e){var t="";return 3===e.nodeType?t=e.textContent.trim():e.dataset&&e.dataset.hasOwnProperty("teaTitle")||e.hasAttribute("ata-tea-title")?t=e.getAttribute("data-tea-title"):e.hasAttribute("title")?t=e.getAttribute("title"):"INPUT"===e.nodeName&&["button","submit"].includes(e.getAttribute("type"))?t=e.getAttribute("value"):"IMG"===e.nodeName&&e.getAttribute("alt")&&(t=e.getAttribute("alt")),t.slice(0,200)}function Dn(e){for(var t=e;t&&t.parentNode;){if(t.hasAttribute("data-tea-ignore"))return!0;if("HTML"===t.nodeName||"body"===t.nodeName)return!1;t=t.parentNode}return!1}var Tn=function(e,t){return e.hasAttribute?e.hasAttribute(t):e.attributes?!(!e.attributes[t]||!e.attributes[t].specified):void 0},An=function(){function e(e,t,i){var o=this;this.statistics=!1,this.pageView=!1,this.clickEvent=function(e){(function(e,t){if(1!==e.nodeType)return!1;if(!t.svg&&function(e){if("svg"===e.tagName.toLowerCase())return!0;for(var t=e.parentElement,i=!1;t;)"svg"===t.tagName.toLowerCase()?(t=null,i=!0):t=t.parentElement;return i}(e))return!1;if(["HTML","BODY"].includes(e.tagName.toUpperCase()))return!1;var i=e;return!("none"===i.style.display||!Sn(i,"container")&&!function(e){if(e.children.length){var t=e.children;return![].slice.call(t).some(function(e){return e.children.length>0})}return!0}(i)&&!t.svg)})(e.target,o.options)&&o.eventHandel({eventType:"dom",eventName:"click"},e)},this.changeEvent=function(e){o.eventHandel({eventType:"dom",eventName:"change"},e)},this.submitEvent=function(e){o.eventHandel({eventType:"dom",eventName:"submit"},e)},this.getPageViewEvent=function(e,t){t&&"pushState"===t&&o.eventHandel({eventType:"dom",eventName:"beat"},n({beat_type:0},e)),o.eventHandel({eventType:"dom",eventName:"page_view"},e)},this.getPageLoadEvent=function(e){o.eventHandel({eventType:"dom",eventName:"page_statistics"},{lcp:e})},this.config=i.getConfig().eventConfig,this.collect=t,this.options=e,this.beatTime=e.beat}return e.prototype.init=function(e){this.eventHandel=e;var t=this.config.mode;this.addListener(t)},e.prototype.addListener=function(e){var t=this;if("proxy-capturing"===e){if(this.config.click&&window.document.addEventListener("click",this.clickEvent,!0),this.config.change&&window.document.addEventListener("change",this.changeEvent,!0),this.config.submit&&window.document.addEventListener("submit",this.submitEvent,!0),this.config.pv){this.collect.on("route-change",function(e){var i=e.config,n=e.name;t.getPageViewEvent(i,n),t.pageView=!0});var i=setTimeout(function(){t.pageView||(t.getPageViewEvent(t.getDefaultConfig()),t.pageView=!0,clearTimeout(i))},2e3)}if(this.config.beat){try{"complete"===document.readyState?this.beatEvent(this.beatTime):window.addEventListener("load",function(){t.beatEvent(t.beatTime)});var n=0,o=null;window.addEventListener("scroll",function(){clearTimeout(o),o=setTimeout(r,500),n=document.documentElement.scrollTop||document.body.scrollTop});var r=function(){(document.documentElement.scrollTop||document.body.scrollTop)==n&&t.eventHandel({eventType:"dom",eventName:"beat"},{beat_type:1})}}catch(e){}try{var a=window.performance&&window.performance.getEntriesByType("paint");a&&a.length?(new PerformanceObserver(function(e){var i=e.getEntries(),n=i[i.length-1],o=n.renderTime||n.loadTime;t.statistics||(t.getPageLoadEvent(o),t.statistics=!0)}).observe({entryTypes:["largest-contentful-paint"]}),setTimeout(function(){t.statistics||(t.getPageLoadEvent(a[0].startTime||0),t.statistics=!0)},2e3)):this.getPageLoadEvent(0)}catch(e){this.getPageLoadEvent(0)}}}},e.prototype.removeListener=function(){window.document.removeEventListener("click",this.clickEvent,!0),window.document.removeEventListener("change",this.changeEvent,!0),window.document.removeEventListener("submit",this.submitEvent,!0)},e.prototype.beatEvent=function(e){var t=this;try{var i;this.eventHandel({eventType:"dom",eventName:"beat"},{beat_type:3}),this.beatTime&&(i=setInterval(function(){t.eventHandel({eventType:"dom",eventName:"beat"},{beat_type:2})},e)),g(function(){t.eventHandel({eventType:"dom",eventName:"beat",eventSend:"becon"},{beat_type:0}),t.beatTime&&clearInterval(i)})}catch(e){}},e.prototype.getDefaultConfig=function(){return{is_html:1,url:location.href,referrer:document.referrer,page_key:location.href,refer_page_key:document.referrer,page_title:document.title||location.pathname,page_manual_key:"",refer_page_manual_key:"",refer_page_title:"",page_path:location.pathname,page_host:location.host}},e}(),Rn={eventConfig:{mode:"proxy-capturing",submit:!1,click:!0,change:!1,pv:!0,beat:!0,hashTag:!1,impr:!1},scoutConfig:{mode:"xpath"}},xn=function(){function e(e,t){this.config=e,this.config.eventConfig=Object.assign(this.config.eventConfig,t)}return e.prototype.getConfig=function(){return this.config},e.prototype.setConfig=function(e){return this.config=e},e}();var Gn=function(e,t,i,o,r){return n(n({event:e},function(e,t,i,n){var o={},r=function(e){if(e){var t=e.getBoundingClientRect(),i=t.width,n=t.height;return{left:t.left,top:t.top,element_width:i,element_height:n}}}(t),a=function(e,t){void 0===e&&(e={}),void 0===t&&(t={});var i=e.clientX,n=e.clientY,o=t.left,r=t.top,a=i-o>=0?i-o:0,s=n-r>=0?n-r:0;return{touch_x:Math.floor(a),touch_y:Math.floor(s)}}(e,r),s=r.element_width,c=r.element_height,l=a.touch_x,u=a.touch_y,d=function(e){for(var t=[];null!==e.parentElement;)t.push(e),e=e.parentElement;var i=[],n=[];return t.forEach(function(e){var t=function(e){if(null===e)return{str:"",index:0};var t=0,i=e.parentElement;if(i)for(var n=i.children,o=0;o<n.length&&n[o]!==e;o++)n[o].nodeName===e.nodeName&&t++;return{str:[e.nodeName.toLowerCase(),Sn(e,"list")?"[]":""].join(""),index:t}}(e),o=t.str,r=t.index;i.unshift(o),n.unshift(r)}),{element_path:"/"+i.join("/"),positions:n}}(t),p=d.element_path,f=d.positions,g=function(e){var t=kn(e),i=[];return function e(t){var n=zn(t);if(n&&-1===i.indexOf(n)&&i.push(n),t.childNodes.length>0)for(var o=t.childNodes,r=0;r<o.length;r++)8!==o[r].nodeType&&e(o[r])}(t),i}(t),_=window.performance.timing.navigationStart,m=Date.now()-_,v=f.map(function(e){return""+e}),y=null;if(window.TEAVisualEditor&&window.TEAVisualEditor.getOriginXpath&&(y=window.TEAVisualEditor.getOriginXpath({xpath:p,positions:v})),o.element_path=y&&y.xpath||p,o.positions=y&&y.positions||v,n&&!n.text&&(o.texts=g,o.element_title=function(e){var t=kn(e),i="";return function e(t){var n=zn(t);if(n&&(i+=n),t.childNodes.length>0)for(var o=t.childNodes,r=0;r<o.length;r++)3===o[r].nodeType&&e(o[r])}(t),i}(t)),o.element_id=t.getAttribute("id")||"",o.element_class_name=t.getAttribute("class")||"",o.element_type=t.nodeType,o.element_width=Math.floor(s),o.element_height=Math.floor(c),o.touch_x=l,o.touch_y=u,o.page_manual_key="",o.elememt_manual_key="",o.since_page_start_ms=m,o.page_start_ms=_,o.page_path=location.pathname,o.page_host=location.host,i.track_attr&&function(e,t){return!!function(e,t){if("string"==typeof t)return Tn(e,t);if(h(t)){for(var i=!1,n=0;n<t.length;n++)if(Tn(e,t[n])){i=!0;break}return i}}(e,t)}(t,i.track_attr)){var b=function(e,t){var i={};if("string"==typeof t)Tn(e,t)&&(i.attrs=e.getAttribute(t));else if(h(t))for(var n=0;n<t.length;n++)Tn(e,t[n])&&(i[t[n]]=e.getAttribute(t[n]));return i}(t,i.track_attr);for(var E in b)o[E]=b[E]}var w=kn(t);return"A"===w.tagName&&(o.href=w.getAttribute("href")),"IMG"===t.tagName&&(o.src=t.getAttribute("src")),o}(t,i,o,r)),{is_html:1,page_key:window.location.href,page_title:document.title})},Mn=function(){function e(e,t){this.ignore={text:!0},this.initConfig=e,this.options=t,this.eventName=t&&"tea"===t.custom?{click:"__bav_click",page:"__bav_page",beat:"__bav_beat",static:"__bav_page_statistics",exposure:"__bav_page_exposure"}:{click:"bav2b_click",page:"bav2b_page",beat:"bav2b_beat",static:"bav2b_page_statistics",exposure:"bav2b_exposure"},t&&!0===t.text&&(this.ignore.text=!1),t&&t.exposure&&t.exposure.eventName&&(this.eventName.exposure=t.exposure.eventName)}return e.prototype.handleEvent=function(e,t){try{if(Dn(e.target))return null;var i="bav2b_click";switch(t){case"click":return i=e.target.getAttribute("data-applog-click-event")||this.eventName.click,Gn(i,e,e.target,this.options,this.ignore);case"change":return n(n({},Gn(i="bav2b_change",e,e.target,this.options)),function(e,t){try{if("bav2b_change"===e)return t.hasAttribute("data-tea-track")?{value:t.value}:{}}catch(e){return{}}}(i,e.target));case"submit":return Gn(i="bav2b_submit",e,e.target,this.options)}}catch(e){return console.error(e),null}},e.prototype.handleViewEvent=function(e){e.event=this.eventName.page,e.page_title=document.title,e.page_total_width=window.innerWidth,e.page_total_height=window.innerHeight;try{var t=window.sessionStorage.getItem("_tea_cache_duration");if(t){var i=JSON.parse(t);e.refer_page_duration_ms=i?i.duration:""}e.scroll_width=document.documentElement.scrollLeft?document.documentElement.scrollLeft+window.innerWidth:window.innerWidth,e.scroll_height=document.documentElement.scrollTop?document.documentElement.scrollTop+window.innerHeight:window.innerHeight,e.page_start_ms=window.performance.timing.navigationStart}catch(e){console.log("page event error "+JSON.stringify(e))}return e},e.prototype.handleStatisticsEvent=function(e){var t={};t.event=this.eventName.static,t.is_html=1,t.page_key=location.href,t.refer_page_key=document.referrer||"",t.page_title=document.title,t.page_manual_key=this.initConfig.autotrack.page_manual_key||"",t.refer_page_manual_key="";try{var i=e.lcp,n=window.performance.timing,o=n.loadEventEnd-n.navigationStart;t.page_init_cost_ms=parseInt(i||(o>0?o:0)),t.page_start_ms=n.navigationStart}catch(e){console.log("page_statistics event error "+JSON.stringify(e))}return t},e.prototype.handleBeadtEvent=function(e){e.event=this.eventName.beat,e.page_key=window.location.href,e.is_html=1,e.page_title=document.title,e.page_manual_key=this.initConfig.autotrack.page_manual_key||"";try{e.page_viewport_width=window.innerWidth,e.page_viewport_height=window.innerHeight,e.page_total_width=document.documentElement.scrollWidth,e.page_total_height=document.documentElement.scrollHeight,e.scroll_width=document.documentElement.scrollLeft+window.innerWidth,e.scroll_height=document.documentElement.scrollTop+window.innerHeight,e.since_page_start_ms=Date.now()-window.performance.timing.navigationStart,e.page_start_ms=window.performance.timing.navigationStart}catch(e){console.log("beat event error "+JSON.stringify(e))}return e},e.prototype.handleExposureEvent=function(e,t){if(Dn(t.target))return null;var i=Gn(e.event||this.eventName.exposure,t,t.target||t,this.options,this.ignore);if(i.$exposure_type=e.exposureType,this.options.exposure.callback){var n=this.options.exposure.callback(i);return n||Object.keys(n).length?n:(console.warn("exposure callback must return data!"),i)}return i},e.prototype.handleScrollEvent=function(e,t){var i=Gn(e.event||this.eventName.scroll,t,t.target||t,this.options,this.ignore);if(i=Object.assign(i,e.params),!this.options.scroll.callback||(i=this.options.scroll.callback(i))||Object.keys(i).length)return i;console.warn("scroll callback must return data!")},e}(),In=function(){function e(e){this.collect=e,this.eventNameList=["report_click_event","report_change_event","report_submit_event","report_exposure_event","report_page_view_event","report_page_statistics_event","report_beat_event"]}return e.prototype.send=function(e,t){var i=e.eventSend,n=t.event;delete t.event,i&&"becon"===i?this.collect.beconEvent(n,t):this.collect.event(n,t)},e.prototype.get=function(e,t){var i=Object.assign({headers:{"content-type":"application/json"},method:"GET"},t);fetch(e,i)},e.prototype.post=function(e,t){var i=Object.assign({headers:{"content-type":"application/json"},method:"POST"},t);fetch(e,i)},e}(),Cn=!1;var On,Bn=function(){function e(e,t){this._instance=null,this._intersection=e,this.config=t,this._intersection&&this.init()}return e.prototype.init=function(){var e=this;if(window.MutationObserver)try{if(this._instance=new MutationObserver(function(t){t.forEach(function(t){"attributes"===t.type&&e.attributeChangeObserve(t),"childList"===t.type&&e.modifyNodeObserve(t)})}),!document||!document.body)return void console.warn("please use sdk api init after body element");var t=!1!==this.config.autotrack.exposure.attributes;this._instance.observe(document.body,{childList:!0,attributes:t,subtree:!0,attributeOldValue:!1})}catch(e){console.log("your browser cannot support MutationObserver，so cannot report exposure event, please update")}else console.log("your browser cannot support MutationObserver，so cannot report exposure event, please update")},e.prototype.attributeChangeObserve=function(e){e.target.hasAttribute("data-exposure")?this.exposureAdd(e,"mutation"):this.exposureRemove(e)},e.prototype.modifyNodeObserve=function(e){var t=this;Array.prototype.forEach.call(e.addedNodes,function(e){1===e.nodeType&&e.hasAttribute("data-exposure")&&t.exposureAdd(e,"intersect"),t.mapChild(e,t.exposureAdd.bind(t))}),Array.prototype.forEach.call(e.removedNodes,function(e){1===e.nodeType&&e.hasAttribute("data-exposure")&&t.exposureRemove(e),t.mapChild(e,t.exposureRemove.bind(t))})},e.prototype.mapChild=function(e,t){var i=this;1===e.nodeType&&e.children.length&&Array.prototype.forEach.call(e.children,function(e){1===e.nodeType&&e.hasAttribute("data-exposure")&&t(e),i.mapChild(e,t)})},e.prototype.exposureAdd=function(e,t){try{this._intersection&&this._intersection.exposureAdd(e,t)}catch(e){console.log("intersection error",JSON.stringify(e.message))}},e.prototype.exposureRemove=function(e){try{this._intersection&&this._intersection.exposureRemove(e)}catch(e){console.log("intersection error",JSON.stringify(e.message))}},e._exposure_observer=null,e}();!function(e){e[e.EXPOSURE_ONCE=0]="EXPOSURE_ONCE",e[e.LIFECYCLE_SHOW_NEW=3]="LIFECYCLE_SHOW_NEW",e[e.RESUME_FORM_PAGE=6]="RESUME_FORM_PAGE",e[e.RESUME_FORM_BACK=7]="RESUME_FORM_BACK",e[e.NOT_EXPOSURE=-1]="NOT_EXPOSURE"}(On||(On={}));var Un,Nn=function(){function e(t,i,n){var o=this;this.backStatus=!1,this.instance=this.buildObserver(),this.collect=t,this.observeMap=e._observer_map,i.autotrack.exposure.ratio?this.ratio=i.autotrack.exposure.ratio:0===i.autotrack.exposure.ratio?this.ratio=0:this.ratio=.5,this.timeLimit=i.autotrack.exposure.stay||0,this.exposureType=On.NOT_EXPOSURE,this.eventHandle=n,this.hashMap=new Map,this.backStatus=!1,this.lastState=null,this.collect.on("re-start-sdk",function(){o.visibilitychange()}),this.addListen()}return e.prototype.buildObserver=function(){var t=this;if(e._observer_instance)return console.log("your browser cannot support IntersectionObserver， so cannot report exposure event, please update"),null;if(window.IntersectionObserver){for(var i=[],n=0;n<=1;n+=.01)i.push(n);i.push(1);try{e._observer_instance=new IntersectionObserver(function(e){e.forEach(function(e){var i=e.target.observeId,n=t.observeMap.get(i),o=(e.target,e.isIntersecting,e.intersectionRatio);if(n.intersectionRatio=o,o<=.1&&(e.target.backStatus=!1),t.observeMap.set(i,n),o<t.ratio)return n.isIntersecting=!1,n.added=!1,n.exposured=!1,n.startTime=Date.now(),void t.observeMap.set(i,n);if(!n.added){if(n.startTime=Date.now(),n.added=!0,n.isIntersecting=!0,t.timeLimit){var r=setTimeout(function(){try{if(n.isIntersecting&&!n.exposured&&t.observeMap.get(i)){var o=t.observeMap.get(i).intersectionRatio;t.exposureEvent(e,o,i,n)}}catch(e){console.log("IntersectionObserver setTimeout error，msg: "+JSON.stringify(e))}},t.timeLimit);n.wait=r}t.observeMap.set(i,n)}Date.now()-n.startTime>=t.timeLimit&&!n.exposured&&t.exposureEvent(e,o,i,n)})},{threshold:i})}catch(e){console.log("IntersectionObserver error，msg: "+JSON.stringify(e))}return e._observer_instance}return console.log("your browser cannot support IntersectionObserver， so cannot report exposure event, please update"),null},e.prototype.exposureAdd=function(e,t){var i="mutation"===t?e.target:e,n=i.observeId,o=ne();if(n||this.observeMap.has(n)){var r=this.observeMap.get(n);if(r&&i!==r.instance)this.unobserve(i),this.observeMap.delete(n),i.observeId=o,i.visible=!1,this.observeMap.set(o,{instance:i.cloneNode(!0),isIntersecting:!1}),this.observe(i);else{if(!0===i.visible)return;this.handleBoundingExposure(i)}}else i.observeId=o,i.visible=!1,this.observeMap.set(o,{instance:i.cloneNode(!0),isIntersecting:!1}),this.observe(i)},e.prototype.exposureRemove=function(e){this.observeMap.has(e.observeId)&&(this.observeMap.delete(e.observeId),this.unobserve(e),e.observeId="",e.visible=!1)},e.prototype.exposureEvent=function(e,t,i,n){if(t>=this.ratio){if("0"===e.target.style.opacity||"hidden"===e.target.style.visibility)return;if(!0===n.exposured)return;n.startWait&&clearTimeout(n.startWait);var o=e.target.getAttribute("data-applog-exposure-event");this.eventHandle({eventType:"dom",eventName:"exposure",event:o,exposureType:this.getExposureType(e.target)},e),e.target.visible=!0,e.target.hasExposure=!0,n.startTime=Date.now(),n.exposured=!0}else n.startTime=Date.now(),n.exposured=!1;this.observeMap.set(i,n)},e.prototype.observe=function(e){this.instance&&this.instance.observe(e)},e.prototype.unobserve=function(e){this.instance&&this.instance.unobserve(e)},e.prototype.getExposureDomToExposure=function(){var e=this;Array.prototype.forEach.call(document.querySelectorAll("[data-exposure]"),function(t){e.handleBoundingExposure(t)})},e.prototype.visibilitychange=function(){var e=this,t=null;"visible"===document.visibilityState?this.timeLimit?t=setTimeout(function(){e.getExposureDomToExposure()},this.timeLimit):this.getExposureDomToExposure():(clearTimeout(t),this.customType=void 0)},e.prototype.handleBoundingExposure=function(e){if(this.getBoundingRatio(e)>=this.ratio){e.visible=!0;var t=e.getAttribute&&e.getAttribute("data-exposure-event");this.eventHandle({eventType:"dom",eventName:"exposure",event:t,exposureType:this.customType||On.RESUME_FORM_BACK},e)}},e.prototype.getBoundingRatio=function(e){var t=e.getBoundingClientRect(),i=t.top,n=t.left,o=t.width,r=t.height,a=window.innerWidth||document.documentElement.clientWidth,s=window.innerHeight||document.documentElement.clientHeight;return i>=0&&n>=0&&i<=s&&n<=a?(o>a?a:o)*(s-i)/(o*r):0},e.prototype.getExposureType=function(e){return e.visible?!1!==e.backStatus&&(this.backStatus||this.customType||2===window.performance.navigation.type)?this.exposureType=On.RESUME_FORM_PAGE:this.exposureType=On.LIFECYCLE_SHOW_NEW:(e.hasExposure,!1!==e.backStatus&&(this.backStatus||this.customType||2===window.performance.navigation.type)?this.exposureType=On.RESUME_FORM_PAGE:this.exposureType=On.EXPOSURE_ONCE),this.exposureType},e.prototype.addListen=function(){var e=this;this.collect.on("set-exposure-type",function(t){e.customType=t});var t,i,n,o=this.visibilitychange.bind(this);return t=document,i="visibilitychange",n=o,t.addEventListener?t.addEventListener(i,n,!1):t.attachEven?t.attachEven("on"+i,n):t["on"+i]=n,window.addEventListener("hashchange",function(t){var i=e.hashMap.get(t.oldURL);i&&location.href===i.prev?(e.backStatus=!0,e.exposureType=On.RESUME_FORM_PAGE):(e.backStatus=!1,e.hashMap.set(location.href,{current:t.newURL,prev:t.oldURL}))}),this.collect.on("STATE_CHANGE",function(t){e.lastState=t}),window.addEventListener("popstate",function(t){var i=t.state;i&&i.current&&e.lastState&&e.lastState.back&&i.current===e.lastState.back?(e.backStatus=!0,e.exposureType=On.RESUME_FORM_PAGE):e.backStatus=!1}),function(){!function(e,t,i){e.addEventListener?e.removeEventListener(t,i,!1):e.attachEven&&e.detachEven("on"+t,i)}(document,"visibilitychange",o)}},e._observer_instance=null,e._observer_map=new Map,e}(),Ln=function(){function e(e,t,i){t.autotrack&&t.autotrack.exposure&&(this._intersection=new Nn(e,t,i),this._observer=new Bn(this._intersection,t),this._intersection&&this._observer?this.initObserver():console.log("your browser version cannot support exposure event, please update~"))}return e.prototype.initObserver=function(){var e=this;Array.prototype.forEach.call(document.querySelectorAll("[data-exposure]"),function(t){e._intersection.exposureAdd(t,"intersect")})},e}();!function(e){e[e.SCROLL_UP=1]="SCROLL_UP",e[e.SCROLL_DOWN=2]="SCROLL_DOWN",e[e.SCROLL_LEFT=3]="SCROLL_LEFT",e[e.SCROLL_RIGHT=4]="SCROLL_RIGHT",e[e.NOT_SCROLL=-1]="NOT_SCROLL"}(Un||(Un={}));var Pn,jn=function(){function e(e,t){this.distance=30,e.autotrack&&e.autotrack.scroll&&(e.autotrack.scroll.distance&&(this.distance=e.autotrack.scroll.distance),this.eventHandle=t,this.addLinstenr(),this.mutation())}return e.prototype.addLinstenr=function(){var e=this;Array.prototype.forEach.call(document.querySelectorAll("[data-scroll]"),function(t){e.scrollHandle(t)})},e.prototype.mutation=function(){var e=this;if(window.MutationObserver)try{var t=new MutationObserver(function(t){t.forEach(function(t){"childList"===t.type&&e.modifyNodeObserve(t)})});if(!document||!document.body)return void console.warn("please use sdk api init after body element");t.observe(document.body,{childList:!0,attributes:!0,subtree:!0,attributeOldValue:!1})}catch(e){console.log("your browser cannot support MutationObserver")}else console.log("your browser cannot support MutationObserver")},e.prototype.modifyNodeObserve=function(e){var t=this;Array.prototype.forEach.call(e.addedNodes,function(e){1===e.nodeType&&e.hasAttribute("data-scroll")&&t.scrollHandle(e),t.mapChild(e,t.scrollHandle.bind(t))}),Array.prototype.forEach.call(e.removedNodes,function(e){1===e.nodeType&&e.hasAttribute("data-scroll")&&t.scrollHandle(e,"remove"),t.mapChild(e,t.scrollHandle.bind(t))})},e.prototype.mapChild=function(e,t){var i=this;1===e.nodeType&&e.children.length&&Array.prototype.forEach.call(e.children,function(e){1===e.nodeType&&e.hasAttribute("data-scroll")&&t(e),i.mapChild(e,t)})},e.prototype.scrollHandle=function(e,t){var i=this;try{var n=e.scrollTop,o=e.scrollLeft,r=null,a=0,s=0,c=function(t){clearTimeout(r),r=setTimeout(function(){var r=e.scrollTop,h=e.scrollLeft,d=t.target&&t.target.getAttribute("data-scroll-event")||"";1===u||2===u?r===c&&(s=c-n,Math.abs(s)>=i.distance&&i.distance&&i.eventHandle({eventType:"dom",eventName:"scroll",event:d,params:{$direction:u,$offsetY:s,$offsetX:a}},t)):3!==u&&4!==u||h===l&&(a=l-o,Math.abs(a)>=i.distance&&i.distance&&i.eventHandle({eventType:"dom",eventName:"scroll",event:d,params:{$direction:u,$offsetY:s,$offsetX:a}},t)),n=c,o=l},100);var c=e.scrollTop,l=e.scrollLeft,u=Un.NOT_SCROLL;c>n?u=Un.SCROLL_DOWN:c<n?u=Un.SCROLL_UP:l>o?u=Un.SCROLL_LEFT:l<o&&(u=Un.SCROLL_RIGHT)};return"remove"===t?e.removeEventListener("scroll",c,!1):e.addEventListener("scroll",c,!1),function(){e.removeEventListener("scroll",c,!1)}}catch(e){console.warn("scroll event error",JSON.stringify(e))}},e}(),Vn={hashTag:!1,impr:!1},Kn=function(){function e(){}return e.prototype.apply=function(e,t){if(this.autoTrackStart=!1,this.collect=e,this.config=t,t.autotrack){var i=e.Types;this.ready(i.Autotrack),this.collect.emit(i.AutotrackReady)}},e.prototype.ready=function(e){this.collect.set(e);var t=this.config.autotrack;t="object"==typeof t?t:{},t=Object.assign(Vn,t),this.destroyed=!1,this.options=t,this.Config=new xn(Rn,this.options),this.Exposure=new Ln(this.collect,this.config,this.handle.bind(this)),this.Scroll=new jn(this.config,this.handle.bind(this)),this.Listener=new An(t,this.collect,this.Config),this.EventHandle=new Mn(this.config,t),this.Request=new In(this.collect),this.autoTrackStart=!0,this.init(),function(e,t){window.TEAVisualEditor=window.TEAVisualEditor||{},window.TEAVisualEditor.appId=t.app_id;var i,n,o,r=t.channel_domain,a="";if((i=H).length&&i.forEach(function(e){hn.push(e)}),r){var s=void 0,c="";try{var l=window.performance.getEntriesByType("resource");if(l&&l.length&&(l.forEach(function(e){"script"===e.initiatorType&&e.name&&-1!==e.name.indexOf("collect")&&(c=e.name)}),c&&(s=c.split("/"))&&s.length)){a="https:/";for(var u=2;u<s.length&&u!==s.length-1;u++)a=a+"/"+s[u];if(a&&a.indexOf("/5.0")){var h=a.split("/5.0");a=h[0]||a}}}catch(e){}}window.addEventListener("message",pn,!1);try{o=function(i){var n=i.data.app_id;n&&n!==t.app_id||function(e){var t,i,n,o,r=e.event,a=e.autoTrackInstance;Cn||(Cn=!0,t=e.editorUrl,i=function(){dn(r,"editorScriptloadSuccess"),a.destroy()},n=function(){r&&dn(r,"editorScriptloadError"),Cn=!1},(o=document.createElement("script")).src=t,o.onerror=function(){n()},o.onload=function(){i()},document.getElementsByTagName("head")[0].appendChild(o))}({event:i,editorUrl:"https://sf16-website-login.neutral.ttwstatic.com/obj/tiktok_web_login_static/log-sdk/collect/heatmap-core.js?query="+Date.now(),autoTrackInstance:e})},un[n="tea:openHeatMapCore"]=un[n]||[],un[n].push(o)}catch(e){console.log("openHeatMapCore error")}}(this,this.config)},e.prototype.init=function(){this.Listener.init(this.handle.bind(this)),"base"===this.collect.loadType&&(window.opener||window.parent).postMessage("[tea-sdk]ready","*")},e.prototype.handle=function(e,t){try{if(this.config.autotrack.collect_url&&!this.config.autotrack.collect_url())return}catch(e){}"dom"===e.eventType&&this.handleDom(e,t)},e.prototype.handleDom=function(e,t){try{var i=e.eventName;if("click"===i||"change"===i||"submit"===i)(a=this.EventHandle.handleEvent(t,i))&&this.Request.send({eventType:"custom"},a);else if("page_view"===i||"page_statistics"===i){var n;(n="page_view"===i?this.EventHandle.handleViewEvent(t):this.EventHandle.handleStatisticsEvent(t))&&this.Request.send({eventType:"custom"},n)}else if("beat"===i){var o=this.EventHandle.handleBeadtEvent(t),r=e.eventSend;o&&this.Request.send({eventType:"custom",eventSend:r},o)}else if("exposure"===i)(a=this.EventHandle.handleExposureEvent(e,t))&&this.Request.send({eventType:"custom"},a);else if("scroll"===i){var a;(a=this.EventHandle.handleScrollEvent(e,t))&&this.Request.send({eventType:"custom"},a)}}catch(e){console.log("handel dom event error "+JSON.stringify(e))}},e.prototype.destroy=function(){if(!this.autoTrackStart)return console.warn("engine is undefined, make sure you have called autoTrack.start()");this.autoTrackStart=!1,this.Listener.removeListener()},e}();!function(e){e.Net="net",e.FailNet="f_net",e.FailData="f_data"}(Pn||(Pn={}));var qn={pv:["predefine_pageview"],sdk:["_be_active","predefine_page_alive","predefine_page_close","__profile_set","__profile_set_once","__profile_increment","__profile_unset","__profile_append"],autotrack:["bav2b_click","bav2b_page","bav2b_beat","bav2b_page_statistics","__bav_click","__bav_page","__bav_beat","__bav_page_statistics"]},Hn=function(){function e(){}return e.prototype.apply=function(e,t){var i=this;if(this.ready=t.app_id&&t.enable_tracer&&!t.disable_track_event,this.ready){this.limit={pv:1,sdk:3,autotrack:3,log:3},this.errorCode={f_net:0,f_data:0},this.tracerCache=new Map,this.collect=e,this.appid=t.app_id,this.reportUrl=e.configManager.getUrl("event");var n=this.collect.Types;e.adapters.fetch,this.collect.on(n.Event,function(e){h(e)?e.forEach(function(e){i.addCount("log")}):i.addCount("log")}),this.collect.on(n.SubmitError,function(e){var t=e.type,n=e.eventDate,o=e.errorCode,r=e.response;i.addErrorCount(n,t,o,r)}),this.listener(),this.collect.emit(n.TracerReady)}},e.prototype.addCount=function(e,t,i){void 0===t&&(t="net"),void 0===i&&(i=1);try{this.tracerCache||(this.tracerCache=new Map);var n=void 0;if(this.tracerCache.has(e))(o=this.tracerCache.get(e)).has(t)?(n=o.get(t).params.count,n++,o.set(t,this.processTracer(n,e,t))):(n=i,o.set(t,this.processTracer(i,e,t)));else{var o=new Map;n=i,o.set(t,this.processTracer(i,e,t)),this.tracerCache.set(e,o)}"net"===t&&n>=this.limit[e]&&this.report(!1)}catch(e){console.log(e)}},e.prototype.addErrorCount=function(e,t,i,n){var o=this;try{if(e&&e.length){var r=e[0].events;r&&r.length&&("f_data"===t?(n&&n.hasOwnProperty("sc")?this.addCount("log",t,r.length-n.sc):this.addCount("log",t,r.length),this.errorCode[t]=i):r.forEach(function(e){var n="log";for(var r in qn)if(-1!==qn[r].indexOf(e.event)){n=r;break}o.addCount(n,t,1),o.errorCode[t]=i}))}}catch(e){}},e.prototype.report=function(e){if(this.tracerCache){var t=[];this.tracerCache.forEach(function(e){console.log(e),e.forEach(function(e){t.push(e)})}),t&&t.length&&this.sendTracer(t,e)}},e.prototype.sendTracer=function(e,t){try{var i=this.collect.eventManager.merge(e);this.collect.requestManager.useRequest({url:this.reportUrl,data:i,useBeacon:t}),this.tracerCache=null}catch(e){}},e.prototype.processTracer=function(e,t,i){try{var n={count:e,state:i,key:t,params_for_special:"applog_trace",aid:this.appid,platform:"web",_staging_flag:1,sdk_version:"5.3.9_oversea"};"f_net"!==i&&"f_data"!==i||(n.errorCode=this.errorCode[i]);var o=this.collect.processEvent("applog_trace",n);if(o&&o.event)return delete o.is_bav,o}catch(e){console.warn("something error")}},e.prototype.listener=function(){var e=this;document.addEventListener("visibilitychange",function(){"hidden"===document.visibilityState&&e.leavePage()}),g(function(){e.leavePage()})},e.prototype.leavePage=function(){this.report(!0)},e}(),Fn=function(){function e(){this.retryWaitTime=3e3,this.retryStatus=!1,this.retryCacheStatus=!1}return e.prototype.apply=function(e,t){var i=this;if(t.enable_storage&&!t.disable_storage&&(this.collect=e,this.config=t,!this.collect.destroy)){var n=e.Types,o=e.adapters.storage;this.storage=new o(!1),this.eventUrl=this.collect.configManager.getUrl("event"),this.eventKey="__tea_cache_events_"+t.app_id,this.storageNum=t.storage_num||50,this.retryNum=t.retry_num||3,this.retryInterval=1e3,e.on(n.SubmitError,function(e){"f_data"!==e.type&&i.storeData(e)}),e.on(n.Ready,function(){i.checkStorage()})}},e.prototype.retryRightNow=function(e){var t=this;if(this.retryStatus)this.errorCache.push(e);else{var i=0;this.retryStatus=!0;var n=setInterval(function(){if(3===i)return t.storeData(t.errorCache),t.retryStatus=!1,void clearInterval(n);var o=e.eventData;t.fetchData(o,function(){t.retryStatus=!1,clearInterval(n),t.retryCacheStatus&&t.errorCache.splice(0,1),t.errorCache.length&&(t.retryCacheStatus=!0,t.retryRightNow(t.errorCache[0]))},function(){i++})},this.retryInterval)}},e.prototype.storeData=function(e){var t=this.storage.getItem(this.eventKey),i=e.eventData;Object.keys(t).length!==this.storageNum&&(t[Date.now()]=i,this.storage.setItem(this.eventKey,t))},e.prototype.checkStorage=function(){var e=this;try{if(!window.navigator.onLine)return;var t=this.storage.getItem(this.eventKey);if(!t||!Object.keys(t).length)return;var i={events:[{event:"ontest",params:{app_id:this.config.app_id},local_time_ms:Date.now()}],user:{user_unique_id:this.collect.configManager.get("web_id")},header:{}};this.fetchData([i],function(){var i=JSON.parse(JSON.stringify(t)),n=function(n){e.fetchData(t[n],function(){delete i[n],e.storage.setItem(e.eventKey,i)},function(){},!1)};for(var o in t)n(o)},function(){},!0)}catch(e){console.warn("error check storage")}},e.prototype.fetchData=function(e,t,i,n){this.collect.requestManager.useRequest({url:this.eventUrl,data:e,timeout:3e4,success:t,fail:i,app_key:n?"566f58151b0ed37e":""})},e}(),Jn="undefined"!=typeof window?(window.LogPluginObject||(window.LogPluginObject={}),window.LogPluginObject):null,Wn=function(){function e(){}return e.prototype.apply=function(e,t){this._plugin={},this.config=t,this.collect=e,this.channel=t.channel||"cn",this.loadExtend()},e.prototype.loadExtend=function(){var e=this;try{this.collect.remotePlugin.forEach(function(t,i){if("sdk"===t)if(sn.hasOwnProperty(i)){var n=sn[i].object,o=""+sn[i].src[e.channel];e.exist(i,n,o)}else console.warn("your "+i+" is not exist，please check plugin name");else"object"==typeof t&&(t.src?e.exist(i,t.call,t.src):e.process(i,t.instance,"INSTANCE"))})}catch(e){this.collect.emit(S.DEBUGGER_MESSAGE,{type:S.DEBUGGER_MESSAGE_SDK,info:"LoadExtend Fail",level:"error",time:Date.now(),data:e.message}),console.log("load extend error")}},e.prototype.exist=function(e,t,i){var n=this;Jn[t]?(this.process(e,Jn[t]),console.log("already has "+e+" plugin~")):this.loadPlugin(e,i,function(){n.process(e,Jn[t]),console.log(" %c %s %s %s","color: yellow; background-color: black;","–","load plugin:"+e+" success","-")},function(){console.log(" %c %s %s %s","color: red; background-color: yellow;","–","load plugin:"+e+" error","-")})},e.prototype.process=function(e,t,i){try{if(i){var n=new t;n.apply&&n.apply(this.collect,this.config),console.log("excude "+e+" success")}else t&&t(this.collect,this.config)}catch(t){this.collect.emit(S.DEBUGGER_MESSAGE,{type:S.DEBUGGER_MESSAGE_SDK,info:"Extend Process Fail",level:"error",time:Date.now(),data:t.message}),console.log("excude "+e+" error, message:"+t.message)}},e.prototype.loadPlugin=function(e,t,i,n){var o=this;try{var r=document.createElement("script");r.src=t,this._plugin[e]||(this._plugin[e]=[]),this._plugin[e].push(i),r.onerror=function(){n(t)},r.onload=function(){o._plugin[e].forEach(function(e){e()})},document.getElementsByTagName("head")[0].appendChild(r)}catch(e){this.collect.emit(S.DEBUGGER_MESSAGE,{type:S.DEBUGGER_MESSAGE_SDK,info:"Extend LoadPlugin Fail",level:"error",time:Date.now(),data:e.message})}},e}(),Zn=function(){function e(){this.autotrack=!1,this.spa=!1,this.cache={},this.allowHash=!1}return e.prototype.apply=function(e,t){if(t.spa||t.autotrack){var i=e.Types;this.collect=e,this.config=t,this.appid=t.app_id,this.allowHash=t.allow_hash,this.fncArray=new Map,this.setKey(),this.setLocation(),this.hack(),this.init(),this.listener(),e.emit(i.RouteReady)}},e.prototype.setKey=function(){var e=this.collect.adapters.storage;this.storage=new e(!1),this.cache_key="__tea_cache_refer_"+this.appid,this.cache={refer_key:"",refer_title:document.title||location.pathname,refer_manual_key:"",routeChange:!1},this.config.autotrack&&"object"==typeof this.config.autotrack&&this.config.autotrack.page_manual_key&&(this.cache.refer_manual_key=this.config.autotrack.page_manual_key),this.storage.setItem(this.cache_key,this.cache)},e.prototype.hack=function(){var e=this,t=window.history.pushState;history.pushState=function(i){for(var n=[],o=1;o<arguments.length;o++)n[o-1]=arguments[o];"function"==typeof history.onpushstate&&history.onpushstate({state:i});var r=t.call.apply(t,s([history,i],n));if(e.collect.sdkStop||e.collect.destroy)return r;if(!(e.lastLocation===location.href||e.config.disable_spa_query&&e.pathEquel())){e.setReferCache(e.lastLocation);var a=e.getPopStateChangeEventData();return e.lastLocation=location.href,e.sendPv(a,"pushState"),r}};var i=history.replaceState;history.replaceState=function(t){for(var n=[],o=1;o<arguments.length;o++)n[o-1]=arguments[o];"function"==typeof history.onreplacestate&&history.onreplacestate({state:t});var r=i.call.apply(i,s([history,t],n));if(e.collect.sdkStop||e.collect.destroy)return r;if(!(e.lastLocation===location.href||e.config.disable_spa_query&&e.pathEquel())){e.setReferCache(e.lastLocation);var a=e.getPopStateChangeEventData();return e.lastLocation=location.href,e.sendPv(a),r}}},e.prototype.setLocation=function(){"undefined"!=typeof window&&(this.lastLocation=window.location.href)},e.prototype.getLocation=function(){return this.lastLocation},e.prototype.pathEquel=function(){try{return new URL(this.lastLocation).origin+new URL(this.lastLocation).pathname===new URL(location.href).origin+new URL(location.href).pathname}catch(e){return!1}},e.prototype.init=function(){var e=this.getPopStateChangeEventData();this.collect.emit("route-change",{config:e,init:!0})},e.prototype.listener=function(){var e=this;window.addEventListener("hashchange",function(t){if(!e.collect.sdkStop&&!e.collect.destroy&&e.lastLocation!==window.location.href&&(!e.config.disable_spa_query||!e.pathEquel())&&e.allowHash){e.setReferCache(e.lastLocation),e.lastLocation=window.location.href;var i=e.getPopStateChangeEventData();e.sendPv(i)}}),window.addEventListener("popstate",function(t){if(!e.collect.sdkStop&&!e.collect.destroy&&!(e.lastLocation===window.location.href||e.config.disable_spa_query&&e.pathEquel())){e.setReferCache(e.lastLocation),e.lastLocation=window.location.href;var i=e.getPopStateChangeEventData();e.sendPv(i)}})},e.prototype.getPopStateChangeEventData=function(){var e=this.pageConfig();return e.is_back=0,e},e.prototype.pageConfig=function(){try{var e,t=this.storage.getItem(this.cache_key)||{},i=this.storage.getItem("__tea_cache_first_"+this.appid);return e=!i||1!=i,{is_html:1,url:location.href,referrer:this.handleRefer(),page_key:location.href,refer_page_key:this.handleRefer(),page_title:document.title||location.pathname,page_manual_key:this.config.autotrack&&this.config.autotrack.page_manual_key||"",refer_page_manual_key:t&&t.refer_manual_key||"",refer_page_title:t&&t.refer_title||"",page_path:location.pathname,page_host:location.host,is_first_time:""+e}}catch(t){return this.collect.emit(S.DEBUGGER_MESSAGE,{type:S.DEBUGGER_MESSAGE_SDK,info:"something error",level:"error",time:Date.now(),data:t.message}),{}}},e.prototype.sendPv=function(e,t){this.collect.emit("route-change",{config:e,init:!1})},e.prototype.handleRefer=function(){var e="";try{var t=this.storage.getItem(this.cache_key)||{};e=t.routeChange?t.refer_key:this.collect.configManager.get("referrer")}catch(t){e=document.referrer}return e},e.prototype.setReferCache=function(e){var t=this.storage.getItem(this.cache_key)||{};t.refer_key=e,t.routeChange=!0,this.storage.setItem(this.cache_key,t)},e}(),Xn=function(){function e(){}return e.prototype.apply=function(e,t){var i=this;this.collect=e,this.config=t;var n=e.Types;e.on(n.TrackDurationStart,function(e){i.trackEventStart(e)}),e.on(n.TrackDurationEnd,function(e){i.trackEventEnd(e)}),e.on(n.TrackDurationPause,function(e){i.trackEventPause(e)}),e.on(n.TrackDurationResume,function(e){i.trackEventResume(e)}),this.Types=n,this.TrackEventMap=new Map,this.ready(n.TrackDuration)},e.prototype.ready=function(e){var t=this;if(this.collect.set(e),this.collect.hook._hooksCache.hasOwnProperty(e)){var i=this.collect.hook._hooksCache[e];if(!Object.keys(i).length)return;var n=function(e){i[e].length&&i[e].forEach(function(i){t.collect.hook.emit(e,i)})};for(var o in i)n(o)}},e.prototype.trackEventStart=function(e){this.TrackEventMap.set(e,{startTime:Date.now(),isPause:!1,pauseTime:0,resumeTime:0})},e.prototype.trackEventEnd=function(e){var t=e.eventName,i=e.params;if(this.TrackEventMap.has(t)){var n,o=this.TrackEventMap.get(t);n=o.isPause?o.pauseTime-o.startTime:o.resumeTime?o.pauseTime-o.startTime+(Date.now()-o.resumeTime):Date.now()-o.startTime;var r=Object.assign(i,{event_duration:n});this.collect.event(t,r),this.cleanEventTrack(t)}},e.prototype.trackEventPause=function(e){if(this.TrackEventMap.has(e)){var t=this.TrackEventMap.get(e);t.isPause||(t.isPause=!0,t.pauseTime=Date.now(),this.TrackEventMap.set(e,t))}},e.prototype.trackEventResume=function(e){if(this.TrackEventMap.has(e)){var t=this.TrackEventMap.get(e);t.isPause&&(t.isPause=!1,t.resumeTime=Date.now(),this.TrackEventMap.set(e,t))}},e.prototype.cleanEventTrack=function(e){this.TrackEventMap.delete(e)},e}();ln.usePlugin(Wn,"extend"),ln.usePlugin(mn,"et"),ln.usePlugin(Fn,"retry"),ln.usePlugin(_n,"ab"),ln.usePlugin(bn,"stay"),ln.usePlugin(Kn,"autotrack"),ln.usePlugin(Xn,"trackeventduration"),ln.usePlugin(En,"heartbeat"),ln.usePlugin(wn,"monitor"),ln.usePlugin(Zn,"route"),ln.usePlugin(Hn,"tracer");var $n=new ln("default"),Yn=ln;const Qn=$n}}]);